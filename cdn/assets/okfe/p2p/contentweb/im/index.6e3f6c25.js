"use strict";(self.webpackChunkp2p=self.webpackChunkp2p||[]).push([[7473],{12799:()=>{},98911:(e,n,t)=>{t.d(n,{C:()=>k,D:()=>p,G:()=>_,I:()=>s,L:()=>E,S:()=>M,U:()=>c,a:()=>A,b:()=>d,c:()=>m,d:()=>f,e:()=>g,f:()=>v,g:()=>h,h:()=>b,i:()=>I,j:()=>l,k:()=>S,l:()=>y,m:()=>C});var r=t(23029),a=t(92901),o=t(84854),i=t(57394),s="/priapi/v1/im",c="/v3/users/im";function u(e){return e.split("").reverse().join("").replaceAll("*","").replaceAll("=",":").replaceAll(")","/").replaceAll("|","-").replaceAll(",",".")}var l=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0]?"/ws/v1/im/an/web":"/ws/v1/im/web";if(!(0,i.$)()){var n=window.localStorage.getItem("ok_im_ws_local_override");if(n)return n;if(/(localhost|127\.0\.0\.1)/.test(window.location.host))return"".concat("wss://wspribeta.okex.org").concat(e)}var t=window.localStorage.getItem("dev_ct_wsPress");return(null==t?void 0:t.startsWith(u("1,0,0,7*2*1))=sw")))||(null==t?void 0:t.startsWith(u("moc,gko,retem|eciffo))=ssw")))?t:"".concat(o.A.socketBaseUrls.im).concat(e)},d="".concat(s,"/conversation/v1/ids"),m="".concat(s,"/conversation/v1/list"),f="".concat(s,"/conversation/v1/update"),p="".concat(s,"/conversation/v1/delete-conversation"),v="".concat(s,"/group/member/v1/list"),h="".concat(s,"/group/v1/info"),g="".concat(s,"/relation/v1/init"),_="".concat(s,"/relation/v1/info"),A="".concat(s,"/relation/v1/list"),E="".concat(s,"/contact/v1/list-with-remarks"),b="".concat(s,"/auth/v1/token"),C="".concat(s,"/user/info/v1/query"),y="".concat(s,"/user/privacy/v1/update"),S="".concat(s,"/qrcode/v1/retrieve"),M="".concat(s,"/media/v1/upload"),I="".concat(s,"/grayscale/v1"),k=function(){return(0,a.A)((function e(n){(0,r.A)(this,e),this.driver=n}),[{key:"imStore",get:function(){return this.driver.imStore}},{key:"imHttp",get:function(){return this.driver.imHttp}},{key:"imWS",get:function(){return this.driver.imWS}},{key:"imConfig",get:function(){return this.driver.initConfig}},{key:"userInfo",get:function(){return this.driver.userInfo}},{key:"emitter",get:function(){return this.driver.emitter}},{key:"cache",get:function(){return this.driver.cache}}])}()},6564:(e,n,t)=>{t.d(n,{I:()=>a});var r=t(41594),a=function(e){var n=e.size,t=void 0===n?20:n,a=e.color,o=void 0===a?"currentColor":a;return r.createElement("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:o},r.createElement("path",{d:"M8.58011 4.62H8.40011C8.49911 4.62 8.58011 4.539 8.58011 4.44V4.62H15.4201V4.44C15.4201 4.539 15.5011 4.62 15.6001 4.62H15.4201V6.24H17.0401V4.44C17.0401 3.64575 16.3944 3 15.6001 3H8.40011C7.60586 3 6.96011 3.64575 6.96011 4.44V6.24H8.58011V4.62ZM19.9201 6.24H4.08011C3.68186 6.24 3.36011 6.56175 3.36011 6.96V7.68C3.36011 7.779 3.44111 7.86 3.54011 7.86H4.89911L5.45486 19.6275C5.49086 20.3948 6.12536 21 6.89261 21H17.1076C17.8771 21 18.5094 20.397 18.5454 19.6275L19.1011 7.86H20.4601C20.5591 7.86 20.6401 7.779 20.6401 7.68V6.96C20.6401 6.56175 20.3184 6.24 19.9201 6.24ZM16.9344 19.38H7.06586L6.52136 7.86H17.4789L16.9344 19.38Z",fill:o}))}},25721:(e,n,t)=>{t.d(n,{I:()=>o});var r=t(23029),a=t(92901),o=function(){return(0,a.A)((function e(n){(0,r.A)(this,e),this.name=n}),[{key:"connect",value:function(){return Promise.resolve()}}])}()},54997:(e,n,t)=>{t.r(n),t.d(n,{default:()=>T});var r=t(89379),a=t(90675),o=t(10467),i=t(5544),s=t(41594),c=t(84854),u=t(57394),l=t(76951),d=t(67146),m=t(6564),f=t(15696),p=t(99137),v=t.e(7473).then(t.bind(t,22715));function h(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:60,n=(0,u.u)().client,t=(0,s.useState)(""),r=(0,i.A)(t,2),l=r[0],d=r[1],m=(0,s.useState)(null),f=(0,i.A)(m,2),p=f[0],h=f[1],g=(0,s.useState)(!1),_=(0,i.A)(g,2),A=_[0],E=_[1],b=(0,s.useState)(0),C=(0,i.A)(b,2),y=C[0],S=C[1],M=(0,s.useState)(!1),I=(0,i.A)(M,2),k=I[0],x=I[1],w=(0,s.useState)(!1),T=(0,i.A)(w,2),N=T[0],R=T[1],L=(0,s.useState)(!1),O=(0,i.A)(L,2),U=O[0],P=O[1],D=(0,s.useRef)(null),G=(0,s.useRef)(null),q=(0,s.useRef)(null),B=(0,s.useRef)(null);function H(){return(H=(0,o.A)((0,a.A)().mark((function e(){var n,t;return(0,a.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!B.current){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,v;case 5:return n=e.sent,t=n.Recorder,B.current=new t({wasmURL:"".concat(c.A.cdnBaseUrl,"/cdn/assets/files/2312/651B57F85E0EDC31.wasm")}),e.next=10,B.current.init();case 10:x(!0),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(2),u.L.error("Failed to instantiate recorder (vmsg)",{error:e.t0,tags:{feErrorType:"UserAction",feCallOrigin:"initRecorder"}});case 16:case"end":return e.stop()}}),e,null,[[2,13]])})))).apply(this,arguments)}(0,s.useEffect)((function(){return function(){H.apply(this,arguments)}(),function(){n?n.updateMicOccupancyState({resetName:u.a1.AUDIO_MESSAGE.name}):(0,u.w)()}}),[n]);var F=function(){var e=(0,o.A)((0,a.A)().mark((function e(){var t,r,o,i,s;return(0,a.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=3;break}return(0,u.w)(),e.abrupt("return");case 3:if(n.updateMicOccupancyState({resetName:u.a1.AUDIO_MESSAGE.name}),B.current){e.next=7;break}return console.error("Recorder instance is not initialized."),e.abrupt("return");case 7:if("closed"!==(null==(r=B.current.audioCtx)?void 0:r.state)){e.next=9;break}return e.abrupt("return");case 9:return e.next=11,B.current.stopRecording();case 11:o=e.sent,E(!1),R(!0),d(URL.createObjectURL(o)),h(new File([o],"".concat(Date.now(),".mp3"),{type:"audio/mpeg"})),i=Date.now(),s=(i-(null!==(t=q.current)&&void 0!==t?t:0))/1e3,S(Math.round(s)),G.current&&(clearInterval(G.current),G.current=null),D.current&&(clearTimeout(D.current),D.current=null);case 21:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return{audioURL:l,audioFile:p,isRecording:A,startRecording:function(){k?B.current?(d(""),h(null),S(0),P(!1),B.current.startRecording(),E(!0),R(!1),D.current=setTimeout((function(){F(),P(!0)}),1e3*e),q.current=Date.now(),G.current=setInterval((function(){S((function(e){return e+1}))}),1e3)):console.warn("Recorder instance is not initialized."):console.warn("Recording is not ready yet.")},stopRecording:F,recordingDuration:y,isRecorderReady:k,isRecordingFinished:N,isReachedMaxDuration:U}}var g="_delete-btn_e4p22_1",_=function(e){var n=e.onDelete;return s.createElement(l.A,{title:(0,u.t)("im_voice_message_hover_delete"),placement:l.A.DIRECTION.top,alwaysUpdatePopper:!0},s.createElement(d.A,{onClick:function(){return null==n?void 0:n()},"aria-label":(0,u.t)("im_voice_message_hover_delete"),className:g},s.createElement(m.I,{size:24,color:"#545454"})))},A=function(e){var n=e.disabled,t=void 0!==n&&n,r="".concat((0,u.g)(),t?"/cdn/assets/imgs/239/AD66619FFB9D164D.svg":"/cdn/assets/imgs/236/AFE75335B9DDBEB8.svg");return s.createElement("img",{src:r,alt:"send"})},E=function(e){var n=e.size,t=void 0===n?20:n,r=e.color,a=void 0===r?"#EB4B6D":r;return s.createElement("svg",{width:t,height:t,viewBox:"0 0 22 22",fill:"none"},s.createElement("path",{d:"M13.85 8.15H8.15V13.85H13.85V8.15Z",fill:a}),s.createElement("circle",{cx:"11",cy:"11",r:"10",stroke:a,strokeWidth:"1.425"}))},b="_record-send-btn_1k9i5_1",C=function(e){var n=e.showStop,t=void 0!==n&&n,r=e.onClickStop,a=e.onVoiceSend,o=(0,u.t)(t?"im_voice_message_hover_stop":"im_general_chat_hover_send");return s.createElement(l.A,{title:o,placement:l.A.DIRECTION.top,alwaysUpdatePopper:!0},s.createElement(d.A,{"aria-label":o,className:b,onClick:function(){t?r():a()}},t?s.createElement("span",{"data-testid":"im-record-pause-btn"},s.createElement(E,null)):s.createElement("span",{"data-testid":"im-record-send-btn"},s.createElement(A,null))))},y=function(e){var n=e.mode,t=void 0===n?"play":n,r=e.color,a=e.size,o=e.onPlay,i=e.onPause;return s.createElement(l.A,{title:(0,u.t)("play"===t?"im_voice_message_hover_play":"im_voice_message_hover_stop"),placement:l.A.DIRECTION.top,alwaysUpdatePopper:!0},s.createElement(d.A,{onClick:function(){"play"===t?o&&o():i&&i()},type:"button","aria-label":"play"===t?(0,u.t)("im_voice_message_hover_play"):(0,u.t)("im_voice_message_hover_stop")},"play"===t?s.createElement(u.aT,{color:r,size:a}):s.createElement(u.aU,{color:r,size:a})))},S="_status-dot_1ztvu_1",M="_colorChange_1ztvu_1",I=function(e){var n=e.startColor,t=e.endColor,r=e.duration,a={"--start-color":n,"--end-color":t,animation:"".concat(r>0?M:"none"," ").concat(r,"s infinite alternate")};return s.createElement("div",{className:S,style:a})},k="_voice-bar-wrapper_ouhmo_1",x="_voice-control-wrapper_ouhmo_17",w=(0,f.observer)((function(e){var n=e.isRecording,t=e.recordingDuration,a=e.url,o=e.isReachedMaxDuration,c=(0,u.ap)(a,u.aV.VOICE),d=c.play,m=c.pause,f=c.isPlaying,p=c.isPaused,v=c.currentTime,h=(0,s.useState)(!1),g=(0,i.A)(h,2),_=g[0],A=g[1];(0,s.useEffect)((function(){o&&(A(!0),setTimeout((function(){A(!1)}),5e3))}),[o]);var E,b={startColor:n?"#EDA2B2":" #31BD65",endColor:n?"#EB4B6D":" #31BD65",duration:.47};return E=n?(0,u.K)(t):f||p?"".concat((0,u.K)(v)," / ").concat((0,u.K)(t)):Number.isFinite(t)?(0,u.K)(t):"00:00",s.createElement("div",{className:k},s.createElement(l.A,{title:(0,u.t)("im_voice_message_hover_maximum_duration"),style:{top:"-26",left:"20"},popupStyle:{maxWidth:"500"},placement:l.A.DIRECTION.top,alwaysUpdatePopper:!0,show:_}),!n&&s.createElement("div",{className:x},s.createElement(y,{onPause:function(){m()},onPlay:function(){d()},color:"black",size:24,mode:f?"pause":"play"})),s.createElement(I,(0,r.A)({},b)),E)})),T=function(e){var n=e.onDelete,t=e.channel,r=e.onSendClick,a=(0,u.ao)(t).sendMessage,o=h(60),i=o.audioURL,c=o.isRecording,l=o.startRecording,d=o.stopRecording,m=o.recordingDuration,f=o.audioFile,v=o.isRecorderReady,g=o.isRecordingFinished,A=o.isReachedMaxDuration;(0,s.useEffect)((function(){!v||c||g||l()}),[v,l,c,g]);return s.createElement("div",{"data-testid":"im-voice-input",className:p.s["voice-input-wrapper"]},s.createElement(_,{onDelete:function(){d(),n&&n()}}),s.createElement(w,{isReachedMaxDuration:A,isRecording:c,recordingDuration:m,url:i}),s.createElement(C,{showStop:c,onClickStop:function(){d()},onVoiceSend:function(){r&&r(),a({contentType:u.Y.VOICE_MESSAGE,messageContent:{audioURL:i,audioFile:f,duration:m}})}}))}},46042:(e,n,t)=>{t.d(n,{W:()=>f});var r=t(89379),a=t(23029),o=t(92901),i=t(50388),s=t(52176),c=t(53954),u=t(85501),l=t(41594),d=t(57394);var m=function(e){function n(e){var t,r,o,u;return(0,a.A)(this,n),r=this,o=n,u=[e],o=(0,c.A)(o),(t=(0,i.A)(r,(0,s.A)()?Reflect.construct(o,u||[],(0,c.A)(r).constructor):o.apply(r,u))).state={hasError:!1},t}return(0,u.A)(n,e),(0,o.A)(n,[{key:"componentDidCatch",value:function(e,n){this.setState({hasError:!0});var t="".concat(this.props.type,"_ErrorBoundary"),r=new Error;throw r.name=t,r.stack=e.stack||n.componentStack||void 0,r.message="".concat(t,"-\n").concat(e.message),d.L.error(t,{error:r,tags:{feErrorType:"ErrorBoundary"}}),e}},{key:"render",value:function(){return this.props.children}}],[{key:"getDerivedStateFromError",value:function(){return{hasError:!0}}}])}(l.Component);function f(e,n){return function(t){return l.createElement(m,{type:n},l.createElement(e,(0,r.A)({},t)))}}},52486:(e,n,t)=>{t.d(n,{A:()=>le});var r=t(60436),a=t(5544),o=t(89379),i=t(64467),s=t(90675),c=t(10467),u=t(23029),l=t(92901),d=t(50388),m=t(52176),f=t(53954),p=t(85501),v=t(25721),h=t(98911),g=t(57394),_=t(41594),A=t(63010),E=t(83573),b=t(97408),C=t(67146),y=t(49047),S=t(26204),M=t(95577),I=t(62576),k=t(13826),x=t(84763),w=t(72768),T=t(44497),N=t(46042),R=t(30508),L=t(55355);function O(e,n,t){return n=(0,f.A)(n),(0,d.A)(e,(0,m.A)()?Reflect.construct(n,t||[],(0,f.A)(e).constructor):n.apply(e,t))}var U={GET_ANNOUNCEMENT_LIST:"".concat(h.I,"/group/announcement/v1/list"),DELETE_ANNOUNCEMENT:"".concat(h.I,"/group/announcement/v1/delete"),CREATE_ANNOUNCEMENT:"".concat(h.I,"/group/announcement/v1/add")},P=function(e){function n(e){var t,r;return(0,u.A)(this,n),(t=O(this,n,[e])).isEnabled=!0,t.isEnabled=!(null==(r=e.initConfig)?void 0:r.anonymousMode),t}return(0,p.A)(n,e),(0,l.A)(n,[{key:"getAnnouncementList",value:function(){var e=(0,c.A)((0,s.A)().mark((function e(n){var t,r;return(0,s.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.groupId,this.isEnabled){e.next=3;break}return e.abrupt("return",[]);case 3:return e.next=5,this.imHttp.get(U.GET_ANNOUNCEMENT_LIST,{params:{groupId:t}});case 5:return r=e.sent,e.abrupt("return",r);case 7:case"end":return e.stop()}}),e,this)})));return function(n){return e.apply(this,arguments)}}()},{key:"createAnnouncement",value:function(){var e=(0,c.A)((0,s.A)().mark((function e(n){var t,r,a;return(0,s.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.groupId,r=n.content,e.next=3,this.imHttp.post(U.CREATE_ANNOUNCEMENT,{groupId:t,content:r});case 3:return a=e.sent,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e,this)})));return function(n){return e.apply(this,arguments)}}()},{key:"deleteAnnouncement",value:function(){var e=(0,c.A)((0,s.A)().mark((function e(n){var t,r,a;return(0,s.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.groupId,r=n.announcementIds,e.next=3,this.imHttp.post(U.DELETE_ANNOUNCEMENT,{groupId:t,announcementIds:r});case 3:return a=e.sent,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e,this)})));return function(n){return e.apply(this,arguments)}}()},{key:"isIndexedDbEnabled",get:function(){return this.driver.cache.isIndexedDbEnabled}},{key:"db",get:function(){return this.driver.cache.db}},{key:"initIndexedDB",value:function(){var e=(0,c.A)((0,s.A)().mark((function e(){var n;return(0,s.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isIndexedDbEnabled&&this.db){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,this.db.openStore("announcementDraftStore",{keyPath:"channelId"});case 5:return n=e.sent,e.next=8,n.get("fake_index");case 8:this.announcementDraftStore=n,e.next=16;break;case 11:e.prev=11,e.t0=e.catch(2),this.driver.cache.isIndexedDbEnabled=!1,g.L.setGlobalTag("indexedDb",!1),g.L.error("Error initializing cache manager",{error:e.t0,tags:{feErrorType:"ImClient"}});case 16:case"end":return e.stop()}}),e,this,[[2,11]])})));return function(){return e.apply(this,arguments)}}()},{key:"getAnnouncementDraftRecord",value:function(){var e=(0,c.A)((0,s.A)().mark((function e(n){var t;return(0,s.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.announcementDraftStore){e.next=3;break}return e.next=3,this.initIndexedDB();case 3:if(this.isIndexedDbEnabled&&this.db){e.next=5;break}return e.abrupt("return",void 0);case 5:return e.next=7,this.announcementDraftStore.get(n);case 7:return t=e.sent,e.abrupt("return",null==t?void 0:t.announcementDraft);case 9:case"end":return e.stop()}}),e,this)})));return function(n){return e.apply(this,arguments)}}()},{key:"setAnnouncementDraftRecord",value:function(){var e=(0,c.A)((0,s.A)().mark((function e(n){var t,r=arguments;return(0,s.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.length>1&&void 0!==r[1]?r[1]:"",this.announcementDraftStore){e.next=4;break}return e.next=4,this.initIndexedDB();case 4:if(this.isIndexedDbEnabled){e.next=6;break}return e.abrupt("return",void 0);case 6:return e.next=8,this.announcementDraftStore.set({channelId:n,announcementDraft:t});case 8:return e.abrupt("return",!0);case 9:case"end":return e.stop()}}),e,this)})));return function(n){return e.apply(this,arguments)}}()}])}(h.C),D="_bannerWrap_8ntmq_1",G="_clickable_8ntmq_8",q="_announcementIcon_8ntmq_11",B="_content_8ntmq_18",H="_truncated_8ntmq_22",F=function(e){var n=e.title,t=e.content,r=e.icon,a=e.type,s=e.className,c=e.onClick,u=e.onClose,l=e.lineClamp,d=(0,_.useMemo)((function(){return"info"===a?b.A.TYPE.info:"warn"===a?b.A.TYPE.warn:void 0}),[a]),m=(0,_.useMemo)((function(){return r||("announcement"===a?_.createElement("img",{alt:"",className:q,src:"".concat((0,g.g)(),"/cdn/assets/imgs/238/CA72FA3D69D3F670.svg")}):void 0)}),[r,a]);return _.createElement(C.A,{onClick:c,className:E((0,i.A)({},G,Boolean(c)),D,s)},_.createElement(b.A,{type:d,icon:m,showIcon:!0,onClose:function(e){null==u||u(),e.stopPropagation()},title:n,desc:_.createElement("div",(0,o.A)({className:E(B,(0,i.A)({},H,Boolean(l)))},l&&{style:{WebkitLineClamp:l}}),t)}))},V={announcementHome:"_announcementHome_13yc5_1",announcementEmpty:"_announcementEmpty_13yc5_5",announcementListWrapper:"_announcementListWrapper_13yc5_11",announcementListManage:"_announcementListManage_13yc5_18",announcementListSelectAll:"_announcementListSelectAll_13yc5_30",active:"_active_13yc5_36",announcementListBox:"_announcementListBox_13yc5_39",announcementListInnerBox:"_announcementListInnerBox_13yc5_46",announcementItem:"_announcementItem_13yc5_57",announcementItemInfo:"_announcementItemInfo_13yc5_74",announcementItemTop:"_announcementItemTop_13yc5_83",announcementItemTime:"_announcementItemTime_13yc5_89",announcementItemSummary:"_announcementItemSummary_13yc5_95",announcementListButtonBox:"_announcementListButtonBox_13yc5_107",announcementListButtonDelete:"_announcementListButtonDelete_13yc5_115",announcementDetail:"_announcementDetail_13yc5_118",announcementDetailTitle:"_announcementDetailTitle_13yc5_123",announcementDetailTitleLeftBox:"_announcementDetailTitleLeftBox_13yc5_130",announcementDetailTitleBack:"_announcementDetailTitleBack_13yc5_136",announcementDetailTitleAvatar:"_announcementDetailTitleAvatar_13yc5_143",announcementDetailTitleRightBox:"_announcementDetailTitleRightBox_13yc5_146",announcementDetailContent:"_announcementDetailContent_13yc5_157",announcementDetailContentLink:"_announcementDetailContentLink_13yc5_171",username:"_username_13yc5_175"},W="_backIcon_1ae6l_1";function Y(e){var n=e.onClick,t=e.fontSize,r=e.className,a=e.color;return _.createElement(y.A,{a11yText:(0,g.t)("commonall_text_btn_back"),iconName:"okds-arrow-chevron-left-centered-md",onClick:n,style:{fontSize:t||24,color:a},className:E(W,r)})}var j=function(e){var n=e.className,t=e.onBackHandler,r=e.announcementInfo,a=void 0===r?{}:r,o=a.updateTime,i=a.content,s=a.authorInfo,c="string"===typeof i?i.trim():"";return _.createElement("div",{className:E(V.announcementDetail,n)},_.createElement("div",{className:V.announcementDetailTitle},_.createElement("div",{className:V.announcementDetailTitleLeftBox},_.createElement(Y,{onClick:t,className:V.announcementDetailTitleBack}),_.createElement(g.A,{userInfo:s,width:40,height:40,className:V.announcementDetailTitleAvatar}),_.createElement(g.U,{userInfo:s})),_.createElement("div",{className:V.announcementDetailTitleRightBox},(0,g.f)(o,!1))),_.createElement("div",{className:V.announcementDetailContent},_.createElement(g.T,{text:c})))},z=function(e){var n=e.context,t=e.event,r=e.showDeleteDialog,a=e.imStore,o=function(e,n){return[{id:"delete-announcement",title:(0,g.t)("im_general_chat_btn_delete"),icon:"".concat((0,g.g)(),"/cdn/assets/imgs/238/D99FB7D3D2C5F5AF.svg"),handler:function(){e&&(null==n||n({announcements:[e.id]}))}}]}(n,r),i=t.currentTarget.getBoundingClientRect(),s=(0,g.a)(t)||{x:0,y:0};a.overlayStore.showOperationMenu({menuConfig:o,offsetX:s.x-i.left,offsetY:s.y-i.top,targetElement:t.currentTarget})},K="normal",X="select",J=(0,N.W)((function(e){var n,t,r,o,i=e.channel,u=e.announcementList,l=e.updateCurrentPage,d=e.onDeleteSuccess,m=e.currentAnnouncementDetail,f=(0,g.u)(),p=f.client,v=f.store,h=(0,_.useState)(K),A=(0,a.A)(h,2),b=A[0],y=A[1],x=(0,_.useState)(m),w=(0,a.A)(x,2),T=w[0],N=w[1],R=(0,_.useState)(new Set),L=(0,a.A)(R,2),O=L[0],U=L[1],P=null==(t=null==(n=i.groupInfo)?void 0:n.userGroupPermission)?void 0:t.deleteAnnouncement,D=(0,_.useMemo)((function(){return O.size===u.length}),[O.size,u.length]),G=function(){N(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)},q=function(e,n){e?O.add(n.id):O.delete(n.id),U(new Set(O))},B=function(){var e=(0,c.A)((0,s.A)().mark((function e(n,t){var r,a;return(0,s.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.update({confirmLoading:!0}),e.next=3,null==(a=null==(r=null==p?void 0:p.driver)?void 0:r.announcementController)?void 0:a.deleteAnnouncement({groupId:i.channelId,announcementIds:t}).catch((function(){n.update({confirmLoading:!1})}));case 3:e.sent&&(null==d||d(),S.A.success((0,g.t)(t.length>1?"im_group_announcement_toast_announcement_deleted_plural":"im_group_announcement_toast_announcement_deleted_singular")),n.update({confirmLoading:!1}),n.destroy(),U(new Set));case 5:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}(),H=function(e){var n=e.announcements,t=void 0===n?[]:n,r=g.D.confirmation({title:(0,g.t)(t.length>1?"im_group_announcement_modaltitle_delete_announcement_plural":"im_group_announcement_modaltitle_delete_announcement_singular"),children:_.createElement("span",{className:V.dialogConfirmationContent},(0,g.t)("im_group_announcement_modaldesc_delete_announcement")),confirmText:(0,g.t)("im_general_chat_btn_delete"),cancelText:(0,g.t)("im_general_use_btn_cancel"),onConfirm:function(){B(r,t)}})};return _.createElement("div",{className:V.announcementHome},!T&&_.createElement(_.Fragment,null,u.length?_.createElement("div",{className:V.announcementListWrapper},(null==(o=null==(r=null==i?void 0:i.groupInfo)?void 0:r.userGroupPermission)?void 0:o.deleteAnnouncement)&&_.createElement("div",{className:V.announcementListManage},b===K&&_.createElement(I.A,{type:I.A.TYPE.primary,category:I.A.CATEGORY.text,onClick:function(){y(X)},size:I.A.SIZE.s},(0,g.t)("im_group_announcement_textbtn_manage")),b===X&&_.createElement(I.A,{category:I.A.CATEGORY.text,type:I.A.TYPE.primary,className:E(V.announcementListSelectAll,D?V.active:""),size:I.A.SIZE.s,onClick:function(){if(!D){var e=new Set;u.forEach((function(n){e.add(n.id)})),U(e)}}},(0,g.t)("im_group_announcement_textbtn_select_all"))),_.createElement("div",{className:V.announcementListBox},_.createElement("div",{className:V.announcementListInnerBox},u.map((function(e,n){var t=e.id,r=e.updateTime,a=e.content,o=e.authorInfo,i=e.isDraft,s=O.has(t);return _.createElement(C.A,{key:n,"data-im-btn-full":!0,tabIndex:0,className:V.announcementItem,onContextMenu:function(n){n.preventDefault(),b!==X&&P&&z({context:e,showDeleteDialog:H,event:n,imStore:v})},onClick:function(){i?l(!1,"announcementNew"):G(e)},onKeyDown:function(n){"Space"===n.code&&(n.preventDefault(),q(!s,e))}},b===X&&_.createElement(M.A,{tabIndex:-1,className:V.announcementItemCheckbox,checked:s,clickStopPropagation:!0,onChange:function(n){q(n.target.checked,e)}}),_.createElement("span",{"aria-hidden":!0},_.createElement(g.A,{userInfo:o,width:40,height:40})),_.createElement("div",{className:V.announcementItemInfo},_.createElement("div",{className:V.announcementItemTop},_.createElement(g.U,{userInfo:o,showOfficialTag:!1,nameTextClassName:V.username}),_.createElement("span",{className:V.announcementItemTime},(0,g.f)(r,!0))),_.createElement("div",{className:V.announcementItemSummary},a)))})))),b===X&&_.createElement("div",{className:V.announcementListButtonBox},_.createElement(I.A,{className:V.announcementListButtonCancel,category:I.A.CATEGORY.outline,type:I.A.TYPE.secondary,onClick:function(){y(K),U(new Set)}},(0,g.t)("im_general_use_btn_cancel")),_.createElement(I.A,{className:V.announcementListButtonDelete,type:I.A.TYPE.highlight,disabled:!O.size,onClick:function(){H({announcements:Array.from(O)})}},(0,g.t)("im_general_chat_btn_delete")))):_.createElement(k.A.State,{type:k.A.State.TYPE.noRecord,className:V.announcementEmpty,title:(0,g.t)("im_group_announcement_empty_no_announcements")})),T&&_.createElement(j,{announcementInfo:T,onBackHandler:function(){G()}}))}),"AnnouncementHomePage"),Q={announcementNew:"_announcementNew_1mrvy_1",textArea:"_textArea_1mrvy_6",buttonBox:"_buttonBox_1mrvy_13",buttonPublish:"_buttonPublish_1mrvy_20"},Z=(0,N.W)((function(e){var n=e.className,t=e.updateCurrentPage,r=e.channel,o=(0,_.useState)(""),i=(0,a.A)(o,2),u=i[0],l=i[1],d=(0,g.u)().client,m=function(){var e=(0,c.A)((0,s.A)().mark((function e(){var n;return(0,s.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null==d?void 0:d.driver.announcementController.getAnnouncementDraftRecord(r.channelId);case 2:(n=e.sent)&&l(n);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,_.useEffect)((function(){m()}),[]);var f=function(){var e=(0,c.A)((0,s.A)().mark((function e(n){var a,o;return(0,s.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.update({confirmLoading:!0}),e.next=3,null==(o=null==(a=null==d?void 0:d.driver)?void 0:a.announcementController)?void 0:o.createAnnouncement({groupId:r.channelId,content:u}).catch((function(){n.update({confirmLoading:!1})}));case 3:e.sent&&(S.A.success((0,g.t)("im_group_announcement_toast_announcement_published")),n.update({confirmLoading:!1}),n.destroy(),null==d||d.driver.announcementController.setAnnouncementDraftRecord(r.channelId,""),t(!0));case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),p=function(){var e=g.D.confirmation({title:(0,g.t)("im_group_announcement_modaltitle_publish_announcement"),children:_.createElement("span",{className:"im-dialog-confirmation-content"},(0,g.t)("im_group_announcement_modaldesc_publish_announcement")),confirmText:(0,g.t)("im_group_announcement_btn_publish"),cancelText:(0,g.t)("im_general_use_btn_cancel"),onConfirm:function(){f(e)}})};return _.createElement(x.A,{className:E(Q.announcementNew,n),onSubmit:p},_.createElement(x.A.Item,{noStyle:!0},_.createElement(w.A.TextArea,{autoFocus:!0,onKeyDown:function(e){"Enter"===e.code&&e.metaKey&&(e.preventDefault(),p())},className:Q.textArea,placeholder:(0,g.b)("im_group_chat_placeholder_write_message"),showCount:!0,error:"",errorType:w.A.TIP_TYPE.always,value:u,maxLength:1e3,onChange:function(e){var n=e.target.value;l(n),null==d||d.driver.announcementController.setAnnouncementDraftRecord(r.channelId,n)}})),_.createElement(x.A.Item,{noStyle:!0,className:Q.buttonBox},_.createElement(I.A,{className:Q.buttonCancel,category:I.A.CATEGORY.outline,type:I.A.TYPE.secondary,onClick:function(){t(!0)}},(0,g.t)("im_general_use_btn_cancel")),_.createElement(I.A,{className:Q.buttonPublish,type:I.A.TYPE.highlight,disabled:!u||!1,htmlType:"submit"},(0,g.t)("im_group_announcement_btn_publish"))))}),"AnnouncementCreatePage"),$="_announcementTitle_6di0o_1",ee="_titleLeft_6di0o_11",ne="_backIcon_6di0o_21",te="_addNewBtn_6di0o_28",re="_titleRight_6di0o_31",ae=function(e){var n=e.className,t=e.updateShowAnnouncement,r=e.announcementCount,a=e.pageInfo,o=e.updateCurrentPage;return _.createElement("div",{className:E($,n)},_.createElement("div",{className:ee},a.withBackIcon&&_.createElement(Y,{onClick:function(){o(!0)},className:ne}),(0,g.t)(a.titleKey),a.withAddBtn&&_.createElement(I.A,{className:te,type:I.A.TYPE.highlight,size:I.A.SIZE.xxs,onClick:function(){r>=10?g.D.confirmation({title:(0,g.t)("im_group_announcement_modaltitle_max_post"),children:_.createElement("span",null,(0,g.t)("im_group_announcement_modaldesc_max_post",{number:10})),confirmText:(0,g.t)("im_general_use_btn_ok_error")}):o(!1,"announcementNew")},"aria-label":(0,g.t)("im_group_announcement_btn_add_new")},(0,g.t)("im_group_announcement_btn_add_new"))),_.createElement(R.C,{onClick:function(){t(!1)},className:re}))},oe="_channelAnnouncement_a0la8_1",ie=function(e,n){var t;return(0,o.A)((0,o.A)({},e),{},{authorInfo:null==(t=null==n?void 0:n.get(e.createBy))?void 0:t.userInfo})},se=function(e){var n,t=e.className,i=e.channel,u=e.updateShowAnnouncement,l=e.pinAnnouncement,d=e.showNormalAnnouncement,m=e.clearAnnouncements,f=(0,_.useState)([]),p=(0,a.A)(f,2),v=p[0],h=p[1],A=(0,_.useState)(null),b=(0,a.A)(A,2),C=b[0],y=b[1],S=(0,g.u)().client,M=function(){var e=(0,c.A)((0,s.A)().mark((function e(n){var t,r,a,o,c,u;return(0,s.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null==(r=null==(t=null==S?void 0:S.driver)?void 0:t.announcementController)?void 0:r.getAnnouncementList({groupId:n});case 2:(a=e.sent)&&(c=a.map((function(e){return ie(e,i.memberListMap)})),u=null!==(o=null==c?void 0:c[0])&&void 0!==o?o:null,(null==i?void 0:i.groupInfo)&&(0,T.runInAction)((function(){Object.assign(null==i?void 0:i.groupInfo,{latestGroupAnnouncement:u})})),h(c));case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();(0,_.useEffect)((function(){var e;i&&i.channelType===g.C.GROUP&&(null==i?void 0:i.memberListMap)&&(M(i.channelId),e=i.channelId,null==S||S.off(L.C.ON_ANNOUNCEMENT_CHANGED,(function(){})),null==S||S.on(L.C.ON_ANNOUNCEMENT_CHANGED,(function(n){var t=n.data.channelId;e===t&&M(e)})))}),[null==i?void 0:i.channelId,!!(null==i?void 0:i.memberListMap)]);var I=(0,_.useMemo)((function(){var e,n;return{announcementHome:{name:"announcementHome",titleKey:"im_group_chat_title_announcements",withAddBtn:null==(n=null==(e=null==i?void 0:i.groupInfo)?void 0:e.userGroupPermission)?void 0:n.postAnnouncement,renderPage:function(e){return _.createElement(J,(0,o.A)({},e))}},announcementNew:{name:"announcementNew",titleKey:"im_group_announcement_title_add_announcement",withBackIcon:!0,renderPage:function(e){return _.createElement(Z,(0,o.A)({},e))}}}}),[i]),k=(0,_.useState)(["announcementHome"]),x=(0,a.A)(k,2),w=x[0],N=x[1],R=function(e,n){if(e&&w.length>=2)return w.shift(),void N((0,r.A)(w));n&&(w.unshift(n),N((0,r.A)(w)))};(0,_.useEffect)((function(){d||y(null)}),[d]);var O=null==(n=null==i?void 0:i.groupInfo)?void 0:n.latestGroupAnnouncement;if((0,_.useEffect)((function(){if(!d&&O&&i.memberListMap){var e=ie(O,i.memberListMap);return l({announcement:e,onClick:function(){u(!0),y(e)}})}}),[d,O,i.memberListMap]),(0,_.useEffect)((function(){return function(){m(),N(["announcementHome"])}}),[null==i?void 0:i.channelId]),!i||!d)return null;var U=I[w[0]],P=Boolean(null==w?void 0:w.length);return _.createElement("div",{className:E(oe,t)},P?_.createElement(_.Fragment,null,_.createElement(ae,{updateShowAnnouncement:u,pageInfo:U,updateCurrentPage:R,announcementCount:v.length}),U.renderPage({channel:i,announcementList:v,updateCurrentPage:R,onDeleteSuccess:function(){M(i.channelId)},currentAnnouncementDetail:C})):null)},ce=_.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"21",height:"20",viewBox:"0 0 21 20",fill:"none"},_.createElement("path",{d:"M17.4089 2.1875C17.3347 2.1875 17.2585 2.20117 17.1824 2.23242L5.92456 6.75586H2.72144C2.54956 6.75586 2.40894 6.90039 2.40894 7.08008V12.9199C2.40894 13.0996 2.54956 13.2441 2.72144 13.2441H4.70776C4.6355 13.4707 4.59644 13.7109 4.59644 13.9551C4.59644 15.2422 5.64722 16.2891 6.94019 16.2891C8.02222 16.2891 8.93433 15.5547 9.20386 14.5625L17.1843 17.7695C17.2605 17.7988 17.3367 17.8145 17.4109 17.8145C17.741 17.8145 18.0359 17.5371 18.0359 17.166V2.83594C18.0339 2.46484 17.741 2.1875 17.4089 2.1875ZM6.94019 14.8887C6.42261 14.8887 6.00269 14.4707 6.00269 13.9551C6.00269 13.7363 6.07886 13.5273 6.21753 13.3613L7.87573 14.0273C7.83667 14.5078 7.43237 14.8887 6.94019 14.8887ZM16.6277 16.0293L6.448 11.9395L6.19604 11.8379H3.81519V8.16211H6.19604L6.448 8.06055L16.6277 3.9707V16.0293Z",fill:"currentColor"})),ue=function(e){var n=e.announcementBoxClassName,t=(0,g.c)(),r=t.activeConversation,s=t.conversationId,c=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=_.useState({}),t=(0,a.A)(n,2),r=t[0],s=t[1];(0,_.useEffect)((function(){A.A.init({project:"im"})}),[]);var c=(0,_.useCallback)((function(e){s((function(n){return(0,o.A)((0,o.A)({},n),{},(0,i.A)({},e,null))}))}),[]),u=(0,_.useCallback)((function(e){return s((function(n){return(0,o.A)((0,o.A)({},n),{},(0,i.A)({},e.id,e))})),function(){c(e.id)}}),[c]),l=(0,_.useCallback)((function(){s({})}),[]),d=(0,_.useCallback)((function(n){var t=n.announcement,r=n.onClick;return u({id:"imAnnouncementPinned_".concat(e),version:t.id,order:30,title:(0,g.t)("im_group_announcement_notif_announcement"),content:(0,g.r)(t.content),type:"announcement",lineClamp:2,onClick:r})}),[u,e]),m=(0,_.useCallback)((function(){return u({id:"bewareScamAlert_".concat(e),order:20,title:(0,g.t)("im_add_contact_alert_title_beware_of_scams"),content:(0,g.t)("im_add_contact_alert_text_official_users_scam"),type:"info"})}),[u,e]),f=(0,_.useMemo)((function(){return Object.values(r).filter((function(e){if(!e)return!1;var n=e.id,t=e.version,r=void 0===t?1:t,a=Number(A.A.get(n))||Number.MIN_SAFE_INTEGER;return Number(r)>a})).sort((function(e,n){return((null==e?void 0:e.order)||0)-((null==n?void 0:n.order)||0)}))}),[r]);return{bannersComponent:(0,_.useMemo)((function(){return f.length?_.createElement("div",null,f.map((function(e){return e?_.createElement(F,(0,o.A)((0,o.A)({key:e.id},e),{},{onClose:function(){var n;c(e.id),A.A.set(e.id,e.version||1),null==(n=e.onClose)||n.call(e)}})):null}))):null}),[f]),pinBanner:u,pinAnnouncementBanner:d,pinScamWarningBanner:m,clearBanners:l}}(s),u=c.bannersComponent,l=c.pinAnnouncementBanner,d=c.clearBanners,m=c.pinBanner,f=(0,g.d)(),p=f.isGroupInactive,v=f.isGroup,h=(0,_.useState)(!1),E=(0,a.A)(h,2),b=E[0],C=E[1];(0,_.useEffect)((function(){p&&(null==C||C(!1))}),[p]),(0,_.useEffect)((function(){s&&C(!1)}),[s]);var y=v?_.createElement(se,{channel:r,className:n,updateShowAnnouncement:C,showNormalAnnouncement:b,pinAnnouncement:l,clearAnnouncements:d}):null,S=v&&!p?_.createElement(g.I,{as:"children",tipTitle:(0,g.t)("im_group_chat_hover_announcement"),clickHandler:function(){C(!b)},placement:"bottom"},ce):null;return{pinBanner:m,bannersComponent:u,showAnnouncementSettings:b,AnnouncementContent:y,AnnouncementToggle:S}},le=function(e){function n(){var e;return(0,u.A)(this,n),(e=O(this,n,["announcement"])).init=function(e){var n=e;n.announcementController=new P(e),n.pluginModules.useAnnouncement=ue},e}return(0,p.A)(n,e),(0,l.A)(n)}(v.I)},14767:(e,n,t)=>{t.d(n,{C:()=>O,a:()=>Q,b:()=>se,u:()=>U});var r=t(64467),a=t(89379),o=t(53986),i=t(90675),s=t(10467),c=t(5544),u=t(41594),l=t(58252),d=t(82767),m=t(26204),f=t(46399),p=t(86466),v=t(49047),h=t(89208),g=t(13826),_=t(46042),A=t(19018),E=t(83573),b=t(15696),C=t(8358),y=t(96188),S=t(57394),M=t(55355),I=t(84854),k=t(5140),x=t(49981),w=["className","itemInfo","activeChannelId","renderPrefix","onContextMenu"],T="_wrapper_3vmd4_1",N=function(e){var n=e.count,t=void 0===n?0:n,r=e.className,a=void 0===r?"":r,o=(0,u.useState)(0),i=(0,c.A)(o,2),s=i[0],l=i[1],d=(0,u.useRef)({timer:0});return(0,u.useEffect)((function(){d.current.timer&&clearTimeout(d.current.timer),d.current.timer=setTimeout((function(){l(t>99?"99+":t)}),100)}),[t]),s?u.createElement("div",{className:E(T,a),"data-unread":t},s):null},R="_conversation-list-container_ybjxi_1",L=function(e){var n=e.dataChannelId;return u.createElement("div",{"data-channel-id":n,"data-testid":"channel-skeleton-".concat(n),style:{height:"72px",padding:"18px 16px",display:"flex",gap:"12px",alignItems:"center",borderBottom:"1px solid var(--okd-color-border-primary)"}},u.createElement(l.A.Avatar,{active:!0,style:{width:40,height:40,flexShrink:0}}),u.createElement(l.A.Input,{active:!0,style:{width:"100%"}}))},O=(0,u.memo)(L);function U(){var e=(0,S.u)().client,n=(0,u.useState)((function(){var n;return null==(n=null==e?void 0:e.queryUserInfo)?void 0:n.call(e)})),t=(0,c.A)(n,2),r=t[0],a=t[1];(0,u.useEffect)((function(){if(e){a(e.queryUserInfo());var n=function(e){a(e.data)};return e.on(M.C.ON_PROFILE_CHANGED,n),function(){e.off(M.C.ON_PROFILE_CHANGED,n)}}}),[e]);var o=(0,u.useMemo)((function(){return(0,S.j)(null==r?void 0:r.tags)}),[r]);return{profile:r,isOfficialUser:o}}var P="_dialog_n5ayw_1",D="_card_n5ayw_5",G="_profileRow_n5ayw_16",q="_avatar_n5ayw_23",B="_nameRow_n5ayw_26",H="_name_n5ayw_26",F="_qrCodeWrap_n5ayw_43",V="_prompt_n5ayw_48",W="_logo_n5ayw_55",Y=(0,u.forwardRef)((function(e,n){var r,a,o=e.qrCodeUrl,c=e.size,l=void 0===c?152:c,m=(0,S.u)().store,f=U().profile,p=null==(a=null==(r=I.A.logoMap)?void 0:r.light)?void 0:a.text,v=(0,u.useRef)(null),h=(0,u.useRef)(),g=function(){var e=(0,s.A)((0,i.A)().mark((function e(n){var r;return(0,i.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.e(7473).then(t.bind(t,20331));case 2:if(r=e.sent.toPng,!h.current){e.next=5;break}return e.abrupt("return",h.current);case 5:return 32,h.current=r(n,{includeQueryParams:!1,backgroundColor:"#fff",cacheBust:!0,skipFonts:!0,width:n.clientWidth+64,height:n.clientHeight+64,style:{position:"absolute",left:"".concat(-32,"px"),top:"".concat(-32,"px"),margin:"".concat(32,"px"),width:"".concat(n.clientWidth,"px"),height:"".concat(n.clientHeight,"px")}}),e.abrupt("return",h.current);case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,u.useEffect)((function(){v.current&&o&&g(v.current)}),[o]),(0,u.useImperativeHandle)(n,(function(){return{downloadQr:function(){var e=(0,s.A)((0,i.A)().mark((function e(){var n,t,r;return(0,i.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(v.current&&f){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,g(v.current);case 4:n=e.sent,t=(0,S.h)(f,m.userRegistryStore),(r=document.createElement("a")).href=n,r.download="".concat(t,"_QR.png"),r.click();case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}})),u.createElement("div",{ref:v,className:D},u.createElement("div",{className:G},u.createElement(S.S,{width:32,height:32,className:q,userInfo:f,pictureProps:{useWebp:!1}}),u.createElement(S.U,{className:B,nameTextClassName:H,userInfo:f,showOfficialTag:!0})),u.createElement("div",{className:F,style:{width:l,height:l}},o&&u.createElement(d.A,{text:o,level:"H",size:l})),u.createElement("div",{className:V},(0,S.t)("im_qr_code_scan_with_app")),p&&u.createElement("img",{className:W,src:p,alt:"logo",height:16}))})),j="_menuIcon_38ztj_1",z="_menu-item-icon_38ztj_5",K="_selectOption_38ztj_14",X=function(){var e,n,t,r=(0,A.u)(),a=(0,c.A)(r,2)[1],o=U(),l=o.isOfficialUser,d=o.profile,h=function(){var e=(0,S.u)(),n=e.client,t=e.store,r=e.ready,a=(0,u.useState)(),o=(0,c.A)(a,2),l=o[0],d=o[1],f=(0,u.useState)(!1),p=(0,c.A)(f,2),v=p[0],h=p[1],g=(0,u.useRef)(),_=(0,u.useRef)(null),A=(0,u.useCallback)((0,s.A)((0,i.A)().mark((function e(){var t;return(0,i.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!l&&n){e.next=2;break}return e.abrupt("return");case 2:return h(!0),e.next=5,n.getMyQrCode().finally((function(){h(!1)}));case 5:if(null==(t=e.sent)?void 0:t.qrcode){e.next=8;break}return e.abrupt("return");case 8:d(t.qrcode);case 9:case"end":return e.stop()}}),e)}))),[n,l]);(0,u.useEffect)((function(){g.current&&!v&&g.current.update({showLoading:v,children:u.createElement(S.af,{ready:r,client:n,store:t},u.createElement(Y,{ref:_,qrCodeUrl:l,size:152})),confirmDisabled:!l})}),[l,v,n,t,r]);var E=(0,u.useCallback)((function(){A(),g.current=S.D.show({title:(0,S.t)("im_qr_code_header_my_qr_code"),showLoading:!l,containerClassName:P,children:u.createElement(S.af,{ready:r,client:n,store:t},u.createElement(Y,{ref:_,qrCodeUrl:l,size:152})),confirmText:(0,S.t)("im_qr_code_dialog_btn_save_qr_code"),confirmDisabled:!l,onConfirm:function(){var e=(0,s.A)((0,i.A)().mark((function e(){var n;return(0,i.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,null==(n=_.current)?void 0:n.downloadQr();case 3:m.A.success((0,S.t)("im_qr_code_toast_qr_code_saved")),e.next=10;break;case 6:e.prev=6,e.t0=e.catch(0),S.L.warn("Failed to save profile qr",{error:e.t0,tags:{feErrorType:"UserAction"}}),m.A.error((0,S.t)("im_qr_code_toast_qr_code_saved_fail"));case 10:g.current=void 0;case 11:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(){return e.apply(this,arguments)}}(),onClose:function(){g.current=void 0},maskClosable:!0,escToClose:!0})}),[n,A,l,r,t]);return{showQr:E}}(),g=h.showQr,_=(0,S.p)("useAutoReply"),b=(0,S.p)("useMassSendMessage"),C=(0,S.p)("contactManagement"),y=((null==_?void 0:_())||{}).showAutoReply,M=(null==b?void 0:b())||{},I=M.showMassSendMessage,k=M.Component,x=(0,u.useMemo)((function(){var e,n,t,r=[];return(null==C?void 0:C.ContactManagementPage)&&r.push({label:(0,S.t)("im_contact_list_select_view_contacts"),value:"view-contacts",icon:"".concat((0,S.g)(),"/cdn/assets/imgs/242/9189A1931EDFD85D.svg"),onClick:function(){a(A.R.contactManagement)}}),(null==C?void 0:C.ContactManagementPage)&&(null==(e=null==d?void 0:d.userGlobalPermissionDto)?void 0:e.searchUuid)&&r.push({label:(0,S.t)("im_general_chat_dropdown_search_by_uid"),value:"search-by-uuid",icon:"".concat((0,S.g)(),"/cdn/assets/imgs/2311/DAA4B8F33BCC4C95.svg"),onClick:function(){a(A.R.searchUuid)}}),r.push({label:(0,S.t)("im_delete_chat_select_select_chats"),value:"select-chats",icon:"".concat((0,S.g)(),"/cdn/assets/imgs/2312/72C16A43ACFCAFC3.svg"),onClick:function(){a(A.R.selectChat)}}),I&&l&&r.push({label:(0,S.t)("im_broadcast_new_broadcast"),value:"broadcast-message",iconName:"okx-support-broadcast",onClick:I}),(null==(n=null==d?void 0:d.userGlobalPermissionDto)?void 0:n.generateQrCode)&&r.push({label:(0,S.t)("im_qr_code_select_my_qr_code"),value:"my-qr-code",icon:"".concat((0,S.g)(),"/cdn/assets/imgs/243/C18D51A88339CC97.svg"),onClick:g}),y&&(null==(t=null==d?void 0:d.userGlobalPermissionDto)?void 0:t.setAutoReply)&&r.push({label:(0,S.t)("im_autoreply_btn_autoreply"),value:"auto-reply",icon:"".concat((0,S.g)(),"/cdn/assets/imgs/247/06021FDB2C5CF9B3.svg"),onClick:y}),r.push({label:(0,S.t)("im_unblock_user_btn_settings"),value:"settings",iconName:"okds-setting",onClick:function(){a(A.R.settings)}}),r}),[a,g,y,null==(e=null==d?void 0:d.userGlobalPermissionDto)?void 0:e.searchUuid,null==(n=null==d?void 0:d.userGlobalPermissionDto)?void 0:n.generateQrCode,null==(t=null==d?void 0:d.userGlobalPermissionDto)?void 0:t.setAutoReply,l,I]);if(0===x.length)return null;return u.createElement(u.Fragment,null,u.createElement(f.A,{options:x,size:p.A.SIZE.sm,onChange:function(e){var n=x.find((function(n){return n.value===e.value}));null==n||n.onClick()},optionContClassName:K,displayArea:function(){return u.createElement(S.I,{tipTitle:(0,S.t)("im_general_chat_hover_more_actions"),placement:"bottomLeft",as:"icon",iconClassName:E(j,"okds-plus-circle")})},renderOption:function(e){var n=x.find((function(n){return n.value===e.value}));if(!n)return null;var t=null;return n.icon?t=u.createElement("img",{"aria-hidden":!0,alt:"",src:n.icon,className:z}):n.iconName&&(t=u.createElement(v.A,{"aria-hidden":!0,className:z,iconName:n.iconName})),[u.createElement("span",{key:0},t),u.createElement("span",{key:1},n.label)]}}),k)},J={"conversation-item-box":"_conversation-item-box_h7dvu_1",active:"_active_h7dvu_13",unreadCount:"_unreadCount_h7dvu_19","conversation-info":"_conversation-info_h7dvu_24","conversation-top":"_conversation-top_h7dvu_32","conversation-last-time":"_conversation-last-time_h7dvu_38","im-preview-prefix":"_im-preview-prefix_h7dvu_47","conversation-last-mess":"_conversation-last-mess_h7dvu_51","conversation-last-mess-text":"_conversation-last-mess-text_h7dvu_57","conversation-last-mess-status-box":"_conversation-last-mess-status-box_h7dvu_67","im-conversation-status":"_im-conversation-status_h7dvu_72","im-conversation-status-icon":"_im-conversation-status-icon_h7dvu_78"};var Q=(0,b.observer)((function(e){var n,t,i,s=e.className,c=e.itemInfo,l=e.activeChannelId,d=e.renderPrefix,m=e.onContextMenu,f=void 0===m?null:m,p=(0,o.A)(e,w),v=(0,S.u)(),h=v.store,g=v.config,_=v.registry,A=(0,S.ay)(f),b=(0,S.J)().setActiveConversationId,C=(null==c?void 0:c.entityInfo)||{},y=l===(null==c?void 0:c.channelId),M=!!c.pinnedStatus,I=(null==c?void 0:c.receiveMsgOption)===S.a8.RECEIVE_SILENTLY,x=null!==(n=_.messagePreview)&&void 0!==n?n:{},T=null==(t=null==g?void 0:g.conversationList)?void 0:t.renderName,R=(0,u.useMemo)((function(){return function(e,n,t,r){var a=e.lastUserMsg;if(!a)return null;var o=t.messageInputStore.getDraft(e.channelId),i=r[a.contentType];if(i&&"function"===typeof i)return i({conversation:e,isActive:n,draft:o});if(!n&&(null==o?void 0:o.messageText))return u.createElement(u.Fragment,null,u.createElement("span",{className:J["im-preview-prefix"]},(0,S.t)("im_general_chat_text_preview_draft")),u.createElement("span",null,(0,S.az)(o.messageText)));var s=a,c=(0,k.g)(s,t);return e.groupAtType===S.M.AT_ME?u.createElement(u.Fragment,null,u.createElement("span",{className:J["im-preview-prefix"]},(0,S.t)("im_general_chat_text_preview_me")),u.createElement("span",null,c)):e.groupAtType===S.M.AT_ALL?u.createElement(u.Fragment,null,u.createElement("span",{className:J["im-preview-prefix"]},(0,S.t)("im_general_chat_text_preview_all")),u.createElement("span",null,c)):c}(c,y,h,x)}),[y,c,x,h]),L=!!(null==(i=c.lastUserMsg)?void 0:i.sendTime)&&(0,S.f)(c.lastUserMsg.sendTime,!0);return u.createElement("div",(0,a.A)((0,a.A)({"aria-current":y?"page":"false",role:"menuitem",tabIndex:p.tabIndex,"data-testid":"channel-".concat(c.channelId),"data-channel-id":c.channelId,onKeyDown:function(e){"Enter"===e.key&&(b(c.channelId),e.preventDefault())},className:E("im-focusable",J["conversation-item-box"],s,(0,r.A)({},J.active,y))},p),A()),null==d?void 0:d(),u.createElement("span",{"aria-hidden":!0},u.createElement(S.A,{userInfo:C,channelType:c.channelType,width:40,height:40,"aria-hidden":"true"},u.createElement(N,{count:c.unreadCount,className:J.unreadCount}))),u.createElement("div",{className:J["conversation-info"]},u.createElement("div",{className:J["conversation-top"]},u.createElement(S.U,{customName:null==T?void 0:T(c),userInfo:C,className:J["conversation-name-box"],isGroupName:c.channelType===S.C.GROUP,withOverflowTooltip:!0}),u.createElement("span",{className:J["conversation-last-time"]},L)),u.createElement("div",{className:J["conversation-last-mess"]},u.createElement(S.F,{className:J["conversation-last-mess-text"]},R),u.createElement("div",{className:J["conversation-last-mess-status-box"]},I&&u.createElement("div",{"data-testid":"muted",className:J["im-conversation-status"],"aria-label":(0,S.t)("im_chat_alt_muted_chat")},u.createElement("img",{alt:"",src:"".concat((0,S.g)(),"/cdn/assets/imgs/2312/36C0FD4DC5706414.svg"),className:J["im-conversation-status-icon"]})),M&&u.createElement("div",{"data-testid":"pinned","aria-label":(0,S.t)("im_chat_alt_pinned_chat"),className:J["im-conversation-status"]},u.createElement("img",{alt:"",src:"".concat((0,S.g)(),"/cdn/assets/imgs/2312/8E5B9A169CBE193F.svg"),className:J["im-conversation-status-icon"]}))))))})),Z=function(e){var n=e.context,t=e.imStore,r=e.onDeleteConversation,a=e.event;if(t.client){var o=function(e){var n=e.context,t=e.okImSdk,r=e.onDeleteConversation,a=n.channelId;return[{id:"pin-chat",title:n.pinnedStatus?(0,S.t)("im_function_pop_unpin_chat"):(0,S.t)("im_function_pop_pin_chat"),icon:n.pinnedStatus?"".concat((0,S.g)(),"/cdn/assets/imgs/2312/0DAEA1E11C27583D.svg"):"".concat((0,S.g)(),"/cdn/assets/imgs/2312/8E5B9A169CBE193F.svg"),handler:function(){var e=n.pinnedStatus?0:1;t.setChannelPinnedStatus({channelId:a,pinnedStatus:e})}},{id:"mute-chat",title:n.receiveMsgOption===S.a8.RECEIVE_SILENTLY?(0,S.t)("im_general_chat_dropdown_unmute_notifications"):(0,S.t)("im_general_chat_dropdown_mute_notifications"),icon:n.receiveMsgOption===S.a8.RECEIVE_SILENTLY?"".concat((0,S.g)(),"/cdn/assets/imgs/2312/FC877661D5A8F392.svg"):"".concat((0,S.g)(),"/cdn/assets/imgs/2312/36C0FD4DC5706414.svg"),handler:function(){var e=n.receiveMsgOption===S.a8.RECEIVE_SILENTLY?S.a8.NORMAL:S.a8.RECEIVE_SILENTLY;t.setChannelMute({channelId:a,receiveMsgOption:e})}},{id:"delete-chat",title:(0,S.t)("im_delete_chat_select_delete_chat"),icon:"".concat((0,S.g)(),"/cdn/assets/imgs/238/D99FB7D3D2C5F5AF.svg"),handler:function(){a&&r(a)}}]}({context:n,okImSdk:t.client,onDeleteConversation:r}),i=a.currentTarget.getBoundingClientRect(),s=(0,S.a)(a)||{x:0,y:0};t.overlayStore.showOperationMenu({menuConfig:o,offsetX:s.x-i.left,offsetY:s.y-i.top,targetElement:a.currentTarget})}},$="_page_65ss6_1",ee="_listBox_65ss6_8",ne="_empty_65ss6_14",te="_loadingBox_65ss6_20",re="_loadingIcon_65ss6_33";function ae(e){var n=e.loadMore;return(0,u.useEffect)((function(){n()}),[n]),u.createElement("div",{className:te},u.createElement(h.A,{className:re}))}var oe=(0,b.observer)((function(e){var n,t=e.className,r=void 0===t?"":t,a=e.itemClassName,o=void 0===a?"":a;!function(){var e=(0,S.J)(),n=e.conversationListIsLoading,t=e.conversationList,r=(0,S.u)().client,a=(0,y.u)(n||!t.length);(0,u.useEffect)((function(){var e;a&&(0,S.V)("IMHomepageFullPageView",{origin:null!==(e=null==r?void 0:r.app)&&void 0!==e?e:null,load_time:a})}),[r,a])}();var l=(0,S.u)(),d=l.store,m=l.config,f=(0,S.J)(),p=f.conversationList,v=f.conversationListHasMore,h=f.activeConversation,_=f.conversationListReady,A=f.loadConversationList,b=f.promptDeleteConversations,M=(0,u.useCallback)((0,s.A)((0,i.A)().mark((function e(){var n,t;return(0,i.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=p.length-1,!(t=p[n])){e.next=5;break}return e.next=5,A({prevChannelId:t.channelId});case 5:case"end":return e.stop()}}),e)}))),[p,A]),I=function(){var e=(0,S.J)(),n=e.conversationList,t=e.activeConversation,r=(0,u.useState)(0),a=(0,c.A)(r,2),o=a[0],i=a[1],s=(0,u.useRef)(null),l=(0,u.useRef)([]);return(0,u.useEffect)((function(){if(null==t?void 0:t.channelId){var e=n.findIndex((function(e){return e.channelId===t.channelId}));e>-1&&i(e)}}),[null==t?void 0:t.channelId,n]),{convListRef:l,containerRef:s,handleKeyDown:function(e){var t,r,a;if(s.current){var c,u=o-1,l=o+1,d=n[u],m=n[l];switch(e.code){case"ArrowUp":if(e.preventDefault(),!d)break;i(u),null==(t=s.current)||t.scrollToIndex(u,{align:"center"}),null==(r=null==(c=document.querySelector("[data-channel-container] [data-channel-id='".concat(d.channelId,"']")))?void 0:c.focus)||r.call(c);break;case"ArrowDown":if(e.preventDefault(),!m)break;i(l),s.current.scrollToIndex(l,{align:"center"}),null==(a=null==(c=document.querySelector("[data-channel-container] [data-channel-id='".concat(m.channelId,"']")))?void 0:c.focus)||a.call(c)}}},selectedIndex:o}}(),k=I.containerRef,w=I.handleKeyDown,T=I.selectedIndex,N=!_&&u.createElement("div",null,Array.from({length:13},(function(e,n){return u.createElement(O,{key:"skeleton-".concat(n)})}))),R=_&&0===p.length&&u.createElement(g.A.State,{className:ne,type:g.A.State.TYPE.noRecord,title:(0,S.t)("im_landing_empty_no_conversations")}),L=_&&v&&u.createElement(ae,{loadMore:M}),U=(0,u.useMemo)((function(){var e;return(null==(e=m.conversationList)?void 0:e.renderActionMemu)?m.conversationList.renderActionMemu(u.createElement(X,null)):u.createElement(X,null)}),[m.conversationList]);return u.createElement("div",{"data-channel-container":!0,className:E($,r)},!!(null==(n=m.conversationList)?void 0:n.actionsMenu)&&u.createElement(x.H,{isLoading:!_},U),u.createElement("div",{tabIndex:0,onKeyDown:w,role:"region","aria-label":(0,S.t)("im_chat_alt_chat_inbox"),className:ee},N,R,u.createElement(C.n,{ref:k,"data-testid":"conversation-list",style:{height:"100%",scrollbarGutter:"stable"},overscan:3},p.map((function(e,n){return function(e,n){var t,r,a=(null==(t=null==m?void 0:m.conversationList)?void 0:t.conversationRightClick)?function(e){e.cancelable&&e.preventDefault(),Z({event:e,context:n,imStore:d,onDeleteConversation:function(e){b({channelIds:[e]})}})}:void 0,i=n.isLoaded?"":"-loading",s="".concat(n.channelId).concat(i);return u.createElement(Q,{tabIndex:(null==(r=null==p?void 0:p[T])?void 0:r.channelId)===n.channelId?0:-1,key:s,activeChannelId:null==h?void 0:h.channelId,className:o,itemInfo:n,onClick:function(){d.conversationStore.setActiveConversationId(n.channelId)},onContextMenu:a})}(0,e)})),L)))})),ie=(0,_.W)(oe,"ConversationListPage"),se=(0,_.W)((function(e){var n=e.className,r=void 0===n?"":n,a=e.itemClassName,o=void 0===a?"":a,i=e.config,s=(0,S.u)().store;(0,A.c)(),(0,u.useEffect)((function(){i&&s.configStore.updateConversationListConfig(i)}),[i,s.configStore]);var c=(0,S.J)().loadConversationList,l=(0,S.u)().ready,d=(0,S.p)("contactManagement"),m=null==d?void 0:d.ContactManagementPage,f=null==d?void 0:d.BlockedContactPage,p=null==d?void 0:d.SearchUuidPage;(0,u.useEffect)((function(){l&&c({resetList:!0}).catch((function(e){S.L.error("Failed to get conversation list",{errorName:"ConversationListLoadingFailed",error:e,tags:{feErrorType:"ImClient",feCallOrigin:"loadConversationList"}})}))}),[l]),(0,u.useEffect)((function(){return s.conversationStore.updateRouterReady(!0),function(){s.conversationStore.updateRouterReady(!1)}}),[s.conversationStore]);var v=[{id:A.R.listHome,path:A.R.listHome,component:ie},{id:A.R.selectChat,path:A.R.selectChat,component:(0,u.lazy)((function(){return t.e(7473).then(t.bind(t,15468))}))},{id:A.R.settings,path:A.R.settings,component:(0,u.lazy)((function(){return t.e(7473).then(t.bind(t,45039))}))},{id:"fallback",component:ie}];return m&&v.push({id:A.R.contactManagement,path:A.R.contactManagement,component:m}),f&&v.push({id:A.R.blockedContacts,path:A.R.blockedContacts,component:f}),p&&v.push({id:A.R.searchUuid,path:A.R.searchUuid,component:p}),u.createElement("div",{className:R},u.createElement(A.d,null,u.createElement(S.aA,null,u.createElement(u.Suspense,{fallback:u.createElement("div",{className:r,style:{display:"flex",justifyContent:"center",alignItems:"center"}},u.createElement(h.A,null))},u.createElement(A.S,null,v.map((function(e){return u.createElement(A.e,{key:e.id,path:e.path,render:function(){var n=e.component;return u.createElement(n,{className:r,itemClassName:o})}})})))))))}),"ConversationList")},9345:(e,n,t)=>{t.d(n,{x:()=>a});var r=t(74176),a={filterOffOkAssistantConversations:function(e){var n;return!e||(null==(n=e.entityInfo)?void 0:n.groupType)!==r.e.OK_ASSISTANT},filterOffNonOkAssistantConversations:function(e){var n;return!e||(null==(n=e.entityInfo)?void 0:n.groupType)===r.e.OK_ASSISTANT}}},19018:(e,n,t)=>{t.d(n,{R:()=>R,S:()=>N,a:()=>h,b:()=>I,c:()=>g,d:()=>x,e:()=>w,f:()=>O,u:()=>M});var r=t(24765),a=t(53986),o=t(89379),i=t(87695),s=t(5544),c=t(90675),u=t(10467),l=t(41594),d=t(57394),m=t(74002),f=["children"],p=["path","render"],v=3e5;function h(){var e=(0,d.u)(),n=e.client,t=e.store.userRegistryStore.userInfoMap,r=(0,l.useCallback)(function(){var e=(0,u.A)((0,c.A)().mark((function e(r){var a,o;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t[r.userId],!(!r.force&&a&&Date.now()-a.lastUpdated<=v)){e.next=3;break}return e.abrupt("return",t[r.userId]);case 3:if(n){e.next=6;break}return(0,d.w)(),e.abrupt("return",void 0);case 6:return e.next=8,n.driver.contactController.getContactInfo({contactUid:r.userId});case 8:return o=e.sent,e.abrupt("return",o);case 10:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),[n,t]);return{fetchUserInfo:r}}function g(){var e=(0,d.u)(),n=e.ready,t=e.client,r=e.store.userRegistryStore.syncUserRelationList,a=(0,l.useCallback)((0,u.A)((0,c.A)().mark((function e(){var n;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=3;break}return(0,d.w)(),e.abrupt("return",[]);case 3:return e.next=5,t.driver.contactController.getAllAlias();case 5:return n=e.sent,r(n),e.abrupt("return",n);case 8:case"end":return e.stop()}}),e)}))),[t]);return(0,l.useEffect)((function(){var e;n&&((null==(e=null==t?void 0:t.config)?void 0:e.anonymousMode)||L((function(){a()})))}),[n,t]),null}var _=function(e){try{return decodeURI(e)}catch(n){return e}},A=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.path,t=void 0===n?"/":n,r=e.record,a=void 0===r||r,o=t,i=[o],s=new m.E,c=function(e){var n=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).replace;a&&(void 0!==n&&n?i.splice(i.length-1,1,e):i.push(e)),o=e,s.emit("navigate",e)},u=c,d=function(){i.length>1&&(i.pop(),c(i[i.length-1],{replace:!0}))},f=function(e){var n=function(n){e(n.data)};return s.on("navigate",n),function(){return s.off("navigate",n)}};return{hook:function(){return[(0,l.useSyncExternalStore)(f,(function(){return o})),u,d]},navigate:u,goBack:d,history:a?i:void 0,reset:a?function(){i.splice(0,i.length),c(t)}:void 0}}().hook,E=function(e){var n=(0,l.useRef)([e,function(){return n[0].apply(n,arguments)}]).current;return(0,l.useInsertionEffect)((function(){n[0]=e})),n[1]},b={hook:A,parser:function(e){var n,t="",r=e.split("/");for(r[0]||r.shift();n=r.shift();)t+="/".concat(n);return{keys:[],pattern:new RegExp("^".concat(t,"/?$"),"i")}},base:"",hrefs:function(e){return e}},C=(0,l.createContext)(b),y=function(){return(0,l.useContext)(C)},S=function(e){var n,t,r=e.hook(),a=(0,s.A)(r,2),o=a[0],i=a[1];return[_((n=e.base,t=o,t.toLowerCase().indexOf(n.toLowerCase())?"~".concat(t):t.slice(n.length)||"/")),E((function(n,t){return i(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return"~"===e[0]?e.slice(1):n+e}(n,e.base),t)}))]},M=function(){return S(y())},I=function(){return function(e){var n=e.hook(),t=(0,s.A)(n,3)[2];return E(t)}(y())},k=function(e,n,t){var r=e(n||"*"),a=r.pattern,s=r.keys,c=a.exec(t)||[],u=(0,i.A)(c),l=u[0],d=u.slice(1);return void 0!==l?[!0,function(){var e=Object.fromEntries(s.map((function(e,n){return[e,d[n]]}))),n=(0,o.A)({},d);return e&&Object.assign(n,e),n}()]:[!1,null]},x=function(e){var n,t,r=e.children,i=(0,a.A)(e,f),s=y(),c=s;i.hrefs=null!==(n=i.hrefs)&&void 0!==n?n:null==(t=i.hook)?void 0:t.hrefs;for(var u=(0,l.useRef)({}),d=u.current,m=d,p=0,v=Object.keys(s);p<v.length;p++){var h=v[p],g="base"===h?s[h]+(i[h]||""):i[h]||s[h];d===m&&g!==m[h]&&(m=(0,o.A)({},m),u.current=m),m[h]=g,g!==s[h]&&(c=m)}return(0,l.createElement)(C.Provider,{value:c,children:r})},w=function(e){var n=e.path,t=e.render,r=(0,a.A)(e,p),o=y(),i=S(o),c=(0,s.A)(i,1)[0],u=k(o.parser,n,c);return(0,s.A)(u,1)[0]?t(r):null},T=function(e){return Array.isArray(e)?e.flatMap((function(e){return T(e&&e.type===l.Fragment?e.props.children:e)})):[e]},N=function(e){var n,t=e.children,a=e.location,o=y(),i=S(o),c=(0,s.A)(i,1)[0],u=(0,r.A)(T(t));try{for(u.s();!(n=u.n()).done;){var d=n.value,m=0;if((0,l.isValidElement)(d)&&(m=k(o.parser,d.props.path,a||c))[0])return(0,l.cloneElement)(d,{match:m})}}catch(f){u.e(f)}finally{u.f()}return null},R={listHome:"/listHome",searchUuid:"/searchUuid",selectChat:"/selectChat",contactManagement:"/contactManagement",settings:"/settings",blockedContacts:"/blockedContacts"},L=function(e){"requestIdleCallback"in window?requestIdleCallback((function(){e()})):setTimeout((function(){e()}))};function O(){return new Promise((function(e){return requestAnimationFrame(e)}))}},5140:(e,n,t)=>{t.d(n,{g:()=>o});var r=t(64467),a=t(57394),o=function(e,n){var t,o=(t={},(0,r.A)((0,r.A)((0,r.A)((0,r.A)((0,r.A)((0,r.A)((0,r.A)((0,r.A)((0,r.A)((0,r.A)(t,a.Y.TEXT_MESSAGE,(function(){var n;return(null==(n=e.textMessage)?void 0:n.text)||""})),a.Y.PICTURE_MESSAGE,(function(){return(0,a.t)("im_general_chat_text_preview_image")})),a.Y.VIDEO_MESSAGE,(function(){return(0,a.t)("im_general_chat_text_preview_video")||"[Video]"})),a.Y.VOICE_MESSAGE,(function(){return(0,a.t)("im_general_chat_text_preview_voice_message")||"[Voice]"})),a.Y.SYSTEM_MESSAGE,(function(){return(0,a.aB)(e,n)})),a.Y.MESSAGE_RECALLED,(function(){return(0,a.t)("im_general_chat_text_preview_message_recalled")})),a.Y.MESSAGE_RECALLED_BY_ADMIN,(function(){return(0,a.t)("im_group_chat_alert_admin_recalled_message")})),a.Y.VOICE_CALL_MESSAGE,(function(){return(0,a.aC)(e)})),a.Y.MEDIA_MESSAGE,(function(){return(0,a.t)("im_general_chat_text_preview_file")})),a.Y.CUSTOM_MESSAGE,(function(){return(0,a.aD)(e,n)})),(0,r.A)(t,a.Y.GROUP_INVITATION_MESSAGE,(function(){return(0,a.t)(e.isSender?"im_notification_label_group_chat_invite_sent_no_var":"im_notification_label_group_chat_invite_received")})))[null==e?void 0:e.contentType];return o?o():(0,a.aE)().showText}},74176:(e,n,t)=>{t.d(n,{G:()=>a,a:()=>s,b:()=>i,c:()=>o,e:()=>c});var r=t(64467),a=function(e){return e[e.OWNER=0]="OWNER",e[e.ADMIN=1]="ADMIN",e[e.NORMAL=2]="NORMAL",e}(a||{}),o=function(e){return e[e.NORMAL=0]="NORMAL",e[e.DISMISS=1]="DISMISS",e}(o||{}),i=function(e){return e[e.NORMAL=0]="NORMAL",e[e.MUTED=1]="MUTED",e[e.QUITED=2]="QUITED",e}(i||{}),s=(0,r.A)((0,r.A)((0,r.A)({},0,"im_group_chat_tag_owner"),1,"im_group_chat_tag_admin"),2,""),c=function(e){return e[e.NOVICE_GROUP=0]="NOVICE_GROUP",e[e.CURRENCY_GROUP=1]="CURRENCY_GROUP",e[e.CUSTOMER_SERVICE=2]="CUSTOMER_SERVICE",e[e.COMMUNITY_NOVICE=3]="COMMUNITY_NOVICE",e[e.COMMON=4]="COMMON",e[e.MERCHANT=5]="MERCHANT",e[e.AFFILIATE=6]="AFFILIATE",e[e.SOCIAL_TRADING=7]="SOCIAL_TRADING",e[e.OK_ASSISTANT=8]="OK_ASSISTANT",e[e.DEFAULT=100]="DEFAULT",e}(c||{})},76256:(e,n,t)=>{t.d(n,{A:()=>_n});var r=t(60436),a=t(53986),o=t(64467),i=t(89379),s=t(5544),c=t(90675),u=t(10467),l=t(23029),d=t(92901),m=t(50388),f=t(52176),p=t(53954),v=t(85501),h=t(25721),g=t(98911),_=t(41594),A=t(57394),E=t(83573),b=t(26204),C=t(67146),y=t(30187),S=t(72768),M=t(62576),I=t(95577),k=t(47612),x=t(49047),w=t(91423),T=t(85349),N=t(74176),R=t(15696),L=t(46042),O=t(34738),U="_tips_1s5st_1",P="_operationBox_1s5st_8",D="_left_1s5st_16",G="_right_1s5st_22",q="_title_1s5st_29",B=function(e){var n=e.tip,t=e.children,r=e.className;return _.createElement(_.Fragment,null,n&&_.createElement("div",{className:U},n),_.createElement("div",{className:E(P,r)},t))};B.LeftContent=function(e){var n=e.children,t=e.className;return _.createElement("div",{className:E(D,t)},n)},B.RightContent=function(e){var n=e.title,t=e.children,r=e.className;return _.createElement("div",{className:E(G,r)},_.createElement("div",{className:E(q)},n),t)};var H=t(30508),F=["channel"];function V(e,n,t){return n=(0,p.A)(n),(0,m.A)(e,(0,f.A)()?Reflect.construct(n,t||[],(0,p.A)(e).constructor):n.apply(e,t))}var W={GET_GROUP_MEMBER_LIST:"".concat(g.I,"/group/member/v1/list"),GET_GROUP_INFO:"".concat(g.I,"/group/v1/info"),UPDATE_GROUP_SETTINGS:"".concat(g.I,"/group/v1/update"),SET_GROUP_ROLE:"".concat(g.I,"/group/v1/set-role"),CREATE_GROUP_CHAT:"".concat(g.I,"/group/v1/create"),POST_QUIT_GROUP:"".concat(g.I,"/group/member/v1/quit"),POST_REMOVE_MEMBER:"".concat(g.I,"/group/v1/remove-member"),POST_TRANSFER_OWNERSHIP:"".concat(g.I,"/group/v1/transfer-owner"),POST_ADD_MEMBER:"".concat(g.I,"/admin/add-users-to-group"),UPLOAD_GROUP_IMAGE:"".concat(g.U,"/group/images")},Y=function(e){function n(){return(0,l.A)(this,n),V(this,n,arguments)}return(0,v.A)(n,e),(0,d.A)(n,[{key:"quitGroup",value:function(){var e=(0,u.A)((0,c.A)().mark((function e(n){var t;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.groupId,e.next=3,this.imHttp.post(W.POST_QUIT_GROUP,{groupId:t});case 3:return this.driver.groupController.hideGroup(t),e.abrupt("return",!0);case 5:case"end":return e.stop()}}),e,this)})));return function(n){return e.apply(this,arguments)}}()},{key:"disbandGroup",value:function(){var e=(0,u.A)((0,c.A)().mark((function e(n){var t;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.groupId,e.next=3,this.imHttp.post(W.UPDATE_GROUP_SETTINGS,{groupId:t,disbandGroup:1});case 3:return this.driver.groupController.hideGroup(t),e.abrupt("return",!0);case 5:case"end":return e.stop()}}),e,this)})));return function(n){return e.apply(this,arguments)}}()},{key:"kickedFromGroup",value:function(){var e=(0,u.A)((0,c.A)().mark((function e(n){var t;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.groupId,e.next=3,this.driver.conversationController.getConversationList({channelIds:[t]});case 3:return e.abrupt("return",!0);case 4:case"end":return e.stop()}}),e,this)})));return function(n){return e.apply(this,arguments)}}()},{key:"updateGroupSettings",value:function(){var e=(0,u.A)((0,c.A)().mark((function e(n){var t;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.imHttp.post(W.UPDATE_GROUP_SETTINGS,n);case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e,this)})));return function(n){return e.apply(this,arguments)}}()},{key:"updateGroupName",value:function(){var e=(0,u.A)((0,c.A)().mark((function e(n){var t,r,a;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.groupId,r=n.groupName,e.next=3,this.updateGroupSettings({groupId:t,groupName:r});case 3:return a=e.sent,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e,this)})));return function(n){return e.apply(this,arguments)}}()},{key:"uploadGroupImage",value:function(e){var n=e.dataUrl;return this.imHttp.post(W.UPLOAD_GROUP_IMAGE,{imageStr:n})}},{key:"updateGroupAvatar",value:function(){var e=(0,u.A)((0,c.A)().mark((function e(n){var t,r,a,o,i;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.groupId,r=n.dataUrl,e.next=3,this.uploadGroupImage({dataUrl:r});case 3:return a=e.sent,o=a.imageId,e.next=7,this.updateGroupSettings({groupId:t,groupAvatar:o});case 7:return i=e.sent,e.abrupt("return",i);case 9:case"end":return e.stop()}}),e,this)})));return function(n){return e.apply(this,arguments)}}()},{key:"setGroupAdmin",value:function(){var e=(0,u.A)((0,c.A)().mark((function e(n){var t,r,a,o;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.memberUids,r=n.groupId,a=n.roleToUpdate,e.next=3,this.imHttp.post(W.SET_GROUP_ROLE,{memberUids:t,groupId:r,roleToUpdate:a});case 3:return o=e.sent,e.abrupt("return",o);case 5:case"end":return e.stop()}}),e,this)})));return function(n){return e.apply(this,arguments)}}()},{key:"removeGroupMember",value:function(){var e=(0,u.A)((0,c.A)().mark((function e(n){var t,r,a,o;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.memberUids,r=n.groupId,a=n.service,e.next=3,this.imHttp.post(W.POST_REMOVE_MEMBER,{groupMemberUidList:t,groupId:r,service:a,scenarioType:0});case 3:return o=e.sent,e.abrupt("return",o);case 5:case"end":return e.stop()}}),e,this)})));return function(n){return e.apply(this,arguments)}}()},{key:"transferOwnership",value:function(){var e=(0,u.A)((0,c.A)().mark((function e(n){var t,r,a;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.groupId,r=n.userUid,e.next=3,this.imHttp.post(W.POST_TRANSFER_OWNERSHIP,{userUid:r,groupId:t});case 3:return a=e.sent,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e,this)})));return function(n){return e.apply(this,arguments)}}()}])}(g.C),j=function(e){var n=e.channel,t=(0,A.u)().client,r=(0,_.useState)(!1),a=(0,s.A)(r,2),o=a[0],i=a[1],l=function(){var e=(0,u.A)((0,c.A)().mark((function e(r){var a,s,u,l;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!o){e.next=2;break}return e.abrupt("return");case 2:return i(!0),u=N.G.NORMAL,l="im_group_chat_toast_admin_removed",e.next=7,null==(s=null==t?void 0:t.driver.groupMgmtController)?void 0:s.setGroupAdmin({memberUids:[null==(a=null==r?void 0:r.userInfo)?void 0:a.userUid],groupId:n.channelId,roleToUpdate:u}).catch((function(){i(!1)}));case 7:e.sent&&(i(!1),b.A.success((0,A.t)(l)));case 9:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return _.createElement(T.M,{hideSearchBox:!0,nextfixRenderer:function(e){return _.createElement(A.I,{tipTitle:(0,A.t)("im_group_chat_textbtn_remove_admins"),iconUrl:"".concat((0,A.g)(),"/cdn/assets/imgs/2311/8BD93924A292421D.svg"),clickHandler:function(){l(e)},disabled:o})},onlyShowAdmin:!0,hideOwner:!0})},z="_editor_7j87v_1",K="_previewArea_7j87v_6",X="_mask_7j87v_13",J="_draggedImg_7j87v_32",Q=304;function Z(e,n,t,r){if(n.current&&t.current){var a=n.current.sX,o=n.current.sY;(0,A.q)(e)&&e.targetTouches[0]?(a=e.targetTouches[0].clientX,o=e.targetTouches[0].clientY):(0,A.s)(e)&&(a=e.clientX,o=e.clientY);var s=a-n.current.sX,c=o-n.current.sY;r((function(e){if(!e)return e;var n=(0,i.A)((0,i.A)({},e),{},{x:e.x+s,y:e.y+c});return t.current?function(e,n){if(!n)return e;var t=n.clientWidth,r=n.clientHeight,a=e.width,o=e.height,s=e.x,c=e.y,u=(t-Q)/2,l=(r-Q)/2,d=u,m=l,f=Math.min(Q+u-a,d),p=Math.min(Q+l-o,m);return(0,i.A)((0,i.A)({},e),{},{x:Math.max(Math.min(d,s),f),y:Math.max(Math.min(m,c),p)})}(n,t.current):n})),Object.assign(n,{current:{sX:a,sY:o}})}}var $=(0,_.forwardRef)((function(e,n){var t=e.file,r=(0,_.useState)(),a=(0,s.A)(r,2),o=a[0],c=a[1],u=(0,_.useState)(),l=(0,s.A)(u,2),d=l[0],m=l[1],f=(0,_.useRef)(null),p=(0,_.useRef)(null),v=(0,_.useRef)();(0,_.useEffect)((function(){var e=window.URL.createObjectURL(t);return c(e),function(){window.URL.revokeObjectURL(e)}}),[t]);(0,_.useImperativeHandle)(n,(function(){return{savePreviewImage:function(){return function(e,n,t,r){var a=document.createElement("canvas"),o=a.getContext("2d");if(o&&e&&n.current&&t.current){var i=e.height,s=e.width,c=e.x,u=e.y,l=t.current,d=l.clientWidth,m=l.clientHeight,f=s/n.current.naturalWidth,p=(d-Q)/2,v=(m-Q)/2,h=Math.min(i,s)/f;f<1?(a.width=h*f,a.height=h*f,o.scale(f,f)):(a.width=h,a.height=h),o.drawImage(n.current,(p-c)/f,(v-u)/f,h,h,0,0,h,h),o.save();var g=r.type;return a.toDataURL(g)}}(d,f,p,t)}}}));var h=function(e){(0,A.q)(e)&&e.targetTouches[0]?v.current={sX:e.targetTouches[0].clientX,sY:e.targetTouches[0].clientY}:(0,A.s)(e)&&(v.current={sX:e.clientX,sY:e.clientY})},g=(0,_.useMemo)((function(){return(0,O.A)((function(e){Z(e,v,p,m)}),30)}),[]),E=function(){v.current=void 0};return o?_.createElement("div",{className:z},_.createElement("div",{className:K,ref:p},_.createElement("div",{className:X,"aria-hidden":!0,id:"mask-box",style:{width:Q,height:Q},onTouchStart:h,onTouchMove:g,onTouchEnd:E,onMouseDown:h,onMouseMove:g,onMouseUp:E,onMouseLeave:E}),_.createElement("img",{ref:f,alt:"current-file",src:o,style:{display:"none"},onLoad:function(e){if(p.current){var n=e.target,t=n.width/n.height,r=p.current,a=r.clientWidth,o=r.clientHeight,i=Q*Math.max(t,1),s=Q/Math.min(t,1);m({height:s,width:i,x:(a-i)/2,y:(o-s)/2})}}}),_.createElement("div",{id:"preview-img",className:J,style:(0,i.A)({backgroundImage:"url(".concat(o,")")},d&&{backgroundSize:"".concat(d.width,"px ").concat(d.height,"px"),backgroundPosition:"".concat(d.x,"px ").concat(d.y,"px")})}))):null})),ee="_editBtn_gvf87_1",ne="_editIcon_gvf87_14",te=function(e){var n=e.className,t=e.onEditComplete,r=(0,_.useRef)(null),a=(0,_.useRef)(null);return _.createElement(C.A,{onClick:function(){var e,n;return null==(n=null==(e=r.current)?void 0:e.click)?void 0:n.call(e)},className:E(ee,n)},_.createElement(y.A,{className:ne,src:"".concat((0,A.g)(),"/cdn/assets/imgs/243/C6FF90BF07FDF167.svg"),width:11,height:11}),_.createElement("input",{ref:r,type:"file",accept:"image/jpeg,image/jpg,image/png",style:{display:"none"},onChange:function(e){var n,o=null==(n=e.target.files)?void 0:n[0];if(r.current&&(r.current.value=""),r.current&&r.current.blur(),e.stopPropagation(),o)var i=A.D.show({title:(0,A.t)("im_affiliate_group_header_set_group_photo"),children:_.createElement($,{ref:a,file:o}),noContentPadding:!0,confirmText:(0,A.t)("im_general_use_btn_save"),onConfirm:function(){var e=(0,u.A)((0,c.A)().mark((function e(){var n,r;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.update({confirmLoading:!0}),r=null==(n=a.current)?void 0:n.savePreviewImage()){e.next=5;break}return i.update({confirmLoading:!1}),e.abrupt("return");case 5:return e.next=7,t({dataUrl:r}).finally((function(){i.update({confirmLoading:!1})}));case 7:i.destroy();case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),cancelText:(0,A.t)("im_general_use_btn_cancel")})}}))},re="_textDisplay_1qzrd_1",ae="_editIcon_1qzrd_7",oe="_textEditor_1qzrd_10",ie="_textArea_1qzrd_10",se=function(e){var n=e.className,t=e.text,r=e.onEditComplete,a=(0,_.useState)(!1),o=(0,s.A)(a,2),i=o[0],l=o[1],d=(0,_.useState)(t),m=(0,s.A)(d,2),f=m[0],p=m[1],v=(0,_.useState)(),h=(0,s.A)(v,2),g=h[0],b=h[1],C=function(){var e=(0,u.A)((0,c.A)().mark((function e(){var n;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f!==t&&f){e.next=3;break}return l(!1),e.abrupt("return");case 3:return e.next=5,r(f);case 5:(null==(n=e.sent)?void 0:n.success)?l(!1):(null==n?void 0:n.error)&&b((0,A.t)(n.error));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,_.useEffect)((function(){p(t)}),[t]),i?_.createElement(S.A.TextArea,{className:E(oe,n),placeholder:t,value:f,onChange:function(e){return p(e.target.value)},error:g,showCount:!0,maxLength:100,inputClassName:ie,rows:1,onBlur:C,onKeyDown:function(e){"Enter"===e.key&&(e.preventDefault(),C())}}):_.createElement(A.F,{className:E(re,n)},_.createElement(A.O,null,f||t),_.createElement(A.I,{className:ae,iconUrl:"".concat((0,A.g)(),"/cdn/assets/imgs/243/45E2F5F39793E5BE.svg"),clickHandler:function(){return b(void 0),l(!0)}}))},ce=function(e,n){return n<e},ue=function(){var e=(0,A.u)().client,n=(0,A.d)(),t=n.currGroupRole,r=n.groupId,a=(0,_.useCallback)((function(e){return t<e}),[t]),o=(0,_.useCallback)(function(){var n=(0,u.A)((0,c.A)().mark((function n(t){var a,o;return(0,c.A)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a=t.memberUids,e){n.next=4;break}throw(0,A.w)(),new Error("sdk not setup");case 4:if(r){n.next=6;break}return n.abrupt("return",void 0);case 6:return n.next=8,e.driver.groupMgmtController.removeGroupMember({groupId:r,memberUids:a,service:A.v.IM});case 8:return(o=n.sent)&&b.A.success((0,A.t)("im_remove_member_toast_user_has_been_removed",{memberNum:(null==o?void 0:o.successCount)||0})),n.abrupt("return",o);case 11:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),[e,r]),i=(0,_.useCallback)((function(e){return new Promise((function(n,t){var r=A.D.confirmation({title:(0,A.t)("im_remove_member_notification_title_remove_group_members"),children:_.createElement("span",{className:"im-dialog-confirmation-content"},(0,A.t)("im_remove_member_notification_desc_permanently_remove")),confirmText:(0,A.t)("im_group_chat_btn_remove"),confirmBtnProps:{type:M.A.TYPE.red,category:M.A.CATEGORY.fill},cancelText:(0,A.t)("im_general_use_btn_cancel"),onConfirm:function(){var a=(0,u.A)((0,c.A)().mark((function a(){var i;return(0,c.A)().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return r.update({confirmLoading:!0}),a.next=3,o(e).catch((function(e){r.update({confirmLoading:!1}),t(e)}));case 3:if(i=a.sent,r.update({confirmLoading:!1}),i){a.next=8;break}return n(i),a.abrupt("return");case 8:r.destroy(),n(i);case 10:case"end":return a.stop()}}),a)})));return function(){return a.apply(this,arguments)}}()})}))}),[o]);return{checkCanRemoveMember:a,removeGroupMembers:o,promptRemoveGroupMembers:i}},le="_groupAdminSetDialog_fjxhs_1",de="_groupAdminSetDialogContainer_fjxhs_1",me="_adminSetDialogOperationBox_fjxhs_4",fe="_adminSetMemberList_fjxhs_7",pe="_memberItemCheckbox_fjxhs_12",ve="_leftPartBox_fjxhs_18",he="_rightPartBox_fjxhs_21",ge="_memberItemCloseIcon_fjxhs_25",_e="add",Ae="remove",Ee="transfer_owner",be="remove_group_member",Ce=(0,o.A)((0,o.A)((0,o.A)((0,o.A)({},_e,{title:"im_group_chat_modaltitle_add_admins",confirmText:"im_group_chat_btn_add",tips:"im_group_chat_modaldesc_add_admins",maxSelectCount:20,confirmBtnType:M.A.TYPE.highlight}),Ae,{title:"im_group_chat_modaltitle_remove_admins",confirmText:"im_group_chat_btn_remove",tips:"im_group_chat_modaldesc_add_admins",maxSelectCount:20,confirmBtnType:M.A.TYPE.red}),Ee,{title:"im_group_chat_modaltitle_transfer_ownership",confirmText:"im_group_chat_btn_transfer",maxSelectCount:1,confirmBtnType:M.A.TYPE.highlight}),be,{title:"im_remove_member_header_remove_members",confirmText:"im_group_chat_btn_remove",tips:"im_remove_member_text_select_members",confirmBtnType:M.A.TYPE.red}),ye=function(e){var n,t,r,a,o=e.visible,i=e.channel,l=e.mode,d=void 0===l?_e:l,m=e.updateVisible,f=(0,A.u)().client,p=ue().removeGroupMembers,v=(0,_.useState)(new Map),h=(0,s.A)(v,2),g=h[0],E=h[1],y=(0,_.useState)(!1),S=(0,s.A)(y,2),k=S[0],x=S[1],w=function(e,n){e?g.set(null==n?void 0:n.memberUid,n):g.delete(null==n?void 0:n.memberUid),E(new Map(g))};(0,_.useEffect)((function(){o||E(new Map)}),[o]);var R=(0,_.useMemo)((function(){var e=i.memberListMap?Array.from(i.memberListMap.values()):[];return d===Ae?e.filter((function(e){return e.role===N.G.ADMIN})):d===be?e.filter((function(e){var n=e.role;return ce(n,i.role)})):e}),[i.memberListMap,i.role,d]),L=(0,_.useMemo)((function(){return Array.from(g.values())||[]}),[g]),O=function(){var e=(0,u.A)((0,c.A)().mark((function e(){var n,t,r;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=L.map((function(e){return e.memberUid})),x(!0),t=d===_e?N.G.ADMIN:N.G.NORMAL,r="im_group_chat_toast_admin_added",t===N.G.ADMIN?n.length>1&&(r="im_group_chat_toast_admins_added"):r=n.length>1?"im_group_chat_toast_admins_removed":"im_group_chat_toast_admin_removed",e.next=7,null==f?void 0:f.driver.groupMgmtController.setGroupAdmin({memberUids:n,groupId:i.channelId,roleToUpdate:t}).catch((function(){x(!1)}));case 7:e.sent&&(x(!1),b.A.success((0,A.t)(r)),E(new Map),m(!1));case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),U=function(){var e=(0,u.A)((0,c.A)().mark((function e(){var n;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=L[0].memberUid,x(!0),e.next=4,null==f?void 0:f.driver.groupMgmtController.transferOwnership({userUid:n,groupId:i.channelId}).catch((function(){x(!1)}));case 4:e.sent&&(x(!1),E(new Map),m(!1));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),P=function(){var e=(0,u.A)((0,c.A)().mark((function e(){var n,t;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=L.map((function(e){return e.memberUid})),x(!0),e.next=4,p({memberUids:n}).catch((function(){x(!1)}));case 4:if(t=e.sent,x(!1),t){e.next=8;break}return e.abrupt("return");case 8:E(new Map),m(!1);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return _.createElement(A.D,{className:le,containerClassName:de,title:(0,A.t)(null==(n=Ce[d])?void 0:n.title),visible:o,confirmText:(0,A.t)(null==(t=Ce[d])?void 0:t.confirmText),confirmBtnProps:{type:(null==(r=Ce[d])?void 0:r.confirmBtnType)||M.A.TYPE.highlight,category:M.A.CATEGORY.fill},cancelText:(0,A.t)("im_general_use_btn_cancel"),onCancel:function(){m(!1)},confirmDisabled:0===L.length,onConfirm:function(){d!==Ee?d!==be?O():P():U()},hideCloseBtn:!0,width:700,confirmLoading:k},_.createElement(B,{className:me,tip:(0,A.t)(null==(a=Ce[d])?void 0:a.tips)},_.createElement(B.LeftContent,{className:ve},_.createElement(T.M,{className:fe,prefixRenderer:function(e){var n=d===_e&&(0,T.h)(null==e?void 0:e.role),t=g.has(null==e?void 0:e.memberUid),r=Ce[d],a=null==r?void 0:r.maxSelectCount;d===_e&&(a-=R.filter((function(e){return e.role===N.G.ADMIN})).length);var o=(null==r?void 0:r.maxSelectCount)&&g.size>=a&&!t;return _.createElement(I.A,{className:pe,onChange:function(n){w(n.target.checked,e)},disabled:n||!!o,checked:n||t})},searchPlaceholder:(0,A.b)("im_group_chat_placeholder_search_name_email"),hideOwner:!0,propsMemberList:R,disableAdmin:d===_e})),_.createElement(B.RightContent,{className:he,title:(0,A.t)(L.length<=1?"im_group_chat_text_selected_number_single":"im_group_chat_text_selected_number",{number:L.length})},_.createElement(T.M,{className:fe,hideSearchBox:!0,nextfixRenderer:function(e){return _.createElement(C.A,{"aria-label":(0,A.t)("im_group_chat_btn_remove"),onClick:function(){return w(!1,e)}},_.createElement("img",{alt:"",src:"".concat((0,A.g)(),"/cdn/assets/imgs/237/550FE9483DE674AC.svg"),className:ge}))},propsMemberList:L}))))},Se="_groupMemberRow_1uwmu_1",Me="_memberDisplay_1uwmu_10",Ie="_toolButton_1uwmu_17",ke="_displayName_1uwmu_25",xe="_actionIcon_1uwmu_37",we=(0,R.observer)((function(e){var n=e.className,t=e.memberList,r=e.withAddIcon,a=void 0!==r&&r,o=e.onAddClicked,i=e.withRemoveIcon,s=void 0!==i&&i,c=e.onRemoveClicked,u=(0,A.u)().store;if(!(null==t?void 0:t.length))return null;var l=5-Number(a)-Number(s);return _.createElement("div",{className:E(Se,n)},t.slice(0,l).map((function(e){var n=(null==e?void 0:e.userInfo)||{userUid:e.memberUid};return _.createElement("div",{className:Me,key:e.memberUid},_.createElement(A.A,{userInfo:n,withProfile:!0,channelType:A.C.GROUP}),_.createElement("div",{className:ke},(0,A.h)(n,u.userRegistryStore)))})),a&&_.createElement(C.A,{className:E(Me,Ie),onClick:o,type:"button"},_.createElement(y.A,{src:"".concat((0,A.g)(),"/cdn/assets/imgs/237/F5A2D248AA1FB8D0.svg"),"aria-hidden":!0,className:xe,height:40,width:40}),_.createElement("span",{className:ke},(0,A.t)("im_group_chat_textbtn_add_admins"))),s&&_.createElement(C.A,{className:E(Me,Ie),onClick:c},_.createElement(y.A,{src:"".concat((0,A.g)(),"/cdn/assets/imgs/237/6483360983150D00.svg"),alt:(0,A.b)("im_group_chat_textbtn_remove_admins"),className:xe,"aria-hidden":!0,height:40,width:40}),_.createElement("span",{className:ke},(0,A.t)("im_group_chat_textbtn_remove_admins"))))})),Te="_managementSettings_9lcp5_1",Ne="_groupInfo_9lcp5_1",Re="_groupName_9lcp5_10",Le="_groupMembers_9lcp5_20",Oe="_membersTitle_9lcp5_26",Ue="_titleText_9lcp5_32",Pe="_viewAll_9lcp5_39",De="_viewAllContent_9lcp5_39",Ge="_membersListMini_9lcp5_45",qe="_groupSettings_9lcp5_49",Be="_settingsTitleText_9lcp5_62",He="_settingsTitleIcon_9lcp5_70",Fe="_actionButtonWrap_9lcp5_75",Ve="_actionButton_9lcp5_75",We="_groupAvatar_9lcp5_84",Ye="_editAvatarBtn_9lcp5_87",je=(0,L.W)((0,R.observer)((function(e){var n,t,r,a,o=e.channel,i=e.groupInfo,l=e.updateCurrentPage,d=(0,A.u)(),m=d.client,f=d.store,p=(0,_.useState)(!1),v=(0,s.A)(p,2),h=v[0],g=v[1],y=function(){var e=(0,A.u)().client,n=(0,A.d)().groupId,t=(0,_.useCallback)((0,u.A)((0,c.A)().mark((function t(){var r;return(0,c.A)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=3;break}throw(0,A.w)(),new Error("sdk not setup");case 3:if(n){t.next=5;break}return t.abrupt("return",void 0);case 5:return t.next=7,e.driver.groupMgmtController.quitGroup({groupId:n});case 7:return r=t.sent,t.abrupt("return",r);case 9:case"end":return t.stop()}}),t)}))),[e,n]),r=(0,_.useCallback)((function(){return new Promise((function(e,n){var r=A.D.confirmation({title:(0,A.t)("im_group_chat_modaltitle_leave_group"),children:_.createElement("span",{className:"im-dialog-confirmation-content"},(0,A.t)("im_group_chat_modaldesc_leave_group")),confirmText:(0,A.t)("im_group_chat_btn_leave_group"),confirmBtnProps:{type:M.A.TYPE.red,category:M.A.CATEGORY.fill},cancelText:(0,A.t)("im_general_use_btn_cancel"),onConfirm:function(){var a=(0,u.A)((0,c.A)().mark((function a(){var o;return(0,c.A)().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return r.update({confirmLoading:!0}),a.next=3,t().catch((function(e){r.update({confirmLoading:!1}),n(e)}));case 3:if(o=a.sent,r.update({confirmLoading:!1}),o){a.next=8;break}return e(o),a.abrupt("return");case 8:r.destroy(),e(o);case 10:case"end":return a.stop()}}),a)})));return function(){return a.apply(this,arguments)}}()})}))}),[t]);return{leaveGroup:t,promptLeaveGroup:r}}(),S=y.promptLeaveGroup,I=function(){var e=(0,A.u)().client,n=(0,A.d)().groupId,t=(0,_.useCallback)((0,u.A)((0,c.A)().mark((function t(){var r;return(0,c.A)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=3;break}throw(0,A.w)(),new Error("sdk not setup");case 3:if(n){t.next=5;break}return t.abrupt("return",void 0);case 5:return t.next=7,e.driver.groupMgmtController.disbandGroup({groupId:n});case 7:return r=t.sent,t.abrupt("return",r);case 9:case"end":return t.stop()}}),t)}))),[e,n]),r=(0,_.useCallback)((function(){return new Promise((function(e,n){var r=A.D.confirmation({title:(0,A.t)("im_group_chat_modaltitle_disband_delete_group"),children:_.createElement("span",{className:"im-dialog-confirmation-content"},(0,A.t)("im_group_chat_modaldesc_disband_delete_group")),confirmText:(0,A.t)("im_group_chat_btn_disband"),confirmBtnProps:{type:M.A.TYPE.red,category:M.A.CATEGORY.fill},cancelText:(0,A.t)("im_general_use_btn_cancel"),onConfirm:function(){var a=(0,u.A)((0,c.A)().mark((function a(){var o;return(0,c.A)().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return r.update({confirmLoading:!0}),a.next=3,t().catch((function(e){r.update({confirmLoading:!1}),n(e)}));case 3:if(o=a.sent,r.update({confirmLoading:!1}),o){a.next=8;break}return e(o),a.abrupt("return");case 8:r.destroy(),e(o);case 10:case"end":return a.stop()}}),a)})));return function(){return a.apply(this,arguments)}}()})}))}),[t]);return{disbandGroup:t,promptDisbandGroup:r}}(),w=I.promptDisbandGroup,T=(0,_.useMemo)((function(){var e;return null==(e=null==i?void 0:i.members)?void 0:e.some((function(e){return ce(e.role,null==o?void 0:o.role)}))}),[null==o?void 0:o.role,null==i?void 0:i.members]),N=null==(t=null==(n=o.groupInfo)?void 0:n.userGroupPermission)?void 0:t.updateGroupSettings,R=null==(a=null==(r=o.groupInfo)?void 0:r.userGroupPermission)?void 0:a.disbandGroup;return _.createElement("div",{className:E(Te)},_.createElement(A.F,{className:Ne},_.createElement(A.S,{isGroup:!0,userInfo:o.entityInfo,width:80,height:80,className:We},N?_.createElement(te,{className:Ye,onEditComplete:function(){var e=(0,u.A)((0,c.A)().mark((function e(n){var t,r,a;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.dataUrl,e.prev=1,e.next=4,null==m?void 0:m.driver.groupMgmtController.updateGroupAvatar({groupId:o.channelId,dataUrl:t});case 4:return r=e.sent,(a=null==r?void 0:r.result)&&b.A.success((0,A.t)("im_general_toast_changes_saved")),e.abrupt("return",a);case 10:return e.prev=10,e.t0=e.catch(1),console.error(e.t0),e.abrupt("return",!1);case 14:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(n){return e.apply(this,arguments)}}()}):null),N?_.createElement(se,{className:Re,text:(0,A.h)(o.entityInfo,f.userRegistryStore),onEditComplete:function(){var e=(0,u.A)((0,c.A)().mark((function e(n){var t,r;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,null==m?void 0:m.driver.groupMgmtController.updateGroupName({groupId:o.channelId,groupName:n});case 3:return t=e.sent,(r=null==t?void 0:t.result)&&b.A.success((0,A.t)("im_general_toast_changes_saved")),e.abrupt("return",{success:!!r});case 9:return e.prev=9,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",{success:!1,error:(0,A.t)("im_affiliate_group_alert_desc_enter_a_valid_group")});case 13:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(n){return e.apply(this,arguments)}}()}):_.createElement(A.O,{className:Re},(0,A.h)(o.entityInfo,f.userRegistryStore))),_.createElement("div",{className:Le},_.createElement("div",{className:Oe},_.createElement("div",{className:Ue},(0,A.t)("im_group_chat_title_members")),i&&_.createElement(C.A,{onClick:function(){l(!1,"groupMemberList")}},_.createElement(k.A,{type:k.A.TYPE.primary,withRightIcon:!0,weight:k.A.WEIGHT.muted,size:k.A.SIZE.xs,className:Pe,linkClassName:De},(0,A.t)("im_group_chat_textbtn_view_all",{number:i.memberCount})))),_.createElement(we,{memberList:null==i?void 0:i.members,className:Ge,withRemoveIcon:T,onRemoveClicked:function(){g(!0)}}),T&&_.createElement(ye,{visible:h,channel:o,updateVisible:g,mode:be})),N&&_.createElement(C.A,{type:"button","data-im-btn-full":!0,className:qe,onClick:function(){l(!1,"groupSettings")}},_.createElement("span",{className:Be},(0,A.t)("im_group_chat_title_group_settings")),_.createElement("span",{className:He},_.createElement(x.A,{iconName:"okds-arrow-chevron-right-centered-md"}))),_.createElement("div",{className:Fe},R?_.createElement(M.A,{className:Ve,category:M.A.CATEGORY.text,type:M.A.TYPE.red,block:!0,rect:!0,onClick:function(){return w()}},(0,A.t)("im_group_chat_btn_disband_and_delete")):_.createElement(M.A,{className:Ve,category:M.A.CATEGORY.text,type:M.A.TYPE.red,block:!0,rect:!0,onClick:function(){return S()}},(0,A.t)("im_group_chat_btn_leave_group"))))})),"GroupLandingPage"),ze=(0,L.W)((function(e){e.channel;var n=(0,a.A)(e,F),t=ue(),r=t.promptRemoveGroupMembers,o=t.checkCanRemoveMember;return _.createElement(T.M,(0,i.A)({nextfixRenderer:function(e){return o(e.role)?_.createElement(A.I,{tipTitle:(0,A.t)("im_group_chat_textbtn_remove_admins"),iconUrl:"".concat((0,A.g)(),"/cdn/assets/imgs/2311/8BD93924A292421D.svg"),clickHandler:function(){r({memberUids:[e.memberUid]})}}):null}},n))}),"GroupMemberListPage"),Ke="_container_1az5y_1",Xe="_settingsWrapper_1az5y_7",Je="_rowEnd_1az5y_15",Qe="_rowText_1az5y_21",Ze="_text_1az5y_30",$e="_membersContainer_1az5y_36",en="_row_1az5y_15",nn="_main_1az5y_45",tn="_settingRowStart_1az5y_49",rn="_title_1az5y_52",an="_desc_1az5y_59",on="_settingRowEnd_1az5y_66",sn=function(e){var n=e.className,t=e.title,r=e.desc,a=e.rightNode,o=e.checked,i=e.extraNode,c=e.onSwitchChange,u=(0,_.useState)(!1),l=(0,s.A)(u,2),d=l[0],m=l[1];return(0,_.useEffect)((function(){m(!1)}),[o]),_.createElement("div",{className:E(en,n)},_.createElement("div",{className:nn},_.createElement("div",{className:tn},_.createElement("div",{className:rn},t),_.createElement("div",{className:an},r)),_.createElement("div",{className:on},a||_.createElement(w.A,{size:w.A.SIZE.sm,checked:o,onChange:function(e){c&&(m(!0),c(e))},loading:d}))),i)},cn=(0,R.observer)((function(e){var n=e.className,t=e.channel,r=e.updateCurrentPage,a=(0,_.useState)(!1),o=(0,s.A)(a,2),i=o[0],c=o[1],u=(0,_.useState)(_e),l=(0,s.A)(u,2),d=l[0],m=l[1],f=function(){c(arguments.length>0&&void 0!==arguments[0]?arguments[0]:!i)},p=t.memberListMap,v=(0,_.useMemo)((function(){var e=[];return Array.from(null==p?void 0:p.values()).some((function(n){return n.role!==N.G.OWNER&&(n.role!==N.G.ADMIN||(e.push(n),!1))})),e}),[p]);return _.createElement(_.Fragment,null,_.createElement(sn,{title:(0,A.t)("im_group_chat_title_admins"),desc:(0,A.t)("im_group_chat_subtitle_admins"),rightNode:function(){var e=v.length?(0,A.t)("im_general_use_textbtn_view_all"):(0,A.t)("im_group_chat_textbtn_add_admins");return _.createElement(C.A,{className:Je,onClick:function(){v.length?r(!1,"groupAdminList"):(m(_e),f(!0))}},_.createElement(k.A,{type:k.A.TYPE.primary,withRightIcon:!0,weight:k.A.WEIGHT.muted,size:k.A.SIZE.xs,className:Qe,linkClassName:Ze},e))}(),extraNode:_.createElement(we,{className:$e,memberList:v,withAddIcon:!0,onAddClicked:function(){m(_e),f(!0)},withRemoveIcon:!0,onRemoveClicked:function(){m(Ae),f(!0)}}),className:n}),_.createElement(ye,{visible:i,channel:t,updateVisible:f,mode:d}))})),un=function(e){var n,t=e.className,r=e.channel,a=(0,_.useState)(!1),o=(0,s.A)(a,2),i=o[0],c=o[1],u=function(){c(arguments.length>0&&void 0!==arguments[0]?arguments[0]:!i)},l=(0,A.d)().groupInfo;return(null==(n=null==l?void 0:l.userGroupPermission)?void 0:n.transferOwner)?_.createElement(_.Fragment,null,_.createElement(sn,{title:(0,A.t)("im_group_chat_title_transfer_ownership"),desc:(0,A.t)("im_group_chat_subtitle_transfer_ownership"),rightNode:_.createElement(C.A,{onClick:function(){return u(!0)}},_.createElement(x.A,{a11yText:(0,A.t)("im_group_chat_btn_transfer"),iconName:"okds-arrow-chevron-right-centered-md"})),className:t}),_.createElement(ye,{visible:i,channel:r,updateVisible:u,mode:Ee})):null},ln=(0,L.W)((function(e){var n,t,r,a,i,l=e.className,d=e.channel,m=e.updateCurrentPage,f=d.groupInfo,p=(0,A.u)().client,v=(0,_.useState)(),h=(0,s.A)(v,2),g=h[0],b=h[1],C=null==(t=null==(n=d.groupInfo)?void 0:n.userGroupPermission)?void 0:t.updateGroupSettings;(0,_.useEffect)((function(){C||m(!0)}),[C]);var y=function(){var e=(0,u.A)((0,c.A)().mark((function e(n,t){var r;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!g){e.next=2;break}return e.abrupt("return");case 2:return b(!0),r=(0,o.A)({groupId:d.channelId},n,t?1:0),e.next=6,null==p?void 0:p.driver.groupMgmtController.updateGroupSettings(r).catch((function(){b(!1)}));case 6:e.sent&&b(!1);case 8:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}();return f?_.createElement("div",{className:E(Ke,l)},_.createElement("div",{className:Xe},(null==(r=null==f?void 0:f.userGroupPermission)?void 0:r.setRole)&&_.createElement(cn,{channel:d,updateCurrentPage:m}),(null==(a=null==f?void 0:f.userGroupPermission)?void 0:a.transferOwner)&&_.createElement(un,{channel:d}),(null==(i=null==f?void 0:f.userGroupPermission)?void 0:i.muteUnmuteMember)&&_.createElement(sn,{title:(0,A.t)("im_group_chat_title_disable_chat"),desc:(0,A.t)("im_group_chat_subtitle_disable_chat"),checked:!f.allowMembersSendMessage,onSwitchChange:function(e){y("allowMembersSendMessage",!e)}}),_.createElement(sn,{title:(0,A.t)("im_group_chat_title_enable_mentions"),desc:(0,A.t)("im_group_chat_subtitle_enable_mentions"),checked:!!f.allowMentionOthers,onSwitchChange:function(e){y("allowMentionOthers",e)}}))):null}),"GroupSettingsPage"),dn="_title_1duvi_1",mn="_leftSection_1duvi_9",fn="_backIcon_1duvi_19",pn=function(e){var n=e.className,t=e.updateShowManagement,r=e.pageInfo,a=e.updateCurrentPage;return _.createElement("div",{className:E(dn,n)},_.createElement("div",{className:mn},r.withBackIcon&&_.createElement(x.A,{className:fn,a11yText:(0,A.t)("commonall_text_btn_back"),iconName:"okds-arrow-chevron-left-centered-md",onClick:function(){a(!0)}}),(0,A.t)(r.titleKey)),_.createElement(H.C,{onClick:function(){return t(!1)},fontSize:24}))},vn="_container_h7o6z_1",hn=function(e){var n=e.className,t=e.channel,a=e.updateShowManagement,o=(0,_.useMemo)((function(){return{groupHome:{name:"groupHome",titleKey:"im_group_chat_maintitle_settings",renderPage:function(e){return _.createElement(je,(0,i.A)({},e))}},groupMemberList:{name:"groupMemberList",titleKey:"im_group_chat_title_members",withBackIcon:!0,renderPage:function(e){return _.createElement(ze,(0,i.A)({},e))}},groupSettings:{name:"groupSettings",titleKey:"im_group_chat_title_group_settings",withBackIcon:!0,renderPage:function(e){return _.createElement(ln,(0,i.A)({},e))}},groupAdminList:{name:"groupAdminList",titleKey:"im_group_chat_title_admins",withBackIcon:!0,renderPage:function(e){return _.createElement(j,(0,i.A)({},e))}}}}),[]),c=(0,_.useState)(["groupHome"]),u=(0,s.A)(c,2),l=u[0],d=u[1],m=function(e,n){if(e&&l.length>=2)return l.shift(),void d((0,r.A)(l));n&&(l.unshift(n),d((0,r.A)(l)))};if(!t)return null;var f=o[l[0]];return _.createElement("div",{className:E(vn,n)},l.length>0&&_.createElement(_.Fragment,null,_.createElement(pn,{updateShowManagement:a,pageInfo:f,updateCurrentPage:m}),f.renderPage({channel:t,groupInfo:t.groupInfo,updateCurrentPage:m})))},gn=function(e){var n=e.channel,t=e.managementBoxClassName,r=(0,_.useState)(!1),a=(0,s.A)(r,2),o=a[0],i=a[1],c=(0,A.d)(),u=c.isGroupInactive,l=c.isGroup,d=null==n?void 0:n.channelId;return(0,_.useEffect)((function(){u&&i(!1)}),[u]),(0,_.useEffect)((function(){d&&i(!1)}),[d]),{groupMgmtToggle:l&&!u?_.createElement(A.I,{as:"icon",iconClassName:E("okds-setting","icon-setting"),tipTitle:(0,A.t)("im_group_chat_hover_settings"),clickHandler:function(){null==i||i(!0)},placement:"bottom"}):null,groupMgmtPanel:l&&o&&n?_.createElement(hn,{channel:n,className:t,updateShowManagement:i}):null}},_n=function(e){function n(){var e;return(0,l.A)(this,n),(e=V(this,n,["groupManagement"])).init=function(n){e.groupMgmtController=new Y(n);var t=n;t.groupMgmtController=e.groupMgmtController,t.pluginModules.useRemoveGroupMemberPrompt=ue,t.pluginModules.useGroupManagement=gn},e}return(0,v.A)(n,e),(0,d.A)(n)}(h.I)},57394:(e,n,t)=>{t.d(n,{$:()=>ae,A:()=>Yn,B:()=>Ne,C:()=>Se,D:()=>wt,E:()=>un,F:()=>zn,G:()=>rt,H:()=>cn,I:()=>tt,J:()=>Tt,K:()=>He,L:()=>Fa,M:()=>Te,N:()=>Bt,O:()=>it,P:()=>ge,Q:()=>he,R:()=>ye,S:()=>et,T:()=>It,U:()=>mt,V:()=>hr,W:()=>pr,X:()=>_e,Y:()=>Ue,Z:()=>Ae,_:()=>Wa,a:()=>Jt,a0:()=>ve,a1:()=>Ee,a2:()=>we,a3:()=>rn,a4:()=>ke,a5:()=>Ge,a6:()=>Le,a7:()=>De,a8:()=>Me,a9:()=>Yr,aA:()=>Oa,aB:()=>ze,aC:()=>fr,aD:()=>Ma,aE:()=>Qr,aF:()=>zt,aG:()=>Wt,aH:()=>pe,aI:()=>dt,aJ:()=>mn,aK:()=>Un,aL:()=>za,aM:()=>xn,aN:()=>Pn,aO:()=>xa,aP:()=>lr,aQ:()=>Nn,aR:()=>Xa,aS:()=>Sa,aT:()=>na,aU:()=>ea,aV:()=>nn,aa:()=>ma,ab:()=>Ze,ac:()=>ln,ad:()=>En,af:()=>Ra,ag:()=>qn,ai:()=>Nt,an:()=>qt,ao:()=>Ht,ap:()=>Ft,au:()=>Re,av:()=>Oe,ay:()=>Qt,az:()=>at,b:()=>Ve,c:()=>Rt,d:()=>Vt,f:()=>Qe,g:()=>Va,h:()=>hn,i:()=>vn,j:()=>fe,m:()=>qe,n:()=>Be,o:()=>An,p:()=>en,q:()=>Xt,r:()=>gn,s:()=>Kt,t:()=>Fe,u:()=>La,v:()=>xe,w:()=>ja});var r,a=t(90675),o=t(10467),i=t(53986),s=t(24765),c=t(23029),u=t(92901),l=t(60436),d=t(89379),m=t(5544),f=t(64467),p=t(30912),v=t(56218),h=t(88951),g=t(19495),_=t(41594),A=t(84854),E=t(4536),b=t(37991),C=t(47649),y=t(80426),S=t(99692),M=t(76851),I=t(57209),k=t(79736),x=t(69434),w=t(72843),T=t(44497),N=t(15696),R=t(49047),L=t(67146),O=t(30187),U=t(76951),P=t(7686),D=t(85937),G=t(26204),q=t(62576),B=t(89208),H=t(88212),F=t(21867),V=t(22822),W=t(83573),Y=t(74176),j=t(33501),z=(t(74747),["highlight"]),K=["className","children"],X=["channelType","className","width","height","userInfo","withProfile","getContainer","onRightClick","onInitIndividualChat","children"],J=["children","className"],Q=["isGroup","className","width","height","userInfo","onRightClick","pictureProps","children"],Z=["children","disableHover","tooltipClassName","className"],$=["className","customName","userInfo","nameTextClassName","customTagClassName","customTag","showOfficialTag","isGroupName","withOverflowTooltip","hidden"],ee=["message","onClose","className","offColor","enableJumpToMsg"],ne=["url","duration","isSender","senderUid"],te=["errorName"],re=function(){return!1},ae=function(){var e;return"prod"===(null==(e=A.A)?void 0:e.envSign)},oe=2,ie=6,se=103,ce=104,ue=105,le=(0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)({},oe,{value:oe,isOfficial:!0,desc:"official",key:"im_group_chat_tag_official"}),ie,{value:ie,isOfficial:!0,desc:"support",key:"im_general_chat_tag_support"}),se,{value:se,isOfficial:!1,desc:"vip",key:"im_vip_tag_to_be_recall"}),ce,{value:ce,isOfficial:!1,desc:"vip",key:"im_vip_tag_monitor"}),ue,{value:ue,isOfficial:!1,desc:"vip",key:"im_vip_tag_urgent"}),de=Object.entries({NOVICE_GROUP:0,CURRENCY_GROUP:1,CUSTOMER_GROUP:2,COMMUNITY_GROUP:3,COMMON:4,MERCHANT:5,SOCIAL_TRADING:7}).reduce((function(e,n){var t=(0,m.A)(n,2),r=t[0],a=t[1];return(0,d.A)((0,d.A)({},e),{},(0,f.A)({},a,{value:a,desc:r,key:"im_group_chat_tag_official"}))}),{}),me=function(e){return e>=1&&e<=100},fe=function(e){return!!e&&e.some(me)},pe=function(e,n){return e?n?function(e){return e.map((function(e){return de[e]})).filter((function(e,n,t){return e&&t.indexOf(e)===n}))}(e):function(e){return e.map((function(e){return me(e)?le[e]||le[oe]:le[e]})).filter((function(e,n,t){return e&&t.indexOf(e)===n}))}(e):[]},ve=function(e){return e[e.CALLER=0]="CALLER",e[e.CALLEE=1]="CALLEE",e}(ve||{}),he=function(e){return e[e.VIDEO=1]="VIDEO",e[e.AUDIO=2]="AUDIO",e}(he||{}),ge=function(e){return e.VIDEO="video",e.AUDIO="audio",e}(ge||{}),_e=function(e){return e[e.INIT=1]="INIT",e[e.CANCEL=2]="CANCEL",e[e.NO_ANSWER=3]="NO_ANSWER",e[e.ACCEPT=4]="ACCEPT",e[e.REJECT=5]="REJECT",e[e.TERMINATE=7]="TERMINATE",e[e.COMPLETE=8]="COMPLETE",e}(_e||{}),Ae=[2,3,5,7,8],Ee={VOICE_CALL:{name:"voice_call",errorKey:"im_voice_call_alert_ongoing_call"},AUDIO_MESSAGE:{name:"audio_message",errorKey:"im_voice_message_toast_complete_voice_to_start"}},be=function(e){return e[e.notBlacklisted=0]="notBlacklisted",e[e.blacklisted=1]="blacklisted",e}(be||{}),Ce=function(e){return e[e.stranger=0]="stranger",e[e.oneWay=1]="oneWay",e[e.twoWay=2]="twoWay",e}(Ce||{}),ye=function(e){return e[e.normal=0]="normal",e[e.p2p=1]="p2p",e[e.affiliate=2]="affiliate",e[e.socialTrading=3]="socialTrading",e}(ye||{}),Se=function(e){return e[e.GROUP=0]="GROUP",e[e.PRIVATE=1]="PRIVATE",e[e.SUPERGROUP=2]="SUPERGROUP",e[e.NOTIFICATION=3]="NOTIFICATION",e}(Se||{}),Me=function(e){return e[e.NORMAL=0]="NORMAL",e[e.NOT_RECEIVE=1]="NOT_RECEIVE",e[e.RECEIVE_SILENTLY=2]="RECEIVE_SILENTLY",e}(Me||{}),Ie=function(e){return e[e.default=0]="default",e[e.muted=1]="muted",e[e.blocked=2]="blocked",e}(Ie||{}),ke=function(e){return e[e.NORMAL=0]="NORMAL",e[e.HIDDEN=1]="HIDDEN",e}(ke||{}),xe=function(e){return e[e.IM=1]="IM",e[e.AFFILIATE=2]="AFFILIATE",e[e.CS=3]="CS",e[e.P2P=4]="P2P",e}(xe||{}),we=function(e){return e[e.NO=0]="NO",e[e.YES=1]="YES",e}(we||{}),Te=function(e){return e[e.NORMAL=0]="NORMAL",e[e.AT_ME=1]="AT_ME",e[e.AT_ALL=2]="AT_ALL",e[e.ATALL_ATME=3]="ATALL_ATME",e}(Te||{}),Ne={key:"all",publicText:"@all",localeKey:"im_mention_text_all"},Re=function(e){return e[e.USER_MSG_TYPE=100]="USER_MSG_TYPE",e[e.SYS_MSG_TYPE=200]="SYS_MSG_TYPE",e}(Re||{}),Le=function(e){return e[e.NORMAL=0]="NORMAL",e[e.DELETED=1]="DELETED",e[e.REJECTED=2]="REJECTED",e[e.SENDER_RECALLED=3]="SENDER_RECALLED",e[e.ADMIN_RECALLED=4]="ADMIN_RECALLED",e}(Le||{}),Oe=function(e){return e[e.IOS=1]="IOS",e[e.ANDROID=2]="ANDROID",e[e.WEB=3]="WEB",e}(Oe||{}),Ue=function(e){return e[e.TEXT_MESSAGE=101]="TEXT_MESSAGE",e[e.PICTURE_MESSAGE=102]="PICTURE_MESSAGE",e[e.VOICE_MESSAGE=103]="VOICE_MESSAGE",e[e.VOICE_CALL_MESSAGE=104]="VOICE_CALL_MESSAGE",e[e.QUOTE_MESSAGE=105]="QUOTE_MESSAGE",e[e.CUSTOM_MESSAGE=106]="CUSTOM_MESSAGE",e[e.RECEIPT_MESSAGE=107]="RECEIPT_MESSAGE",e[e.RECALL_MESSAGE=108]="RECALL_MESSAGE",e[e.RECALL_MESSAGE_BY_ADMIN=109]="RECALL_MESSAGE_BY_ADMIN",e[e.MESSAGE_RECALLED=110]="MESSAGE_RECALLED",e[e.MESSAGE_RECALLED_BY_ADMIN=111]="MESSAGE_RECALLED_BY_ADMIN",e[e.VIDEO_MESSAGE=112]="VIDEO_MESSAGE",e[e.MEDIA_MESSAGE=113]="MEDIA_MESSAGE",e[e.GROUP_INVITATION_MESSAGE=114]="GROUP_INVITATION_MESSAGE",e[e.SYSTEM_MESSAGE=200]="SYSTEM_MESSAGE",e}(Ue||{}),Pe=[101,102,103,104,106,112,113],De={CREATE_SINGLE_CHAT:101,NEW_GROUP_ANNOUNCEMENT:300,REMOVE_GROUP_ANNOUNCEMENT:316,ENABLE_GROUP_CHAT:301,DISABLE_GROUP_CHAT:302,ENABLE_GROUP_MENTION:303,DISABLE_GROUP_MENTION:304,ENABLE_GROUP_LINK:305,DISABLE_GROUP_LINK:306,ADD_GROUP_ADMIN:307,REMOVE_GROUP_ADMIN:308,ADD_GROUP_ADMIN_MORE_THAN_5:309,REMOVE_GROUP_ADMIN_MORE_THAN_5:310,CREATE_GROUP:311,INVITE_GROUP_MEMBER:312,REMOVE_GROUP_MEMBER:313,INVITE_GROUP_MEMBER_MORE_THAN_5:314,REMOVE_GROUP_MEMBER_MORE_THAN_5:315,MEMBER_QUIT_GROUP:317,DISBAND_GROUP:318,REFRESH_CONVERSATION:401,TRANSFER_GROUP_OWNER:319,CONTACT_ADDED:501,GROUP_NAME_CHANGED:320,GROUP_AVATAR_CHANGED:321},Ge=[De.CREATE_SINGLE_CHAT,De.MEMBER_QUIT_GROUP,De.REFRESH_CONVERSATION],qe=function(e){return!!e&&e.relationType!==Ce.stranger},Be=function(e){return!!e&&e.blacklisted===be.blacklisted},He=function(){var e=Number(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0),n=Math.round(e),t=Math.floor(n/60).toString().padStart(2,"0"),r=(n%60).toString().padStart(2,"0");return"".concat(t,":").concat(r)},Fe=(0,E.OS)({partName:"web_biz_general"}),Ve=(0,E.OS)({partName:"web_biz_general",useBr:!1}),We=function(e,n,t){var r=n.find((function(n){return n.userUid===e}))||{};return hn(r,null==t?void 0:t.userRegistryStore)},Ye=function(e,n,t){var r="";return e.slice(0,5).forEach((function(e,a){var o=We(e,n,t);o&&(r+=0===a?o:", ".concat(o))})),r};function je(e,n,t){return e?n:t}var ze=function(e,n){var t,r=e.systemMessage,a=r.systemAction,o=r.actingUid,i=r.targetUidsList,s=r.userInfoList,c=r.targetUidCount,u=r.data,l=null==(t=n.client)?void 0:t.queryUserInfo().userUid,d=o===l,m=Math.max(c-5,1),f=(u||{}).groupName,p="";switch(a){case De.NEW_GROUP_ANNOUNCEMENT:p=je(d,Fe("im_group_announcement_alert_you_post_announcement"),Fe("im_group_announcement_alert_user_post_announcement",{user:We(o,s,n)}));break;case De.REMOVE_GROUP_ANNOUNCEMENT:p=je(d,Fe("im_group_announcement_alert_you_remove_announcement"),Fe("im_group_announcement_alert_user_remove_announcement",{user:We(o,s,n)}));break;case De.ENABLE_GROUP_CHAT:p=je(d,Fe("im_group_chat_alert_chat_enabled_new"),Fe("im_group_chat_alert_user_enabled_chat",{user:We(o,s,n)}));break;case De.DISABLE_GROUP_CHAT:p=je(d,Fe("im_group_chat_alert_chat_disabled_new"),Fe("im_group_chat_alert_user_disabled_chat",{user:We(o,s,n)}));break;case De.ENABLE_GROUP_MENTION:p=je(d,Fe("im_group_chat_alert_you_enabled_mention"),Fe("im_group_chat_alert_user_enabled_mention",{user:We(o,s,n)}));break;case De.DISABLE_GROUP_MENTION:p=je(d,Fe("im_group_chat_alert_you_disabled_mention"),Fe("im_group_chat_alert_user_disabled_mention",{user:We(o,s,n)}));break;case De.ENABLE_GROUP_LINK:p=je(d,Fe("im_group_chat_alert_you_enabled_link"),Fe("im_group_chat_alert_user_enabled_link",{user:We(o,s,n)}));break;case De.DISABLE_GROUP_LINK:p=je(d,Fe("im_group_chat_alert_you_disabled_link"),Fe("im_group_chat_alert_user_disabled_link",{user:We(o,s,n)}));break;case De.ADD_GROUP_ADMIN:p=je(d,Fe("im_group_chat_alert_you_added_admin",{member:Ye(i,s,n)}),Fe("im_group_chat_alert_user_added_admin",{admin:We(o,s,n),member:Ye(i,s,n)}));break;case De.REMOVE_GROUP_ADMIN:p=je(d,Fe("im_group_chat_alert_you_removed_admin",{admin:Ye(i,s,n)}),Fe("im_group_chat_alert_user_removed_admin",{admin1:We(o,s,n),admin2:Ye(i,s,n)}));break;case De.ADD_GROUP_ADMIN_MORE_THAN_5:p=je(d,Fe("im_group_chat_alert_you_added_admin_and_others",{members:Ye(i,s,n),number:m}),Fe("im_group_chat_alert_user_added_admin_and_others",{admin:We(o,s,n),members:Ye(i,s,n),number:m}));break;case De.REMOVE_GROUP_ADMIN_MORE_THAN_5:p=je(d,Fe("im_group_chat_alert_you_removed_admin_and_others",{admins:Ye(i,s,n),number:m}),Fe("im_group_chat_alert_user_removed_admin_and_others",{admin1:We(o,s,n),admin2:Ye(i,s,n),number:m}));break;case De.CREATE_GROUP:p=je(d,Fe("im_group_chat_alert_you_created_group",{group:f}),Fe("im_group_chat_alert_user_created_group",{user:We(o,s,n),group:f}));break;case De.INVITE_GROUP_MEMBER:p=je(d,Fe("im_group_chat_alert_you_added_member",{user:Ye(i,s,n)}),Fe("im_group_chat_alert_user_added_member",{user1:We(o,s,n),user2:Ye(i,s,n)}));break;case De.INVITE_GROUP_MEMBER_MORE_THAN_5:p=je(d,Fe("im_group_chat_alert_you_added_member_and_others",{users:Ye(i,s,n),number:m}),Fe("im_group_chat_alert_user_added_member_and_others",{user1:We(o,s,n),user2:Ye(i,s,n),number:m}));break;case De.REMOVE_GROUP_MEMBER:p=d?Fe("im_group_chat_alert_you_removed_member",{user:Ye(i,s,n)}):l&&i.includes(l)?Fe("im_group_chat_alert_removed_from_group"):Fe("im_group_chat_alert_user_removed_user",{user1:We(o,s,n),user2:Ye(i,s,n)});break;case De.REMOVE_GROUP_MEMBER_MORE_THAN_5:p=d?Fe("im_group_chat_alert_you_removed_member_and_others",{users:Ye(i,s,n),number:m}):l&&i.includes(l)?Fe("im_group_chat_alert_removed_from_group"):Fe("im_group_chat_alert_user_removed_user_and_others",{user1:We(o,s,n),user2:Ye(i,s,n),number:m});break;case De.TRANSFER_GROUP_OWNER:p=je(d,Fe("im_group_chat_alert_you_made_owner",{user:Ye(i,s,n)}),Fe("im_group_chat_alert_user_made_owner",{userA:We(o,s,n),userB:Ye(i,s,n)}));break;case De.DISBAND_GROUP:var v=We(o,s,n);p=je(d,Fe("im_group_chat_alert_you_disbanded_group"),Fe("im_group_chat_alert_user_disbanded_group",{user:v}));break;case De.CONTACT_ADDED:p=d?Fe("im_add_contact_text_you_add_user"):Fe("im_add_contact_text_user_add_you",{user:We(o,s,n)});break;case De.GROUP_AVATAR_CHANGED:p=je(d,Fe("im_affiliate_group_toast_you_change_photo"),Fe("im_affiliate_group_toast_user_change_photo",{user:We(o,s,n)}));break;case De.GROUP_NAME_CHANGED:p=je(d,Fe("im_affiliate_group_text_you_change_group_name"),Fe("im_affiliate_group_text_user_change_group_name",{user:We(o,s,n)}))}return p};function Ke(e){return function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"yyyyMMdd",t=e?new Date(+e):new Date(0);return(0,b.r6)(t,{format:n})}(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"yyyyMMddHHmmss")}var Xe=864e5;function Je(){return new Date((new Date).setHours(0,0,0,0)).getTime()}var Qe=function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return"";var t=Number(e);if(t>Je())return n?Ke(t,"HH:mm"):Fe("im_general_chat_time_stamp_today");if(t>Je()-Xe)return Fe("im_general_chat_time_stamp_yesterday");if(t>function(){var e=(new Date).getDay(),n=e-1>=0?e-1:6;return Je()-n*Xe}())switch(new Date(t).getDay()){case 1:return Fe("im_general_chat_time_stamp_monday");case 2:return Fe("im_general_chat_time_stamp_tuesday");case 3:return Fe("im_general_chat_time_stamp_wednesday");case 4:return Fe("im_general_chat_time_stamp_thursday");case 5:return Fe("im_general_chat_time_stamp_friday");default:return Ke(t,"MM-dd")}return t>function(){var e=new Date;return e.setMonth(0),e.setDate(1),e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),e.getTime()}()?Ke(t,"MM-dd"):Ke(t,"MM-dd yyyy")},Ze={imFetchConfig:{project:"web_biz_general",site:"common"}},$e=function(e,n){var t=null==e?void 0:e.driver.pluginModules;if(t)return t[n]},en=function(e){var n=La().client;return $e(n,e)},nn={GLOBAL:"global",VOICE:"voiceChannel",MUSIC:"musicChannel",NOTIFICATION:"notificationChannel"};var tn=function(e){if("object"===typeof e&&null!==e){if("function"===typeof Object.getPrototypeOf){var n=Object.getPrototypeOf(e);return n===Object.prototype||null===n}return"[object Object]"===Object.prototype.toString.call(e)}return!1};var rn=function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return n.reduce((function(e,n){if(Array.isArray(n))throw new TypeError("Arguments provided to ts-deepmerge must be objects, not arrays.");return Object.keys(n).forEach((function(t){var r,a,o,i,s;["__proto__","constructor","prototype"].includes(t)||(i=e[t],s=n[t],Array.isArray(i)&&Array.isArray(s)?function(e,n,t,r,a){t[a]=e?n?Array.from(new Set(t[a].concat(r[a]))):[].concat((0,l.A)(t[a]),(0,l.A)(r[a])):r[a]}(rn.options.mergeArrays,rn.options.uniqueArrayItems,e,n,t):!function(e,n){return tn(e)&&tn(n)}(e[t],n[t])?e[t]=(r=e[t],a=n[t],o=rn.options.allowUndefinedOverrides,void 0===a?o?a:r:a):e[t]=rn(e[t],n[t]))})),e}),{})},an={allowUndefinedOverrides:!0,mergeArrays:!0,uniqueArrayItems:!0};function on(){return function(){if("undefined"===typeof AbortController){var e=function(){return(0,u.A)((function e(){(0,c.A)(this,e),this.signal={aborted:!1}}),[{key:"abort",value:function(){this.signal.aborted=!0}}])}();window.AbortController=e}}(),(0,T.makeAutoObservable)({abortController:new AbortController,get abortSignal(){return this.abortController.signal},rootStore:{},injectRootStore:function(e){this.rootStore=e},activeConversationId:null,conversationMap:{},conversationIds:[],routerReady:!1,pushConversationToTop:function(e){var n,t=this,r=this.conversationIds.filter((function(n){return n!==e})),a=r.findIndex((function(e){var n;return!(null==(n=t.conversationMap[e])?void 0:n.pinnedStatus)}));(null==(n=this.conversationMap[e])?void 0:n.pinnedStatus)?r.unshift(e):a<0?r.push(e):r.splice(a,0,e),this.conversationIds=r},setActiveConversationId:function(e){this.abortController.abort();var n=new AbortController;this.abortController=n,this.activeConversationId&&this.activeConversationId===e||(this.rootStore.messageStore.resetListStates(),this.activeConversationId=e,Fa.setGlobalTag("conversation",this.activeConversationId))},get activeConversation(){var e,n=this;if(!this.activeConversationId)return null;var t=this.conversationList.find((function(e){return e.channelId===n.activeConversationId}));if(!t)return null;var r,a=this.rootStore.groupStore.memberListMap[this.activeConversationId],o=this.rootStore.groupStore.groupInfoMap[this.activeConversationId],i=null==(e=null==t?void 0:t.entityInfo)?void 0:e.relatedId;return t.channelType===Se.PRIVATE&&i&&(r=this.rootStore.userRegistryStore.userInfoMap[i]||(0,d.A)({userUid:i},t.entityInfo)),(0,d.A)((0,d.A)({},t),{},{memberListMap:a,groupInfo:o,contactInfo:r})},conversationListStatus:"idle",conversationListHasMore:!0,get conversationList(){var e,n,t=this,r=this.conversationIds.filter((function(e){var n=t.conversationMap[e];return n&&(null==n?void 0:n.status)!==ke.HIDDEN&&n.isLoaded})).map((function(e){return t.conversationMap[e]}));return(null==(e=this.rootStore.client)?void 0:e.driver.conversationController.conversationFilter)?r.filter(null==(n=this.rootStore.client)?void 0:n.driver.conversationController.conversationFilter):r},get conversationListIsLoading(){return"loading"===this.conversationListStatus||"loadingMore"===this.conversationListStatus},get conversationListReady(){return"loading"!==this.conversationListStatus&&(!this.conversationListHasMore||this.conversationIds.length>0)},setConversationList:function(e){this.conversationIds=e.map((function(e){return e.channelId}));var n,t=(0,s.A)(e);try{for(t.s();!(n=t.n()).done;){var r=n.value;this.updateConversation((0,d.A)((0,d.A)({},r),{},{lastReadMsgSeq:String(r.lastReadMsgSeq||0)}))}}catch(Ea){t.e(Ea)}finally{t.f()}return[]},setConversationListStatus:function(e){this.conversationListStatus=e},setConversationListHasMore:function(e){this.conversationListHasMore=e},resetConversationList:function(){this.setConversationList([]),this.setConversationListHasMore(!0),this.setConversationListStatus("idle"),this.setActiveConversationId(null),this.conversationMap={}},insertConversationId:function(e){this.conversationIds.includes(e.channelId)||this.conversationIds.push(e.channelId)},updateConversation:function(e){return!!e.channelId&&(this.conversationIds.includes(e.channelId)||(re()&&console.warn("[IM SDK] attempting to update a conversation that is not in the list\nInserting conversation ID now"),this.insertConversationId(e)),this.conversationMap[e.channelId]=(0,d.A)((0,d.A)({},this.conversationMap[e.channelId]||{}),e),!0)},updateConversations:function(e){var n,t=(0,s.A)(e);try{for(t.s();!(n=t.n()).done;){var r=n.value;this.updateConversation(r)}}catch(Ea){t.e(Ea)}finally{t.f()}},removeConversations:function(e){this.conversationIds=this.conversationIds.filter((function(n){return!e.includes(n)}));var n,t=(0,s.A)(e);try{for(t.s();!(n=t.n()).done;){var r=n.value;delete this.conversationMap[r]}}catch(Ea){t.e(Ea)}finally{t.f()}this.activeConversationId&&e.includes(this.activeConversationId)&&(this.setActiveConversationId(null),this.rootStore.messageStore.setMessages([]))},incrementUnsendCount:function(e){var n=this.conversationMap[e];return n?(n.unsendMessageCount=(n.unsendMessageCount||0)+1,n.unsendMessageCount):0},updateRouterReady:function(e){this.routerReady=e}},{},{autoBind:!0})}rn.options=an,rn.withOptions=function(e){rn.options=(0,d.A)((0,d.A)({},an),e);for(var n=arguments.length,t=new Array(n>1?n-1:0),r=1;r<n;r++)t[r-1]=arguments[r];var a=rn.apply(void 0,t);return rn.options=an,a};var sn=function(){var e="",n=function(e){return"".concat("OK_IM_SDK_UI_EVENT_").concat(e)};return{setEventBusAppName:function(n){e=n},dispatch:function(t){window.postMessage({type:n(t.type),from:"Dispatcher-".concat(e),data:t.data},window.location.origin)},onEvent:function(t,r){var a=n(t),o="Dispatcher-".concat(e),i=function(e){var n=e.data,t=n.type,i=n.from,s=n.data;t===a&&i===o&&r(s)};return window.addEventListener("message",i),function(){window.removeEventListener("message",i)}}}}(),cn=sn.onEvent,un=sn.dispatch,ln=sn.setEventBusAppName,dn=function(){return{messageText:"",mentionedUsers:new Map,quotedMsg:null}};function mn(e){return"__expired"in e&&e.__expired}var fn=50;function pn(){var e=(0,T.makeAutoObservable)({rootStore:{},injectRootStore:function(e){this.rootStore=e},messages:[],get messagesCount(){return this.messages.length},setMessages:function(e){this.messages=e},messagesStatus:"idle",setMessagesStatus:function(e){this.messagesStatus=e},prependMessages:function(e){var n,t,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if((null==(t=e[0])?void 0:t.channelId)!==this.rootStore.conversationStore.activeConversationId)return[];var a=[];return e.forEach((function(e){[Ue.RECALL_MESSAGE,Ue.RECALL_MESSAGE_BY_ADMIN,Ue.RECEIPT_MESSAGE].includes(e.contentType)||(e.isSender||e.status!==Le.REJECTED)&&(e.contentType===Ue.VOICE_CALL_MESSAGE&&e.callMessage&&!Ae.includes(e.callMessage.signalType)||(e.visible=!0,a.push(e)))})),this.setMaintainScrollPositionFromBottom(r),(n=this.messages).unshift.apply(n,a),a},appendMessages:function(e){var n,t,r;if((null==(t=e[0])?void 0:t.channelId)!==this.rootStore.conversationStore.activeConversationId)return[];var a=[];e.forEach((function(e){[Ue.RECALL_MESSAGE,Ue.RECALL_MESSAGE_BY_ADMIN,Ue.RECEIPT_MESSAGE].includes(e.contentType)||(e.isSender||e.status!==Le.REJECTED)&&(e.contentType===Ue.VOICE_CALL_MESSAGE&&e.callMessage&&!Ae.includes(e.callMessage.signalType)||(e.visible=!0,a.push(e)))}));var o=null==(r=this.messages.at(-1))?void 0:r.seq;if(o){var i=+o+1,s=a.findIndex((function(e){return e.seq>=i}));if(s<0&&a.length>0)return console.warn("appended list should only start from",i),[];s>-1&&a.splice(0,s)}return a.sort((function(e,n){return Number(e.seq)-Number(n.seq)})),this.setMaintainScrollPositionFromBottom(!1),(n=this.messages).push.apply(n,a),a},updateMessage:function(e){Number(e.seq)%1===0&&this.setLoadedLatestMsgSeq(e.seq);var n=this.messages.findIndex((function(n){var t,r;return(null==(t=n.extra)?void 0:t.tempId)===(null==(r=e.extra)?void 0:r.tempId)||!!e.clientMsgId&&n.clientMsgId===e.clientMsgId}));n<0||(this.messages[n]=e)},patchMessage:function(e){var n=this.messages.findIndex((function(n){return n.seq===e.seq}));n<0||(this.setMaintainScrollPositionFromBottom(!1),this.messages[n]=(0,d.A)((0,d.A)({},this.messages[n]),e))},patchQuoteMessage:function(e,n){var t,r=this.messages.findIndex((function(n){return n.seq===e}));r<0||(this.messages[r]=(0,d.A)((0,d.A)({},this.messages[r]),{},{quotedMessage:n?(0,d.A)((0,d.A)({},null==(t=this.messages[r])?void 0:t.quotedMessage),n):null}))},pushLocalMessage:function(e){"normal"===this.listMode&&(this.setMaintainScrollPositionFromBottom(!1),this.messages.push(e))},pushNewMessages:function(e){var n,t=this;"normal"===this.listMode&&(null==(n=e[0])?void 0:n.channelId)===this.rootStore.conversationStore.activeConversationId&&(0,T.runInAction)((function(){var n=function(e,n){var t=[],r=[],a=0;return e.forEach((function(e){Number(e.seq)>Number(a)&&Number(e.seq)%1===0&&(a=Number(e.seq)),-1===n.findIndex((function(n){var t=!1;return t=function(e,n){var t,r,a,o;return!!(null==(t=null==e?void 0:e.extra)?void 0:t.tempId)&&!!(null==(r=null==n?void 0:n.extra)?void 0:r.tempId)&&(null==(a=e.extra)?void 0:a.tempId)===(null==(o=n.extra)?void 0:o.tempId)}(n,e),n.seq==e.seq&&(t=!0),t}))?t.push(e):r.push(e)})),{actualNewMessages:t,localUpdates:r,largestSeq:a}}(e,t.messages),r=n.actualNewMessages,a=n.localUpdates,o=n.largestSeq;t.setMaintainScrollPositionFromBottom(!1),a.forEach((function(e){var n=t.messages.findIndex((function(n){var t,r;return(null==(t=n.extra)?void 0:t.tempId)===(null==(r=e.extra)?void 0:r.tempId)}));n>=0&&(t.messages[n]=e)})),o>0&&o%1===0&&t.setLoadedLatestMsgSeq(o),r.length&&(t.messages=t.messages.concat(r))}))},topEndReached:!1,setTopEndFetched:function(e){this.topEndReached=e},isAtScrollBottom:!0,setIsAtScrollBottom:function(e){this.isAtScrollBottom=e},purgeMessages:function(e,n){for(var t=0;t<this.messages.length;t++){var r=this.messages[t];r.loading||(t>this.messages.length-fn||mn(r)||(t<e||t>n)&&(this.messages[t]={seq:r.seq,__expired:!0}))}},restoreMessages:function(e){var n=this;(null==e?void 0:e.length)&&e.forEach((function(e){var t=n.messages.findIndex((function(n){return n.seq==e.seq}));t>-1&&mn(n.messages[t])&&(n.messages[t]=e)}))},fileUploadStatus:{},setFileUploadStatus:function(e,n,t){this.fileUploadStatus[e]||(this.fileUploadStatus[e]={}),this.fileUploadStatus[e][n]=t},get hasUploadingFile(){var e=this.rootStore.conversationStore.activeConversationId,n=e?this.fileUploadStatus[e]:{};return Boolean(n)&&Object.keys(n).some((function(e){return"uploading"===n[e]}))},loadedEarliestMsgSeq:Number.MAX_SAFE_INTEGER,setLoadedEarliestMsgSeq:function(e){this.loadedEarliestMsgSeq=e},loadedLatestMsgSeq:1,setLoadedLatestMsgSeq:function(e){this.loadedLatestMsgSeq=e},get listMode(){var e;return this.messages.length&&this.messages.at(-1)?Number(this.loadedLatestMsgSeq)>=Number(null==(e=this.rootStore.conversationStore.activeConversation)?void 0:e.lastReceivedMsgSeq)?"normal":"detached":"normal"},resetListStates:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.setMaintainScrollPositionFromBottom(!1),this.messages=[],this.messagesStatus=e?"loadingBlocking":"idle",this.loadedEarliestMsgSeq=Number.MAX_SAFE_INTEGER,this.loadedLatestMsgSeq=1,this.topEndReached=!1,this.isAtScrollBottom=!0,this.fileUploadStatus={}},maintainScrollPositionFromBottom:!1,setMaintainScrollPositionFromBottom:function(e){this.maintainScrollPositionFromBottom=e},scrollToBottom:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{smooth:!1,force:!0},n=e.smooth,t=e.force,r=this.rootStore.conversationStore.activeConversation;r&&un({type:"MESSAGE_LIST_SCROLL_TO_BOTTOM",data:{channelId:r.channelId,smooth:n,force:t}})},scrollToMessage:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=n.highlight,r=void 0!==t&&t,a=(0,i.A)(n,z),o=this.rootStore.conversationStore.activeConversation;o&&un({type:"OK-IM-SCROLL-TO-MESSAGE",data:{channelId:o.channelId,seq:e,shouldHighlight:r,scrollOptions:a,from:"STORE"}})}},{},{autoBind:!0});return e}var vn=function(e){var n=e||{},t=n.nickname,r=n.enNickname;return"zh_CN"===A.A.locale||"zh_TW"===A.A.locale?t||r||"":r||t||""},hn=function(e,n){var t=(null==e?void 0:e.userUid)||(null==e?void 0:e.relatedId),r=t?null==n?void 0:n.userInfoMap[t]:void 0;return(null==r?void 0:r.remarkName)||(null==e?void 0:e.remarkName)||""||vn(e)},gn=function(e){return e.replace(/^\s*\n/gm,"")},_n=function(e,n){return e.localeCompare(n,"zh-CN",{collation:"pinyin"})},An=function(e){var n=e.userInfo,t=e.searchTerm,r=e.isOfficial,a=void 0!==r&&r,o=t.toUpperCase(),i=vn({nickname:null==n?void 0:n.nickname,enNickname:null==n?void 0:n.enNickname}),s=[null==n?void 0:n.remarkName,i];return a&&s.push(null==n?void 0:n.userUid),s.some((function(e){return e&&e.toUpperCase().includes(o)}))};function En(e){var n=e.client,t=pn(),r=on(),a=(0,T.makeAutoObservable)({memberListMap:{},setMemberListMap:function(e,n){this.memberListMap[e]=n},groupInfoMap:{},setGroupInfo:function(e,n){this.groupInfoMap[e]=n}},{},{autoBind:!0}),o=(0,T.makeAutoObservable)({rootStore:{},injectRootStore:function(e){this.rootStore=e},draftMap:{},getDraft:function(e){var n=this;if(!this.draftMap[e]){var t=dn();return(0,T.action)((function(){n.draftMap[e]=t})),t}return this.draftMap[e]},updateDraft:function(e,n){var t=this.draftMap[e]||dn();this.draftMap[e]=(0,d.A)((0,d.A)({},t),n)},clearDraft:function(e){delete this.draftMap[e]},quoteMessage:function(e,n){var t,r;if(e===(null==n?void 0:n.channelId)){var a=this.draftMap[e]||dn();a.quotedMsg&&(null==(t=a.quotedMsg)?void 0:t.seq)!==n.seq?(this.draftMap[e]=(0,d.A)((0,d.A)({},dn()),{},{quotedMsg:n}),un({type:"OK-IM-INPUT-SET-TEXT-CONTENT",data:{from:"STORE",textContent:""}})):(this.draftMap[e]=(0,d.A)((0,d.A)({},a),{},{quotedMsg:n}),un({type:"OK-IM-INPUT-FOCUS",data:{from:"STORE"}}));var o=this.rootStore.groupStore.memberListMap[e],i=null==o?void 0:o.get(n.senderUid);!n.isSender&&i&&(null==(r=$e(this.rootStore.client,"mentionUser"))||r({from:"STORE",groupMember:(0,T.toJS)(i)}))}}},{},{autoBind:!0}),i=(0,T.makeAutoObservable)({audioChannels:{},setChannelAudio:function(e,n){this.audioChannels[e]||(this.audioChannels[e]={instance:null,audios:{}}),this.audioChannels[e].audios[n.url]=n},getChannelAudio:function(e){return this.audioChannels[e]},getAudioState:function(e,n){var t;return null==(t=this.audioChannels[e])?void 0:t.audios[n]},stopOtherAudios:function(e,n){var t,r=this.audioChannels[e];if(r)for(var a=0,o=Object.entries(r.audios);a<o.length;a++){var i=(0,m.A)(o[a],2),s=i[0],c=i[1];s!==n&&(c.isPlaying||c.isPaused)&&(c.isPlaying=!1,c.isPaused=!1,c.currentTime=0,null==(t=r.instance)||t.pause(),r.instance.currentTime=0)}},updateChannelInstance:function(e,n){this.audioChannels[e]||(this.audioChannels[e]={instance:null,audios:{}}),this.audioChannels[e].instance=n},attachAudioEvents:function(e,n,t){var r=this,a=function(){var a=Number.isFinite(t.duration)?t.duration:0;r.setChannelAudio(e,(0,d.A)((0,d.A)({},r.getAudioState(e,n)),{},{duration:a}))},o=function(){var a=t.currentTime;r.setChannelAudio(e,(0,d.A)((0,d.A)({},r.getAudioState(e,n)),{},{currentTime:a}))},i=function(){r.setChannelAudio(e,(0,d.A)((0,d.A)({},r.getAudioState(e,n)),{},{isPlaying:!1,isPaused:!1,currentTime:0}))};return t.addEventListener("loadeddata",a),t.addEventListener("timeupdate",o),t.addEventListener("ended",i),{handleLoadedData:a,handleTimeUpdate:o,handleEnded:i}},detachAudioEvents:function(e,n,t,r){t.removeEventListener("loadeddata",r.handleLoadedData),t.removeEventListener("timeupdate",r.handleTimeUpdate),t.removeEventListener("ended",r.handleEnded)}},{},{autoBind:!0}),c=(0,T.makeAutoObservable)({conversationList:{conversationRightClick:!0,actionsMenu:!0},message:{mode:"regular",profileDetailMenu:!0,profileRightClickMenu:!0,messageRightClickMenu:!0,header:!0,inMessageUserTag:!0,outMessageUserTag:!1,displayMessageSender:!0,readIndicator:!0,inputBox:{audioInput:!0,mediaInput:!0,emojiInput:!0},auto:{scroll:!0,focus:!0,read:!0},displayScamWarningBanner:!0,displayMessageDateDivider:!0,reply:{enable:!0,canReply:[Ue.TEXT_MESSAGE,Ue.VIDEO_MESSAGE,Ue.PICTURE_MESSAGE,Ue.MEDIA_MESSAGE,Ue.VOICE_MESSAGE]},announcement:{enable:!0},mediaMessage:{enableFile:!1}},updateMessageConfig:function(e){this.message=rn(this.message,e)},updateConversationListConfig:function(e){this.conversationList=rn(this.conversationList,e)}},{},{autoBind:!0}),u=(0,T.makeAutoObservable)({userInfoMap:{},setUserInfo:function(e,n){var t=this.userInfoMap[e];t&&t.blacklisted!==n.blacklisted&&(n.blacklisted!==be.blacklisted||this.blockedIdList.includes(e)||this.prependBlockedId(e),n.blacklisted===be.notBlacklisted&&this.blockedIdList.includes(e)&&this.removeBlockedId(e)),this.userInfoMap[e]=(0,d.A)((0,d.A)({},n),{},{lastUpdated:Date.now()})},syncUserRelationList:function(e){var n,t=(0,s.A)(e);try{for(t.s();!(n=t.n()).done;){var r=n.value;this.setUserInfo(r.userUid,r)}}catch(Ea){t.e(Ea)}finally{t.f()}},get userList(){return Object.values(this.userInfoMap)},get contactList(){var e=this;return Object.values(this.userInfoMap).filter((function(e){return e.relationType!==Ce.stranger})).sort((function(n,t){var r=hn(n,e),a=hn(t,e);return _n(r,a)}))},blockedIdList:[],removeBlockedId:function(e){this.blockedIdList=this.blockedIdList.filter((function(n){return n!==e}))},prependBlockedId:function(e){this.blockedIdList=[e].concat((0,l.A)(this.blockedIdList))},updateBlockedList:function(e){this.blockedIdList=e.map((function(e){return e.userUid}))},get blockedList(){var e=this;return this.blockedIdList.map((function(n){return e.userInfoMap[n]}))}},{},{autoBind:!0}),f=(0,T.makeAutoObservable)({visible:!1,operationMenu:void 0,showOperationMenu:function(e){var n=this;this.visible&&(0,T.runInAction)((function(){return n.closeOperationMenu()})),0!==e.menuConfig.length&&(this.visible=!0,this.operationMenu=(0,d.A)({},e))},closeOperationMenu:function(){this.visible=!1,this.operationMenu=void 0},destroy:function(){this.closeOperationMenu()}},{operationMenu:!1},{autoBind:!0}),p=(0,T.makeAutoObservable)({client:n,messageStore:t,conversationStore:r,groupStore:a,messageInputStore:o,audioStore:i,configStore:c,userRegistryStore:u,overlayStore:f},{});return p.messageStore.injectRootStore(p),p.conversationStore.injectRootStore(p),p.messageInputStore.injectRootStore(p),p}var bn="_menu-box_1w3o7_1",Cn="_menu-item-row_1w3o7_12",yn="_menu-item-icon_1w3o7_28",Sn=function(e){var n=e.id,t=e.icon,r=e.iconName,a=e.title,o=e.onClick,i=(0,_.useMemo)((function(){return t?_.createElement("img",{"aria-hidden":!0,alt:"",src:t,className:yn}):r?_.createElement(R.A,{"aria-hidden":!0,className:yn,iconName:r}):null}),[t,r]);return _.createElement(L.A,{"data-action":n,"data-testid":"im-btn-".concat(n),className:Cn,onClick:o},i,a)},Mn=function(e){var n=e.menuConfig,t=e.onClose;return n&&0!==n.length?_.createElement(_.Fragment,null,n.map((function(e){return _.createElement(Sn,{key:e.id,id:e.id,icon:e.icon,iconName:e.iconName,title:e.title,onClick:function(){e.handler(),t()}})}))):null},In=function(e){var n=e.menuConfig,t=e.onClose,r=_.useRef(null),a=n&&Boolean(n.length);return function(e,n){var t=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mousedown",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};(0,_.useEffect)((function(){if(t){var o=function(t){var r=t.target;r&&r.isConnected&&(Array.isArray(e)?e.filter((function(e){return Boolean(e.current)})).every((function(e){return e.current&&!e.current.contains(r)})):e.current&&!e.current.contains(r))&&n(t)};return document.addEventListener(r,o,a),function(){document.removeEventListener(r,o,a)}}}),[t])}(r,t,a),(0,_.useLayoutEffect)((function(){a&&setTimeout((function(){var e,n=null==(e=r.current)?void 0:e.querySelector("button[data-action]");null==n||n.focus()}))}),[a]),_.createElement("div",{ref:r,"data-testid":"im-context-menu",className:W(bn)},_.createElement(Mn,{menuConfig:n,onClose:t}))},kn="im-msg",xn=function(e){return"".concat(kn,"-").concat(e.clientMsgId.replace(".","_"))},wn=function(e){return"".concat(kn,"-username-").concat(e.clientMsgId.replace(".","_"))},Tn=function(e){return"".concat(kn,"-quote-").concat(e.clientMsgId.replace(".","_"))},Nn=function(e){return"".concat(kn,"-content-").concat(e.clientMsgId.replace(".","_"))},Rn=function(e){return"".concat(kn,"-content-fb-").concat(e.clientMsgId.replace(".","_"))},Ln=function(e){return"".concat(kn,"-time-").concat(e.clientMsgId.replace(".","_"))},On=function(e){return"".concat(kn,"-status-").concat(e.clientMsgId.replace(".","_"))},Un={isMe:"im-aria-me",comma:"im-comma"},Pn=function(e,n){var t,r=[],a=wn(e);n.querySelector("#".concat(a))&&(r.push(a),r.push(Un.comma));var o=Tn(e);n.querySelector("#".concat(o))&&(r.push(o),r.push(Un.comma));var i=null!==(t=n.querySelector("#".concat(Nn(e))))&&void 0!==t?t:n.querySelector("#".concat(Rn(e)));i&&(r.push(i.id),r.push(Un.comma)),n.querySelector("#".concat(Ln(e)))&&(r.push(Ln(e)),r.push(Un.comma));var s=On(e);return n.querySelector("#".concat(s))&&r.push(s),r.length&&r[r.length-1]===Un.comma&&r.pop(),r};function Dn(e){var n=e.userUid,t=e.channelId;return{userUid:n,channelId:t,channelType:0,groupAtType:0,inGroupStatus:1,groupStatus:0,pinnedStatus:0,receiveMsgOption:2,sendMsgOption:0,unreadCount:0,startMsgSeq:"0",endMsgSeq:null,lastReceivedMsgSeq:String(Number.MAX_SAFE_INTEGER),oppositeLastReadMsgSeq:"0",lastReadMsgSeq:"0",attachedInfo:"",isLoaded:!0,extra:"",entityInfo:{avatar:null,relatedId:t,nickname:"AnonymousGroup",enNickname:"AnonymousGroup",tags:[],groupType:Y.e.OK_ASSISTANT},updateTime:"",lastMsgTime:"",role:Y.G.NORMAL,status:ke.NORMAL}}var Gn=function(e){var n=e.channelIds,t=e.prevChannelId,r=e.count;if(!t)return n.slice(0,r);var a=n.indexOf(t);return a>=0?n.slice(a+1,a+1+r):[]},qn=function(e,n){return function(){var t=(0,o.A)((0,a.A)().mark((function t(r,o){var i,s,c,u,d,m,f,p,v,h,g,_,A;return(0,a.A)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=r.prevChannelId,s=r.channelIds,c=r.resetList,u=r.limit,d=void 0===u?30:u,n){t.next=4;break}return ja(),t.abrupt("return",[]);case 4:if(!e.conversationListIsLoading&&e.conversationListHasMore){t.next=6;break}return t.abrupt("return",[]);case 6:if(t.prev=6,!c&&e.conversationIds.length){t.next=15;break}return e.setConversationListStatus("loading"),t.next=11,n.driver.conversationController.fetchAllSimplifiedChannels({source:o});case 11:h=t.sent,c?e.setConversationList(h):h.forEach((function(n){e.insertConversationId(n)})),t.next=16;break;case 15:e.setConversationListStatus("loadingMore");case 16:return g=s||Gn({channelIds:(0,l.A)(e.conversationIds),prevChannelId:i,count:d}),t.next=19,n.getConversationList({channelIds:g},o||"loadConversation");case 19:if(_=t.sent,e.setConversationListStatus("success"),_){t.next=23;break}return t.abrupt("return",[]);case 23:if(null==(A=null==(p=null==_?void 0:_.data)?void 0:p.filter(null!==(v=null==(f=null==(m=null==n?void 0:n.driver)?void 0:m.conversationController)?void 0:f.conversationFilter)&&void 0!==v?v:function(){return!0}))?void 0:A.length){t.next=27;break}return e.setConversationListHasMore(!1),t.abrupt("return",[]);case 27:return e.updateConversations(_.data),t.abrupt("return",_.data);case 31:t.prev=31,t.t0=t.catch(6),e.setConversationListStatus("idle");case 34:return t.abrupt("return",[]);case 35:case"end":return t.stop()}}),t,null,[[6,31]])})));return function(e,n){return t.apply(this,arguments)}}()};function Bn(e){return"anonymous"in e&&e.anonymous}function Hn(e){return Boolean("uid"in e&&e.uid)}function Fn(e){return Boolean("channelId"in e&&e.channelId)}var Vn="_system_dz9vt_1",Wn=function(e){var n=e.className,t=e.children,r=(0,i.A)(e,K);return _.createElement("div",(0,d.A)({"data-testid":"im-system-message",className:W(Vn,n)},r),t)},Yn=function(e){var n=e.channelType,t=void 0===n?Se.PRIVATE:n,r=e.className,a=void 0===r?"":r,o=e.width,s=void 0===o?40:o,c=e.height,u=void 0===c?40:c,l=e.userInfo,m=e.withProfile,f=void 0!==m&&m,p=e.getContainer,v=void 0===p?function(){return document.getElementById("im-sdk-popup-container")}:p,h=e.onRightClick,g=e.onInitIndividualChat,A=e.children,E=(0,i.A)(e,X),b=La().store.configStore.message,C=en("contactManagement"),y=null==C?void 0:C.UserProfilePop,S=(0,_.useMemo)((function(){return(null==b?void 0:b.profileRightClickMenu)&&h?h:function(){}}),[b,h]),M=(0,_.useMemo)((function(){return!1!==b.profileDetailMenu&&(!1!==f&&(f&&(null==b?void 0:b.profileDetailMenu)))}),[b.profileDetailMenu,f]),I=_.createElement(et,(0,d.A)({userInfo:l,width:s,height:u,className:a,isGroup:!f&&t===Se.GROUP,onRightClick:S},E),A);return M&&y?_.createElement(y,{disabled:!f,userInfo:l,inGroupChat:t===Se.GROUP,getContainer:v,onInitIndividualChat:g},I):I},jn="f-filter",zn=(0,_.forwardRef)((function(e,n){var t=e.children,r=e.className,a=(0,i.A)(e,J);return _.createElement("div",(0,d.A)({ref:n,className:W(jn,r)},a),t)})),Kn="_imAvatar_1igh7_1",Xn="_withBackground_1igh7_15",Jn="_group_1igh7_19",Qn="_userAvatarImg_1igh7_23",Zn="_userAvatarText_1igh7_31",$n="_defaultImage_1igh7_35",et=function(e){var n,t=e.isGroup,r=void 0!==t&&t,a=e.className,o=e.width,s=void 0===o?40:o,c=e.height,u=void 0===c?40:c,l=e.userInfo,p=e.onRightClick,v=e.pictureProps,h=e.children,g=(0,i.A)(e,Q),A=La().store,E=(0,_.useState)(!1),b=(0,m.A)(E,2),C=b[0],y=b[1],S=(l||{}).avatar,M=(0,_.useMemo)((function(){return!C&&S}),[C,S]),I=(0,_.useMemo)((function(){var e=hn(l,A.userRegistryStore)||"",n=(null==e?void 0:e[0])||"",t="*"===n||!n;return r?_.createElement("img",{alt:"",src:"".concat(Va(),"/cdn/assets/imgs/242/4215F4ECD8A3CFD5.svg"),className:$n}):t?_.createElement("img",{alt:"",src:"".concat(Va(),"/cdn/assets/imgs/242/2ED248F4835FF365.svg"),className:$n}):_.createElement("span",{className:Zn},n)}),[r,A.userRegistryStore,l]);return _.createElement(zn,(0,d.A)({"data-testid":"im-avatar",className:W(Kn,a,(0,f.A)((0,f.A)({},Jn,r),Xn,!M)),style:{width:"".concat(s,"px"),height:"".concat(u,"px"),fontSize:"".concat(s,"px")},onContextMenu:p},g),M?_.createElement(O.A,(0,d.A)((0,d.A)({},v),{},{alt:(null==(n=hn(l,A.userRegistryStore))?void 0:n[0])||"",className:W(jn,Qn),src:S||"",resize:{width:2*s,height:2*u},onError:function(){y(!0)}})):I,h)},nt="_iconBtn_ktrfo_1",tt=function(e){var n=e.tipTitle,t=e.iconUrl,r=e.className,a=e.children,o=e.clickHandler,i=e.iconClassName,s=e.disabled,c=e.placement,u=void 0===c?"top":c,l=e.toolTipClassName,d=e.as,m=void 0===d?"img":d,f=e["data-testid"],p=(0,V.A)().isSm;return _.createElement(U.A,{disabled:p,title:n,placement:U.A.DIRECTION[u],alwaysUpdatePopper:!0,className:W(l),getContainer:function(){return document.getElementById("im-sdk-popup-container")}},_.createElement(L.A,{"aria-label":n,className:W(nt,r),"data-testid":f,onClick:function(e){s||null==o||o(e)}},"img"===m&&_.createElement("img",{"aria-hidden":"true",alt:"",className:i,src:t}),"icon"===m&&_.createElement(R.A,{"aria-hidden":"true",className:i}),"children"===m&&a))};function rt(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function at(e){return e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&amp;/g,"&")}var ot="_text_1r4cb_1",it=function(e){var n=e.children,t=e.disableHover,r=e.tooltipClassName,a=e.className,o=(0,i.A)(e,Z),s=(0,_.useRef)(null);return _.createElement(U.A,{title:n,textOverflow:{text:rt(null!==n&&void 0!==n?n:""),textElement:s.current},noWrapper:!0,disabled:t,className:r,placement:U.A.DIRECTION.bottom},_.createElement("span",(0,d.A)({ref:s,className:W(ot,a,jn)},o),n))},st="_im-name-with-tags_5h8eq_7",ct="_im-name-text_5h8eq_18",ut="_im-tag-group_5h8eq_28",lt="_im-name-tag_5h8eq_32",dt=function(e){var n=e.className,t=e.tag,r=e.style;return _.createElement("span",{className:W(lt,n),style:r},t)},mt=(0,N.observer)((function(e){var n,t=e.className,r=e.customName,a=e.userInfo,o=e.nameTextClassName,s=e.customTagClassName,c=e.customTag,u=e.showOfficialTag,l=void 0===u||u,m=e.isGroupName,f=void 0!==m&&m,p=e.withOverflowTooltip,v=void 0!==p&&p,h=e.hidden,g=(0,i.A)(e,$),A=La().store;if(!a)return null;var E=r||hn(a,A.userRegistryStore);return h?_.createElement(P.A,(0,d.A)({},g),E):_.createElement(zn,{"data-copy-ignore":!0,"data-testid":"im-username","data-imname":E,className:W(st,t)},_.createElement(it,(0,d.A)({disableHover:!v,className:W(ct,o),"aria-label":E},g),E),_.createElement("div",{className:ut},c&&_.createElement(dt,{className:s,tag:c}),l&&pe(null!==(n=null==a?void 0:a.tags)&&void 0!==n?n:[],f).map((function(e){return _.createElement(dt,{className:W(lt,"im-name-tag-".concat(e.desc)),tag:Fe(e.key),key:e.key})}))))})),ft="_link_1htdt_13",pt="_highlight_1htdt_22",vt="_clickable_1htdt_25",ht="(?:25[0-5]|2[0-4]\\d|[01]?\\d?\\d)",gt="(?:".concat(ht,"\\.").concat(ht,"\\.").concat(ht,"\\.").concat(ht,")"),_t="(?:".concat("[a-z\\d](?:[a-z\\d-]{0,61}[a-z\\d])?","\\.)+[a-z]{2,}"),At="(?:".concat(_t,"|").concat(gt,")"),Et="(".concat("(?:https?:\\/\\/)").concat(At).concat("(?::\\d{1,5})?").concat("[a-z\\d.,_\\/~#@&=;%+?\\-\\\\(\\\\)]*",")"),bt=new RegExp(Et,"gi"),Ct=function(e){return e.Text="text",e.Mention="mention",e.Highlight="highlight",e.Link="link",e}(Ct||{}),yt="<",St=">",Mt=function(e){var n,t,r=e.text,a=e.message,o=e.allowMention;if(!r)return[];var i=rt(r)||"",c=new Map;if(o){var u,l=(0,s.A)((null==(n=null==a?void 0:a.textMessage)?void 0:n.atUserList)||[]);try{var d=function(){var e=u.value,n=e.atText.slice(1),t=e.uid;c.set(t,{type:"mention",content:n,uid:e.uid}),i=i.replace(e.atText,(function(){return"".concat(yt).concat(t).concat(St)}))};for(l.s();!(u=l.n()).done;)d()}catch(Ea){l.e(Ea)}finally{l.f()}if((null==(t=null==a?void 0:a.textMessage)?void 0:t.atType)===Te.AT_ALL){var m=Ne.key;c.set(m,{type:"highlight",content:Fe(Ne.localeKey)}),i=i.replace(Ne.publicText,(function(){return"".concat(yt).concat(m).concat(St)}))}}i=i.replace(bt,(function(e){var n=e;return c.set(n,{type:"link",content:at(e)}),"".concat(yt).concat(n).concat(St)}));var f=new RegExp("(".concat(yt,".+?").concat(St,")"),"gi");return i.split(f).map((function(e){return e.startsWith(yt)&&e.endsWith(St)&&c.get(e.slice(1,-1))||{type:"text",content:at(e)}}))};var It=(0,N.observer)((function(e){var n=e.text,t=e.linkClassName,r=e.message,a=e.channel,o=void 0===a?{}:a,i=La().store,s=en("contactManagement"),c=null==s?void 0:s.UserProfilePop,u=o.memberListMap,l=o.channelType,d=o.userUid,m=Boolean(r)&&l===Se.GROUP,f=(0,_.useMemo)((function(){return Mt({text:n,message:r,allowMention:m})}),[n,m,r]);return f.length?_.createElement(zn,{"data-message-type":"text","data-testid":"im-text-message","aria-label":n},f.map((function(e,n){var r,a=e.content+n;switch(e.type){case Ct.Link:return function(e,n,t){var r,a,o=!0;return(null==(r=C.T)?void 0:r.isOKXDesktop)&&-1===(0,y.G)(null==(a=C.T)?void 0:a.OKXDesktopVersion,"2.3.7")&&(o=!1),o?_.createElement(_.Fragment,{key:n},_.createElement("a",{href:e.content,target:"_blank",rel:"noreferrer",className:W(ft,t)},e.content),"\xa0"):_.createElement("div",{key:n,className:W(ft,t)},e.content)}(e,a,t);case Ct.Highlight:return _.createElement("span",{key:a,className:pt},"@".concat(e.content));case Ct.Mention:var o=e.uid===d,s=(null==(r=null==u?void 0:u.get(e.uid))?void 0:r.userInfo)||{nickname:e.content,userUid:e.uid},m=hn(s,i.userRegistryStore),f=vn(s);return o?_.createElement("span",{"data-nickname":f,key:a,className:pt},"@".concat(m)):c?_.createElement(c,{userInfo:s,inGroupChat:l===Se.GROUP,key:a,getContainer:function(){return document.getElementById("im-sdk-popup-container")}},_.createElement("span",{"data-nickname":f,className:W(pt,vt)},"@".concat(m))):_.createElement("span",{"data-nickname":f,className:W(pt),key:a},"@".concat(m));default:return _.createElement(_.Fragment,{key:a},e.content)}}))):null})),kt="_ellipsis_ktxp8_1",xt=function(e){var n=e.children,t=e.maxLine,r=void 0===t?1:t;return _.createElement("span",{style:{WebkitLineClamp:r},className:kt},n)},wt=function(e){return _.createElement(D.A,(0,d.A)((0,d.A)({},e),{},{getContainer:function(){return document.getElementById("im-sdk-popup-container")}}))};Object.keys(D.A).forEach((function(e){wt[e]=D.A[e]})),["show","success","info","prompt","warn","error","action","tip","confirmation"].forEach((function(e){var n=D.A[e];wt[e]=function(e){return n("string"===typeof e||e instanceof String?e:(0,d.A)((0,d.A)({},e),{},{getContainer:function(){return document.getElementById("im-sdk-popup-container")}}))}})),["Action","Prompt","Group","Window","Footer","Tip","Confirmation"].forEach((function(e){var n=D.A[e];wt[e]=function(e){return _.createElement(n,(0,d.A)((0,d.A)({},e),{},{getContainer:function(){return document.getElementById("im-sdk-popup-container")}}))}}));var Tt=function(){var e,n,t=La(),r=t.client,i=t.store,s=t.ready,c=function(){var e=La().client,n=(0,_.useCallback)(function(){var n=(0,o.A)((0,a.A)().mark((function n(t){var r,o,i;return(0,a.A)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=t.channelIds,e){n.next=4;break}throw ja(),new Error("sdk not setup");case 4:return n.next=6,e.deleteConversations({channelIds:r});case 6:return(null==(i=n.sent)?void 0:i.success)&&G.A.success(Fe("im_delete_chat_toast_chats_deleted",{number:(null==(o=i.deletedConversationChanIds)?void 0:o.length)||0})),n.abrupt("return",i);case 9:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),[e]),t=(0,_.useCallback)((function(e){var t=e.channelIds;return new Promise((function(e,r){var i=wt.confirmation({title:Fe("im_delete_chat_title_delete_chats",{number:t.length}),children:_.createElement("span",{className:"im-dialog-confirmation-content"},Fe("im_delete_chat_desc_permanently_delete",{number:t.length})),confirmText:Fe("im_general_chat_btn_delete"),confirmBtnProps:{type:q.A.TYPE.red,category:q.A.CATEGORY.fill},cancelText:Fe("im_general_use_btn_cancel"),onConfirm:function(){var s=(0,o.A)((0,a.A)().mark((function o(){var s;return(0,a.A)().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return i.update({confirmLoading:!0}),a.next=3,n({channelIds:t}).catch((function(e){i.update({confirmLoading:!1}),r(e)}));case 3:if(s=a.sent,i.update({confirmLoading:!1}),s){a.next=8;break}return e(s),a.abrupt("return");case 8:i.destroy(),e(s);case 10:case"end":return a.stop()}}),o)})));return function(){return s.apply(this,arguments)}}()})}))}),[n]);return{deleteConversations:n,promptDeleteConversations:t}}(),u=null!==(e=null==i?void 0:i.conversationStore)&&void 0!==e?e:{},l=u.conversationMap,m=u.conversationList,f=u.conversationListStatus,p=u.conversationListReady,v=u.conversationListHasMore,h=u.activeConversation,g=(0,_.useMemo)((function(){return qn(i.conversationStore,r)}),[i,r]),A=(0,_.useMemo)((function(){return function(e,n){return function(){var t=(0,o.A)((0,a.A)().mark((function t(r){var o,i,s,c,u,l,d,m;return(0,a.A)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n){t.next=3;break}return ja(),t.abrupt("return",null);case 3:if(s=null,c=Bn(r),!Hn(r)){t.next=17;break}return t.next=8,n.createIndividualChat({contactUid:r.uid,relationSourceType:r.relation});case 8:if((u=t.sent).channelId){t.next=11;break}return t.abrupt("return",null);case 11:return t.next=13,n.getConversationList({channelIds:[u.channelId]},"initConversation");case 13:l=t.sent,s=null==(o=null==l?void 0:l.data)?void 0:o[0],t.next=33;break;case 17:if(!c){t.next=25;break}return d=Dn({userUid:n.queryUserInfo().userUid,channelId:r.channelId}),e.setConversationList([d]),t.next=22,n.getConversationList({channelIds:[r.channelId]},"initConversation");case 22:s=t.sent.data[0],t.next=33;break;case 25:if(!Fn(r)){t.next=33;break}if(!e.conversationMap[r.channelId]){t.next=29;break}return e.setActiveConversationId(r.channelId),t.abrupt("return",e.conversationMap[r.channelId]);case 29:return t.next=31,n.getConversationList({channelIds:[r.channelId]},"initConversation");case 31:m=t.sent,s=null==(i=null==m?void 0:m.data)?void 0:i[0];case 33:return(0,T.runInAction)((function(){s&&(e.setActiveConversationId(s.channelId),c||r.resetList?e.setConversationList([s]):(e.updateConversation(s),e.pushConversationToTop(s.channelId)))})),t.abrupt("return",s);case 35:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}(i.conversationStore,r)}),[r,i]),E=(0,_.useCallback)((function(e){return l[e]}),[l]);return(0,d.A)((0,d.A)({},c),{},{initConversation:A,resetConversationList:null==(n=i.conversationStore)?void 0:n.resetConversationList,findConversationByChannelId:E,activeConversation:h,setActiveConversationId:s?i.conversationStore.setActiveConversationId:function(){},conversationList:m,conversationListHasMore:v,conversationListStatus:f,conversationListIsLoading:!!s&&i.conversationStore.conversationListIsLoading,conversationListReady:p,loadConversationList:g})},Nt=function(e,n){return function(e){n&&n.read({channelId:e.channelId,lastReadMsgSeq:String(e.seq),clientMsgId:e.clientMsgId})}},Rt=function(){var e,n=Tt(),t=n.initConversation,r=n.activeConversation,a=n.setActiveConversationId,o=null==r?void 0:r.channelId,i=!!o&&(null==r?void 0:r.status)===ke.HIDDEN,s=(null==r?void 0:r.channelType)===Se.PRIVATE;return{initConversation:t,activeConversation:r,setActiveConversationId:a,conversationId:o,isConversationHidden:i,isPrivateChat:s,isPrivateChatDisabled:s&&Be(null==r?void 0:r.contactInfo),relatedEntityId:null==(e=null==r?void 0:r.entityInfo)?void 0:e.relatedId}};function Lt(e,n){var t=new Set(e.map((function(e){return Number(e.seq)}))),r=n.filter((function(e){return!t.has(e.seq)}));return[].concat((0,l.A)(e),(0,l.A)(r)).sort((function(e,n){return e.seq-n.seq}))}var Ot=function(e){e.setMessagesStatus("loadingBlocking")},Ut=function(e){e.setMessagesStatus("success")},Pt=function(e,n){return e.messages.some((function(e){return e.seq===Number(n)}))},Dt=function(e,n){return+n<e.loadedEarliestMsgSeq&&+n>e.loadedEarliestMsgSeq-180},Gt=function(e,n){return+n>e.loadedLatestMsgSeq&&+n<e.loadedLatestMsgSeq+180},qt=function(){var e=La(),n=e.client,t=e.store,r=t.conversationStore.activeConversation,i=t.messageStore,s=i.setTopEndFetched,c=i.setMessages,u=(0,_.useCallback)(function(){var e=(0,o.A)((0,a.A)().mark((function e(t){var r;return(0,a.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.channelId){e.next=2;break}return e.abrupt("return",void 0);case 2:return e.next=4,null==n?void 0:n.driver.fetchHistoryMessagesByPage({channelId:t.channelId,lastSeq:t.lastSeq,limit:t.limit});case 4:if(r=e.sent){e.next=7;break}return e.abrupt("return",void 0);case 7:return e.abrupt("return",r);case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),[n]),l=(0,_.useCallback)(function(){var e=(0,o.A)((0,a.A)().mark((function e(n){var r,o,l,d,m,f,p,v,h,g;return(0,a.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.channelId,o=n.limit,l=void 0===o?40:o,d=n.signal,r){e.next=3;break}return e.abrupt("return",void 0);case 3:return e.next=5,u({limit:l,lastSeq:i.loadedEarliestMsgSeq,channelId:r});case 5:if((f=e.sent)&&f.channelId===(null==(m=t.conversationStore.activeConversation)?void 0:m.channelId)){e.next=8;break}return e.abrupt("return",void 0);case 8:if(p=f.messageList,v=f.hasMore,h=f.lowestSeq,g=f.highestSeq,!(null==d?void 0:d.aborted)){e.next=11;break}return e.abrupt("return",void 0);case 11:return(0,T.runInAction)((function(){i.setLoadedEarliestMsgSeq(h),i.setLoadedLatestMsgSeq(g),s(!v);var e=Lt(i.messages,p);c(e),i.setMessagesStatus("success")})),e.abrupt("return",f);case 13:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),[null==r?void 0:r.channelId]),d=function(e,n,t){return function(){var r=(0,o.A)((0,a.A)().mark((function r(o){var i,s,c,u,l,d,m,f,p=arguments;return(0,a.A)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(i=(p.length>1&&void 0!==p[1]?p[1]:{}).updateLoadingStatus,s=void 0===i||i,c=p.length>2?p[2]:void 0,null==t?void 0:t.channelId){r.next=4;break}return r.abrupt("return",void 0);case 4:return u=t.channelId,s&&e.messageStore.setMessagesStatus("loadingMore"),r.next=8,n({channelId:u,limit:120,lastSeq:+o+60});case 8:if(l=r.sent,!(null==c?void 0:c.aborted)){r.next=11;break}return r.abrupt("return",void 0);case 11:if(l){r.next=13;break}return r.abrupt("return",void 0);case 13:if(l.messageList.find((function(e){return e.seq==o}))){r.next=16;break}return console.warn("Target message not found"),r.abrupt("return",void 0);case 16:return d=l.messageList,m=l.lowestSeq,f=l.highestSeq,e.messageStore.setLoadedEarliestMsgSeq(m),e.messageStore.setLoadedLatestMsgSeq(f),e.messageStore.setMessages([]),e.messageStore.prependMessages(d),s&&e.messageStore.setMessagesStatus("success"),r.abrupt("return",d);case 23:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()}(t,u,r),m=function(e,n){return function(){var t=(0,o.A)((0,a.A)().mark((function t(r,o){var i,s,c,u,l,d,m,f,p=arguments;return(0,a.A)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=(p.length>2&&void 0!==p[2]?p[2]:{}).updateLoadingStatus,c=p.length>3?p[3]:void 0,!0!==(s=void 0===i||i)||!["loadingMore","loading","loadingBlocking"].includes(e.messageStore.messagesStatus)){t.next=4;break}return t.abrupt("return",void 0);case 4:if(!((u=Number(e.messageStore.loadedEarliestMsgSeq)-1)<=0)){t.next=8;break}return e.messageStore.setTopEndFetched(!0),t.abrupt("return",void 0);case 8:return s&&e.messageStore.setMessagesStatus("loadingMore"),t.next=11,n({limit:r,lastSeq:u,channelId:o});case 11:if(l=t.sent,!(null==c?void 0:c.aborted)){t.next=14;break}return t.abrupt("return",void 0);case 14:if(l&&l.channelId===e.conversationStore.activeConversationId){t.next=16;break}return t.abrupt("return",void 0);case 16:return d=l.messageList,m=l.hasMore,f=l.lowestSeq,e.messageStore.setTopEndFetched(!m),e.messageStore.setLoadedEarliestMsgSeq(f),e.messageStore.prependMessages(d,!0),s&&e.messageStore.setMessagesStatus("success"),t.abrupt("return",l);case 22:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()}(t,u),f=(0,_.useCallback)(function(e,n){return function(){var t=(0,o.A)((0,a.A)().mark((function t(r,o){var i,s,c,u,l,d,m,f=arguments;return(0,a.A)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=(f.length>2&&void 0!==f[2]?f[2]:{}).updateLoadingStatus,c=f.length>3?f[3]:void 0,!0!==(s=void 0===i||i)||!["loadingMore","loading","loadingBlocking"].includes(e.messageStore.messagesStatus)){t.next=4;break}return t.abrupt("return",void 0);case 4:return u=Number(e.messageStore.loadedLatestMsgSeq)+r,t.prev=5,s&&e.messageStore.setMessagesStatus("loadingMore"),t.next=9,n({limit:r,lastSeq:u,channelId:o});case 9:if(l=t.sent,!(null==c?void 0:c.aborted)){t.next=12;break}return t.abrupt("return",void 0);case 12:if(l&&l.channelId===e.conversationStore.activeConversationId){t.next=14;break}return t.abrupt("return",void 0);case 14:return d=l.messageList,m=l.highestSeq,e.messageStore.setLoadedLatestMsgSeq(m),e.messageStore.appendMessages(d),s&&e.messageStore.setMessagesStatus("success"),t.abrupt("return",l);case 21:if(t.prev=21,t.t0=t.catch(5),Fa.error("Error loading more from bottom",{errorName:"MessageLoadingFailed",error:t.t0,data:{limit:r,lastSeq:u,channelId:o},tags:{feErrorType:"UserAction",feCallOrigin:"loadMoreMessagesFromBottom"}}),!(null==c?void 0:c.aborted)){t.next=26;break}return t.abrupt("return",void 0);case 26:return s&&e.messageStore.setMessagesStatus("error"),t.abrupt("return",void 0);case 28:case"end":return t.stop()}}),t,null,[[5,21]])})));return function(e,n){return t.apply(this,arguments)}}()}(t,u),[]),p=(0,_.useCallback)(function(){var e=(0,o.A)((0,a.A)().mark((function e(n,t,r){var o,s;return(0,a.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Pt(i,n)){e.next=2;break}return e.abrupt("return",!0);case 2:if(!Dt(i,n)){e.next=11;break}return o=i.loadedEarliestMsgSeq-+n+20,Ot(i),e.next=7,m(o,t,{updateLoadingStatus:!1},r);case 7:if(!(null==r?void 0:r.aborted)){e.next=9;break}return e.abrupt("return",void 0);case 9:return Ut(i),e.abrupt("return",!0);case 11:return Ot(i),e.next=14,d(n,{updateLoadingStatus:!1},r);case 14:if(s=e.sent,!(null==r?void 0:r.aborted)){e.next=17;break}return e.abrupt("return",void 0);case 17:return Ut(i),e.abrupt("return",s);case 19:case"end":return e.stop()}}),e)})));return function(n,t,r){return e.apply(this,arguments)}}(),[i,m,d]),v=(0,_.useCallback)(function(){var e=(0,o.A)((0,a.A)().mark((function e(n,t,r){var o,s,c,u,l;return(0,a.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Pt(i,n)){e.next=2;break}return e.abrupt("return",!0);case 2:if(!Dt(i,n)){e.next=12;break}return o=i.loadedEarliestMsgSeq-n+20,Ot(i),e.next=7,m(o,t,{updateLoadingStatus:!1},r);case 7:if(s=e.sent,!(null==r?void 0:r.aborted)){e.next=10;break}return e.abrupt("return",void 0);case 10:return Ut(i),e.abrupt("return",s);case 12:if(!Gt(i,n)){e.next=22;break}return c=n-i.loadedLatestMsgSeq+20,Ot(i),e.next=17,f(c,t,{updateLoadingStatus:!1},r);case 17:if(u=e.sent,!(null==r?void 0:r.aborted)){e.next=20;break}return e.abrupt("return",void 0);case 20:return Ut(i),e.abrupt("return",u);case 22:return Ot(i),e.next=25,d(n,{updateLoadingStatus:!1},r);case 25:if(l=e.sent,!(null==r?void 0:r.aborted)){e.next=28;break}return e.abrupt("return",void 0);case 28:return Ut(i),e.abrupt("return",l);case 30:case"end":return e.stop()}}),e)})));return function(n,t,r){return e.apply(this,arguments)}}(),[i,m,f,d]),h=(0,_.useCallback)(function(){var e=(0,o.A)((0,a.A)().mark((function e(n,t,o){var s;return(0,a.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=null==r?void 0:r.startMsgSeq,!(Number(s)>Number(n))){e.next=3;break}return e.abrupt("return",!1);case 3:if("normal"!==i.listMode){e.next=5;break}return e.abrupt("return",p(Number(n),t,o));case 5:if("detached"!==i.listMode){e.next=7;break}return e.abrupt("return",v(Number(n),t,o));case 7:return e.abrupt("return",void 0);case 8:case"end":return e.stop()}}),e)})));return function(n,t,r){return e.apply(this,arguments)}}(),[i,null==r?void 0:r.channelId]),g=(0,_.useCallback)(function(){var e=(0,o.A)((0,a.A)().mark((function e(n){var t,r,o,i,s;return(0,a.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.seq,r=n.channelId,o=n.shouldHighlight,i=n.signal,e.next=3,h(t,r,i);case 3:if(s=e.sent){e.next=6;break}return e.abrupt("return",void 0);case 6:return un({type:"OK-IM-SCROLL-TO-MESSAGE",data:{from:"HOOK",seq:t,channelId:r,shouldHighlight:o}}),e.abrupt("return",s);case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),[h]);return{getMessageList:u,loadLatestMessages:l,loadAroundMessage:d,locateMessage:h,jumpToMessage:g,loadMoreMessagesFromTop:m,loadMoreMessagesFromBottom:f}},Bt=function(){var e=La().store;return{checkIfUserCanChat:(0,_.useCallback)((function(n){var t=n||{},r=t.sendMsgOption,a=t.entityInfo;return r!==Ie.blocked||!a||(wt.confirmation({title:Fe("im_block_user_dialog_header_unable_to_contact_user",{user:hn(a,e.userRegistryStore)}),children:_.createElement("span",{className:"im-dialog-confirmation-content"},Fe("im_block_user_dialog_you_cant_contact")),confirmText:Fe("im_general_use_btn_ok_error")}),!1)}),[e.userRegistryStore])}},Ht=function(e){var n=La(),t=n.client,r=n.store,i=Rt().activeConversation,s=qt().loadLatestMessages,c=e||i,u=Bt().checkIfUserCanChat,l=(0,_.useCallback)(function(){var e=(0,o.A)((0,a.A)().mark((function e(n){var o,i,l,m,f;return(0,a.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=3;break}return ja(),e.abrupt("return",void 0);case 3:if(c){e.next=5;break}return e.abrupt("return",void 0);case 5:if((i=c.channelId)&&u(c)){e.next=9;break}return console.warn("user cannot send"),e.abrupt("return",void 0);case 9:if(l=null==(o=r.messageInputStore.getDraft(i))?void 0:o.quotedMsg,m=(0,d.A)((0,d.A)({channelId:i},n),{},{messageContent:n.messageContent}),l&&(m.quotedMessage=l),"detached"!==r.messageStore.listMode){e.next=19;break}return f=r.conversationStore.abortSignal,r.messageStore.resetListStates(),e.next=17,s({channelId:i,lastSeq:Number.MAX_SAFE_INTEGER,signal:f});case 17:e.next=20;break;case 19:un({type:"MESSAGE_LIST_SCROLL_TO_BOTTOM",data:{channelId:i,smooth:!1,force:!0}});case 20:return r.messageInputStore.updateDraft(i,{quotedMsg:void 0}),e.abrupt("return",t.sendMessage(m));case 22:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),[t,c,r,u,s]),m=(0,_.useCallback)(function(){var e=(0,o.A)((0,a.A)().mark((function e(n){var r,o;return(0,a.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=3;break}return ja(),e.abrupt("return",void 0);case 3:if(c){e.next=5;break}return e.abrupt("return",void 0);case 5:if((r=c.channelId)&&u(c)){e.next=8;break}return e.abrupt("return",!1);case 8:return e.next=10,t.resendMessage({channelId:r,tempMessage:(0,T.toJS)(n)});case 10:return o=e.sent,e.abrupt("return",o);case 12:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),[c,u,t]);return{sendMessage:l,resendMessage:m}};function Ft(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nn.GLOBAL,t=La().store,r=t.audioStore,a=r.setChannelAudio,o=r.getChannelAudio,i=r.getAudioState,s=r.stopOtherAudios,c=r.updateChannelInstance,u=r.attachAudioEvents,l=r.detachAudioEvents,m=i(n,e)||{isPlaying:!1,isPaused:!1,duration:0,currentTime:0};return{play:function(){var r=o(n);if(r||(t.audioStore.audioChannels[n]={instance:null,audios:{}},r=o(n)),r){r.instance&&r.instance.src!==e&&(r.instance.pause(),r.instance.currentTime=0);var d=new Audio(e);s(n,e),r.instance=d;var m=i(n,e);m&&(d.src=e,d.currentTime=m.currentTime);var f=u(n,e,d);return d.play().then((function(){a(n,{url:e,isPlaying:!0,isPaused:!1,duration:d.duration,currentTime:d.currentTime}),c(n,d)})).catch((function(e){Fa.warn("Failed to play recording",{error:e,tags:{feErrorType:"UserAction",feCallOrigin:"audioPlayer.play"}})})),function(){l(n,e,d,f)}}},pause:function(){var t=o(n);if(t){var r=t.instance;if(r){var s=u(n,e,r);r.pause(),l(n,e,r,s),a(n,(0,d.A)((0,d.A)({},i(n,e)),{},{isPlaying:!1,isPaused:!0,currentTime:r.currentTime}))}}},stop:function(){var t=o(n);if(t){var r=t.instance;if(r){var s=u(n,e,r);r.pause(),r.currentTime=0,l(n,e,r,s),a(n,(0,d.A)((0,d.A)({},i(n,e)),{},{isPlaying:!1,isPaused:!1,currentTime:0}))}}},isPlaying:m.isPlaying,isPaused:m.isPaused,duration:m.duration,currentTime:m.currentTime}}function Vt(){var e,n=Rt(),t=n.conversationId,r=n.activeConversation,a=n.isConversationHidden,o=!!t&&(null==r?void 0:r.channelType)===Se.GROUP,i=o?t:"",s=null!==(e=null==r?void 0:r.role)&&void 0!==e?e:Y.G.NORMAL,c=null==r?void 0:r.groupInfo,u=null==r?void 0:r.memberListMap,l=s===Y.G.OWNER,d=l||s===Y.G.ADMIN,m=o&&(null==r?void 0:r.inGroupStatus)===we.NO&&(null==r?void 0:r.groupStatus)===Y.c.NORMAL,f=o&&(null==r?void 0:r.inGroupStatus)===we.NO&&(null==r?void 0:r.groupStatus)===Y.c.DISMISS;return{isGroup:o,isGroupOwner:l,isAdmin:d,isKickedFromGroup:m,isGroupDisbanded:f,isGroupChatDisabled:c&&!c.allowMembersSendMessage&&!d,isGroupInactive:a||m||f,groupId:i,groupInfo:c,groupMemberMap:u,currGroupRole:s}}var Wt=function(e){var n=e.size,t=void 0===n?20:n;return _.createElement(R.A,{a11yText:Fe("im_voice_message_hover_voice_message"),iconName:"okx-support-im-mic-on",style:{fontSize:t}})},Yt={offColor:"_offColor_1h918_1",container:"_container_1h918_4",subContainer:"_subContainer_1h918_55",subContainerMedia:"_subContainerMedia_1h918_62",author:"_author_1h918_65",text:"_text_1h918_72",context:"_context_1h918_75",ellipsisText:"_ellipsisText_1h918_84",previewImage:"_previewImage_1h918_93"},jt=function(e){var n=e.text,t=void 0===n?"":n,r=e.message,a=e.store,o=a.conversationStore.activeConversation,i=o.memberListMap,s=o.channelType,c=Boolean(r)&&s===Se.GROUP,u=Mt({text:t,message:r,allowMention:c});return u.length?u.map((function(e){var n;if(e.type===Ct.Mention){var t=(null==(n=null==i?void 0:i.get(e.uid))?void 0:n.userInfo)||{nickname:e.content,userUid:e.uid},r=hn(t,a.userRegistryStore);return"@".concat(r)}return e.content})).join(""):""};function zt(e){var n=e.message,t=(e.onClose,e.className),r=e.offColor,a=void 0!==r&&r,o=e.enableJumpToMsg,s=(0,i.A)(e,ee),c=La().store,u=qt().jumpToMessage,l=(0,_.useMemo)((function(){var e,t,r,a,o,i;if(!n)return null;var s,u=hn((0,d.A)({userUid:n.senderUid},n.senderName),c.userRegistryStore);if(n.contentType===Ue.MESSAGE_RECALLED||n.contentType===Ue.MESSAGE_RECALLED_BY_ADMIN)return _.createElement("div",{className:W(Yt.subContainer)},_.createElement("div",{className:Yt.author},u),_.createElement("div",{className:Yt.context},Fe("im_reply_text_this_message_recalled")));if(n.contentType===Ue.TEXT_MESSAGE)return _.createElement("div",{className:W(Yt.subContainer)},_.createElement("div",{className:Yt.author},u),_.createElement("div",{className:Yt.context},_.createElement(zn,{className:Yt.ellipsisText},jt({store:c,text:null!==(s=null==(e=n.textMessage)?void 0:e.text)&&void 0!==s?s:"",message:n}))));if(n.contentType===Ue.VIDEO_MESSAGE){var l=Ga(null==(t=null==n?void 0:n.videoMessage)?void 0:t.thumbnail),m=null==(r=null==n?void 0:n.videoMessage)?void 0:r.duration,f=Number.isFinite(m)?He(m):"00:00";return _.createElement(_.Fragment,null,_.createElement("span",{className:W(Yt.subContainer)},_.createElement("span",{className:Yt.author},u),_.createElement("span",{className:Yt.context},_.createElement(O.A,{src:"".concat(Va(),"/cdn/assets/imgs/246/0DCF3167C895CFA5.svg")}),f)),_.createElement(O.A,{className:W(jn,Yt.previewImage),src:l,alt:"",useWebp:!1}))}if(n.contentType===Ue.PICTURE_MESSAGE){var p=Ga(null==(a=null==n?void 0:n.imageMessage)?void 0:a.thumbnail);return _.createElement(_.Fragment,null,_.createElement("span",{className:W(Yt.subContainer)},_.createElement("span",{className:Yt.author},u),_.createElement("span",{className:Yt.context},_.createElement(R.A,{iconName:"okds-communication-img"}),Fe("im_reply_text_image"))),_.createElement(O.A,{className:W(jn,Yt.previewImage),src:p,alt:"",useWebp:!1}))}if(n.contentType===Ue.VOICE_MESSAGE){var v=null==(o=null==n?void 0:n.voiceMessage)?void 0:o.duration,h=Number.isFinite(v)?He(v):"00:00";return _.createElement("span",{className:W(Yt.subContainer)},_.createElement("span",{className:Yt.author},u),_.createElement("span",{className:Yt.context},_.createElement(Wt,{size:16}),h))}return n.contentType===Ue.MEDIA_MESSAGE?_.createElement("span",{className:W(Yt.subContainer,Yt.subContainerMedia)},_.createElement("span",{className:Yt.author},u),_.createElement("span",{className:Yt.context},_.createElement(R.A,{iconName:"okds-orders"}),_.createElement(xt,null,null==(i=n.mediaMessage)?void 0:i.fileName))):null}),[n,c]);if(!l)return null;var m=function(){(null==n?void 0:n.seq)&&o&&Pe.includes(n.contentType)&&u({seq:n.seq,channelId:n.channelId,shouldHighlight:!0,signal:c.conversationStore.abortSignal})};return _.createElement("div",(0,d.A)({"data-reply-seq":null==n?void 0:n.seq,role:"button",tabIndex:0,onClick:m,onKeyDown:m,className:W(Yt.container,t,(0,f.A)({},Yt.offColor,a))},s),l)}function Kt(e){return(null==window?void 0:window.MouseEvent)&&e.nativeEvent instanceof window.MouseEvent}function Xt(e){return(null==window?void 0:window.TouchEvent)&&e.nativeEvent instanceof window.TouchEvent}function Jt(e){return Xt(e)?{x:e.touches[0].clientX,y:e.touches[0].clientY}:Kt(e)?{x:e.nativeEvent.clientX,y:e.nativeEvent.clientY}:null}function Qt(e){var n=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).threshold,t=void 0===n?400:n,r=(0,_.useRef)(!1),a=(0,_.useRef)(!1),o=(0,_.useRef)(),i=(0,_.useRef)(e),s=C.T.isIOS;(0,_.useEffect)((function(){i.current=e}),[e]);var c=(0,_.useCallback)((function(e){if(!a.current&&Xt(e)&&!(e.touches.length>1)){a.current=!0;var n=e.currentTarget;o.current=setTimeout((function(){var t;i.current&&(Object.assign(e,{currentTarget:n}),(t=document.activeElement)&&"blur"in t&&"function"===typeof t.blur&&document.activeElement.blur(),i.current(e),r.current=!0)}),t)}}),[t]),u=(0,_.useCallback)((function(){a.current&&(r.current=!1,a.current=!1,void 0!==o.current&&clearTimeout(o.current))}),[]);return(0,_.useEffect)((function(){if(!(0,S.f)()&&s)return window.addEventListener("touchend",e),function(){window.removeEventListener("touchend",e)};function e(e){var n={target:e.target,currentTarget:e.currentTarget,nativeEvent:e,persist:function(){}};u(n)}}),[u,s]),(0,_.useEffect)((function(){void 0!==o.current&&clearTimeout(o.current)}),[]),(0,_.useCallback)((function(){return e?s?{onTouchStart:c,onTouchEnd:u,onTouchMove:u,onContextMenu:function(e){e.stopPropagation(),e.preventDefault()}}:{onContextMenu:e}:{}}),[s,e,u,c])}var Zt="_timestamp_4hcgl_1",$t="_pre_4hcgl_8",er="_hide_4hcgl_12",nr=function(e){var n=e.time,t=e.className,r=e.id;return _.createElement("div",{className:W(Zt,t),id:r,"aria-label":(0,b.r6)(new Date(Number(n)),{format:M.Bp.StandardDateTime})},_.createElement("span",{className:W($t,(0,f.A)({},er,+n>Je()))},Qe(n),",\xa0"),I.A.format(n,"hh:mm"))},tr={"dark-bubble":"_dark-bubble_1g3iz_1","light-bubble":"_light-bubble_1g3iz_1",incoming:"_incoming_1g3iz_42",outgoing:"_outgoing_1g3iz_52",hideAvatar:"_hideAvatar_1g3iz_59",messageBubble:"_messageBubble_1g3iz_65",userMessageWrapper:"_userMessageWrapper_1g3iz_77",userMessageWithAvatar:"_userMessageWithAvatar_1g3iz_85",avatarColumn:"_avatarColumn_1g3iz_91",nameMessageColumn:"_nameMessageColumn_1g3iz_95",timestamp:"_timestamp_1g3iz_104",messageWithInfo:"_messageWithInfo_1g3iz_107","group-mess-box":"_group-mess-box_1g3iz_113",messageBodyRow:"_messageBodyRow_1g3iz_116",compactTimestamp:"_compactTimestamp_1g3iz_123",indicatorWrapper:"_indicatorWrapper_1g3iz_133",me:"_me_1g3iz_65",readIndicator:"_readIndicator_1g3iz_148",readIndicatorIcon:"_readIndicatorIcon_1g3iz_151",loadingIcon:"_loadingIcon_1g3iz_154",retryIcon:"_retryIcon_1g3iz_158","no-border":"_no-border_1g3iz_187",hidden:"_hidden_1g3iz_196",messageReply:"_messageReply_1g3iz_199",selectNone:"_selectNone_1g3iz_203",messageContent:"_messageContent_1g3iz_206"},rr=function(e){var n=e.context,t=e.event,r=e.hasAdminPermission,a=e.imStore,o=e.isChatDisabled,i=e.onCopy,s=e.enableReply,c=void 0===s||s,u=e.enableRecall,l=void 0===u||u,d=[],m=a.configStore.message;if(l&&!o&&function(e,n,t){var r;if(!1===(null==(r=null==t?void 0:t.recall)?void 0:r.enable))return!1;if(e.contentType===Ue.VOICE_CALL_MESSAGE)return!1;if(!n){var a=(new Date).getTime();if(!e.isSender||a-Number(e.sendTime)>6e4)return!1}return!0}(n,r,m)&&d.push({id:"recall-message",title:Fe("im_group_chat_pop_recall_message"),iconName:"okx-support-im-recall-message",handler:function(){var e;null==(e=a.client)||e.recallMessage({channelId:n.channelId,seq:n.seq,adminRecallOthersMessage:r&&!n.isSender})}}),!o&&c&&function(e,n){var t,r,a,o,i;return!!(null==(t=null==n?void 0:n.reply)?void 0:t.enable)&&!!(null==(o=null==(a=null==(r=null==n?void 0:n.reply)?void 0:r.canReply)?void 0:a.includes)?void 0:o.call(a,null==e?void 0:e.contentType))&&("function"===typeof(null==(i=null==n?void 0:n.reply)?void 0:i.canReplyFn)?n.reply.canReplyFn(e):!e.loading)}(n,m)&&d.push({id:"reply-message",title:Fe("im_reply_btn_reply"),iconName:"okx-support-im-reply",handler:function(){a.messageInputStore.quoteMessage(n.channelId,n)}}),i&&d.push({id:"copy-message",title:Fe("im_reply_btn_copy"),iconName:"okds-copy",handler:i}),d.length){var f=t.currentTarget.getBoundingClientRect(),p=Jt(t)||{x:0,y:0};a.overlayStore.showOperationMenu({menuConfig:d,offsetX:p.x-f.left,offsetY:p.y-f.top,targetElement:t.currentTarget})}},ar=function(e){var n=e.context,t=e.showRemoveMemberDialog,r=e.imStore,a=e.event,o=function(e,n){var t=[];if(!e)return t;var r=e.currentRole,a=e.targetUser;return e.isGroup&&void 0!==r&&n&&t.push({id:"remove-group-member",title:Fe("im_remove_member_tooltips_text_remove_group_member"),icon:"".concat(Va(),"/cdn/assets/imgs/2311/4E0D3BC485843C59.svg"),handler:function(){n({memberUids:[a.userUid]})}}),t}(n,t);if(o.length){var i=a.currentTarget.getBoundingClientRect(),s=Jt(a)||{x:0,y:0};r.overlayStore.showOperationMenu({menuConfig:o,offsetX:s.x-i.left,offsetY:s.y-i.top,targetElement:a.currentTarget})}};function or(e,n){var t=e.isSender,r=e.senderUid,a=e.senderName,o=La(),i=o.client,s=o.store.conversationStore.activeConversation,c=Vt(),u=c.isGroup,l=c.groupMemberMap,m=null==s?void 0:s.entityInfo,f=(0,_.useMemo)((function(){var t,r;if(e)return null==(r=null==(t=n.avatar)?void 0:t.getSenderAvatarUrl)?void 0:r.call(t,e)}),[n.avatar,e]);return(0,_.useMemo)((function(){var e,n=f?{avatar:f}:{};if(t)return(0,d.A)((0,d.A)((0,d.A)({},null==i?void 0:i.queryUserInfo()),n),{},{role:null!==(e=null==s?void 0:s.role)&&void 0!==e?e:Y.G.NORMAL});var o=(0,d.A)({userUid:r,tags:[]},a);if(u){var c,p=null==l?void 0:l.get(r),v=(null==p?void 0:p.userInfo)||o;return(0,d.A)((0,d.A)((0,d.A)({},v),n),{},{role:null!==(c=null==p?void 0:p.role)&&void 0!==c?c:Y.G.NORMAL})}return(0,d.A)((0,d.A)((0,d.A)((0,d.A)({role:Y.G.NORMAL},o),m),a),n)}),[u,r,a,m,l,f])}var ir=(0,N.observer)((function(e){var n=e.message,t=e.prevMessage,r=e.options,a=void 0===r?{}:r,o=La().store,i=Vt().isGroup,s=o.configStore.message,c=n.isSender,u=(0,_.useMemo)((function(){var e,t;if(n)return null==(t=null==(e=s.nickname)?void 0:e.getSenderNickname)?void 0:t.call(e,n)}),[s.nickname,n]),l=or(n,s),d=!Xa(n,t),m=(0,_.useMemo)((function(){return ur(a,s.displayMessageSender,i,c)}),[i,c,a,null==s?void 0:s.displayMessageSender]),f=d&&m,p=(0,_.useMemo)((function(){return c?s.outMessageUserTag:s.inMessageUserTag}),[c,s]);return _.createElement(mt,{id:wn(n),hidden:!f,userInfo:l,customName:u,className:tr.selectNone,showOfficialTag:p,customTag:p&&void 0!==(null==l?void 0:l.role)&&Fe(Y.a[l.role]||""),customTagClassName:(null==l?void 0:l.role)===Y.G.OWNER?"im-group-owner":"im-group-admin"})})),sr=(0,N.observer)((function(e){var n,t=e.message,r=e.prevMessage,a=e.options,o=void 0===a?{}:a,i=t.channelType,s=La().store,c=Rt().activeConversation,u=Vt().isGroup,l=s.configStore.message,d=t.isSender,m=or(t,l),f=!Xa(t,r),p=(0,_.useMemo)((function(){return ur(o,l.displayMessageSender,u,d)}),[u,d,o,null==l?void 0:l.displayMessageSender]),v=f&&p,h=(null==(n=en("useRemoveGroupMemberPrompt"))?void 0:n())||{},g=h.promptRemoveGroupMembers,A=h.checkCanRemoveMember;return v?_.createElement(Yn,{userInfo:m,width:24,height:24,withProfile:!d,channelType:i,getContainer:function(){return document.getElementById("mess-list-wrapper")},onRightClick:function(e){null==e||e.preventDefault(),ar({context:{isGroup:u,currentRole:null==c?void 0:c.role,targetUser:m},event:e,showRemoveMemberDialog:(null==A?void 0:A(m.role))?g:void 0,imStore:s})},"aria-hidden":"true"}):null}));function cr(e,n){return W(e?tr.outgoing:tr.incoming,!n&&tr.hideAvatar)}function ur(e,n,t,r){return!1!==e.usernameRow&&!1!==n&&!(!t||r)}var lr=(0,N.observer)((function(e){var n=e.message,t=e.border,r=void 0===t?8:t,a=e.className,o=e.children,i=e.oppositeLastReadMsgSeq,s=e.onCopy,c=e.prevMessage,u=e.options,l=void 0===u?{}:u,p=La().theme,v=!1!==(null==l?void 0:l.clickToResend),h=n.quotedMessage,g=_.useRef(null),A=_.useState(!1),E=(0,m.A)(A,2),b=E[0],C=E[1],y=function(e,n){var t=(0,_.useCallback)((function(){var t;if(e){var r=window.getSelection(),a=r&&r.rangeCount>0&&n.current&&!!(null==(t=r.getRangeAt(0))?void 0:t.intersectsNode(n.current));!n.current||a&&!(null==r?void 0:r.isCollapsed)||null==r||r.selectAllChildren(n.current);var o=(null==r?void 0:r.toString())||"";e({selectedText:o,selection:r})}}),[e,n]);return(0,_.useEffect)((function(){var r=n.current;if(r&&e){var a=function(e){t(),e.preventDefault()};return r.addEventListener("copy",a),function(){r.removeEventListener("copy",a)}}}),[t,e]),t}(s,g),S=La().store,M=Rt().isPrivateChatDisabled,I=Ht().resendMessage,k=Vt(),x=k.isGroup,w=k.isAdmin,T=k.isGroupChatDisabled,N=S.configStore.message,L="compact"===N.mode,O=n.isSender,P=Qt((0,_.useCallback)((function(e){var t;e.cancelable&&e.preventDefault(),[!1===N.messageRightClickMenu,n.loading,n.needResend,null==(t=n.extra)?void 0:t.isAutoReply].some(Boolean)||rr({imStore:S,context:n,event:e,hasAdminPermission:w,isChatDisabled:M||T,onCopy:s?y:void 0,enableReply:l.reply,enableRecall:l.recall})}),[N.messageRightClickMenu,y,w,T,M,n,s,l.recall,l.reply,S])),D=function(e,n,t){var r=Vt(),a=r.isGroup,o=r.groupInfo,i=a&&!(null==o?void 0:o.allowMembersSendMessage);return(0,_.useCallback)((function(){i?G.A.warn(Fe("im_group_chat_placeholder_chat_disabled")):n&&t(e)}),[i,e,t,n])}(n,v,I),q=(0,_.useMemo)((function(){return ur(l,N.displayMessageSender,x,O)}),[x,O,l,null==N?void 0:N.displayMessageSender]),H=function(e,n,t,r,a,o){var i,s=(0,V.A)().isSm,c=e.channelType,u=e.needResend,l=null!==(i=e.loading)&&void 0!==i&&i,d=e.isSender,m=d&&!l&&e.needResend;return(0,_.useMemo)((function(){if(e.hideActionIcon)return null;if(l)return _.createElement("div",{id:On(e),style:{height:16,width:16},"aria-label":Fe("im_general_text_loading")},_.createElement(B.A.Circle,{size:B.A.SIZE.sm,className:tr.loadingIcon}));if(m)return _.createElement("div",{id:On(e),style:{height:16,width:16}},_.createElement(U.A,{disabled:s||!n,title:Fe("im_general_chat_hover_retry_send"),placement:U.A.DIRECTION.top,className:"status-icon warning-icon",style:{display:"block",margin:"0 auto"},alwaysUpdatePopper:!0},_.createElement(R.A,{"data-retry-icon":!0,iconName:"okds-warning-circle-fill",className:tr.retryIcon,a11yText:Fe("im_general_chat_hover_retry_send"),onClick:o})));if(!1===t.readIndicator)return null;if(!1===r.readIndicator)return null;if(u)return null;if(l)return null;if(!d)return null;if(c!==Se.PRIVATE)return null;var i=e.seq<=a;return _.createElement("div",{id:On(e),"data-name":"read-indicator",className:tr.readIndicator,"aria-label":Ve(i?"im_general_chat_read":"im_general_chat_unread")},_.createElement("img",{"aria-hidden":!0,alt:"",className:tr.readIndicatorIcon,src:"".concat(Va(),i?"/cdn/assets/imgs/227/60C9AA1A21BB8EC1.png":"/cdn/assets/imgs/227/2D3A9F43C25341A6.png")}))}),[c,n,r.readIndicator,o,s,l,d,e,u,a,t.readIndicator,m])}(n,v,l,N,i,D),F=(0,_.useMemo)((function(){return"dark"===p?O?"white":"black":O?"black":"white"}),[O,p]);return _.createElement("div",{className:cr(O,q),id:xn(n),"data-bubblestyle":F},_.createElement("div",{className:tr.userMessageWrapper},_.createElement("div",{className:tr.userMessageWithAvatar},_.createElement("div",{"data-copy-ignore":!0,className:tr.avatarColumn},_.createElement(sr,{message:n,prevMessage:c,options:l})),_.createElement("div",{className:tr.nameMessageColumn},_.createElement(ir,{message:n,prevMessage:c,options:l}),_.createElement("div",{className:W(tr.messageWithInfo,a,(0,f.A)({"group-mess-box":x},tr.me,O))},_.createElement("div",{className:tr.messageBodyRow},_.createElement("div",(0,d.A)((0,d.A)({className:W(tr.messageBubble,(0,f.A)({},tr["no-border"],0===r)),"data-context-menu":!0,style:{padding:"".concat(r,"px")}},L&&{onClick:function(){C((function(e){return!e}))},onBlur:function(){C(!1)}}),P()),h&&_.createElement(zt,{id:Tn(n),"aria-label":Fe("im_chat_alt_replying_to",{quoteSender:hn((0,d.A)({userUid:h.senderUid},h.senderName),S.userRegistryStore)}),className:tr.messageReply,message:h,enableJumpToMsg:!0}),_.createElement(zn,{ref:g,style:{display:"contents"},id:Rn(n)},o)),_.createElement("div",{"data-copy-ignore":!0,className:W(tr.indicatorWrapper,(0,f.A)({},tr.me,O))},!L&&_.createElement(nr,{id:Ln(n),className:tr.timestamp,time:n.sendTime}),H))),L&&_.createElement("div",{"data-copy-ignore":!0},_.createElement(nr,{className:W(tr.compactTimestamp,(0,f.A)({},tr.visible,b)),id:Ln(n),time:n.sendTime}))))))})),dr="_callMsg_1hzbn_1",mr="_icon_1hzbn_8",fr=function(e){var n=e.callMessage||{},t=n.signalType,r=n.duration,a="";switch(t){case _e.CANCEL:a=Fe("im_voice_call_pushmsg_call_canceled");break;case _e.REJECT:a=Fe("im_voice_call_pushmsg_call_declined");break;case _e.COMPLETE:a=Fe("im_voice_call_pushmsg_call_duration",{time:He(r)});break;case _e.TERMINATE:a=Fe("im_voice_call_pushmsg_call_terminated");break;case _e.NO_ANSWER:a=Fe("im_voice_call_pushmsg_no_answer")}return a},pr=function(e){return e.VOICE_MESSAGE="voice_message",e.LIBRARY="library",e.CAMERA="camera",e.VOICE_CALL="voice_call",e.EMOJI="emoji",e}(pr||{}),vr=function(e){return e.IMAGE="image",e.VIDEO="video",e.VOICE_MESSAGE="voice_message",e.FILE="file",e}(vr||{});function hr(e){return gr.apply(this,arguments)}function gr(){return gr=(0,o.A)((0,a.A)().mark((function e(n){var r,o,i,s,c,u,l=arguments;return(0,a.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(null==(r=null==window?void 0:window.utils)?void 0:r.monitor)){e.next=7;break}return e.next=3,t.e(7473).then(t.bind(t,74286));case 3:for(o=e.sent,i=o[n],s=l.length,c=new Array(s>1?s-1:0),u=1;u<s;u++)c[u-1]=l[u];return e.abrupt("return",i.apply(void 0,c));case 7:return e.abrupt("return",(function(){}));case 8:case"end":return e.stop()}}),e)}))),gr.apply(this,arguments)}var _r=function(e){var n=e.file_type,t=e.senderUid,r=Rt().activeConversation,a=La().store,o=function(){var e,n,a;if(!r)return null;var o=(0,l.A)(null!==(e=null==(a=null==r?void 0:r.memberListMap)?void 0:a.values())&&void 0!==e?e:[]).find((function(e){return(null==e?void 0:e.memberUid)===t}));return null!==(n=null==o?void 0:o.role)&&void 0!==n?n:null};return function(){var e,t;hr("IMChatFileOpenClick",{channel_id:null==r?void 0:r.channelId,channel_type:null==r?void 0:r.channelType,group_type:null!==(e=null==(t=null==r?void 0:r.groupInfo)?void 0:t.type)&&void 0!==e?e:null,chat_name:hn(null==r?void 0:r.entityInfo,a.userRegistryStore),sender_group_role:o(),file_type:n})}},Ar="_imgMsg_kfoj8_1",Er="_loading_kfoj8_10",br="_previewBtn_kfoj8_13",Cr="_placeholder_kfoj8_16",yr="_icon_kfoj8_26",Sr="_text_kfoj8_31",Mr=(0,_.memo)((function(){return _.createElement("div",{className:Cr},_.createElement("img",{alt:"",className:yr,src:"".concat(Va(),"/cdn/assets/imgs/239/236A44894F4B6C4B.svg")}),_.createElement("div",{className:Sr},Fe("im_general_chat_text_media_unavailable")))})),Ir=(0,_.memo)(Mr),kr=new Map,xr=function(e){var n,t=e.src,r=e.thumbnail,a=e.alt,o=e.className,i=e.imageMessage,s=null==t?void 0:t.startsWith("blob:"),c=(0,_.useRef)(null),u=null==r?void 0:r.startsWith("data:"),l=(0,_.useState)(u),p=(0,m.A)(l,2),v=p[0],h=p[1],g=(0,_.useState)(0),A=(0,m.A)(g,2),E=A[0],b=A[1],C=(0,_.useState)(null!==(n=kr.get(t))&&void 0!==n&&n),y=(0,m.A)(C,2),S=y[0],M=y[1],I=(0,_.useCallback)((function(){var e="".concat(null==i?void 0:i.width," / ").concat(null==i?void 0:i.height);if(!(null==i?void 0:i.width)||!(null==i?void 0:i.height))return{};var n=i.width,t=i.height,r={};return n>=t&&n>=200?Object.assign(r,{aspectRatio:e,width:200}):t>n&&t>=200?Object.assign(r,{aspectRatio:e,width:200/i.height*(null==i?void 0:i.width)}):Object.assign(r,{aspectRatio:e,width:n}),(Number(null==r?void 0:r.width)>40||Number(null==r?void 0:r.height)>40)&&Object.assign(r,{objectFit:"fill"}),Object.assign(r,{height:"auto"}),r}),[i.height,i.width]);return t?E&&S?_.createElement("img",{"data-testid":"im-img",style:(0,d.A)({height:E,width:"auto"},I()),className:o,src:r,alt:a}):!s&&E?_.createElement("img",{"data-testid":"im-img",className:W(o,(0,f.A)({},Er,v)),style:(0,d.A)({height:E,width:"auto"},I()),src:t,alt:a,onError:function(){M(!0),kr.set(t,!0),h(!1)},onLoad:function(){h(!1),M(!1)}}):_.createElement("img",{style:I(),"data-testid":"im-img",ref:c,className:W(o,(0,f.A)({},Er,s||v)),alt:Ve("im_general_text_loading"),"data-clickable":!0,onLoad:function(){var e,n;E||b(null!==(n=null==(e=c.current)?void 0:e.clientHeight)&&void 0!==n?n:0)},src:r}):null},wr=(0,_.memo)(xr),Tr=function(e){var n=e.src,t=e.thumbnail,r=e.senderUid,a=e.imageMessage,o=_r({senderUid:r,file_type:vr.IMAGE});return _.createElement(L.A,{className:br,"aria-label":Fe("im_chat_alt_open_image_preview"),onClick:function(){var e;e=n,o(),H.A.showPreview({src:e,useWebp:!1,placeholder:_.createElement(Ir,null),actions:[{content:_.createElement(R.A,{className:"okds-download"}),key:"download",onClick:function(){Pa(n,"image")}}]})},"data-message-clickable":!0},_.createElement(wr,{className:Ar,src:n,imageMessage:a,thumbnail:t,alt:""}))},Nr="_mediaMessageContainer_rldda_25",Rr="_mediaMessage_rldda_25",Lr="_mediaIcon_rldda_35",Or="_mediaInfo_rldda_41",Ur="_mediaName_rldda_47",Pr="_mediaStatus_rldda_52",Dr="_successIcon_rldda_61",Gr="_actionIcon_rldda_65",qr="okx-support-im-upload-pdf",Br=(0,_.memo)((function(e){var n,t=e.message,r=e.theme,a=void 0===r?"light":r,o=La().store,i=Rt().activeConversation,s=(0,_.useMemo)((function(){var e,n;return _.createElement(_.Fragment,null,_.createElement(R.A,{"data-testid":"im-media-success",className:Dr,iconName:"okds-success-circle-fill"}),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return+e<1024?"".concat(e," B"):+e<1048576?"".concat((+e/1024).toFixed(2)," KB"):"".concat((+e/1024/1024).toFixed(2)," MB")}(null==(e=t.mediaMessage)?void 0:e.size)," \xb7 ",null==(n=t.mediaMessage)?void 0:n.fileExtension)}),[t.mediaMessage]);return _.createElement("div",{"data-testid":"im-media","data-theme":a,className:Rr},_.createElement(R.A,{className:Lr,iconName:qr}),_.createElement("span",{className:Or},_.createElement("span",{className:Ur},_.createElement(xt,null,null==(n=null==t?void 0:t.mediaMessage)?void 0:n.fileName)),_.createElement("span",{className:Pr},s)),_.createElement(tt,{as:"icon",iconClassName:"okds-download",clickHandler:function(){var e,n,r,a,s,c=za(null==(n=null==t?void 0:t.mediaMessage)?void 0:n.urlPaths,null==(r=null==t?void 0:t.mediaMessage)?void 0:r.fileId);hr("IMChatFileOpenClick",{channel_id:null==i?void 0:i.channelId,channel_type:null==i?void 0:i.channelType,group_type:null!==(e=null==(a=null==i?void 0:i.groupInfo)?void 0:a.type)&&void 0!==e?e:null,chat_name:hn(null==i?void 0:i.entityInfo,o.userRegistryStore),sender_group_role:function(){var e,n,r;if(!i)return null;var a=(0,l.A)(null!==(e=null==(r=null==i?void 0:i.memberListMap)?void 0:r.values())&&void 0!==e?e:[]).find((function(e){return(null==e?void 0:e.memberUid)===t.senderUid}));return null!==(n=null==a?void 0:a.role)&&void 0!==n?n:null}(),file_type:vr.FILE}),Da(null==(s=null==t?void 0:t.mediaMessage)?void 0:s.fileName,c)},className:Gr}))})),Hr=(0,N.observer)((function(e){var n,t=e.channel,r=e.message,a=La().store,o=r.isSender,i=r.senderUid,s=r.senderName,c=xn(r);if(o)return _.createElement(Wn,{id:c,"data-testid":"im-recall-message"},Fe("im_group_chat_alert_you_recalled_message"));var u=t.entityInfo,l=t.memberListMap,d=t.channelType;return _.createElement(Wn,{id:c},Fe("im_group_chat_alert_user_recalled_message",{user:d===Se.PRIVATE?hn(u,a.userRegistryStore):hn((null==(n=null==l?void 0:l.get(i))?void 0:n.userInfo)||s,a.userRegistryStore)}))})),Fr=(0,N.observer)((function(e){var n=e.message,t=La().store,r=ze(n,t);return r?_.createElement(Wn,{id:xn(n)},r):null})),Vr={error:new Map,success:new Map,warn:new Map,info:new Map};function Wr(e){for(var n=arguments.length,t=new Array(n>1?n-1:0),r=1;r<n;r++)t[r-1]=arguments[r];var a=t[0],o=t.slice(1),i="string"===typeof a?{title:a}:a,s=i.title,c=Vr[e];c.has(s)||(c.set(s,i),G.A[e].apply(G.A,[(0,d.A)((0,d.A)({},i),{},{onClose:function(){i.onClose&&i.onClose(),c.delete(s)},getContainer:function(){return document.getElementById("im-sdk-popup-container")}})].concat((0,l.A)(o))))}function Yr(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return Wr.apply(void 0,["error"].concat(n))}var jr="_footer_royq2_25",zr=function(e){var n;if(null==(n=e.message.extra)?void 0:n.isAutoReply)return _.createElement("div",{"data-copy-ignore":!0,className:jr},Fe("im_autoreply_text_automated_msg"))},Kr="_imMessWrap_4y0di_1",Xr=function(e){if(!e.rangeCount)return"";var n=function(e){var n,t,r=e.getRangeAt(0),a=r.commonAncestorContainer;if(a.nodeType===Node.ELEMENT_NODE&&(null==(n=a.parentElement)?void 0:n.getAttribute("data-nickname"))||a.nodeType===Node.TEXT_NODE&&(null==(t=a.parentElement)?void 0:t.getAttribute("data-nickname"))){var o=r.startContainer.parentNode;o&&o!==a&&r.intersectsNode(o)&&r.setStartBefore(o);var i=r.endContainer.parentNode;i&&i!==a&&r.intersectsNode(i)&&r.setEndAfter(i)}return r.cloneContents()}(e);null==n||n.querySelectorAll("[data-copy-Ignore]").forEach((function(e){e.remove()}));var t=n.textContent||"";return null==n||n.querySelectorAll("span[data-nickname]").forEach((function(e){var n=e.getAttribute("data-nickname"),r=e.textContent;r&&n&&(t=t.replace(r,(function(){return"@ ".concat(n)})))})),t=t.replace(/@\s/g,"@")},Jr=function(e){var n,t=e.message,r=e.prevMessage,a=e.oppositeLastReadMsgSeq,o=e.channel,i=e.options,s=(null==(n=t.textMessage)?void 0:n.text)||"",c=(0,_.useCallback)((function(e){var n=e.selection;if(n){var t=Xr(n);if(t)return null==n||n.removeAllRanges(),Ua(t).then((function(){!function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];Wr.apply(void 0,["success"].concat(n))}(Fe("im_copy_toast_message_copied"))}))}}),[]);return _.createElement(lr,{message:t,prevMessage:r,oppositeLastReadMsgSeq:a,onCopy:c,options:i},_.createElement("span",{id:Nn(t),className:Kr},_.createElement(It,{text:s,message:t,linkClassName:"im-mess-link",channel:o}),_.createElement(zr,{message:t})))},Qr=function(){var e=Fe("im_no_support_msg_type");return{templateNotSupported:!0,showText:e,renderDom:function(n){var t=n.message;return _.createElement(Wn,{id:xn(t),"data-testid":"im-unsupported-message"},e)}}},Zr="_video_12xz4_1";function $r(e){var n=e.oppositeLastReadMsgSeq,t=e.message,r=e.prevMessage,a=e.bubbleOptions,o=e.src,i=_r({senderUid:null==t?void 0:t.senderUid,file_type:vr.VIDEO}),s=null==t?void 0:t.videoMessage,c=(0,_.useCallback)((function(){if(!(null==s?void 0:s.width)||!(null==s?void 0:s.height))return{};var e=s.width,n=s.height;return e>264&&(n=n/e*264),n>200?{height:"200px"}:{height:"".concat(n,"px")}}),[s]);if(!(null==t?void 0:t.videoMessage))return _.createElement(lr,{message:t,prevMessage:r,oppositeLastReadMsgSeq:n,options:a});var u=t.videoMessage.thumbnail;!u||u.startsWith("blob:")||u.startsWith("data:")||(u=Ga(u));var l=Nn(t);return _.createElement(lr,{message:t,prevMessage:r,oppositeLastReadMsgSeq:n,options:a},_.createElement(P.A,{id:l},Fe("im_chat_alt_video_message")),_.createElement("video",{tabIndex:-1,"data-message-clickable":!0,"data-test-id":"im-video",onPlay:i,poster:u,src:o,className:Zr,controls:!0,disablePictureInPicture:!0,preload:"none",style:c()}))}var ea=function(e){var n=e.size,t=void 0===n?20:n,r=e.color,a=void 0===r?"white":r;return _.createElement("svg",{width:t,height:t,viewBox:"0 0 20 20",fill:a},_.createElement("path",{d:"M2.14269 9.99935C2.14269 5.66041 5.6609 2.14221 9.99984 2.14221C14.3388 2.14221 17.857 5.66041 17.857 9.99935C17.857 14.3383 14.3388 17.8565 9.99984 17.8565C5.6609 17.8565 2.14269 14.3383 2.14269 9.99935ZM2.604 9.99935C2.604 14.083 5.91616 17.3952 9.99984 17.3952C14.0835 17.3952 17.3957 14.083 17.3957 9.99935C17.3957 5.91567 14.0835 2.60352 9.99984 2.60352C5.91616 2.60352 2.604 5.91567 2.604 9.99935ZM7.79746 12.4993V7.49935H8.03555V12.4993H7.79746ZM11.9641 12.4993V7.49935H12.2022V12.4993H11.9641Z",fill:a,stroke:a,strokeWidth:"0.952381"}))},na=function(e){var n=e.size,t=void 0===n?20:n,r=e.color,a=void 0===r?"white":r;return _.createElement("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:a},_.createElement("path",{d:"M16.398 12.1961L9.19805 16.3961V7.99609L16.398 12.1961Z",fill:a}),_.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M1.99805 11.9981C1.99805 6.48267 6.48462 1.99609 12 1.99609C17.5155 1.99609 22.002 6.48267 22.002 11.9981C22.002 17.5135 17.5155 22.0001 12 22.0001C6.48462 22.0001 1.99805 17.5135 1.99805 11.9981ZM20.335 11.9981C20.335 7.38454 16.6136 3.66309 12 3.66309C7.38649 3.66309 3.66505 7.38454 3.66505 11.9981C3.66505 16.6116 7.38649 20.3331 12 20.3331C16.6136 20.3331 20.335 16.6116 20.335 11.9981Z",fill:a}))},ta=function(e){return e.isPlaying?_.createElement(ea,{size:20,color:"var(--message-text-color)"}):_.createElement(na,{size:20,color:"var(--message-text-color)"})},ra=(0,_.memo)(ta),aa="_voice-comp_1sqtq_1",oa="_voice-time_1sqtq_8",ia="_status-dot_1sqtq_14",sa=(0,N.observer)((function(e){var n=e.url,t=e.duration,r=(e.isSender,e.senderUid),a=(0,i.A)(e,ne),o=Ft(n,nn.VOICE),s=o.play,c=o.pause,u=o.isPlaying,l=o.isPaused,m=o.currentTime,f=_r({senderUid:r,file_type:vr.VOICE_MESSAGE}),p="";p=u||l?"".concat(He(m)," / ").concat(He(t)):Number.isFinite(t)?He(t):"00:00";return _.createElement(L.A,(0,d.A)({className:aa,"data-testid":"im-audio-message",style:{width:t<=20?160:t<=40?200:240},onClick:function(){u?c():(s(),f())},"aria-label":Fe(u?"im_voice_message_hover_stop":"im_voice_message_hover_play")},a),_.createElement(ra,{isPlaying:u}),_.createElement("div",{className:oa},_.createElement("div",{className:ia}),p))})),ca={withStackTrace:!1},ua=function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ca;return{data:n.isOk()?{type:"Ok",value:n.value}:{type:"Err",value:n.error},message:e,stack:t.withStackTrace?(new Error).stack:void 0}},la=function(){function e(n){(0,c.A)(this,e),this._promise=n}return(0,u.A)(e,[{key:"map",value:function(n){return new e(this._promise.then(function(){var e=(0,o.A)((0,a.A)().mark((function e(t){return(0,a.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.isErr()){e.next=2;break}return e.abrupt("return",new Ca(t.error));case 2:return e.t0=ba,e.next=5,n(t.value);case 5:return e.t1=e.sent,e.abrupt("return",new e.t0(e.t1));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()))}},{key:"andThrough",value:function(n){return new e(this._promise.then(function(){var e=(0,o.A)((0,a.A)().mark((function e(t){var r;return(0,a.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.isErr()){e.next=2;break}return e.abrupt("return",new Ca(t.error));case 2:return e.next=4,n(t.value);case 4:if(!(r=e.sent).isErr()){e.next=7;break}return e.abrupt("return",new Ca(r.error));case 7:return e.abrupt("return",new ba(t.value));case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()))}},{key:"andTee",value:function(n){return new e(this._promise.then(function(){var e=(0,o.A)((0,a.A)().mark((function e(t){return(0,a.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.isErr()){e.next=2;break}return e.abrupt("return",new Ca(t.error));case 2:return e.prev=2,e.next=5,n(t.value);case 5:e.next=9;break;case 7:e.prev=7,e.t0=e.catch(2);case 9:return e.abrupt("return",new ba(t.value));case 10:case"end":return e.stop()}}),e,null,[[2,7]])})));return function(n){return e.apply(this,arguments)}}()))}},{key:"mapErr",value:function(n){return new e(this._promise.then(function(){var e=(0,o.A)((0,a.A)().mark((function e(t){return(0,a.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.isOk()){e.next=2;break}return e.abrupt("return",new ba(t.value));case 2:return e.t0=Ca,e.next=5,n(t.error);case 5:return e.t1=e.sent,e.abrupt("return",new e.t0(e.t1));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()))}},{key:"andThen",value:function(n){return new e(this._promise.then((function(t){if(t.isErr())return new Ca(t.error);var r=n(t.value);return r instanceof e?r._promise:r})))}},{key:"orElse",value:function(n){return new e(this._promise.then(function(){var e=(0,o.A)((0,a.A)().mark((function e(t){return(0,a.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.isErr()){e.next=2;break}return e.abrupt("return",n(t.error));case 2:return e.abrupt("return",new ba(t.value));case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()))}},{key:"match",value:function(e,n){return this._promise.then((function(t){return t.match(e,n)}))}},{key:"unwrapOr",value:function(e){return this._promise.then((function(n){return n.unwrapOr(e)}))}},{key:"safeUnwrap",value:function(){var e=this;return(0,p.A)((0,a.A)().mark((function n(){return(0,a.A)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.t0=h.A,n.t1=g.A,n.next=4,(0,v.A)(e._promise.then((function(e){return e.safeUnwrap()})));case 4:return n.t2=n.sent,n.t3=(0,n.t1)(n.t2),n.t4=v.A,n.delegateYield((0,n.t0)(n.t3,n.t4),"t5",8);case 8:return n.abrupt("return",n.t5);case 9:case"end":return n.stop()}}),n)})))()}},{key:"then",value:function(e,n){return this._promise.then(e,n)}},{key:Symbol.asyncIterator,value:function(){var e=this;return(0,p.A)((0,a.A)().mark((function n(){var t;return(0,a.A)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,v.A)(e._promise);case 2:if(!(t=n.sent).isErr()){n.next=6;break}return n.next=6,da(t.error);case 6:return n.abrupt("return",t.value);case 7:case"end":return n.stop()}}),n)})))()}}],[{key:"fromSafePromise",value:function(n){return new e(n.then((function(e){return new ba(e)})))}},{key:"fromPromise",value:function(n,t){return new e(n.then((function(e){return new ba(e)})).catch((function(e){return new Ca(t(e))})))}},{key:"fromThrowable",value:function(n,t){return function(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];return new e((0,o.A)((0,a.A)().mark((function e(){return(0,a.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.t0=ba,e.next=4,n.apply(void 0,i);case 4:return e.t1=e.sent,e.abrupt("return",new e.t0(e.t1));case 8:return e.prev=8,e.t2=e.catch(0),e.abrupt("return",new Ca(t?t(e.t2):e.t2));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))())}}},{key:"combine",value:function(e){return ha(e)}},{key:"combineWithAllErrors",value:function(e){return _a(e)}}])}();function da(e){return new la(Promise.resolve(new Ca(e)))}var ma=la.fromPromise;la.fromSafePromise,la.fromThrowable;var fa,pa,va=function(e){var n,t=Aa([]),r=(0,s.A)(e);try{var a=function(){var e=n.value;if(e.isErr())return t=Ea(e.error),1;t.map((function(n){return n.push(e.value)}))};for(r.s();!(n=r.n()).done&&!a(););}catch(Ea){r.e(Ea)}finally{r.f()}return t},ha=function(e){return la.fromSafePromise(Promise.all(e)).andThen(va)},ga=function(e){var n,t=Aa([]),r=(0,s.A)(e);try{for(r.s();!(n=r.n()).done;){var a=n.value;a.isErr()&&t.isErr()?t.error.push(a.error):a.isErr()&&t.isOk()?t=Ea([a.error]):a.isOk()&&t.isOk()&&t.value.push(a.value)}}catch(Ea){r.e(Ea)}finally{r.f()}return t},_a=function(e){return la.fromSafePromise(Promise.all(e)).andThen(ga)};function Aa(e){return new ba(e)}function Ea(e){return new Ca(e)}(pa=fa||(fa={})).fromThrowable=function(e,n){return function(){try{return Aa(e.apply(void 0,arguments))}catch(t){return Ea(n?n(t):t)}}},pa.combine=function(e){return va(e)},pa.combineWithAllErrors=function(e){return ga(e)};var ba=function(){return(0,u.A)((function e(n){(0,c.A)(this,e),this.value=n}),[{key:"isOk",value:function(){return!0}},{key:"isErr",value:function(){return!this.isOk()}},{key:"map",value:function(e){return Aa(e(this.value))}},{key:"mapErr",value:function(e){return Aa(this.value)}},{key:"andThen",value:function(e){return e(this.value)}},{key:"andThrough",value:function(e){var n=this;return e(this.value).map((function(e){return n.value}))}},{key:"andTee",value:function(e){try{e(this.value)}catch(n){}return Aa(this.value)}},{key:"orElse",value:function(e){return Aa(this.value)}},{key:"asyncAndThen",value:function(e){return e(this.value)}},{key:"asyncAndThrough",value:function(e){var n=this;return e(this.value).map((function(){return n.value}))}},{key:"asyncMap",value:function(e){return la.fromSafePromise(e(this.value))}},{key:"unwrapOr",value:function(e){return this.value}},{key:"match",value:function(e,n){return e(this.value)}},{key:"safeUnwrap",value:function(){var e=this.value;return(0,a.A)().mark((function n(){return(0,a.A)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",e);case 1:case"end":return n.stop()}}),n)}))()}},{key:"_unsafeUnwrap",value:function(e){return this.value}},{key:"_unsafeUnwrapErr",value:function(e){throw ua("Called `_unsafeUnwrapErr` on an Ok",this,e)}},{key:Symbol.iterator,value:(0,a.A)().mark((function e(){return(0,a.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.value);case 1:case"end":return e.stop()}}),e,this)}))}])}(),Ca=function(){return(0,u.A)((function e(n){(0,c.A)(this,e),this.error=n}),[{key:"isOk",value:function(){return!1}},{key:"isErr",value:function(){return!this.isOk()}},{key:"map",value:function(e){return Ea(this.error)}},{key:"mapErr",value:function(e){return Ea(e(this.error))}},{key:"andThrough",value:function(e){return Ea(this.error)}},{key:"andTee",value:function(e){return Ea(this.error)}},{key:"andThen",value:function(e){return Ea(this.error)}},{key:"orElse",value:function(e){return e(this.error)}},{key:"asyncAndThen",value:function(e){return da(this.error)}},{key:"asyncAndThrough",value:function(e){return da(this.error)}},{key:"asyncMap",value:function(e){return da(this.error)}},{key:"unwrapOr",value:function(e){return e}},{key:"match",value:function(e,n){return n(this.error)}},{key:"safeUnwrap",value:function(){var e=this.error;return(0,a.A)().mark((function n(){return(0,a.A)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Ea(e);case 2:throw new Error("Do not use this generator out of `safeTry`");case 3:case"end":return n.stop()}}),n)}))()}},{key:"_unsafeUnwrap",value:function(e){throw ua("Called `_unsafeUnwrap` on an Err",this,e)}},{key:"_unsafeUnwrapErr",value:function(e){return this.error}},{key:Symbol.iterator,value:(0,a.A)().mark((function e(){var n;return(0,a.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this,e.next=3,n;case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)}))}])}();fa.fromThrowable;var ya=function(){return{message:"ParseError"}};function Sa(e){try{return Aa(JSON.parse(null!==e&&void 0!==e?e:""))}catch(n){return Ea(ya())}}function Ma(e,n){var t,r,a=e.customMessage||e.customMessagePreview;if(!a)return"";if("CryptoGiftProcessing"===a.bizName&&e.isSender)return Fe("im_general_chat_notif_gift_sent");if("CryptoGiftSendSuccess"===a.bizName&&!e.isSender)return Fe("im_general_chat_notif_gift_received_var",{userName:hn((0,d.A)({userUid:e.senderUid},e.senderName),null==n?void 0:n.userRegistryStore)});if("OneToOnePaymentProcessing"===a.bizName&&e.isSender){var o,i=Sa(null==a?void 0:a.content);return i.isErr()?"":Fe("im_general_chat_notif_payment_sent",{amount:(0,b.vv)(null!==(o=null==(t=null==i?void 0:i.value)?void 0:t.amount)&&void 0!==o?o:0,{code:null==(r=null==i?void 0:i.value)?void 0:r.tokenType,isSymbol:!1})})}return"OneToOnePaymentSent"!==a.bizName||e.isSender?"":Fe("im_general_chat_notif_payment_received_var",{userName:hn((0,d.A)({userUid:e.senderUid},e.senderName),null==n?void 0:n.userRegistryStore)})}function Ia(e){var n=e.message,t=La().store,r=(0,_.useMemo)((function(){return Ma(n,t)}),[n,t]);return r?_.createElement(Wn,null,r):null}var ka=(r={},(0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)(r,Ue.TEXT_MESSAGE,(function(e){var n=e.message,t=e.oppositeLastReadMsgSeq,r=e.channel,a=e.prevMessage,o=e.bubbleOptions;return _.createElement(Jr,{message:n,prevMessage:a,oppositeLastReadMsgSeq:t,channel:r,options:o})})),Ue.PICTURE_MESSAGE,(function(e){var n=e.message,t=e.oppositeLastReadMsgSeq,r=e.prevMessage,a=e.bubbleOptions,o=e.src;if(!(null==n?void 0:n.imageMessage))return _.createElement(lr,{message:n,prevMessage:r,oppositeLastReadMsgSeq:t,options:a});var i=n.imageMessage.thumbnail;return!i||i.startsWith("blob:")||i.startsWith("data:")||(i=Ga(i)),_.createElement(lr,{message:n,prevMessage:r,oppositeLastReadMsgSeq:t,options:a},_.createElement(P.A,{id:Nn(n)},Fe("im_chat_alt_image_message")),_.createElement(Tr,{imageMessage:n.imageMessage,senderUid:n.senderUid,src:o,thumbnail:i||o}))})),Ue.VIDEO_MESSAGE,(function(e){var n=e.message,t=e.oppositeLastReadMsgSeq,r=e.prevMessage,a=e.bubbleOptions,o=e.src;return _.createElement($r,{oppositeLastReadMsgSeq:t,message:n,prevMessage:r,bubbleOptions:a,src:o})})),Ue.VOICE_MESSAGE,(function(e){var n=e.message,t=e.oppositeLastReadMsgSeq,r=e.prevMessage,a=e.bubbleOptions,o=e.src;if(!(null==n?void 0:n.voiceMessage))return _.createElement(lr,{message:n,oppositeLastReadMsgSeq:t,prevMessage:r});var i=n.voiceMessage.duration,s=Nn(n);return _.createElement(lr,{message:n,prevMessage:r,options:a,oppositeLastReadMsgSeq:t},_.createElement(P.A,{id:s},Fe("im_voice_message_hover_voice_message")),_.createElement(sa,{"data-message-clickable":!0,"aria-describedby":s,isSender:n.isSender,senderUid:n.senderUid,url:o,duration:i}))})),Ue.SYSTEM_MESSAGE,(function(e){var n=e.message;return _.createElement(Fr,{message:n})})),Ue.MESSAGE_RECALLED,(function(e){var n=e.channel,t=e.message;return _.createElement(Hr,{channel:n,message:t})})),Ue.MESSAGE_RECALLED_BY_ADMIN,(function(e){var n=e.message,t=Fe("im_group_chat_alert_admin_recalled_message");return _.createElement(Wn,{id:xn(n)},t)})),Ue.VOICE_CALL_MESSAGE,(function(e){var n=e.oppositeLastReadMsgSeq,t=e.prevMessage,r=e.bubbleOptions,a=e.message;return _.createElement(lr,{message:a,prevMessage:t,oppositeLastReadMsgSeq:n,options:r},_.createElement("div",{"data-testid":"im-call-message",className:dr,id:Nn(a)},_.createElement(R.A,{iconName:"okx-support-call-endcall",className:mr}),fr(a)))})),Ue.MEDIA_MESSAGE,(function(e){var n,t=e.oppositeLastReadMsgSeq,r=e.prevMessage,a=e.message,o=e.bubbleOptions;return _.createElement(lr,{message:a,prevMessage:r,oppositeLastReadMsgSeq:t,className:Nr,options:o},_.createElement(P.A,{id:Nn(a)},null==(n=a.mediaMessage)?void 0:n.fileName),_.createElement(Br,{theme:a.isSender?"dark":"light",message:a}))})),Ue.CUSTOM_MESSAGE,(function(e){var n=e.message;return _.createElement(Ia,{message:n})})),(0,f.A)(r,Ue.GROUP_INVITATION_MESSAGE,(function(e){var n=e.message,t=Fe(n.isSender?"im_notification_label_group_chat_invite_sent_no_var":"im_notification_label_group_chat_invite_received");return _.createElement(Wn,null,t)}))),xa=function(e){var n=null==e?void 0:e.contentType,t=ka[n];return t&&"function"===typeof t?t:Qr().renderDom},wa=(0,N.observer)((function(){var e=La().store,n=(0,V.A)().isSm,t=function(){e.overlayStore.closeOperationMenu()},r=e.overlayStore.operationMenu||{},a=r.menuConfig,o=r.offsetX,i=r.offsetY,s=r.targetElement;return e.overlayStore.visible?n?_.createElement(wt.Action,{visible:e.overlayStore.visible,onClose:t,maskClosable:!0,escToClose:!0,hideCloseBtn:!0,getContainer:function(){return document.getElementById("im-sdk-popup-container")}},_.createElement(Mn,{menuConfig:a,onClose:t})):_.createElement(F.A,{content:_.createElement(In,{menuConfig:a,onClose:t}),noWrapper:!0,show:e.overlayStore.visible,placement:F.A.DIRECTION.bottomLeft,hideArrow:!0,gutter:0,rebirthPopper:!0,referenceRef:{getBoundingClientRect:function(){var e=null==s?void 0:s.getBoundingClientRect(),n=0,r=0;return 0===(null==e?void 0:e.height)&&0===(null==e?void 0:e.width)?(t(),n=-99999,r=-99999):(n=(o||0)+((null==e?void 0:e.left)||0),r=(i||0)+((null==e?void 0:e.top)||0)),{x:n,y:r,width:0,height:0,top:r,right:n,bottom:r,left:n}},contextElement:s},getContainer:function(){return document.getElementById("im-sdk-popup-container")}},_.createElement(_.Fragment,null)):null})),Ta=(0,_.createContext)({client:void 0,store:{},ready:!1,config:{},registry:{}}),Na=function(){var e=en("CallOverlay");return e?_.createElement(e,null):null},Ra=function(e){var n=e.client,t=e.store,r=void 0===t?En({client:void 0}):t,a=e.registry,o=void 0===a?{}:a,i=e.children,s=e.ready,c=e.dialogContainer,u=void 0===c?"dedicated":c,l=e.theme,d=void 0===l?"light":l,f=(0,_.useMemo)((function(){return{client:n,store:r,ready:s,config:r.configStore,registry:o,theme:d}}),[n,r,s,o,d]),p=_.useState(!1),v=(0,m.A)(p,2),h=v[0],g=v[1];return(0,_.useEffect)((function(){g(!0)}),[]),_.createElement(Ta.Provider,{value:f},_.createElement(Oa,null,i,h&&_.createElement(Na,null),h&&_.createElement(wa,null),"dedicated"===u&&h&&_.createElement("div",{id:"im-sdk-popup-container",className:"im-sdk-popup-container theme-".concat(d," im-theme-").concat(d)})))};function La(){if(!Ta)throw new Error("useOkIm() must be used within <OkImProvider />");return(0,_.useContext)(Ta)}var Oa=function(e){var n=e.children,t=La().client;return _.createElement(k.A,{localeData:null==t?void 0:t.localeData,fetchConfig:Ze.imFetchConfig},n)},Ua=function(){var e=(0,o.A)((0,a.A)().mark((function e(n){var t;return(0,a.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return");case 2:if(!A.A.isApp){e.next=5;break}return j.clipboard.copy({text:n}),e.abrupt("return");case 5:if(!navigator||!navigator.clipboard){e.next=9;break}return e.next=8,navigator.clipboard.writeText(n);case 8:return e.abrupt("return");case 9:(t=document.createElement("input")).readOnly=!0,t.style.position="absolute",t.style.opacity="0",t.style.bottom="0",t.style.zIndex="-1000",document.body.appendChild(t),t.value=n,t.setSelectionRange(0,n.length),t.focus(),document.execCommand&&document.execCommand("copy"),t.blur(),document.body.removeChild(t);case 22:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),Pa=function(e,n){var t=document.createElement("a");t.href=e,t.download=n,t.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window}))},Da=function(){var e=(0,o.A)((0,a.A)().mark((function e(n,t){var r,o,i;return(0,a.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,fetch(t);case 4:return r=e.sent,e.next=7,r.blob();case 7:o=e.sent,i=URL.createObjectURL(o),Pa(i,null!==n&&void 0!==n?n:"");case 10:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}(),Ga=function(e){return e?e.startsWith("data:image")?e:"data:image/png;base64,".concat(e):""},qa=function(){var e,n=null==(e=null==window?void 0:window.__INIT_STATE__)?void 0:e.appContext;return n?{hostProject:null==n?void 0:n.project,hostVer:null==n?void 0:n.version,imVersion:undefined,imBundleType:undefined}:{}},Ba={initialized:!1},Ha=function(e){return function(n,t){var r,a=t||{},o=a.errorName,s=(0,i.A)(a,te);return ae()||console.warn(n,s),e(n,(0,d.A)((0,d.A)({},s),{},{tags:(0,d.A)((0,d.A)((0,d.A)({},qa()),(0,d.A)({},Ba)),null==s?void 0:s.tags),customConfig:(0,d.A)((0,d.A)((0,d.A)({},{project:{id:248,token:"0ba2c9f7c7917cb7c389fe5b1c79421a"}}),null==s?void 0:s.customConfig),o&&{error:(0,d.A)({type:o},null==(r=null==s?void 0:s.customConfig)?void 0:r.error)})}))}},Fa={debug:Ha(x.v.debug),info:Ha(x.v.info),warn:Ha(x.v.warn),error:Ha(x.v.error),timeStart:x.v.timeStart,timeEnd:x.v.timeEnd,setGlobalTag:function(e,n){Ba[e]=n},resetGlobalTag:function(){Ba={initialized:!1}}},Va=function(){return A.A.cdnBaseUrl};function Wa(e){return Ya.apply(this,arguments)}function Ya(){return(Ya=(0,o.A)((0,a.A)().mark((function e(n){return(0,a.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,w.k)({url:n}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ja(){console.warn("OK IM SDK has not been setup. Make sure sdk is ready before running this function.")}var za=function(e){var n,t,r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"/priapi/v1/im/media/v1/web/static",i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=A.A.ipRegion,c=(null==e?void 0:e[s])?s:"default",u=null==e?void 0:e[c],l=null==(n=C.T)?void 0:n.isOKXDesktop,d=null==(t=C.T)?void 0:t.isIOS;return a?i||l&&-1===(0,y.G)(null==(r=C.T)?void 0:r.OKXDesktopVersion,"2.4.0")||A.A.isApp&&d&&-1===(0,y.G)(j.getAppVersion(),"6.99.0")?u:"".concat(o,"/").concat(a,"?ipRegion=").concat(c):u},Ka=(0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)({},Ue.TEXT_MESSAGE,!0),Ue.VOICE_MESSAGE,!0),Ue.VIDEO_MESSAGE,!0),Ue.PICTURE_MESSAGE,!0),Ue.VOICE_CALL_MESSAGE,!0),Ue.MEDIA_MESSAGE,!0),Ue.CUSTOM_MESSAGE,!0),Xa=function(e,n){return!(!(null==e?void 0:e.contentType)||!(null==n?void 0:n.contentType))&&(!(!Ka[null==e?void 0:e.contentType]||!Ka[null==n?void 0:n.contentType])&&(e.senderUid===n.senderUid&&(Qe(e.sendTime)===Qe(n.sendTime)&&Math.abs(+(null==e?void 0:e.sendTime)-+(null==n?void 0:n.sendTime))<3e5)))}},15468:(e,n,t)=>{t.r(n),t.d(n,{default:()=>O});var r=t(60436),a=t(90675),o=t(10467),i=t(5544),s=t(64467),c=t(41594),u=t(83573),l=t(15696),d=t(8358),m=t(76951),f=t(67146),p=t(89208),v=t(95577),h=t(13826),g=t(46042),_=t(57394),A=t(14767),E=t(49981),b=t(6564),C=t(19018),y="_buttonWrapper_1spg9_1",S="_disabled_1spg9_15",M=function(e){var n=e.onDelete,t=e.disabled,r=void 0!==t&&t;return c.createElement(m.A,{title:(0,_.t)("im_general_chat_btn_delete"),placement:m.A.DIRECTION.bottom,disabled:r,alwaysUpdatePopper:!0},c.createElement(f.A,{disabled:r,onClick:n,className:u((0,s.A)((0,s.A)({},y,!0),S,r)),"aria-label":(0,_.t)("im_general_chat_btn_delete")},c.createElement(b.I,null)))},I="_selectConversationPage_rmefu_1",k="_selectCountDisplay_rmefu_6",x="_listBox_rmefu_15",w="_loadingDisplay_rmefu_22",T="_loadingIcon_rmefu_29",N="_empty_rmefu_32";function R(e){var n=e.loadMore;return(0,c.useEffect)((function(){n()}),[n]),c.createElement("div",{className:w},c.createElement(p.A,{className:T}))}var L=(0,l.observer)((function(e){var n=e.className,t=void 0===n?"":n,s=e.itemClassName,l=void 0===s?"":s,m=(0,c.useState)(new Set),f=(0,i.A)(m,2),p=f[0],g=f[1],b=(0,_.J)(),y=b.conversationList,S=b.loadConversationList,w=b.conversationListHasMore,T=b.conversationListReady,L=b.promptDeleteConversations,O=p.size,U=(0,C.b)(),P=(0,c.useCallback)((0,o.A)((0,a.A)().mark((function e(){var n,t;return(0,a.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=y.length-1,!(t=y[n])){e.next=5;break}return e.next=5,S({prevChannelId:t.channelId});case 5:case"end":return e.stop()}}),e)}))),[y,S]),D=!T&&c.createElement("div",null,Array.from({length:13},(function(e,n){return c.createElement(A.C,{key:"skeleton-".concat(n)})}))),G=T&&0===y.length&&c.createElement(h.A.State,{className:N,type:h.A.State.TYPE.noRecord,title:(0,_.t)("im_landing_empty_no_conversations")}),q=T&&w&&c.createElement(R,{loadMore:P});return c.createElement("div",{className:u(I,t)},c.createElement(E.H,{withCloseButton:!0},c.createElement("span",{className:k},(0,_.t)("im_delete_chat_text_number_selected",{number:O})),c.createElement(M,{disabled:!O,onDelete:function(){L({channelIds:(0,r.A)(p)}).then(U).catch(console.log)}})),c.createElement("div",{className:x},D,G,c.createElement(d.n,{style:{height:"100%",scrollbarGutter:"stable"},overscan:3},y.map((function(e,n){return function(e,n){var t=p.has(n.channelId),r=n.isLoaded?"":"-loading",a="".concat(n.channelId).concat(r);return c.createElement(A.a,{key:a,className:l,itemInfo:n,renderPrefix:function(){return c.createElement(v.A,{checked:t})},onClick:function(){t?p.delete(n.channelId):p.add(n.channelId),g(new Set(p))}})}(0,e)})),q)))})),O=(0,g.W)(L,"SelectConvoPage")},56301:(e,n,t)=>{t.r(n),t.d(n,{default:()=>h});var r=t(41594),a=t(83573),o=t(67146),i=t(4613),s=t(57394),c=t(33350),u="_im-emoji-list-box_okelb_1",l="_im-emoji-list-inner-box_okelb_9",d="_im-emoji-list_okelb_1",m="_im-emoji-item_okelb_23",f=["0x1f603","0x1f600","0x1f60a","0x1f609","0x1f60d","0x1f618","0x1f61a","0x1f61c","0x1f61d","0x1f633","0x1f601","0x1f614","0x1f60c","0x1f612","0x1f61f","0x1f61e","0x1f623","0x1f622","0x1f602","0x1f62d","0x1f62a","0x1f630","0x1f605","0x1f613","0x1f62b","0x1f629","0x1f628","0x1f631","0x1f621","0x1f624","0x1f616","0x1f606","0x1f60b","0x1f637","0x1f60e","0x1f634","0x1f632","0x1f635","0x1f608","0x1f47f","0x1f62f","0x1f62c","0x1f615","0x1f636","0x1f607","0x1f60f","0x1f611","0x1f648","0x1f649","0x1f64a","0x1f47d","0x1f4a9","0x2764","0x1f494","0x1f525","0x1f4a2","0x1f4a4","0x1f6ab","0x2b50","0x26a1","0x1f319","0x2600","0x26c5","0x2601","0x2744","0x2614","0x26c4","0x1f44d","0x1f44e","0x1f91d","0x1f44c","0x1f44a","0x270a","0x270c","0x270b","0x1f64f","0x261d","0x1f44f","0x1f4aa","0x1f46a","0x1f46b","0x1f47c","0x1f434","0x1f436","0x1f437","0x1f47b","0x1f339","0x1f33b","0x1f332","0x1f384","0x1f381","0x1f389","0x1f4b0","0x1f382","0x1f356","0x1f35a","0x1f366","0x1f36b","0x1f349","0x1f377","0x1f37b","0x2615","0x1f3c0","0x26bd","0x1f3c2","0x1f3a4","0x1f3b5","0x1f3b2","0x1f004","0x1f451","0x1f484","0x1f48b","0x1f48d","0x1f4da","0x1f393","0x270f","0x1f3e1","0x1f6bf","0x1f4a1","0x1f4de","0x1f4e2","0x1f556","0x23f0","0x23f3","0x1f4a3","0x1f52b","0x1f48a","0x1f680","0x1f30f"],p=function(e){var n=e.onClickHandler;return r.createElement("span",{className:d},f.map((function(e,t){return r.createElement(o.A,{autoFocus:0===t,tabIndex:0,key:e,type:"button",className:m,onClick:function(){null==n||n(+e)}},String.fromCodePoint(+e))})))},v=function(){return r.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"17",height:"18",viewBox:"0 0 17 18",fill:"none"},r.createElement("path",{d:"M15.6735 8.99997C15.6735 12.8239 12.5736 15.9238 8.74972 15.9238C4.92581 15.9238 1.82591 12.8239 1.82591 8.99997C1.82591 5.17605 4.92581 2.07616 8.74972 2.07616C12.5736 2.07616 15.6735 5.17605 15.6735 8.99997ZM8.74972 16.9571C13.1443 16.9571 16.7069 13.3946 16.7069 8.99997C16.7069 4.60536 13.1443 1.04282 8.74972 1.04282C4.35511 1.04282 0.792578 4.60536 0.792578 8.99997C0.792578 13.3946 4.35511 16.9571 8.74972 16.9571Z",fill:"currentColor",stroke:"currentColor",strokeWidth:"0.2"}),r.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6.47116 7.16136C6.4694 7.16551 6.46885 7.16944 6.46885 7.17136C6.46885 7.17327 6.4694 7.1772 6.47116 7.18135C6.47268 7.18494 6.47452 7.18739 6.47618 7.18904C6.47784 7.1907 6.48028 7.19254 6.48387 7.19406C6.48802 7.19582 6.49195 7.19637 6.49387 7.19637C6.49578 7.19637 6.49971 7.19582 6.50386 7.19406C6.50745 7.19254 6.5099 7.1907 6.51155 7.18904C6.51321 7.18739 6.51505 7.18494 6.51657 7.18135C6.51833 7.1772 6.51888 7.17327 6.51888 7.17136C6.51888 7.16944 6.51833 7.16551 6.51657 7.16136C6.51505 7.15777 6.51321 7.15533 6.51155 7.15367C6.5099 7.15201 6.50745 7.15017 6.50386 7.14865C6.49971 7.14689 6.49578 7.14634 6.49387 7.14634C6.49195 7.14634 6.48802 7.14689 6.48387 7.14865C6.48028 7.15017 6.47784 7.15201 6.47618 7.15367C6.47452 7.15533 6.47268 7.15777 6.47116 7.16136ZM6.49387 7.97967C6.94029 7.97967 7.30218 7.61778 7.30218 7.17136C7.30218 6.72493 6.94029 6.36304 6.49387 6.36304C6.04744 6.36304 5.68555 6.72493 5.68555 7.17136C5.68555 7.61778 6.04744 7.97967 6.49387 7.97967Z",fill:"currentColor"}),r.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10.9829 7.16136C10.9811 7.16551 10.9806 7.16944 10.9806 7.17136C10.9806 7.17327 10.9811 7.1772 10.9829 7.18135C10.9844 7.18494 10.9862 7.18739 10.9879 7.18904C10.9896 7.1907 10.992 7.19254 10.9956 7.19406C10.9997 7.19582 11.0037 7.19637 11.0056 7.19637C11.0075 7.19637 11.0114 7.19582 11.0156 7.19406C11.0192 7.19254 11.0216 7.1907 11.0233 7.18904C11.0249 7.18739 11.0268 7.18494 11.0283 7.18135C11.03 7.1772 11.0306 7.17327 11.0306 7.17136C11.0306 7.16944 11.03 7.16551 11.0283 7.16136C11.0268 7.15777 11.0249 7.15533 11.0233 7.15367C11.0216 7.15201 11.0192 7.15017 11.0156 7.14865C11.0114 7.14689 11.0075 7.14634 11.0056 7.14634C11.0037 7.14634 10.9997 7.14689 10.9956 7.14865C10.992 7.15017 10.9896 7.15201 10.9879 7.15367C10.9862 7.15533 10.9844 7.15777 10.9829 7.16136ZM11.0056 7.97967C11.452 7.97967 11.8139 7.61778 11.8139 7.17136C11.8139 6.72493 11.452 6.36304 11.0056 6.36304C10.5592 6.36304 10.1973 6.72493 10.1973 7.17136C10.1973 7.61778 10.5592 7.97967 11.0056 7.97967Z",fill:"currentColor"}),r.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6.22325 10.6379C6.11612 10.3849 5.82453 10.2655 5.57052 10.3714C5.31562 10.4776 5.19508 10.7703 5.30129 11.0252L5.76283 10.8329C5.30129 11.0252 5.30139 11.0254 5.3015 11.0257L5.30172 11.0262L5.30223 11.0275L5.30347 11.0304L5.30684 11.0382C5.30949 11.0442 5.31294 11.052 5.31723 11.0614C5.32579 11.08 5.3377 11.1051 5.35315 11.1356C5.38401 11.1966 5.42924 11.2799 5.49053 11.378C5.61271 11.5735 5.80111 11.8316 6.07003 12.0898C6.61436 12.6123 7.48075 13.1253 8.75013 13.1253C10.0195 13.1253 10.8859 12.6123 11.4302 12.0898C11.6991 11.8316 11.8875 11.5735 12.0097 11.378C12.071 11.2799 12.1162 11.1966 12.1471 11.1356C12.1626 11.1051 12.1745 11.08 12.183 11.0614C12.1873 11.052 12.1908 11.0442 12.1934 11.0382L12.1968 11.0304L12.198 11.0275L12.1985 11.0262L12.1988 11.0257C12.1989 11.0254 12.199 11.0252 11.7374 10.8329L12.199 11.0252C12.3052 10.7703 12.1846 10.4776 11.9297 10.3714C11.6757 10.2655 11.3841 10.3849 11.277 10.6379M11.277 10.638L11.274 10.6447C11.2705 10.6523 11.2642 10.6657 11.2548 10.6842C11.2361 10.7212 11.2055 10.778 11.1617 10.848C11.0739 10.9885 10.9355 11.1785 10.7377 11.3684C10.3485 11.742 9.72123 12.1253 8.75013 12.1253C7.77902 12.1253 7.15177 11.742 6.76256 11.3684C6.56472 11.1785 6.42638 10.9885 6.33852 10.848C6.29478 10.778 6.26417 10.7212 6.24544 10.6842C6.23609 10.6657 6.22976 10.6523 6.22629 10.6447L6.22325 10.6379",fill:"currentColor"}))},h=function(e){var n=e.className,t=e.textInputRef,o=e.disabled,d=void 0!==o&&o,m=(0,r.useRef)();return r.createElement(i.A,{onVisibleChange:function(e){e&&(0,s.V)("IMChatBtmSendClick",{button_name:s.W.EMOJI})},placement:i.A.DIRECTION.topRight,trigger:i.A.TRIGGER.click,popperClassName:u,descClassName:l,description:r.createElement(p,{onClickHandler:function(e){var n,r,a,o,i,u;null==(n=m.current)||n.setVisible(!1);var l=null==(r=null==t?void 0:t.current)?void 0:r.getTextValue();l&&(null==(a=(0,s.G)(l))?void 0:a.length)>=c.a||(null==(i=null==(o=null==t?void 0:t.current)?void 0:o.updateTextValue)||i.call(o,"".concat(l).concat(String.fromCodePoint(e))),null==(u=null==t?void 0:t.current)||u.moveCursorToEnd())}}),popupRef:function(e){m.current=e},disabled:d,graspBaseDom:!0,rebirthPopper:!0},r.createElement(s.I,{tipTitle:(0,s.t)("im_general_chat_hover_emoji"),className:a(n),disabled:d,as:"children"},r.createElement(v,null)))}},8358:(e,n,t)=>{t.d(n,{n:()=>z});var r=t(89379),a=t(53986),o=t(90675),i=t(64467),s=t(10467),c=t(24765),u=t(5544),l=t(60436),d=t(65983),m=t(41594),f=t(75206),p=["children","count","overscan","keepMounted","itemSize","shift","horizontal","reverse","cache","ssrCount","item","onScroll","onScrollEnd","onRangeChange","style"],v=null,h=Math.min,g=Math.max,_=Math.abs,A=Math.floor,E=Array.isArray,b=setTimeout,C=function(e,n,t){return h(t,g(n,e))},y=function(e){return(0,l.A)(e).sort((function(e,n){return e-n}))},S="function"==typeof queueMicrotask?queueMicrotask:function(e){Promise.resolve().then(e)},M=function(e){var n,t;return function(){return n||(n=!0,t=e.apply(void 0,arguments)),t}},I=-1,k=function(e,n,t){for(var r=t?"unshift":"push",a=0;a<n;a++)e[r](I);return e},x=function(e,n){var t=e.t[n];return t===I?e.o:t},w=function(e,n,t){var r=e.t[n]===I;return e.t[n]=t,e.i=h(n,e.i),r},T=function(e,n){if(!e.l)return 0;if(e.i>=n)return e.u[n];e.i<0&&(e.u[0]=0,e.i=0);for(var t=e.i,r=e.u[t];t<n;)r+=x(e,t),e.u[++t]=r;return e.i=n,r},N=function(e,n){for(var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.l-1;t<=r;){var a=A((t+r)/2),o=T(e,a);if(o<=n){if(o+x(e,a)>n)return a;t=a+1}else r=a-1}return C(t,0,e.l-1)},R=function(e,n,t){var r=n-e.l;return e.i=t?-1:h(n-1,e.i),e.l=n,r>0?(k(e.u,r),k(e.t,r,t),e.o*r):(e.u.splice(r),(t?e.t.splice(0,-r):e.t.splice(r)).reduce((function(n,t){return n-(t===I?e.o:t)}),0))},L="undefined"!=typeof window,O=function(){return document.documentElement},U=M((function(){return!!L&&"rtl"===getComputedStyle(O()).direction})),P=M((function(){return/iP(hone|od|ad)/.test(navigator.userAgent)})),D=M((function(){return"scrollBehavior"in O().style})),G=L?m.useLayoutEffect:m.useEffect,q=function(e,n){return n&&U()?-e:e},B=function(e,n){var t,r,a,c=n?"scrollLeft":"scrollTop",l=n?"overflowX":"overflowY",d=function(){var r=(0,s.A)((0,o.A)().mark((function r(s,l){var m,f,p,v,h,g,_,A,E;return(0,o.A)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t){r.next=2;break}return r.abrupt("return",void S((function(){return d(s,l)})));case 2:if(a&&a(),m=function(){var n;return[new Promise((function(t,r){n=t,a=r,function(e){return!!e._()}(e)&&b(r,150)})),e.B(2,(function(){n&&n()}))]},!l||!D()){r.next=23;break}case 5:if(e.O(8,s()),!e.I()){r.next=20;break}return f=m(),p=(0,u.A)(f,2),v=p[0],h=p[1],r.prev=7,r.next=10,v;case 10:r.next=15;break;case 12:return r.prev=12,r.t0=r.catch(7),r.abrupt("return");case 15:return r.prev=15,h(),r.finish(15);case 18:r.next=5;break;case 20:t.scrollTo((0,i.A)((0,i.A)({},n?"left":"top",q(s(),n)),"behavior","smooth")),r.next=39;break;case 23:return g=m(),_=(0,u.A)(g,2),A=_[0],E=_[1],r.prev=24,t[c]=q(s(),n),e.O(7),r.next=29,A;case 29:r.next=34;break;case 31:return r.prev=31,r.t1=r.catch(24),r.abrupt("return");case 34:return r.prev=34,E(),r.finish(34);case 37:r.next=23;break;case 39:case"end":return r.stop()}}),r,null,[[7,12,15,18],[24,31,34,37]])})));return function(e,n){return r.apply(this,arguments)}}();return{D:function(o){t=o,r=function(e,n,t,r,a,o){var i=Date.now,s=0,c=!1,l=!1,d=!1,m=!1,f=function(){var n,t=function(){n!=v&&clearTimeout(n)},r=function(){t(),n=b((function(){n=v,function(){if(c||l)return c=!1,void f();d=!1,e.O(2)}()}),150)};return r.L=t,r}(),p=function(){s=i(),d&&(m=!0),e.O(1,r()),f()},h=function(n){if(!c&&0!==e.M()&&!n.ctrlKey){var r=i()-s;150>r&&50<r&&(t?n.deltaX:n.deltaY)&&(c=!0)}},g=function(){l=!0,d=m=!1},_=function(){l=!1,P()&&(d=!0)};return n.addEventListener("scroll",p),n.addEventListener("wheel",h,{passive:!0}),n.addEventListener("touchstart",g,{passive:!0}),n.addEventListener("touchend",_,{passive:!0}),{$:function(){n.removeEventListener("scroll",p),n.removeEventListener("wheel",h),n.removeEventListener("touchstart",g),n.removeEventListener("touchend",_),f.L()},A:function(){var n=e.J(),o=(0,u.A)(n,2),i=o[0],s=o[1];i&&(a(q(i,t),s,m),m=!1,s&&e._()>e.h()&&e.O(1,r()))}}}(e,o,n,(function(){return q(o[c],n)}),(function(n,t,r){if(r){var i=o.style,s=i[l];i[l]="hidden",b((function(){i[l]=s}))}t?(o[c]=e.T()+n,a&&a()):o[c]+=n}))},$:function(){r&&r.$()},P:function(e){d((function(){return e}))},V:function(n){n+=e.T(),d((function(){return n}))},X:function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.align,a=t.smooth,o=t.offset,i=void 0===o?0:o;if(n=C(n,0,e.C()-1),"nearest"===r){var s=e.k(n),c=e.T();if(s<c)r="start";else{if(!(s+e.R(n)>c+e._()))return;r="end"}}d((function(){return i+e.H()+e.k(n)+("end"===r?e.R(n)-e._():"center"===r?(e.R(n)-e._())/2:0)}),a)},A:function(){r&&r.A()}}},H="current",F=function(e,n){if(E(e)){var t,r=(0,c.A)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;F(a,n)}}catch(o){r.e(o)}finally{r.f()}}else e==v||"boolean"==typeof e||n.push(e)},V=function(e){var n=(0,m.useRef)(e);return G((function(){n[H]=e}),[e]),n},W=function(e,n){var t,r=n?"width":"height",a=new WeakMap,o=function(e){var n;return{D:function(t){(n||(n=new(function(e){return e.defaultView}(function(e){return e.ownerDocument}(t)).ResizeObserver)(e))).observe(t)},Y:function(e){n.unobserve(e)},$:function(){n&&n.disconnect()}}}((function(n){var o,i=[],s=(0,c.A)(n);try{for(s.s();!(o=s.n()).done;){var u=o.value,l=u.target,d=u.contentRect;if(l.offsetParent)if(l===t)e.O(4,d[r]);else{var m=a.get(l);m!=v&&i.push([m,d[r]])}}}catch(f){s.e(f)}finally{s.f()}i.length&&e.O(3,i)}));return{j:function(e){o.D(t=e)},q:function(e,n){return a.set(e,n),o.D(e),function(){a.delete(e),o.Y(e)}},$:o.$}},Y=(0,m.memo)((function(e){var n=e.U,t=e.F,r=e.G,a=e.K,o=e.N,s=e.Z,c=e.ee,u=e.te,l=(0,m.useRef)(v);G((function(){return t(l[H],r)}),[r]);var f=(0,m.useMemo)((function(){var e=(0,i.A)((0,i.A)((0,i.A)((0,i.A)({position:o&&u?void 0:"absolute"},c?"height":"width","100%"),c?"top":"left",0),c?U()?"right":"left":"top",a),"visibility",!o||u?"visible":"hidden");return c&&(e.display="flex"),e}),[a,o,u,c]);return(0,d.jsx)(s,"string"==typeof s?{ref:l,style:f,children:n}:{ref:l,style:f,index:r,children:n})})),j=(0,m.forwardRef)((function(e,n){var t=e.children,r=e.count,a=e.overscan,o=void 0===a?4:a,i=e.keepMounted,s=e.itemSize,l=e.shift,p=e.horizontal,A=e.cache,E=e.startMargin,b=void 0===E?0:E,C=e.ssrCount,M=e.as,L=void 0===M?"div":M,O=e.item,U=void 0===O?"div":O,D=e.scrollRef,q=e.onScroll,j=e.onScrollEnd,z=e.onRangeChange,K=function(e,n){return(0,m.useMemo)((function(){if("function"==typeof e)return[e,n||0];var t=function(e){var n=[];return F(e,n),n}(e);return[function(e){return t[e]},t.length]}),[e,n])}(t,r),X=(0,u.A)(K,2),J=X[0],Q=X[1],Z=(0,m.useRef)(v),$=(0,m.useRef)(!!C),ee=V(q),ne=V(j),te=function(e){var n=(0,m.useRef)();return n[H]||(n[H]=e())}((function(){var e=!!p,n=function(e){var n,t,r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:40,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],l=!!o,d=[],m=0,f=0,p=0,A=0,E=0,b=0,C=0,S=0,M=0,L=l?[0,g(o-1,0)]:v,O=[0,0],U=0,D=(n=e,t=a,{o:(r=i)?r[1]:t,t:r&&r[0]?k(r[0].slice(0,h(n,r[0].length)),g(0,n-r[0].length)):k([],n),l:n,i:-1,u:k([],n)}),G=new Set,q=function(){return p-f},B=function(e){return function(e,n,t,r){if(r=h(r,e.l-1),T(e,r)<=n){var a=N(e,n+t,r);return[N(e,n,r,a),a]}var o=N(e,n,void 0,r);return[o,N(e,n+t,o)]}(D,e,m,O[0])},H=function(){return function(e){return e.l?T(e,e.l-1)+x(e,e.l-1):0}(D)},F=function(e){return T(D,e)-b},V=function(e){return x(D,e)},W=function(e){e&&(P()&&0!==S?b+=e:(E+=e,A++))};return{p:function(){return d},v:function(){return function(e){return[e.t.slice(),e.o]}(D)},m:function(){return C?O:(O=B(g(0,q()+b+E)),L?[h(O[0],L[0]),g(O[1],L[1])]:O)},S:function(e){return D.t[e]===I},I:function(){return!!L&&D.t.slice(g(0,L[0]-1),h(D.l-1,L[1]+1)+1).includes(I)},k:F,R:V,C:function(){return D.l},T:function(){return p},M:function(){return S},_:function(){return m},H:function(){return f},h:H,W:function(){return A},J:function(){return C=E,E=0,[C,2===M||q()+m>=H()]},B:function(e,n){var t=[e,n];return G.add(t),function(){G.delete(t)}},O:function(e,n){var t,r,a=0;switch(e){case 1:var o=C;C=0;var i=n-p,h=_(i);o&&h<_(o)+1||0!==M||(S=i<0?2:1),l&&(L=v,l=!1),p=n,a=4;var k=q();k>=-m&&k<=H()&&(a+=1,r=h>m);break;case 2:a=8,0!==S&&(t=!0,a+=1),S=0,M=0,L=v;break;case 3:var x=n.filter((function(e){var n=(0,u.A)(e,2),t=n[0],r=n[1];return D.t[t]!==r}));if(!x.length)break;W(x.reduce((function(e,n){var t=(0,u.A)(n,2),r=t[0],a=t[1];return(2===M||(L?r<L[0]:F(r)+(0===S&&0===M?V(r):0)<q()))&&(e+=a-V(r)),e}),0));var T,N=(0,c.A)(x);try{for(N.s();!(T=N.n()).done;){var P=(0,u.A)(T.value,2),Y=P[0],j=P[1],z=V(Y),K=w(D,Y,j);s&&(U+=K?j:j-z)}}catch(X){N.e(X)}finally{N.f()}s&&m&&U>m&&(W(function(e,n){var t=0,r=e.t.filter((function(e,r){var a=e!==I;return a&&r<n&&t++,a})),a=e.o;return e.i=-1,((e.o=function(e){var n=y(e),t=e.length/2|0;return n.length%2==0?(n[t-1]+n[t])/2:n[t]}(r))-a)*g(n-t,0)}(D,O[0])),s=!1),a=3,r=!0;break;case 4:m!==n&&(m=n,a=3);break;case 5:n[1]?(W(R(D,n[0],!0)),M=2,a=1):R(D,n[0]);break;case 6:f=n;break;case 7:M=1;break;case 8:L=B(n),a=1}a&&(d=[],t&&b&&(E+=b,b=0,A++),G.forEach((function(e){var n=(0,u.A)(e,2),t=n[0],o=n[1];a&t&&o(r)})))}}}(Q,s,C,A,!s);return[n,W(n,e),B(n,e),e]})),re=(0,u.A)(te,4),ae=re[0],oe=re[1],ie=re[2],se=re[3];Q!==ae.C()&&ae.O(5,[Q,l]),b!==ae.H()&&ae.O(6,b);var ce=function(e){return(0,m.useReducer)(e.p,void 0,e.p)[1]}(ae),ue=ae.m(),le=(0,u.A)(ue,2),de=le[0],me=le[1],fe=ae.M(),pe=ae.W(),ve=ae.h(),he=[],ge=function(e,n,t,r,a){return 1!==r&&(e-=g(0,t)),2!==r&&(n+=g(0,t)),[g(e,0),h(n,a-1)]}(de,me,o,fe,Q),_e=(0,u.A)(ge,2),Ae=_e[0],Ee=_e[1],be=function(e){var n=J(e);return(0,d.jsx)(Y,{F:oe.q,G:e,K:ae.k(e),N:ae.S(e),Z:U,U:n,ee:se,te:$[H]},function(e,n){var t=e.key;return t!=v?t:"_"+n}(n,e))};G((function(){$[H]=!1;var e=ae.B(1,(function(e){e?(0,f.flushSync)(ce):ce()})),n=ae.B(4,(function(){ee[H]&&ee[H](ae.T())})),t=ae.B(8,(function(){ne[H]&&ne[H]()})),r=function(e){oe.j(e),ie.D(e)};return D?S((function(){return r(D[H])})):r(Z[H].parentElement),function(){e(),n(),t(),oe.$(),ie.$()}}),[]),G((function(){ie.A()}),[pe]),(0,m.useEffect)((function(){z&&z(de,me)}),[de,me]),(0,m.useImperativeHandle)(n,(function(){return{get cache(){return ae.v()},get scrollOffset(){return ae.T()},get scrollSize(){return function(e){return g(e.h(),e._())}(ae)},get viewportSize(){return ae._()},getItemOffset:ae.k,scrollToIndex:ie.X,scrollTo:ie.P,scrollBy:ie.V}}),[]);for(var Ce=Ae,ye=Ee;Ce<=ye;Ce++)he.push(be(Ce));if(i){var Se=[],Me=[];y(i).forEach((function(e){e<Ae&&Se.push(be(e)),e>Ee&&Me.push(be(e))})),he.unshift.apply(he,Se),he.push.apply(he,Me)}return(0,d.jsx)(L,{ref:Z,style:{overflowAnchor:"none",flex:"none",position:"relative",visibility:"hidden",width:se?ve:"100%",height:se?"100%":ve,pointerEvents:0!==fe?"none":void 0},children:he})})),z=(0,m.forwardRef)((function(e,n){var t=e.children,o=e.count,s=e.overscan,c=e.keepMounted,u=e.itemSize,l=e.shift,f=e.horizontal,h=e.reverse,g=e.cache,_=e.ssrCount,A=e.item,E=e.onScroll,b=e.onScrollEnd,C=e.onRangeChange,y=e.style,S=(0,a.A)(e,p),M=(0,m.useRef)(v),I=h&&!f,k=(0,d.jsx)(j,{ref:n,scrollRef:I?M:void 0,count:o,overscan:s,keepMounted:c,itemSize:u,shift:l,horizontal:f,cache:g,ssrCount:_,item:A,onScroll:E,onScrollEnd:b,onRangeChange:C,children:t});return I&&(k=(0,d.jsx)("div",{style:{visibility:"hidden",display:"flex",flexDirection:"column",justifyContent:"flex-end",minHeight:"100%"},children:k})),(0,d.jsx)("div",(0,r.A)((0,r.A)({ref:M},S),{},{style:(0,r.A)((0,i.A)((0,i.A)((0,i.A)((0,i.A)({display:f?"inline-block":"block"},f?"overflowX":"overflowY","auto"),"contain","strict"),"width","100%"),"height","100%"),y),children:k}))}))},42418:(e,n,t)=>{t.r(n),t.d(n,{default:()=>b});var r=t(90675),a=t(10467),o=t(41594),i=t(8675),s=t(84854),c=t(63010),u=t(85937),l=t(26204),d=t(57394),m=t(33501),f=["application/pdf"],p=["image/jpeg","image/jpg","image/png","image/gif","video/mp4","video/quicktime"];var v=function(){var e=(0,a.A)((0,r.A)().mark((function e(){return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s.A.isApp){e.next=2;break}return e.abrupt("return",void 0);case 2:return e.abrupt("return",m.custom({uri:m.URI_ENUM.request,method:"app/openAppDeviceSettings"}));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),h=function(){var e=(0,a.A)((0,r.A)().mark((function e(){return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s.A.isApp){e.next=2;break}return e.abrupt("return",void 0);case 2:return e.abrupt("return",m.custom({uri:m.URI_ENUM.request,method:"app/requestPhotoLibraryPermission"}));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),g=function(){var e=(0,a.A)((0,r.A)().mark((function e(){return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s.A.isApp){e.next=2;break}return e.abrupt("return",void 0);case 2:return e.abrupt("return",m.custom({uri:m.URI_ENUM.request,method:"app/requestCameraPermission"}));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),_="hasRequestedUploadPermissions",A=function(){var e=(0,a.A)((0,r.A)().mark((function e(){var n,t,a,o,i,l,m,f,p;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s.A.isApp){e.next=2;break}return e.abrupt("return",!0);case 2:if(n=c.A.session.init({project:"im"}),!n.get(_)){e.next=6;break}return e.abrupt("return",!0);case 6:return e.next=8,h().catch((function(e){return console.warn("requestPhotoLibraryPermission rejected",e),"soft_deny"}));case 8:return t=e.sent,e.next=11,g().catch((function(e){return console.warn("requestCameraPermission rejected",e),"soft_deny"}));case 11:if(a=e.sent,i="denied"===a,l=(o="denied"===t)||i?180:void 0,n.set(_,1,l),o||i){e.next=18;break}return e.abrupt("return",!0);case 18:return m="",f="",o&&i?(m="okassistant_permissions_both_access_title",f="okassistant_permissions_both_access_desc"):o?(m="okassistant_permissions_photo_access_title_pic",f="okassistant_permissions_photo_access_desc_pic"):(m="okassistant_permissions_camera_access_title_cam",f="okassistant_permissions_camera_access_desc_cam"),p=u.A.tip({title:(0,d.t)(m),children:(0,d.t)(f),confirmText:(0,d.t)("okassistant_permissions_btn_settings"),onConfirm:function(){n.remove(_),v(),p.destroy()},cancelText:(0,d.t)("okassistant_permissions_btn_not_now"),onCancel:function(){p.destroy()}}),e.abrupt("return",!1);case 23:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),E=function(e){return function(e,n){return new Promise((function(t){if(e.type.includes("gif")&&e.size>5242880)n.onGifSizeExceed(),t(!1);else if(["image/jpg","image/jpeg","image/png","image/gif"].includes(e.type)&&e.size>20971520)n.onImageSizeExceed(),t(!1);else if(e.type.includes("video")){e.size>52428800&&(n.onVideoSizeExceed(),t(!1));var r=document.createElement("video");r.preload="metadata",r.onloadedmetadata=function(){window.URL.revokeObjectURL(r.src),t(!0)},r.onerror=function(){t(!1)},r.src=window.URL.createObjectURL(e)}else f.includes(e.type)?(e.size>20971520&&(n.onMediaSizeExceed(),t(!1)),t(!0)):t(!0)}))}(e,{onImageSizeExceed:function(){l.A.warn((0,d.t)("im_function_toast_image_size_exceed"))},onGifSizeExceed:function(){l.A.warn((0,d.t)("im_function_toast_gif_size_exceed"))},onVideoSizeExceed:function(){l.A.warn((0,d.t)("im_general_chat_toast_video_size_exceed",{maxSize:"50MB"}))},onMediaSizeExceed:function(){l.A.warn((0,d.t)("im_file_toast_file_size_exceeded",{number:20}))}})},b=function(e){var n=e.className,t=e.channel,c=e.disabled,u=void 0!==c&&c,m=e.handleSend,v=t.channelId,h=(0,d.u)(),g=h.store,_=h.config,b=(0,o.useRef)(null),C=(0,o.useCallback)(function(){var e=(0,a.A)((0,r.A)().mark((function e(n){var t,a,o,s,c,u,p,h,_;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==(t=n.target.files)?void 0:t.length){e.next=2;break}return e.abrupt("return");case 2:if((s=n.target.files[0])&&b.current){e.next=5;break}return e.abrupt("return");case 5:return b.current.value="",e.next=8,E(s);case 8:if(e.sent){e.next=11;break}return e.abrupt("return");case 11:return r=s.type,c=f.includes(r),u=(0,i.n)(),g.messageStore.setFileUploadStatus(v,u,"uploading"),p=null==(o=null==(a=window.URL)?void 0:a.createObjectURL)?void 0:o.call(a,s),h=function(){return c?d.Y.MEDIA_MESSAGE:s.type.includes("video")?d.Y.VIDEO_MESSAGE:d.Y.PICTURE_MESSAGE},e.next=18,m({contentType:h(),messageContent:{content:"",file:s,localUrl:p}}).catch((function(){g.messageStore.setFileUploadStatus(v,u,"error"),l.A.error((0,d.t)("im_failed_call_internet_failure_17"))}));case 18:!1===(null==(_=e.sent)?void 0:_.success)?(g.messageStore.setFileUploadStatus(v,u,"error"),l.A.error((0,d.t)("im_failed_call_internet_failure_17"))):g.messageStore.setFileUploadStatus(v,u,"success"),window.URL.revokeObjectURL(p);case 21:case"end":return e.stop()}var r}),e)})));return function(n){return e.apply(this,arguments)}}(),[v,m,g.messageStore]),y=(0,o.useMemo)((function(){var e,n=p;return(null==(e=_.message.mediaMessage)?void 0:e.enableFile)&&(n=[].concat(p,f)),n.join(",")}),[_.message.mediaMessage]),S=(0,o.useMemo)((function(){var e;return(null==(e=_.message.mediaMessage)?void 0:e.enableFile)?(0,d.t)("im_general_chat_hover_files"):(0,d.t)("im_general_chat_hover_media")}),[_.message.mediaMessage]),M=(0,o.useCallback)((0,a.A)((0,r.A)().mark((function e(){var n;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(b.current&&!u){e.next=2;break}return e.abrupt("return");case 2:if(n=function(){var e;null==(e=b.current)||e.click(),(0,d.V)("IMChatBtmSendClick",{button_name:d.W.LIBRARY})},!s.A.isApp){e.next=6;break}return A().then((function(e){e&&n()})).catch((function(){n()})),e.abrupt("return");case 6:n();case 7:case"end":return e.stop()}}),e)}))),[u]);return o.createElement(o.Fragment,null,o.createElement(d.I,{"data-testid":"im-upload-btn",tipTitle:S,as:"icon",iconClassName:"okx-support-im-upload-general",className:n,disabled:u,clickHandler:M}),o.createElement("input",{ref:b,type:"file",accept:y,style:{display:"none"},onChange:C}))}},49981:(e,n,t)=>{t.d(n,{H:()=>d});var r=t(41594),a=t(83573),o=t(58252),i=t(19018),s=t(30508),c="_headerBar_paout_1",u="_flexed_paout_4",l="_skeleton_paout_20",d=function(e){var n=e.children,t=e.withCloseButton,d=void 0!==t&&t,m=e.isLoading,f=void 0!==m&&m,p=(0,i.b)();return f?r.createElement("div",{className:a(c)},r.createElement(o.A.Input,{active:!0,className:l})):r.createElement("div",{className:a(c,u)},d&&r.createElement(s.C,{onClick:p,fontSize:24}),n)}},45039:(e,n,t)=>{t.r(n),t.d(n,{default:()=>D});var r=t(89379),a=t(90675),o=t(10467),i=t(64467),s=t(5544),c=t(41594),u=t(83573),l=t(46042),d=t(19018),m=t(57394),f=t(49047),p="_headerBar_pnamq_1",v="_backIcon_pnamq_8",h="_title_pnamq_20",g=function(e){var n=e.title,t=e.withBackButton,r=void 0!==t&&t,a=(0,d.b)();return c.createElement("div",{className:p},r&&c.createElement(f.A,{a11yText:(0,m.t)("commonall_text_btn_back"),iconName:"okds-arrow-chevron-left-centered-md",className:v,onClick:function(){a()}}),Boolean(n)&&c.createElement("div",{className:h},n))},_=t(91423),A=t(67146),E=t(14767),b="_outerContainer_140rm_1",C="_container_140rm_8",y="_userInfo_140rm_11",S="_userAvatar_140rm_19",M="_userName_140rm_22",I="_settingsContainer_140rm_31",k="_settingHeader_140rm_37",x="_settingItem_140rm_45",w="_clickable_140rm_55",T="_details_140rm_61",N="_title_140rm_64",R="_desc_140rm_71",L="_action_140rm_77",O="_navigateIcon_140rm_81",U=function(e){var n=e.config,t=e.currentSettings,r=e.updateSettings,a=(0,d.u)(),o=(0,s.A)(a,2)[1];if("header"===n.type)return c.createElement("section",null,c.createElement("div",{className:k},(0,m.t)(n.title)),n.children.map((function(e){return c.createElement(U,{key:e.title,config:e,currentSettings:t,updateSettings:r})})));var l="navigate"===n.type,p=l?function(){return o(n.key)}:void 0,v=l?c.createElement(f.A,{className:u("okds-arrow-chevron-right-centered-md",O)}):c.createElement(_.A,{size:_.A.SIZE.sm,defaultChecked:(null==t?void 0:t[n.key])===m.a2.YES,async:function(e){return r((0,i.A)({},n.key,e?m.a2.NO:m.a2.YES))}});return l?c.createElement(A.A,{"data-im-btn-full":!0,className:u(x,w),onClick:p},c.createElement("div",{className:T},c.createElement("p",{className:N},(0,m.t)(n.title)),n.desc&&c.createElement("p",{className:R},(0,m.t)(n.desc))),c.createElement("div",{className:L},v)):c.createElement("div",{className:u(x)},c.createElement("div",{className:T},c.createElement("p",{className:N},(0,m.t)(n.title)),n.desc&&c.createElement("p",{className:R},(0,m.t)(n.desc))),c.createElement("div",{className:L},v))};function P(){var e=(0,E.u)(),n=function(){var e=(0,m.u)().client,n=(0,c.useCallback)(function(){var n=(0,o.A)((0,a.A)().mark((function n(t){return(0,a.A)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e){n.next=2;break}return n.abrupt("return");case 2:return n.next=4,e.updateMyPrivacySettings(t);case 4:if(n.sent.result){n.next=7;break}throw Error("Update failed");case 7:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),[e]);return{updatePrivacySettings:n}}();return(0,r.A)((0,r.A)({},e),n)}var D=(0,l.W)((function(e){var n=e.className,t=(0,m.u)().store,r=P(),a=r.updatePrivacySettings,o=r.profile,i=(0,m.p)("contactManagement"),s=(0,c.useMemo)((function(){var e=[{title:"im_unblock_user_header_privacy",type:"header",children:[{title:"im_block_list_header_private_account",type:"toggle",key:"allowAutoJoinGroup"}]}];return(null==i?void 0:i.BlockedContactPage)&&e.push({title:"im_block_list_header_btn_blocked_users",desc:"im_block_list_text_manage_users",type:"navigate",key:d.R.blockedContacts}),e}),[i]);return c.createElement("div",{className:u(b,n)},c.createElement(g,{withBackButton:!0,title:(0,m.t)("im_unblock_user_header_settings")}),o?c.createElement("div",{className:u(C)},c.createElement("div",{className:y},c.createElement(m.S,{userInfo:o,width:80,height:80,className:S}),c.createElement("div",{className:M},(0,m.h)(o,t.userRegistryStore))),c.createElement("div",{className:I},s.map((function(e){return c.createElement(U,{key:e.title,config:e,currentSettings:null==o?void 0:o.userPrivacySettingsDto,updateSettings:a})})))):null)}),"SettingsPage")},30508:(e,n,t)=>{t.d(n,{C:()=>d});var r=t(89379),a=t(53986),o=t(49047),i=t(41594),s=t(83573),c=t(57394),u=["onClick","fontSize","className","color"],l={closeIcon:"_closeIcon_16x28_1"};function d(e){var n=e.onClick,t=e.fontSize,d=e.className,m=e.color,f=(0,a.A)(e,u);return i.createElement(o.A,(0,r.A)({a11yText:(0,c.t)("commonall_resultpage_btn_close"),onClick:n,style:{fontSize:t||24,color:m},iconName:"okds-close",className:s(l.closeIcon,d)},f))}},55355:(e,n,t)=>{t.d(n,{C:()=>a});var r=t(89379),a=(0,r.A)((0,r.A)({},{ON_HISTORY_MESSAGE_FETCHED:"onHistoryMessageFetched",ON_UNREAD_MESSAGES_FETCHED:"onUnreadMessagesFetched"}),{},{ON_RECV_NEW_MESSAGE:"onRecvNewMessage",ON_RECV_MESSAGE_REVOKED:"onRecvMessageRevoked",ON_RECV_C2C_READ_RECEIPT:"onRecvC2CReadReceipt",ON_RECV_C2C_RECALL_MESSAGE:"onRecvC2CRecallMessage",ON_RECV_SYSTEM_MESSAGE:"onRecvSystemMessage",ON_RECV_VOICE_CALL_MESSAGE:"onRecvVoiceCallMessage",ON_RECONNECT:"onReconnect",ON_CONNECT:"onConnect",ON_CHANNEL_LIST_CHANGED:"onChannelListChanged",ON_MESSAGE_LIST_CHANGED:"onMessageListChanged",ON_READ_SEQ_CHANGED:"onReadSeqChanged",ON_ANNOUNCEMENT_CHANGED:"onAnnouncementChanged",ON_GROUP_MEMBER_CHANGED:"onGroupMemberChanged",ON_GROUP_INFO_CHANGED:"onGroupInfoChanged",ON_RECV_CALL_REQUEST:"onRecvCallRequest",ON_CALL_GET_THROUGH:"onGetThrough",ON_CALL_HANGUP:"onHangUp",ON_PROFILE_CHANGED:"onProfileChanged",ON_CALL_STATUS_CHANGE:"onCallStatusChange"})},85349:(e,n,t)=>{t.d(n,{M:()=>y,h:()=>m});var r=t(5544),a=t(74176),o=t(41594),i=t(83573),s=t(16709),c=t(13826),u=t(72768),l=t(24765);var d=t(57394),m=function(e){return e===a.G.ADMIN||e===a.G.OWNER},f=function(e){var n=e.memberListMap,t=e.propsMemberList,r=e.onlyShowAdmin,o=e.hideOwner,i=e.excludeMe,s=e.userUid,c=n||new Map,u=t||Array.from(c.values())||[];if(r){var l=[];return u.some((function(e){return function(e,n,t){return e.role===a.G.OWNER?(n||t.push(e),!1):e.role!==a.G.ADMIN||(t.push(e),!1)}(e,o,l)})),l}return o&&u.some((function(e,n){return e.role===a.G.OWNER&&(u.splice(n,1),!0)})),i&&u.some((function(e,n){var t;return(null==(t=e.userInfo)?void 0:t.userUid)===s&&(u.splice(n,1),!0)})),u},p="_memberList_1k01h_1",v="_searchBox_1k01h_9",h="_searchResult_1k01h_12",g="_searchResultInner_1k01h_18",_="_memberItem_1k01h_26",A="_memberCheckboxDisabled_1k01h_34",E="_memberItemAvatar_1k01h_42",b="_memberItemName_1k01h_52",C="_emptyContainer_1k01h_55",y=function(e){var n=e.className,t=e.propsMemberList,m=e.hideSearchBox,y=e.searchPlaceholder,S=e.prefixRenderer,M=e.nextfixRenderer,I=e.disableAdmin,k=void 0!==I&&I,x=e.onlyShowAdmin,w=void 0!==x&&x,T=e.hideOwner,N=void 0!==T&&T,R=e.searchKeyProp,L=void 0===R?"":R,O=e.onClickItemHandler,U=e.excludeMe,P=void 0!==U&&U,D=e.avatarSize,G=(0,d.u)().store.userRegistryStore.userInfoMap,q=(0,o.useRef)(),B=(0,d.c)().activeConversation,H=(0,o.useRef)(null),F=function(e){var n,t,a=(0,o.useState)(null!==(n=null==(t=e.current)?void 0:t.clientHeight)&&void 0!==n?n:0),i=(0,r.A)(a,2),s=i[0],c=i[1];return(0,o.useEffect)((function(){if(e.current){var n=new ResizeObserver((function(e){var n,t=(0,l.A)(e);try{for(t.s();!(n=t.n()).done;){var r=n.value;c(r.contentRect.height)}}catch(a){t.e(a)}finally{t.f()}}));return n.observe(e.current),function(){n.disconnect()}}}),[e]),s}(H),V=(0,d.u)().client,W=B.memberListMap,Y=B.userUid,j=(0,o.useMemo)((function(){return f({memberListMap:W,propsMemberList:t,onlyShowAdmin:w,hideOwner:N,excludeMe:P,userUid:Y})}),[W,null==W?void 0:W.size,t,w]),z=(0,o.useState)([]),K=(0,r.A)(z,2),X=K[0],J=K[1],Q=(0,o.useState)(""),Z=(0,r.A)(Q,2),$=Z[0],ee=Z[1],ne=function(e){return e?j.filter((function(n){var t;return(0,d.o)({userInfo:G[n.memberUid]||n.userInfo,searchTerm:e,isOfficial:(0,d.j)(null==(t=null==V?void 0:V.queryUserInfo())?void 0:t.tags)})})):j};(0,o.useEffect)((function(){J(ne($))}),[j]);var te=function(e){ee(e),window.setTimeout((function(){var n;J(ne(e)),null==(n=q.current)||n.scrollTo({top:0})}),400)};(0,o.useEffect)((function(){te(L)}),[L]);var re=function(e){var n=e;return o.createElement(s.A.Item,null,o.createElement("div",{role:O?"button":"listitem",tabIndex:O?0:-1,"data-memberuid":n.memberUid,className:i(_,!k||n.role!==a.G.ADMIN&&n.role!==a.G.OWNER?"":A),onClick:function(){null==O||O(n)},onKeyDown:function(e){"Enter"===e.key&&(null==O||O(n))}},null==S?void 0:S(n),o.createElement(d.A,{userInfo:(null==n?void 0:n.userInfo)||{},className:E,withProfile:!0,channelType:d.C.GROUP,width:D,height:D}),o.createElement(d.U,{userInfo:null==n?void 0:n.userInfo,className:b,customTag:(0,d.t)(a.a[n.role]||""),customTagClassName:n.role===a.G.OWNER?"im-group-owner":"im-group-admin"}),null==M?void 0:M(n)))},ae=(0,o.useMemo)((function(){return j.length?o.createElement(c.A.State,{type:c.A.State.TYPE.noResult,className:C,title:(0,d.t)("im_general_use_empty_no_results_found")}):null}),[j]);return o.createElement("div",{className:i(p,n)},!m&&o.createElement(u.A.Search,{size:u.A.SIZE.sm,placeholder:y||(0,d.b)("im_group_chat_placeholder_search_members"),className:v,onChange:function(e){te(e.target.value)},value:$}),o.createElement("div",{className:h},o.createElement("div",{className:g,ref:H},X.length>0?o.createElement(s.A,{data:X,itemKey:"memberUid",height:F},re):ae)))}},74002:(e,n,t)=>{t.d(n,{C:()=>T,E:()=>S,S:()=>U,c:()=>I,e:()=>k,s:()=>x});var r,a,o=t(90675),i=t(10467),s=t(23029),c=t(92901),u=t(89379),l=t(99692),d="pong",m={CONNECTED:0,DISCONNECTED:1,PING_PENDING:2,PING_PENDING_OVER:3},f=!(0,l.f)(),p=f&&!window.inOKXExtension,v=/^\{|\[/,h="";f&&(h=null==(a=null==(r=null==window?void 0:window.okGlobal)?void 0:r.socketBaseUrls)?void 0:a.trade);var g=function(e){return v.test(e)},_=function(){return arguments.length>0&&void 0!==arguments[0]?arguments[0]:h};if(f&&p){var A=window,E=A.location,b=A.TextDecoder;b&&new b("utf-8"),window.$has_debug_push_param$=E.href.indexOf("debug_push=true")>-1}var C={};function y(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this,r=_(n.connectUrl),a=(0,u.A)((0,u.A)({maxPendingTime:5e3,maxReconnectTime:1e4,maxWaitingResponseTime:1e4,maxSleepRecoveringTime:3e3},n),{},{connectUrl:r}),o=C[a.connectUrl];if(o)return o;var i,s={isClosingByClient:!1,isKillingUnWakeUp:!1,isPingPending:!1,isErrorOccurred:!1},c={reconnectTimer:0,handlePendingTimer:0,discontinueTimer:0,killingUnWakeUpTimer:0,pingPendingTimer:0},l={currReconnectTime:0,lastReceivingTime:0},v=[],h=[],A=[],E=[],b=[],y=function(){},S=function(){e.isConnected()&&(y(),c.pingPendingTimer=setTimeout((function(){s.isErrorOccurred&&e.isConnected()||(s.isErrorOccurred=!1,s.isPingPending=!0,b.forEach((function(e){e(m.PING_PENDING)})))}),a.maxPendingTime))},M=function(e,n){for(var t=0;t<e.length;t++){if(e[t]===n){e.splice(t,1);break}}},I=function(){s.isPingPending=!1,clearTimeout(c.pingPendingTimer)},k=function(){clearInterval(c.handlePendingTimer)},x=function(){l.currReconnectTime=0,c.reconnectTimer&&(clearTimeout(c.reconnectTimer),delete c.reconnectTimer)},w=function(){!e.isConnected()&&!e.isConnecting()&&(x(),T())},T=function(){(i=new WebSocket(a.connectUrl)).onopen=N,i.onmessage=R,i.onclose=O,i.onerror=U,c.handlePendingTimer=setInterval(t.handleConnectPending,a.maxPendingTime)},N=function(){s.isClosingByClient=!1,x(),k(),I(),h.forEach((function(e){e(),e.triggered=!0})),b.forEach((function(e){e(m.CONNECTED)}))},R=function(e){l.lastReceivingTime=Date.now(),clearTimeout(c.discontinueTimer),clearTimeout(c.killingUnWakeUpTimer),c.discontinueTimer=setTimeout(S,a.maxPendingTime);var n=e.data;n===d&&(s.isPingPending&&b.forEach((function(e){e(m.PING_PENDING_OVER)})),I()),P(g(n)?JSON.parse(n):n),window.$has_debug_push_param$},L=function(){I(),h.forEach((function(e){e.triggered=!1}))},O=function(e){A.forEach((function(n){n(e)})),s.isKillingUnWakeUp?s.isKillingUnWakeUp=!1:s.isClosingByClient?L():c.reconnectTimer||U(e)},U=function(e){L(),k(),s.isErrorOccurred=!0,c.reconnectTimer=setTimeout(T,l.currReconnectTime);var n=l.currReconnectTime+1e3;n>a.maxReconnectTime&&(n=a.maxReconnectTime),l.currReconnectTime=n,v.forEach((function(n){n(e)})),b.forEach((function(e){e(m.DISCONNECTED)}))},P=function(e){"error"===e.event&&30026===Number(e.errorCode)?i.close():E.forEach((function(n){return n(e)}))};if(this.setPushDataResolver=function(e){return E.push(e),function(){M(E,e)}},this.connect=function(){if(f){if(this.isConnected())return void h.forEach((function(e){e.triggered||(e(),e.triggered=!0)}));this.isConnected()||this.isConnecting()||T()}},this.disconnect=function(){clearTimeout(c.reconnectTimer),clearTimeout(c.discontinueTimer),delete c.reconnectTimer,delete c.discontinueTimer,s.isClosingByClient=!0,i.close(),v.length=0,h.length=0,A.length=0,E.length=0,y=function(){},delete C[a.connectUrl];var e=navigator.connection;e&&e.removeEventListener&&e.removeEventListener("change",this.handleConnectionChange),p&&document.removeEventListener("visibilitychange",this.handleVisibilityChange)},this.isConnecting=function(){return(null==i?void 0:i.readyState)===WebSocket.CONNECTING},this.isConnected=function(){return(null==i?void 0:i.readyState)===WebSocket.OPEN},this.sendChannel=function(e){this.isConnected()?i.send(e):console.error("WebSocket is not in open state, can not send!")},this.onSocketConnected=function(e){return h.push(e),function(){M(h,e)}},this.onSocketError=function(e){return v.push(e),function(){M(v,e)}},this.onSocketClose=function(e){return A.push(e),function(){M(A,e)}},this.onPushDiscontinue=function(e){return y=e,function(){}},this.onStatusChange=function(e){return b.push(e),function(){M(b,e)}},this.handleConnectPending=function(){e.isConnecting()&&v.forEach((function(e){e()}))},this.handleConnectionChange=function(){!0===navigator.onLine&&w()},this.handleVisibilityChange=function(){if("visible"===document.visibilityState){if(!e.isConnected())return void w();Date.now()-l.lastReceivingTime>a.maxWaitingResponseTime&&(S(),c.killingUnWakeUpTimer=setTimeout((function(){L(),x(),s.isKillingUnWakeUp=!0,i.close(),T()}),a.maxSleepRecoveringTime))}},f){var D=navigator.connection;D&&D.addEventListener&&D.addEventListener("change",this.handleConnectionChange),p&&document.addEventListener("visibilitychange",this.handleVisibilityChange)}return C[a.connectUrl]=this,this}y.STATUS=m,f&&!window.WebSocketCore&&(window.WebSocketCore=y);var S=function(){return(0,c.A)((function e(){var n,t,r;(0,s.A)(this,e),r=void 0,(t="events")in(n=this)?Object.defineProperty(n,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[t]=r,this.events={}}),[{key:"emit",value:function(e,n){return this.events[e]&&this.events[e].forEach((function(t){t({data:n,event:e})})),this}},{key:"on",value:function(e,n){return this.events[e]?this.events[e].push(n):this.events[e]=[n],this}},{key:"off",value:function(e,n){if(e&&"function"===typeof n){var t=this.events[e];if(!t)return this;var r=t.findIndex((function(e){return e===n}));-1!==r&&t.splice(r,1)}else this.events[e]=[];return this}},{key:"unmountAll",value:function(){this.events={}}}])}();function M(e){var n=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:21,n="",t=crypto.getRandomValues(new Uint8Array(e|=0));e--;)n+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&t[e]];return n}();return e&&(n+=e),n}var I=function(e){return function(e){var n=new Blob(["".concat(e)]);if("function"===typeof window.URL.createObjectURL){var t=window.URL.createObjectURL(n);return new Worker(t)}}("\n  this.onmessage = function(e) {\n    var data = e.data;\n    setTimeout(function () {\n      this.postMessage(data)\n    }, ".concat(e,")\n  }\n  "))},k=function(e,n){e&&(e.postMessage(""),e.addEventListener("message",n,{once:!0}))},x=function(e){if(!e)return!1;try{return e&&e.terminate(),!0}catch(n){return!1}};function w(){var e=I(arguments.length>0&&void 0!==arguments[0]?arguments[0]:200);return{sendWork:function(n){e&&(e.postMessage(""),e.addEventListener("message",n,{once:!0}))},close:function(){x(e)}}}var T=function(e){return e.Reconnect="reconnect",e.DisconnectWithoutReconnect="disconnectWithoutReconnect",e}(T||{}),N=function(e){var n,t;return{reason:null===e||void 0===e?void 0:e.reason,code:null===e||void 0===e?void 0:e.code,readyState:null===e||void 0===e||null===(n=e.target)||void 0===n?void 0:n.readyState,wsUrl:null===e||void 0===e||null===(t=e.target)||void 0===t?void 0:t.url}};function R(e){var n={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[t]=e[t]);return JSON.stringify(n,(function(e,n){return n instanceof Node?"Node":n instanceof Window?"Window":n})," ")}function L(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}var O=[1003,4001],U=function(){return(0,c.A)((function e(n,t,r){var a=this;(0,s.A)(this,e),L(this,"connection",void 0),L(this,"channelIdKeyName","channelId"),L(this,"requestIdPrefix",void 0),L(this,"wsUrl",""),L(this,"loginData",void 0),L(this,"eventPromiseMap",{}),L(this,"emitter",void 0),L(this,"onNewMessagesReceived",void 0),L(this,"errorFlag",!1),L(this,"lastReconnectTime",0),L(this,"customPushCommands",[]),L(this,"messageBroadcastBuffer",{}),L(this,"throttler",w()),L(this,"paused",!1),L(this,"nonReconnectableCloseCodes",O),L(this,"login",function(){var e=(0,i.A)((0,o.A)().mark((function e(n){var t,r;return(0,o.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n||a.loginData){e.next=3;break}return e.abrupt("return");case 3:return r={requestId:M(a.requestIdPrefix),websocketCommand:"WSAuth",data:t},e.abrupt("return",a.sendPromisified(r));case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()),L(this,"sendPing",(function(){var e;(null===(e=a.connection)||void 0===e?void 0:e.isConnected())&&a.connection.sendChannel("ping")})),L(this,"sendMessage",(function(e,n){var t={requestId:n||M(a.requestIdPrefix),websocketCommand:"WSSendMsg",data:e};return a.sendPromisified(t)})),L(this,"getHistoryMessageList",(function(e,n){var t={requestId:n||M(a.requestIdPrefix),websocketCommand:"WSGetMsgByPage",data:e};return a.sendPromisified(t)})),L(this,"getHistoryMessageListBySeq",(function(e,n){var t={requestId:n||M(a.requestIdPrefix),websocketCommand:"WSGetMsgBySeqList",data:e};return a.sendPromisified(t)})),L(this,"getNewstSeqByChannelIds",(function(e,n){var t={requestId:n||M(a.requestIdPrefix),websocketCommand:"WSGetNewestSeq",data:e};return a.sendPromisified(t)})),L(this,"resolveOrFailEvent",(function(e){var n=a.eventPromiseMap[e.requestId];n&&(0===Number(e.code)?n.resolveEvent(e):n.rejectEvent(e),delete a.eventPromiseMap[e.requestId])})),L(this,"send",(function(e,n,t){var r=e.requestId||M(a.requestIdPrefix),o=(0,u.A)((0,u.A)({},e),{},{requestId:r}),i={request:o,resolveEvent:n,rejectEvent:t};a.eventPromiseMap[r]=i;try{var s;if(!(null===(s=a.connection)||void 0===s?void 0:s.isConnected()))return;a.connection.sendChannel(JSON.stringify(o))}catch(c){t({event:o.websocketCommand,errCode:112,errMsg:"no-connection-conect...",data:"",requestId:r||""})}})),L(this,"sendPromisified",(function(e){return new Promise((function(n,t){a.send(e,n,t)}))})),L(this,"getDebugSessionId",(function(){return a.sendPromisified({websocketCommand:"WSGetSessionId"})})),L(this,"flushSendFailedList",(function(){Object.keys(a.eventPromiseMap).forEach((function(e){var n=a.eventPromiseMap[e];if(n&&(delete a.eventPromiseMap[e],"WSSendMsg"!==n.request.websocketCommand)){var t=n.request,r=n.resolveEvent,o=n.rejectEvent;a.send(t,r,o)}}))})),L(this,"onOpenhandler",function(){var e=(0,i.A)((0,o.A)().mark((function e(n,t){var r,i;return(0,o.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a.errorFlag){e.next=15;break}return e.prev=1,e.next=4,a.login();case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),a.disconnectWithoutReconnect();case 9:(r=(new Date).getTime())-a.lastReconnectTime>=3e3&&(null===(i=a.emitter)||void 0===i||i.emit(T.Reconnect),a.lastReconnectTime=r),a.errorFlag=!1,a.sendPing(),e.next=17;break;case 15:return e.next=17,null===n||void 0===n?void 0:n();case 17:a.flushSendFailedList(),null===t||void 0===t||t();case 19:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(n,t){return e.apply(this,arguments)}}()),L(this,"disconnectWithoutReconnect",function(){var e=(0,i.A)((0,o.A)().mark((function e(n){var t,r;return(0,o.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null===(t=a.emitter)||void 0===t||t.emit(T.DisconnectWithoutReconnect,n),null===(r=a.connection)||void 0===r||r.disconnect();case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()),L(this,"createWs",(function(e,n,t,r){return new Promise((function(o){var i;a.connection=new y({connectUrl:a.wsUrl}),r&&(null===(i=a.connection)||void 0===i||i.onStatusChange(r)),a.connection.connect(),a.connection.onSocketConnected((function(){a.onOpenhandler(e,o)})),a.connection.onSocketError((function(e){a.errorFlag=!0,null===t||void 0===t||t(e)})),a.connection.onSocketClose((function(e){a.errorFlag=!0,(null===e||void 0===e?void 0:e.code)&&a.nonReconnectableCloseCodes.includes(null===e||void 0===e?void 0:e.code)&&a.disconnectWithoutReconnect(e),null===n||void 0===n||n(e)})),a.connection.setPushDataResolver(a.handleIncomingEvent),a.connection.onPushDiscontinue(a.sendPing)}))})),L(this,"getChannelId",(function(e){if(a.channelIdKeyName)return null===e||void 0===e?void 0:e[a.channelIdKeyName]})),L(this,"handleIncomingEvent",(function(e){if(!a.paused){var n=a.getChannelId(e.data);if(a.customPushCommands.includes(e.websocketCommand))a.onNewMessagesReceived(e);else{var t="WSPushMsg"===e.websocketCommand&&Boolean(n);!1===a.channelIdKeyName&&(t="WSPushMsg"===e.websocketCommand),t?(n||(n="__DEFAULT_CHANNEL"),a.messageBroadcastBuffer[n]?a.messageBroadcastBuffer[n].list.push(e):a.messageBroadcastBuffer[n]={list:[e],isEmittingMessage:!1},a.messageBroadcastBuffer[n].isEmittingMessage||(a.messageBroadcastBuffer[n].isEmittingMessage=!0,a.broadcastNewMessages(n))):a.resolveOrFailEvent(e)}}})),L(this,"broadcastNewMessages",(function(e){a.messageBroadcastBuffer[e].list.length?a.throttler.sendWork((function(){a.onNewMessagesReceived(a.messageBroadcastBuffer[e].list.splice(0,100),e),a.broadcastNewMessages(e)})):a.messageBroadcastBuffer[e].isEmittingMessage=!1})),L(this,"close",(function(){var e;null===(e=a.connection)||void 0===e||e.disconnect(),a.connection=void 0,a.requestIdPrefix=void 0,a.wsUrl="",a.eventPromiseMap={},a.emitter=void 0,a.errorFlag=!1,a.lastReconnectTime=0,a.messageBroadcastBuffer={},a.throttler.close()}));var c=r.messageHandlerThrottleDuration,l=void 0===c?200:c;this.throttler=w(l),this.emitter=new S,this.onNewMessagesReceived=n,this.channelIdKeyName=t,this.customPushCommands=r.customPushCommands||[],this.nonReconnectableCloseCodes=this.nonReconnectableCloseCodes.concat(r.nonReconnectableCloseCodes||[]),this.paused=!1,r.debug&&(window.__IMpauseCore=function(){a.paused=!0},window.__IMresumeCore=function(){a.paused=!1},window.__IMtriggerRecon=function(){var e;null===(e=a.emitter)||void 0===e||e.emit(T.Reconnect)})}),[{key:"connect",value:function(e){var n=this;return this.wsUrl=e.url,this.loginData=e.loginData,new Promise((function(t,r){var a=e.url,s=e.requestIdPrefix,c={event:"ImSdkInitWsFailed",rawEvent:{},errCode:0,errMsg:"",data:"",wsUrl:"",dump:""},u=function(){var a=(0,i.A)((0,o.A)().mark((function a(){var i;return(0,o.A)().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return s&&(n.requestIdPrefix=s),a.prev=1,a.next=4,n.login();case 4:a.next=10;break;case 6:a.prev=6,a.t0=a.catch(1),r(a.t0),n.disconnectWithoutReconnect();case 10:null===(i=e.onOpen)||void 0===i||i.call(e),t(!0);case 12:case"end":return a.stop()}}),a,null,[[1,6]])})));return function(){return a.apply(this,arguments)}}();n.createWs(u,(function(n){var t,o,i,s=N(n);c.errCode=null!==(o=null===s||void 0===s?void 0:s.code)&&void 0!==o?o:111,c.wsUrl=a,c.errMsg=null!==(i=null===s||void 0===s?void 0:s.reason)&&void 0!==i?i:"WebSocket Closed ".concat(n.code),c.rawEvent=n,c.dump=R(n),null===(t=e.onClose)||void 0===t||t.call(e,n),r(c)}),(function(n){var t,o,i,s=N(n);c.errCode=null!==(o=null===s||void 0===s?void 0:s.code)&&void 0!==o?o:112,c.wsUrl=a,c.errMsg=null!==(i=null===s||void 0===s?void 0:s.reason)&&void 0!==i?i:"WebSocket Error Event",c.rawEvent=s,c.dump=R(n),null===(t=e.onError)||void 0===t||t.call(e,n),r(c)}),e.onStatusChange)}))}},{key:"addEventListener",value:function(e,n){var t;null===(t=this.emitter)||void 0===t||t.on(e,n)}},{key:"removeEventListener",value:function(e,n){var t;null===(t=this.emitter)||void 0===t||t.off(e,n)}}])}()},20331:(e,n,t)=>{t.r(n),t.d(n,{toCanvas:()=>Pe,toPng:()=>Ge,toSvg:()=>Oe});var r=t(90675),a=t(5544),o=t(10467);function i(e,n){if(e.match(/^[a-z]+:\/\//i))return e;if(e.match(/^\/\//))return window.location.protocol+e;if(e.match(/^[a-z]+:/i))return e;var t=document.implementation.createHTMLDocument(),r=t.createElement("base"),a=t.createElement("a");return t.head.appendChild(r),t.body.appendChild(a),n&&(r.href=n),a.href=e,a.href}var s=function(){var e=0;return function(){return e+=1,"u".concat("0000".concat((Math.random()*Math.pow(36,4)|0).toString(36)).slice(-4)).concat(e)}}();function c(e){for(var n=[],t=0,r=e.length;t<r;t++)n.push(e[t]);return n}function u(e,n){var t=(e.ownerDocument.defaultView||window).getComputedStyle(e).getPropertyValue(n);return t?parseFloat(t.replace("px","")):0}function l(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{width:n.width||function(e){var n=u(e,"border-left-width"),t=u(e,"border-right-width");return e.clientWidth+n+t}(e),height:n.height||function(e){var n=u(e,"border-top-width"),t=u(e,"border-bottom-width");return e.clientHeight+n+t}(e)}}function d(){var e,n;try{n=process}catch(r){}var t=n&&n.env?n.env.devicePixelRatio:null;return t&&(e=parseInt(t,10),Number.isNaN(e)&&(e=1)),e||window.devicePixelRatio||1}var m=16384;function f(e){(e.width>m||e.height>m)&&(e.width>m&&e.height>m?e.width>e.height?(e.height*=m/e.width,e.width=m):(e.width*=m/e.height,e.height=m):e.width>m?(e.height*=m/e.width,e.width=m):(e.width*=m/e.height,e.height=m))}function p(e){return new Promise((function(n,t){var r=new Image;r.decode=function(){return n(r)},r.onload=function(){return n(r)},r.onerror=t,r.crossOrigin="anonymous",r.decoding="async",r.src=e}))}function v(e){return h.apply(this,arguments)}function h(){return(h=(0,o.A)((0,r.A)().mark((function e(n){return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.resolve().then((function(){return(new XMLSerializer).serializeToString(n)})).then(encodeURIComponent).then((function(e){return"data:image/svg+xml;charset=utf-8,".concat(e)})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e,n,t){return _.apply(this,arguments)}function _(){return(_=(0,o.A)((0,r.A)().mark((function e(n,t,a){var o,i,s;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o="http://www.w3.org/2000/svg",i=document.createElementNS(o,"svg"),s=document.createElementNS(o,"foreignObject"),i.setAttribute("width","".concat(t)),i.setAttribute("height","".concat(a)),i.setAttribute("viewBox","0 0 ".concat(t," ").concat(a)),s.setAttribute("width","100%"),s.setAttribute("height","100%"),s.setAttribute("x","0"),s.setAttribute("y","0"),s.setAttribute("externalResourcesRequired","true"),i.appendChild(s),s.appendChild(n),e.abrupt("return",v(i));case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var A=function(e,n){if(e instanceof n)return!0;var t=Object.getPrototypeOf(e);return null!==t&&(t.constructor.name===n.name||A(t,n))};function E(e,n,t){var r=".".concat(e,":").concat(n),a=t.cssText?function(e){var n=e.getPropertyValue("content");return"".concat(e.cssText," content: '").concat(n.replace(/'|"/g,""),"';")}(t):function(e){return c(e).map((function(n){var t=e.getPropertyValue(n),r=e.getPropertyPriority(n);return"".concat(n,": ").concat(t).concat(r?" !important":"",";")})).join(" ")}(t);return document.createTextNode("".concat(r,"{").concat(a,"}"))}function b(e,n,t){var r=window.getComputedStyle(e,t),a=r.getPropertyValue("content");if(""!==a&&"none"!==a){var o=s();try{n.className="".concat(n.className," ").concat(o)}catch(c){return}var i=document.createElement("style");i.appendChild(E(o,t,r)),n.appendChild(i)}}var C="application/font-woff",y="image/jpeg",S={woff:C,woff2:C,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:y,jpeg:y,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml",webp:"image/webp"};function M(e){var n=function(e){var n=/\.([^./]*?)$/g.exec(e);return n?n[1]:""}(e).toLowerCase();return S[n]||""}function I(e){return e.split(/,/)[1]}function k(e){return-1!==e.search(/^(data:)/)}function x(e,n){return"data:".concat(n,";base64,").concat(e)}function w(e,n,t){return T.apply(this,arguments)}function T(){return(T=(0,o.A)((0,r.A)().mark((function e(n,t,a){var o,i;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(n,t);case 2:if(404!==(o=e.sent).status){e.next=5;break}throw new Error('Resource "'.concat(o.url,'" not found'));case 5:return e.next=7,o.blob();case 7:return i=e.sent,e.abrupt("return",new Promise((function(e,n){var t=new FileReader;t.onerror=n,t.onloadend=function(){try{e(a({res:o,result:t.result}))}catch(r){n(r)}},t.readAsDataURL(i)})));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var N={};function R(e,n,t){var r=e.replace(/\?.*/,"");return t&&(r=e),/ttf|otf|eot|woff2?/i.test(r)&&(r=r.replace(/.*\//,"")),n?"[".concat(n,"]").concat(r):r}function L(e,n,t){return O.apply(this,arguments)}function O(){return(O=(0,o.A)((0,r.A)().mark((function e(n,t,a){var o,i,s,c;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=R(n,t,a.includeQueryParams),null==N[o]){e.next=3;break}return e.abrupt("return",N[o]);case 3:return a.cacheBust&&(n+=(/\?/.test(n)?"&":"?")+(new Date).getTime()),e.prev=4,e.next=7,w(n,a.fetchRequestInit,(function(e){var n=e.res,r=e.result;return t||(t=n.headers.get("Content-Type")||""),I(r)}));case 7:s=e.sent,i=x(s,t),e.next=17;break;case 11:e.prev=11,e.t0=e.catch(4),i=a.imagePlaceholder||"",c="Failed to fetch resource: ".concat(n),e.t0&&(c="string"===typeof e.t0?e.t0:e.t0.message),c&&console.warn(c);case 17:return N[o]=i,e.abrupt("return",i);case 19:case"end":return e.stop()}}),e,null,[[4,11]])})))).apply(this,arguments)}function U(e){return P.apply(this,arguments)}function P(){return(P=(0,o.A)((0,r.A)().mark((function e(n){var t;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("data:,"!==(t=n.toDataURL())){e.next=3;break}return e.abrupt("return",n.cloneNode(!1));case 3:return e.abrupt("return",p(t));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(e,n){return G.apply(this,arguments)}function G(){return(G=(0,o.A)((0,r.A)().mark((function e(n,t){var a,o,i,s,c,u;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.currentSrc){e.next=8;break}return a=document.createElement("canvas"),o=a.getContext("2d"),a.width=n.clientWidth,a.height=n.clientHeight,null===o||void 0===o||o.drawImage(n,0,0,a.width,a.height),i=a.toDataURL(),e.abrupt("return",p(i));case 8:return s=n.poster,c=M(s),e.next=12,L(s,c,t);case 12:return u=e.sent,e.abrupt("return",p(u));case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(e){return B.apply(this,arguments)}function B(){return(B=(0,o.A)((0,r.A)().mark((function e(n){var t;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!(null===(t=null===n||void 0===n?void 0:n.contentDocument)||void 0===t?void 0:t.body)){e.next=5;break}return e.next=4,X(n.contentDocument.body,{},!0);case 4:return e.abrupt("return",e.sent);case 5:e.next=9;break;case 7:e.prev=7,e.t0=e.catch(0);case 9:return e.abrupt("return",n.cloneNode(!1));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}function H(e,n){return F.apply(this,arguments)}function F(){return(F=(0,o.A)((0,r.A)().mark((function e(n,t){return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!A(n,HTMLCanvasElement)){e.next=2;break}return e.abrupt("return",U(n));case 2:if(!A(n,HTMLVideoElement)){e.next=4;break}return e.abrupt("return",D(n,t));case 4:if(!A(n,HTMLIFrameElement)){e.next=6;break}return e.abrupt("return",q(n));case 6:return e.abrupt("return",n.cloneNode(!1));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var V=function(e){return null!=e.tagName&&"SLOT"===e.tagName.toUpperCase()};function W(e,n,t){return Y.apply(this,arguments)}function Y(){return(Y=(0,o.A)((0,r.A)().mark((function e(n,t,a){var o,i,s;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=[],0!==(s=V(n)&&n.assignedNodes?c(n.assignedNodes()):A(n,HTMLIFrameElement)&&(null===(o=n.contentDocument)||void 0===o?void 0:o.body)?c(n.contentDocument.body.childNodes):c((null!==(i=n.shadowRoot)&&void 0!==i?i:n).childNodes)).length&&!A(n,HTMLVideoElement)){e.next=4;break}return e.abrupt("return",t);case 4:return e.next=6,s.reduce((function(e,n){return e.then((function(){return X(n,a)})).then((function(e){e&&t.appendChild(e)}))}),Promise.resolve());case 6:return e.abrupt("return",t);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e,n){return A(n,Element)&&(function(e,n){var t=n.style;if(t){var r=window.getComputedStyle(e);r.cssText?(t.cssText=r.cssText,t.transformOrigin=r.transformOrigin):c(r).forEach((function(a){var o=r.getPropertyValue(a);if("font-size"===a&&o.endsWith("px")){var i=Math.floor(parseFloat(o.substring(0,o.length-2)))-.1;o="".concat(i,"px")}A(e,HTMLIFrameElement)&&"display"===a&&"inline"===o&&(o="block"),"d"===a&&n.getAttribute("d")&&(o="path(".concat(n.getAttribute("d"),")")),t.setProperty(a,o,r.getPropertyPriority(a))}))}}(e,n),function(e,n){b(e,n,":before"),b(e,n,":after")}(e,n),function(e,n){A(e,HTMLTextAreaElement)&&(n.innerHTML=e.value),A(e,HTMLInputElement)&&n.setAttribute("value",e.value)}(e,n),function(e,n){if(A(e,HTMLSelectElement)){var t=n,r=Array.from(t.children).find((function(n){return e.value===n.getAttribute("value")}));r&&r.setAttribute("selected","")}}(e,n)),n}function z(e,n){return K.apply(this,arguments)}function K(){return(K=(0,o.A)((0,r.A)().mark((function e(n,t){var a,o,i,s,c,u,l,d,m,f,p,v;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==(a=n.querySelectorAll?n.querySelectorAll("use"):[]).length){e.next=3;break}return e.abrupt("return",n);case 3:o={},i=0;case 5:if(!(i<a.length)){e.next=18;break}if(s=a[i],!(c=s.getAttribute("xlink:href"))){e.next=15;break}if(u=n.querySelector(c),l=document.querySelector(c),u||!l||o[c]){e.next=15;break}return e.next=14,X(l,t,!0);case 14:o[c]=e.sent;case 15:i++,e.next=5;break;case 18:if((d=Object.values(o)).length){for(m="http://www.w3.org/1999/xhtml",(f=document.createElementNS(m,"svg")).setAttribute("xmlns",m),f.style.position="absolute",f.style.width="0",f.style.height="0",f.style.overflow="hidden",f.style.display="none",p=document.createElementNS(m,"defs"),f.appendChild(p),v=0;v<d.length;v++)p.appendChild(d[v]);n.appendChild(f)}return e.abrupt("return",n);case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function X(e,n,t){return J.apply(this,arguments)}function J(){return(J=(0,o.A)((0,r.A)().mark((function e(n,t,a){return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a||!t.filter||t.filter(n)){e.next=2;break}return e.abrupt("return",null);case 2:return e.abrupt("return",Promise.resolve(n).then((function(e){return H(e,t)})).then((function(e){return W(n,e,t)})).then((function(e){return j(n,e)})).then((function(e){return z(e,t)})));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Q=/url\((['"]?)([^'"]+?)\1\)/g,Z=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,$=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function ee(e){var n=e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp("(url\\(['\"]?)(".concat(n,")(['\"]?\\))"),"g")}function ne(e){var n=[];return e.replace(Q,(function(e,t,r){return n.push(r),e})),n.filter((function(e){return!k(e)}))}function te(e,n,t,r,a){return re.apply(this,arguments)}function re(){return(re=(0,o.A)((0,r.A)().mark((function e(n,t,a,o,s){var c,u,l;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,c=a?i(t,a):t,u=M(t),!s){e.next=7;break}e.next=10;break;case 7:return e.next=9,L(c,u,o);case 9:l=e.sent;case 10:return e.abrupt("return",n.replace(ee(t),"$1".concat(l,"$3")));case 13:e.prev=13,e.t0=e.catch(0);case 15:return e.abrupt("return",n);case 16:case"end":return e.stop()}}),e,null,[[0,13]])})))).apply(this,arguments)}function ae(e,n){var t=n.preferredFontFormat;return t?e.replace($,(function(e){for(;;){var n=Z.exec(e)||[],r=(0,a.A)(n,3),o=r[0],i=r[2];if(!i)return"";if(i===t)return"src: ".concat(o,";")}})):e}function oe(e){return-1!==e.search(Q)}function ie(e,n,t){return se.apply(this,arguments)}function se(){return(se=(0,o.A)((0,r.A)().mark((function e(n,t,a){var o,i;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(oe(n)){e.next=2;break}return e.abrupt("return",n);case 2:return o=ae(n,a),i=ne(o),e.abrupt("return",i.reduce((function(e,n){return e.then((function(e){return te(e,n,t,a)}))}),Promise.resolve(o)));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ce(e,n,t){return ue.apply(this,arguments)}function ue(){return(ue=(0,o.A)((0,r.A)().mark((function e(n,t,a){var o,i,s;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i=null===(o=t.style)||void 0===o?void 0:o.getPropertyValue(n))){e.next=7;break}return e.next=4,ie(i,null,a);case 4:return s=e.sent,t.style.setProperty(n,s,t.style.getPropertyPriority(n)),e.abrupt("return",!0);case 7:return e.abrupt("return",!1);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function le(e,n){return de.apply(this,arguments)}function de(){return(de=(0,o.A)((0,r.A)().mark((function e(n,t){return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ce("background",n,t);case 2:if(e.sent){e.next=5;break}return e.next=5,ce("background-image",n,t);case 5:return e.next=7,ce("mask",n,t);case 7:if(e.sent){e.next=10;break}return e.next=10,ce("mask-image",n,t);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function me(e,n){return fe.apply(this,arguments)}function fe(){return(fe=(0,o.A)((0,r.A)().mark((function e(n,t){var a,o,i;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((a=A(n,HTMLImageElement))&&!k(n.src)||A(n,SVGImageElement)&&!k(n.href.baseVal)){e.next=3;break}return e.abrupt("return");case 3:return o=a?n.src:n.href.baseVal,e.next=6,L(o,M(o),t);case 6:return i=e.sent,e.next=9,new Promise((function(e,t){n.onload=e,n.onerror=t;var r=n;r.decode&&(r.decode=e),"lazy"===r.loading&&(r.loading="eager"),a?(n.srcset="",n.src=i):n.href.baseVal=i}));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function pe(e,n){return ve.apply(this,arguments)}function ve(){return(ve=(0,o.A)((0,r.A)().mark((function e(n,t){var a,o;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=c(n.childNodes),o=a.map((function(e){return he(e,t)})),e.next=4,Promise.all(o).then((function(){return n}));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function he(e,n){return ge.apply(this,arguments)}function ge(){return(ge=(0,o.A)((0,r.A)().mark((function e(n,t){return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!A(n,Element)){e.next=7;break}return e.next=3,le(n,t);case 3:return e.next=5,me(n,t);case 5:return e.next=7,pe(n,t);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _e(e,n){var t=e.style;n.backgroundColor&&(t.backgroundColor=n.backgroundColor),n.width&&(t.width="".concat(n.width,"px")),n.height&&(t.height="".concat(n.height,"px"));var r=n.style;return null!=r&&Object.keys(r).forEach((function(e){t[e]=r[e]})),e}var Ae={};function Ee(e){return be.apply(this,arguments)}function be(){return(be=(0,o.A)((0,r.A)().mark((function e(n){var t,a,o;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==(t=Ae[n])){e.next=3;break}return e.abrupt("return",t);case 3:return e.next=5,fetch(n);case 5:return a=e.sent,e.next=8,a.text();case 8:return o=e.sent,t={url:n,cssText:o},Ae[n]=t,e.abrupt("return",t);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ce(e,n){return ye.apply(this,arguments)}function ye(){return ye=(0,o.A)((0,r.A)().mark((function e(n,t){var a,i,s,c;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.cssText,i=/url\(["']?([^"')]+)["']?\)/g,s=a.match(/url\([^)]+\)/g)||[],c=s.map(function(){var e=(0,o.A)((0,r.A)().mark((function e(o){var s;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(s=o.replace(i,"$1")).startsWith("https://")||(s=new URL(s,n.url).href),e.abrupt("return",w(s,t.fetchRequestInit,(function(e){var n=e.result;return a=a.replace(o,"url(".concat(n,")")),[o,n]})));case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()),e.abrupt("return",Promise.all(c).then((function(){return a})));case 5:case"end":return e.stop()}}),e)}))),ye.apply(this,arguments)}function Se(e){if(null==e)return[];for(var n=[],t=e.replace(/(\/\*[\s\S]*?\*\/)/gi,""),r=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");;){var a=r.exec(t);if(null===a)break;n.push(a[0])}t=t.replace(r,"");for(var o=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,i=new RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");;){var s=o.exec(t);if(null===s){if(null===(s=i.exec(t)))break;o.lastIndex=i.lastIndex}else i.lastIndex=o.lastIndex;n.push(s[0])}return n}function Me(e,n){return Ie.apply(this,arguments)}function Ie(){return(Ie=(0,o.A)((0,r.A)().mark((function e(n,t){var a,o;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=[],o=[],n.forEach((function(e){if("cssRules"in e)try{c(e.cssRules||[]).forEach((function(n,r){if(n.type===CSSRule.IMPORT_RULE){var a=r+1,i=Ee(n.href).then((function(e){return Ce(e,t)})).then((function(n){return Se(n).forEach((function(n){try{e.insertRule(n,n.startsWith("@import")?a+=1:e.cssRules.length)}catch(t){console.error("Error inserting rule from remote css",{rule:n,error:t})}}))})).catch((function(e){console.error("Error loading remote css",e.toString())}));o.push(i)}}))}catch(a){var r=n.find((function(e){return null==e.href}))||document.styleSheets[0];null!=e.href&&o.push(Ee(e.href).then((function(e){return Ce(e,t)})).then((function(n){return Se(n).forEach((function(n){r.insertRule(n,e.cssRules.length)}))})).catch((function(e){console.error("Error loading remote stylesheet",e)}))),console.error("Error inlining remote css file",a)}})),e.abrupt("return",Promise.all(o).then((function(){return n.forEach((function(e){if("cssRules"in e)try{c(e.cssRules||[]).forEach((function(e){a.push(e)}))}catch(n){console.error("Error while reading CSS rules from ".concat(e.href),n)}})),a})));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ke(e){return e.filter((function(e){return e.type===CSSRule.FONT_FACE_RULE})).filter((function(e){return oe(e.style.getPropertyValue("src"))}))}function xe(e,n){return we.apply(this,arguments)}function we(){return(we=(0,o.A)((0,r.A)().mark((function e(n,t){var a,o;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=n.ownerDocument){e.next=2;break}throw new Error("Provided element is not within a Document");case 2:return a=c(n.ownerDocument.styleSheets),e.next=5,Me(a,t);case 5:return o=e.sent,e.abrupt("return",ke(o));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Te(e,n){return Ne.apply(this,arguments)}function Ne(){return(Ne=(0,o.A)((0,r.A)().mark((function e(n,t){var a,o;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,xe(n,t);case 2:return a=e.sent,e.next=5,Promise.all(a.map((function(e){var n=e.parentStyleSheet?e.parentStyleSheet.href:null;return ie(e.cssText,n,t)})));case 5:return o=e.sent,e.abrupt("return",o.join("\n"));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Re(e,n){return Le.apply(this,arguments)}function Le(){return(Le=(0,o.A)((0,r.A)().mark((function e(n,t){var a,o,i;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==t.fontEmbedCSS){e.next=4;break}e.t0=t.fontEmbedCSS,e.next=12;break;case 4:if(!t.skipFonts){e.next=8;break}e.t1=null,e.next=11;break;case 8:return e.next=10,Te(n,t);case 10:e.t1=e.sent;case 11:e.t0=e.t1;case 12:(a=e.t0)&&(o=document.createElement("style"),i=document.createTextNode(a),o.appendChild(i),n.firstChild?n.insertBefore(o,n.firstChild):n.appendChild(o));case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Oe(e){return Ue.apply(this,arguments)}function Ue(){return Ue=(0,o.A)((0,r.A)().mark((function e(n){var t,a,o,i,s,c,u=arguments;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=l(n,t=u.length>1&&void 0!==u[1]?u[1]:{}),o=a.width,i=a.height,e.next=4,X(n,t,!0);case 4:return s=e.sent,e.next=7,Re(s,t);case 7:return e.next=9,he(s,t);case 9:return _e(s,t),e.next=12,g(s,o,i);case 12:return c=e.sent,e.abrupt("return",c);case 14:case"end":return e.stop()}}),e)}))),Ue.apply(this,arguments)}function Pe(e){return De.apply(this,arguments)}function De(){return De=(0,o.A)((0,r.A)().mark((function e(n){var t,a,o,i,s,c,u,m,v,h,g,_=arguments;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=l(n,t=_.length>1&&void 0!==_[1]?_[1]:{}),o=a.width,i=a.height,e.next=4,Oe(n,t);case 4:return s=e.sent,e.next=7,p(s);case 7:return c=e.sent,u=document.createElement("canvas"),m=u.getContext("2d"),v=t.pixelRatio||d(),h=t.canvasWidth||o,g=t.canvasHeight||i,u.width=h*v,u.height=g*v,t.skipAutoScale||f(u),u.style.width="".concat(h),u.style.height="".concat(g),t.backgroundColor&&(m.fillStyle=t.backgroundColor,m.fillRect(0,0,u.width,u.height)),m.drawImage(c,0,0,u.width,u.height),e.abrupt("return",u);case 21:case"end":return e.stop()}}),e)}))),De.apply(this,arguments)}function Ge(e){return qe.apply(this,arguments)}function qe(){return qe=(0,o.A)((0,r.A)().mark((function e(n){var t,a,o=arguments;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=o.length>1&&void 0!==o[1]?o[1]:{},e.next=3,Pe(n,t);case 3:return a=e.sent,e.abrupt("return",a.toDataURL());case 5:case"end":return e.stop()}}),e)}))),qe.apply(this,arguments)}},8675:(e,n,t)=>{t.d(n,{n:()=>r});var r=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:21,n="",t=crypto.getRandomValues(new Uint8Array(e|=0));e--;)n+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&t[e]];return n}},39420:(e,n,t)=>{t.d(n,{Ok:()=>oe,Nw:()=>we,jF:()=>te});var r=t(53986),a=t(60436),o=t(24765),i=t(5544),s=t(89379),c=t(90675),u=t(10467),l=t(92901),d=t(23029),m=t(50388),f=t(52176),p=t(53954),v=t(85501),h=t(56218),g=t(30912),_=t(57394),A=t(72446),E=t(74002),b=t(55355),C=t(84854),y=t(30135),S=t(99149),M=t(44985),I=t(99692),k=t(26204),x=t(98911),w=["contactUid"],T=function(e){var n=e||{},t=n.contactUid,a=(0,r.A)(n,w);return(0,s.A)((0,s.A)({},a),{},{userUid:t})},N=t(44497),R=t(47649),L=t(65603);function O(e){return new Promise((function(n,t){var r=new FileReader;r.onloadend=function(){r.result?n(r.result.toString()):t(new Error("Conversion to base64 failed"))},r.onerror=function(){t(new Error("FileReader error"))},r.readAsDataURL(e)}))}function U(e,n,t,r,a){return new Promise((function(o,i){var s=1024*n;if(e.size<=s)o(e);else{var c=new Image;c.onerror=function(){URL.revokeObjectURL(c.src),i(new Error("Image loading error"))},c.onload=function(){URL.revokeObjectURL(c.src);var n=c.width,s=c.height,u=Math.min(t/n,r/s,1);s=Math.round(s*u),n=Math.round(n*u);var l=document.createElement("canvas");l.width=n,l.height=s;var d=l.getContext("2d");d?(d.drawImage(c,0,0,n,s),l.toBlob((function(n){if(n){var t=new File([n],e.name,{type:e.type});o(t)}else i(new Error("Blob creation failed"))}),"image/jpeg",a)):i(new Error("Canvas context error"))};var u=URL.createObjectURL(e);c.src=u}}))}var P=function(){var e=(0,u.A)((0,c.A)().mark((function e(n){var t,r,a,o;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=URL.createObjectURL(n),(r=new Image).src=t,r.onerror=function(){URL.revokeObjectURL(t)},r.complete){e.next=7;break}return e.next=7,new Promise((function(e){r.onload=e}));case 7:return e.next=9,U(n,2,70,70,.8);case 9:return a=e.sent,e.next=12,O(a);case 12:return o=e.sent,URL.revokeObjectURL(t),e.abrupt("return",{thumbnail:o.replace(/^data:[\s\S]{1,20}\/\w+;base64,/,""),width:r.width,height:r.height});case 15:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),D=132;function G(e){return q.apply(this,arguments)}function q(){return q=(0,u.A)((0,c.A)().mark((function e(n){var t,r,a,o,i=arguments;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>1&&void 0!==i[1]?i[1]:D,r=URL.createObjectURL(n),(a=document.createElement("video")).src=r,e.next=6,new Promise((function(e){a.onloadedmetadata=e}));case 6:return o=a.duration,e.abrupt("return",new Promise((function(e){var i=document.createElement("canvas");i.width=t,i.height=t*(a.videoHeight/a.videoWidth);var s=i.getContext("2d"),l=function(){var t=(0,u.A)((0,c.A)().mark((function t(){var u,l,d;return(0,c.A)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s){t.next=2;break}return t.abrupt("return");case 2:if(s.drawImage(a,0,0,i.width,i.height),u=i.toDataURL("image/jpeg",.5),!/^((?!chrome|android).)*safari/i.test(navigator.userAgent)){t.next=11;break}return t.next=8,P(n);case 8:l=t.sent,d=l.thumbnail,u=d;case 11:e({thumbnail:u,duration:o,width:a.videoWidth,height:a.videoHeight}),URL.revokeObjectURL(r);case 13:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();Object.assign(a,{currentTime:0,onseeked:l,onerror:function(){URL.revokeObjectURL(r)}})})));case 8:case"end":return e.stop()}}),e)}))),q.apply(this,arguments)}var B=function(e,n){var t,r,a=e.senderUid===n;return e.contentType===_.Y.VOICE_CALL_MESSAGE&&(null==(t=e.callMessage)?void 0:t.signalType)&&_.Z.includes(null==(r=e.callMessage)?void 0:r.signalType)&&(a=e.callMessage.callerUid===n),(0,s.A)((0,s.A)({visible:!1},e),{},{clientMsgId:"".concat(e.channelId,"_").concat(e.seq),isSender:a,seq:Number(e.seq),quotedMessage:e.quotedMessage})},H=function(){var e=(0,u.A)((0,c.A)().mark((function e(n,t,r,a){var o,l,d,m,f,p,v,h,g,_,A,E,b,y,S,M,I,k,x,w;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m=t.userInfo.userUid,f=n.messageContent.file,p=f.type,v=function(){var e=(0,u.A)((0,c.A)().mark((function e(){var t;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!C.A.isApp&&!R.T.isIOS)||!p||p.toLowerCase().includes("gif")){e.next=7;break}return e.next=4,U(f,2e3,2e3,3e3,.8);case 4:e.t0=e.sent,e.next=8;break;case 7:e.t0=f;case 8:return t=e.t0,e.abrupt("return",a(t,{channelId:n.channelId,isBulkMessage:!!n.isBulkMessage}));case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.next=7,Promise.all([P(f),v()]);case 7:return h=e.sent,g=(0,i.A)(h,2),_=g[0],A=_.thumbnail,E=_.width,b=_.height,y=g[1],S=y.urls,M=y.fileId,I={thumbnail:A,urlPaths:S,width:E,height:b,quotedMsgSeq:null!==(o=null==(d=n.quotedMessage)?void 0:d.seq)&&void 0!==o?o:null,fileId:M},k=(0,L.g)(t.imHttp.deviceId),x=(0,L.e)((0,s.A)((0,s.A)({},n),{},{messageContent:I,extra:{tempId:k}}),m,r),w=B((0,s.A)((0,s.A)({},x),{},{quotedMessage:null!==(l=n.quotedMessage)&&void 0!==l?l:null,loading:!0}),m),e.abrupt("return",{tempMessage:w});case 21:case"end":return e.stop()}}),e)})));return function(n,t,r,a){return e.apply(this,arguments)}}(),F=function(){var e=(0,u.A)((0,c.A)().mark((function e(n,t,r,a){var o,u,l,d,m,f,p,v,h,g,_,A,E,b,C,y,S,M,I;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d=t.userInfo.userUid,m=n.messageContent.file,e.next=4,Promise.all([G(m),a(m,{channelId:n.channelId,isBulkMessage:!!n.isBulkMessage})]);case 4:return f=e.sent,p=(0,i.A)(f,2),v=p[0],h=v.thumbnail,g=v.duration,_=v.width,A=v.height,E=p[1],b=E.urls,C=E.fileId,y={thumbnail:h.replace(/^data:image\/\w+;base64,/,""),duration:g,urlPaths:b,width:_,height:A,quotedMsgSeq:null!==(o=null==(l=n.quotedMessage)?void 0:l.seq)&&void 0!==o?o:null,fileId:C},S=(0,L.g)(t.imHttp.deviceId),M=(0,L.f)((0,s.A)((0,s.A)({},n),{},{messageContent:y,extra:{tempId:S}}),d,r),I=B((0,s.A)((0,s.A)({},M),{},{quotedMessage:null!==(u=n.quotedMessage)&&void 0!==u?u:null,loading:!0}),d),e.abrupt("return",{tempMessage:I});case 19:case"end":return e.stop()}}),e)})));return function(n,t,r,a){return e.apply(this,arguments)}}(),V=function(){var e=(0,u.A)((0,c.A)().mark((function e(n,t,r,a){var o,i,u,l,d,m,f,p,v,h,g,_;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=t.userInfo.userUid,d=n.messageContent.file,e.next=4,a(d,{channelId:n.channelId});case 4:return m=e.sent,f=m.urls,p=m.fileId,v={fileId:p,urlPaths:f,quotedMsgSeq:null!==(o=null==(u=n.quotedMessage)?void 0:u.seq)&&void 0!==o?o:null},h=(0,L.g)(t.imHttp.deviceId),g=(0,L.h)((0,s.A)((0,s.A)({},n),{},{messageContent:v,extra:{tempId:h}}),l,r),_=B((0,s.A)((0,s.A)({},g),{},{quotedMessage:null!==(i=n.quotedMessage)&&void 0!==i?i:null,loading:!0}),l),e.abrupt("return",{tempMessage:_});case 12:case"end":return e.stop()}}),e)})));return function(n,t,r,a){return e.apply(this,arguments)}}(),W=function(){var e=(0,u.A)((0,c.A)().mark((function e(n,t,r,a){var o,i,u,l,d,m,f,p,v,h,g,_,A,E;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=t.userInfo.userUid,d=n.messageContent,m=d.audioFile,f=d.duration,e.next=4,a(m,{channelId:n.channelId,isBulkMessage:!!n.isBulkMessage});case 4:return p=e.sent,v=p.urls,h=p.fileId,g={file:m,fileId:h,urlPaths:v,duration:f,quotedMsgSeq:null!==(o=null==(u=n.quotedMessage)?void 0:u.seq)&&void 0!==o?o:null},_=(0,L.g)(t.imHttp.deviceId),A=(0,L.i)((0,s.A)((0,s.A)({},n),{},{messageContent:g,extra:{tempId:_}}),l,r),E=B((0,s.A)((0,s.A)({},A),{},{quotedMessage:null!==(i=n.quotedMessage)&&void 0!==i?i:null,loading:!0}),l),e.abrupt("return",{tempMessage:E});case 12:case"end":return e.stop()}}),e)})));return function(n,t,r,a){return e.apply(this,arguments)}}(),Y=function(){var e=(0,u.A)((0,c.A)().mark((function e(n,t,r){var a,o,i,u,l,d,m,f,p,v,h,g;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=n.messageContent,l=u.content,d=u.mentionidsList,m=u.mentionType,f=t.userInfo.userUid,p=(0,L.g)(t.imHttp.deviceId),v={text:l,atUserList:d,atType:m,quotedMsgSeq:null!==(a=null==(i=n.quotedMessage)?void 0:i.seq)&&void 0!==a?a:null},h=(0,L.j)((0,s.A)((0,s.A)({},n),{},{messageContent:v,extra:{tempId:p}}),f,r),g=B((0,s.A)((0,s.A)({},h),{},{quotedMessage:null!==(o=n.quotedMessage)&&void 0!==o?o:null,loading:!0}),f),e.abrupt("return",{tempMessage:g});case 7:case"end":return e.stop()}}),e)})));return function(n,t,r){return e.apply(this,arguments)}}(),j=function(){var e=(0,u.A)((0,c.A)().mark((function e(n,t,r){var a,o,i,u;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.userInfo.userUid,o=(0,L.g)(t.imHttp.deviceId),i=(0,L.k)((0,s.A)((0,s.A)({},n),{},{extra:{tempId:o}}),a,r),u=B((0,s.A)((0,s.A)({},i),{},{loading:!0}),a),e.abrupt("return",{tempMessage:u});case 5:case"end":return e.stop()}}),e)})));return function(n,t,r){return e.apply(this,arguments)}}(),z=function(){var e=(0,u.A)((0,c.A)().mark((function e(n,t,r,a){var o;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=n.contentType,e.t0=o,e.next=e.t0===_.Y.TEXT_MESSAGE?4:e.t0===_.Y.PICTURE_MESSAGE?5:e.t0===_.Y.VIDEO_MESSAGE?6:e.t0===_.Y.MEDIA_MESSAGE?7:e.t0===_.Y.VOICE_MESSAGE?8:e.t0===_.Y.CUSTOM_MESSAGE?9:10;break;case 4:return e.abrupt("return",Y(n,t,r));case 5:return e.abrupt("return",H(n,t,r,a));case 6:return e.abrupt("return",F(n,t,r,a));case 7:return e.abrupt("return",V(n,t,r,a));case 8:return e.abrupt("return",W(n,t,r,a));case 9:return e.abrupt("return",j(n,t,r));case 10:return e.abrupt("return",null);case 11:case"end":return e.stop()}}),e)})));return function(n,t,r,a){return e.apply(this,arguments)}}(),K=t(74176),X=t(5140),J=t(47185),Q=t(41594),Z=["ignoreFormat","skipErrorAlert"],$=["ignoreFormat","skipErrorAlert"];function ee(e,n,t){return n=(0,p.A)(n),(0,m.A)(e,(0,f.A)()?Reflect.construct(n,t||[],(0,p.A)(e).constructor):n.apply(e,t))}var ne="".concat(C.A.cdnBaseUrl,"/cdn/assets/files/242/0071F20CB4B91724.mp3");function te(){return{focus:(0,Q.useCallback)((function(){(0,_.E)({type:"OK-IM-INPUT-FOCUS",data:{from:"HOOK"}})}),[]),blur:(0,Q.useCallback)((function(){(0,_.E)({type:"OK-IM-INPUT-BLUR",data:{from:"HOOK"}})}),[]),setTextContent:(0,Q.useCallback)((function(e){(0,_.E)({type:"OK-IM-INPUT-SET-TEXT-CONTENT",data:{from:"HOOK",textContent:e}})}),[]),moveCursorToEnd:(0,Q.useCallback)((function(){(0,_.E)({type:"OK-IM-INPUT-MOVE-CURSOR-TO-END",data:{from:"HOOK"}})}),[])}}var re=Number.MAX_SAFE_INTEGER,ae=function(e,n){if(e>re||n>re)return _.L.error("genRange: start or end is too large",{error:{start:e,end:n}}),[];var t=Math.max(e,1),r=Math.max(n,1);if(t>r)return _.L.error("genRange: end is less than start",{error:{start:e,end:n}}),[];if(r-t>1e3)return _.L.error("genRange: range is too large",{error:{start:e,end:n}}),[];for(var a=[],o=r;o>=t;o--)a.unshift(o);return a},oe=function(e){return e.P2P="p2p",e.MESSAGE_CENTRE="message_centre",e.AFFILIATE="affiliate",e.VIDEO_VERIFY="video_verification",e.OK_ASSISTANT="ok_assistant",e.DEV="dev",e}(oe||{}),ie=function(e){function n(){var e;return(0,d.A)(this,n),(e=ee(this,n,arguments)).getContactInfo=function(){var n=(0,u.A)((0,c.A)().mark((function n(t){var r,a,o,i;return(0,c.A)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=t.contactUid,!(null==(a=e.driver.initConfig)?void 0:a.anonymousMode)){n.next=3;break}return n.abrupt("return",null);case 3:return n.next=5,e.imHttp.get(x.G,{params:{contactUid:r}});case 5:return o=n.sent,i=T(o),e.imStore.userRegistryStore.setUserInfo(i.userUid,i),n.abrupt("return",i);case 10:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),e.getAllAlias=(0,u.A)((0,c.A)().mark((function n(){var t,r,a;return(0,c.A)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(null==(t=e.driver.initConfig)?void 0:t.anonymousMode)){n.next=2;break}return n.abrupt("return",[]);case 2:return n.next=4,e.imHttp.get(x.L);case 4:return r=n.sent,a=r.map(T),n.abrupt("return",a);case 7:case"end":return n.stop()}}),n)}))),e.getContactList=(0,u.A)((0,c.A)().mark((function n(){var t,r,a,o,i=arguments;return(0,c.A)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t=(i.length>0&&void 0!==i[0]?i[0]:{}).excludeRelationTypes,r=void 0===t?[]:t,!(null==(a=e.driver.initConfig)?void 0:a.anonymousMode)){n.next=3;break}return n.abrupt("return",[]);case 3:return n.next=5,e.imHttp.get(x.a,{params:{excludeRelationTypes:r.join(",")}});case 5:return o=n.sent,n.abrupt("return",o.map(T));case 7:case"end":return n.stop()}}),n)}))),e}return(0,v.A)(n,e),(0,l.A)(n)}(x.C),se=function(e){function n(){var e;return(0,d.A)(this,n),(e=ee(this,n,arguments)).conversationFilter=function(){return!0},e.shouldCountAsUnread=function(){return!0},e.setConversationFilter=function(n){e.conversationFilter=n},e.setShouldCountAsUnread=function(n){e.shouldCountAsUnread=n},e.updateConversationFromOtherDevice=(0,u.A)((0,c.A)().mark((function n(){var t,r,a,o,i=arguments;return(0,c.A)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r=(t=i.length>0&&void 0!==i[0]?i[0]:{}).systemMessage,a=t.channelId,(null==r?void 0:r.data)&&(o={},Object.keys(r.data).forEach((function(e){var n=Number(r.data[e]);o[e]=n>=0?n:r.data[e]})),e.imStore.conversationStore.updateConversation((0,s.A)({channelId:a},o)));case 3:case"end":return n.stop()}}),n)}))),e.fetchAllSimplifiedChannels=function(){var n=(0,u.A)((0,c.A)().mark((function n(t){var r,a;return(0,c.A)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(null==(r=e.driver.initConfig)?void 0:r.anonymousMode)){n.next=2;break}return n.abrupt("return",[]);case 2:return n.next=4,e.imHttp.get(x.b,{source:null==t?void 0:t.source});case 4:if(a=n.sent){n.next=7;break}return n.abrupt("return",[]);case 7:return n.abrupt("return",a.map((function(e){return(0,s.A)((0,s.A)({},e),{},{isLoaded:!1,unsendMessageCount:0})})));case 8:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),e.getUnreadCountUpdates=function(){var n=(0,u.A)((0,c.A)().mark((function n(t){var r,a,o,i,s,u,l,d,m,f;return(0,c.A)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=t.channelId,a=Number(t.lastReceivedMsgSeq),o=Number(t.lastReadMsgSeq||-1),i={channelId:r,groupAtType:_.M.NORMAL,unreadCount:0},!(a<=o)){n.next=6;break}return n.abrupt("return",i);case 6:return n.prev=6,s=Math.max(o+1,a-150),u=ae(s,a),n.next=11,e.driver.fetchMessagesBySeqList({channelId:r,seqList:u});case 11:return l=n.sent,d=l.filter((function(e){return Number(e.seq)>Number(o)})),m=!1,f=!1,d.forEach((function(n){var t;n.contentType!==_.Y.SYSTEM_MESSAGE&&!n.isSender&&(e.shouldCountAsUnread(n)&&i.unreadCount++,m=m||(0,A.c)({message:n,myUid:e.userInfo.userUid}),f=f||(null==(t=null==n?void 0:n.textMessage)?void 0:t.atType)===_.M.AT_ALL)})),d.filter((function(e){return e.contentType!==_.Y.SYSTEM_MESSAGE&&!e.isSender})).length&&e.emitter.emit(b.C.ON_UNREAD_MESSAGES_FETCHED,{channelId:r,messageList:d.filter((function(e){return e.contentType!==_.Y.SYSTEM_MESSAGE&&!e.isSender}))}),m?i.groupAtType=_.M.AT_ME:f&&(i.groupAtType=_.M.AT_ALL),n.abrupt("return",i);case 22:return n.prev=22,n.t0=n.catch(6),n.abrupt("return",i);case 25:case"end":return n.stop()}}),n,null,[[6,22]])})));return function(e){return n.apply(this,arguments)}}(),e.getConversationList=function(){var n=(0,u.A)((0,c.A)().mark((function n(t,r){var a,l,d,m,f,p,v,h,g,A;return(0,c.A)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a=t.channelIds,l=void 0===a?[]:a,d=t.unreadCountCalculation,m=void 0===d||d,l.length){n.next=3;break}return n.abrupt("return",{data:[]});case 3:if(p=Promise.resolve(e.imStore.conversationStore.conversationList),(null==(f=e.driver.initConfig)?void 0:f.anonymousMode)||(p=e.imHttp.post(x.c,{channelIds:l},{source:r})),v=function(){var n=(0,u.A)((0,c.A)().mark((function n(){var t,r,a,u,d,m,f,v,h,g;return(0,c.A)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t=e.imWS.getNewstSeqByChannelIds({channelIdList:l}),n.next=3,Promise.all([p,t]);case 3:r=n.sent,a=(0,i.A)(r,2),u=a[0],d=a[1],m=d.data.seqDtoList,f=u.map((function(n){var t=m.find((function(e){return e.channelId===n.channelId}));return(0,s.A)((0,s.A)({},n),{},{lastReadMsgSeq:String(n.lastReadMsgSeq),oppositeLastReadMsgSeq:"0",lastReceivedMsgSeq:String(null==t?void 0:t.seq),status:n.status||_.a4.NORMAL,unreadCount:0,isLoaded:!0,unsendMessageCount:0,lastUserMsg:n.lastUserMsg?B(n.lastUserMsg,e.userInfo.userUid):void 0})})),v=(0,o.A)(f);try{for(v.s();!(h=v.n()).done;)g=h.value,e.getUnreadCountUpdates(g).then((function(n){e.imStore.conversationStore.updateConversation(n)})).catch((function(e){console.warn(e)}))}catch(c){v.e(c)}finally{v.f()}return n.abrupt("return",{data:f});case 12:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),!m){n.next=12;break}return n.next=9,v();case 9:return h=n.sent,e.imStore.conversationStore.updateConversations(h.data),n.abrupt("return",h);case 12:return n.next=14,p;case 14:return g=n.sent,A=g.map((function(n){return(0,s.A)((0,s.A)({},n),{},{lastReadMsgSeq:String(n.lastReadMsgSeq),oppositeLastReadMsgSeq:"0",lastReceivedMsgSeq:"0",status:n.status||_.a4.NORMAL,unreadCount:0,isLoaded:!0,unsendMessageCount:0,lastUserMsg:n.lastUserMsg?B(n.lastUserMsg,e.userInfo.userUid):void 0})})),e.imStore.conversationStore.updateConversations(A),n.abrupt("return",{data:A});case 18:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}(),e.setChannelPinnedStatus=function(){var n=(0,u.A)((0,c.A)().mark((function n(t){var r,a;return(0,c.A)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r=t.channelId,a=t.pinnedStatus,(0,N.runInAction)((function(){e.imStore.conversationStore.updateConversation({channelId:r,pinnedStatus:a}),e.imStore.conversationStore.pushConversationToTop(r)})),e.syncChannelToServer({channelId:r,pinnedStatus:a});case 3:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),e.setChannelMute=function(){var n=(0,u.A)((0,c.A)().mark((function n(t){var r,a;return(0,c.A)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r=t.channelId,a=t.receiveMsgOption,e.imStore.conversationStore.updateConversation({channelId:r,receiveMsgOption:a}),e.syncChannelToServer({channelId:r,receiveMsgOption:a});case 3:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),e.syncChannelToServer=function(){var n=(0,u.A)((0,c.A)().mark((function n(t){var r,a;return(0,c.A)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(null==(r=e.driver.initConfig)?void 0:r.anonymousMode)){n.next=2;break}return n.abrupt("return",!1);case 2:return n.next=4,e.imHttp.post(x.d,t);case 4:return a=n.sent,n.abrupt("return",a);case 6:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),e.createIndividualChat=function(){var n=(0,u.A)((0,c.A)().mark((function n(t){var r,a,o,i;return(0,c.A)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.contactUid,a=t.relationSourceType,o=void 0===a?_.R.normal:a,n.next=3,e.imHttp.post(x.e,{contactUid:r,relationSourceType:o});case 3:return i=n.sent,n.abrupt("return",T(i));case 5:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),e.deleteConversations=function(){var n=(0,u.A)((0,c.A)().mark((function n(t){var r,a,o;return(0,c.A)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.channelIds,a=void 0===r?[]:r,n.next=3,e.imHttp.post(x.D,{channelIds:a});case 3:return(null==(o=n.sent)?void 0:o.success)&&(e.imStore.conversationStore.removeConversations(a),a.forEach((function(n){e.driver.quotedMsgController.clearChannelMsg(n),e.cache.deleteMessagesOfChannel(n)}))),n.abrupt("return",o);case 6:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),e.refreshConversationNewestSeq=function(){var n=(0,u.A)((0,c.A)().mark((function n(t){var r,a;return(0,c.A)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.imWS.getNewstSeqByChannelIds({channelIdList:[t]});case 2:if(r=n.sent,!(a=r.data.seqDtoList[0])){n.next=7;break}return e.imStore.conversationStore.updateConversation({channelId:t,lastReceivedMsgSeq:a.seq}),n.abrupt("return",a);case 7:return n.abrupt("return",void 0);case 8:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),e}return(0,v.A)(n,e),(0,l.A)(n)}(x.C),ce=function(e){function n(e,t){var r;return(0,d.A)(this,n),(r=ee(this,n,[e])).isEnabled=!0,r.isEnabled=!(null==t?void 0:t.anonymousMode),r}return(0,v.A)(n,e),(0,l.A)(n,[{key:"getMemberList",value:function(){var e=(0,u.A)((0,c.A)().mark((function e(n){var t,r,a;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.channelId,r=new Map,this.isEnabled){e.next=4;break}return e.abrupt("return",r);case 4:return e.next=6,this.imHttp.get(x.f,{params:{groupId:t}});case 6:return((null==(a=e.sent)?void 0:a.items)||[]).forEach((function(e){var n;r.set((null==(n=e.userInfo)?void 0:n.userUid)||e.memberUid,e)})),r.size&&this.imStore.groupStore.setMemberListMap(t,r),e.abrupt("return",r);case 10:case"end":return e.stop()}}),e,this)})));return function(n){return e.apply(this,arguments)}}()},{key:"getGroupInfo",value:function(){var e=(0,u.A)((0,c.A)().mark((function e(n){var t,r;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.channelId,this.isEnabled){e.next=3;break}return e.abrupt("return",null);case 3:return e.next=5,this.imHttp.get(x.g,{params:{groupId:t}}).catch((function(){return null}));case 5:return(r=e.sent)&&this.imStore.groupStore.setGroupInfo(t,r),e.abrupt("return",r);case 8:case"end":return e.stop()}}),e,this)})));return function(n){return e.apply(this,arguments)}}()},{key:"hideGroup",value:function(){var e=(0,u.A)((0,c.A)().mark((function e(n){return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.imStore.conversationStore.updateConversation({channelId:n,status:_.a4.HIDDEN})){e.next=3;break}return e.abrupt("return");case 3:this.driver.conversationController.syncChannelToServer({channelId:n,status:_.a4.HIDDEN});case 4:case"end":return e.stop()}}),e,this)})));return function(n){return e.apply(this,arguments)}}()},{key:"manuallyRemoveGroupMember",value:function(){var e=(0,u.A)((0,c.A)().mark((function e(n,t){var r,a,o,i,s;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=n.targetUidsList,a=this.imStore.groupStore,o=a.groupInfoMap[t],i=a.memberListMap[t],o&&(s=o.members.filter((function(e){return!r.includes(e.memberUid)})),o.memberCount>s.length&&(0,N.runInAction)((function(){o.members=s,r.forEach((function(e){null==i||i.delete(e)})),o.memberCount=i.size})));case 5:case"end":return e.stop()}}),e,this)})));return function(n,t){return e.apply(this,arguments)}}()},{key:"manuallyAddGroupMember",value:function(){var e=(0,u.A)((0,c.A)().mark((function e(n,t){var r,o,i,s,u,l,d,m,f,p,v,h;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.targetUidsList,o=n.userInfoList,i=n.actingUid,p=null==(l=null==(u=null==(s=this.driver.imStore)?void 0:s.groupStore)?void 0:u.groupInfoMap)?void 0:l[t],v=null==(f=null==(m=null==(d=this.driver.imStore)?void 0:d.groupStore)?void 0:m.memberListMap)?void 0:f[t],p&&v){e.next=5;break}return e.abrupt("return");case 5:(null==(h=r.map((function(e){var n=o.find((function(n){return n.userUid===e}));return{groupId:t,memberUid:null==n?void 0:n.userUid,inviterUid:i,role:K.G.NORMAL,memberAlias:null==n?void 0:n.alias,memberStatus:K.b.NORMAL,userInfo:n}})).filter((function(e){var n;return r.includes(null!==(n=null==e?void 0:e.memberUid)&&void 0!==n?n:"")})))?void 0:h.length)&&(0,N.runInAction)((function(){var e;h.forEach((function(e){var n;null==v||v.set(null!==(n=e.memberUid)&&void 0!==n?n:"",e)})),(e=p.members).push.apply(e,(0,a.A)(h)),p.memberCount=v.size}));case 7:case"end":return e.stop()}}),e,this)})));return function(n,t){return e.apply(this,arguments)}}()}])}(x.C);function ue(e,n){var t,r,a,o=B(e,n.userInfo.userUid).isSender,i=n.imHttp.deviceId,s=[_.Y.TEXT_MESSAGE,_.Y.PICTURE_MESSAGE,_.Y.VOICE_MESSAGE,_.Y.VOICE_CALL_MESSAGE,_.Y.QUOTE_MESSAGE,_.Y.CUSTOM_MESSAGE,_.Y.VIDEO_MESSAGE,_.Y.MEDIA_MESSAGE].includes(null!==(t=null==e?void 0:e.contentType)&&void 0!==t?t:""),c=null==(a=null==(r=null==e?void 0:e.extra)?void 0:r.tempId)?void 0:a.includes(i);return s&&o&&c}function le(e,n){e&&(e.contentType!==_.Y.RECEIPT_MESSAGE?e.contentType!==_.Y.RECALL_MESSAGE&&e.contentType!==_.Y.RECALL_MESSAGE_BY_ADMIN?e.contentType!==_.Y.SYSTEM_MESSAGE?e.contentType!==_.Y.VOICE_CALL_MESSAGE?n.ON_RECV_NEW_MESSAGE.push(e):n.ON_RECV_VOICE_CALL_MESSAGE.push(e):n.ON_RECV_SYSTEM_MESSAGE.push(e):n.ON_RECV_C2C_RECALL_MESSAGE.push(e):n.ON_RECV_C2C_READ_RECEIPT.push(e))}var de=function(e){function n(){var e;return(0,d.A)(this,n),(e=ee(this,n,arguments)).shouldReceiveMessages=!0,e.handleNewMessageReception=function(){e.emitter.on(b.C.ON_RECV_NEW_MESSAGE,function(){var n=(0,u.A)((0,c.A)().mark((function n(t){var r,a,o,i,s,u;return(0,c.A)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a=t.data,o=null==(r=a[0])?void 0:r.channelId,null==(i=e.imStore.conversationStore.conversationMap[o])?void 0:i.isLoaded){n.next=7;break}return n.next=6,e.driver.conversationController.getConversationList({channelIds:[o]});case 6:i=e.imStore.conversationStore.conversationMap[o];case 7:if(!i||!1!==e.driver.conversationController.conversationFilter(i)){n.next=9;break}return n.abrupt("return");case 9:if(s=a.filter((function(n){return!(0,A.s)(n,e.driver.messageFilters)&&!(0,A.i)(n)})).map((function(n){return n.visible=!0,e.driver.quotedMsgController.processNewMsg(n,i)})),e.cache.writeMessages(a),u=(0,A.p)({myUid:e.userInfo.userUid,channel:e.imStore.conversationStore.conversationMap[o],newMsgList:s,shouldCountAsUnread:e.driver.conversationController.shouldCountAsUnread}),e.imStore.conversationStore.activeConversationId===o&&e.imStore.messageStore.pushNewMessages(s),u){n.next=15;break}return n.abrupt("return");case 15:(0,N.runInAction)((function(){e.imStore.conversationStore.updateConversation(u),e.imStore.conversationStore.pushConversationToTop(u.channelId)})),e.driver.notificationController.notifyNewMessage(s);case 17:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())},e.handleSystemMessageReception=function(){e.emitter.on(b.C.ON_RECV_SYSTEM_MESSAGE,function(){var n=(0,u.A)((0,c.A)().mark((function n(t){var r,a,o,i,s,u;return(0,c.A)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a=t.data,e.cache.writeMessages(a),o=null==(r=a[0])?void 0:r.channelId,null==(i=e.imStore.conversationStore.conversationMap[o])?void 0:i.isLoaded){n.next=8;break}return n.next=7,e.driver.conversationController.getConversationList({channelIds:[o]});case 7:i=e.imStore.conversationStore.conversationMap[o];case 8:if(!i||!1!==e.driver.conversationController.conversationFilter(i)){n.next=10;break}return n.abrupt("return");case 10:return n.next=12,e.updateDataFromSystemMessage(a,o);case 12:if(s=n.sent,e.imStore.conversationStore.activeConversationId===o&&(e.driver.messageFilters[_.Y.SYSTEM_MESSAGE]&&(s=s.filter(e.driver.messageFilters[_.Y.SYSTEM_MESSAGE])),s=s.filter((function(e){var n;return!_.a5.includes(null==(n=e.systemMessage)?void 0:n.systemAction)})),e.imStore.messageStore.pushNewMessages(s)),!s.length){n.next=19;break}if(u=(0,A.p)({myUid:e.userInfo.userUid,channel:e.imStore.conversationStore.conversationMap[o],newMsgList:s,shouldCountAsUnread:e.driver.conversationController.shouldCountAsUnread})){n.next=18;break}return n.abrupt("return");case 18:(0,N.runInAction)((function(){e.imStore.conversationStore.updateConversation(u),e.imStore.conversationStore.pushConversationToTop(u.channelId)}));case 19:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())},e.handleReceiptMessageReception=function(){e.emitter.on(b.C.ON_RECV_C2C_READ_RECEIPT,(function(n){var t,r,a=n.data,i=null==(t=null==a?void 0:a[0])?void 0:t.channelId,s=e.imStore.conversationStore.conversationMap[i];if(null==s?void 0:s.isLoaded){var c,u=Number(s.oppositeLastReadMsgSeq),l=Number(s.lastReadMsgSeq),d=(0,o.A)(a);try{for(d.s();!(c=d.n()).done;){var m=c.value,f=Number(null==(r=m.readReceiptMessage)?void 0:r.lastMsgSeq)||0;m.isSender&&f>l?l=f:!m.isSender&&f>u&&(u=f)}}catch(p){d.e(p)}finally{d.f()}u>Number(s.oppositeLastReadMsgSeq)&&e.imStore.conversationStore.updateConversation({channelId:i,oppositeLastReadMsgSeq:String(u)}),l>Number(s.lastReadMsgSeq)&&(e.imStore.conversationStore.updateConversation({channelId:i,lastReadMsgSeq:String(l)}),e.driver.conversationController.getUnreadCountUpdates(e.imStore.conversationStore.conversationMap[i]).then((function(n){e.imStore.conversationStore.updateConversation(n)})).catch(console.warn))}}))},e.createMessagePatchesFromRecallList=function(n,t){var r,a,i,c,u=[],l=(0,o.A)(t);try{for(l.s();!(c=l.n()).done;){var d=c.value,m=d.contentType===_.Y.RECALL_MESSAGE_BY_ADMIN?Number(d.adminRecallMessage.msgSeq):Number(d.senderRecallMessage.msgSeq),f=d.contentType===_.Y.RECALL_MESSAGE_BY_ADMIN?_.Y.MESSAGE_RECALLED_BY_ADMIN:_.Y.MESSAGE_RECALLED,p={seq:m,contentType:f,textMessage:null,imageMessage:null,videoMessage:null,voiceMessage:null,quotedMessage:null,status:d.contentType===_.Y.RECALL_MESSAGE_BY_ADMIN?_.a6.ADMIN_RECALLED:_.a6.SENDER_RECALLED};e.driver.messageFilters[f]&&!(null==(a=(r=e.driver.messageFilters)[f])?void 0:a.call(r,p))&&(p.visible=!1);var v,h=e.driver.quotedMsgController.getLinksTo(n,m)||[],g=(0,o.A)(h);try{for(g.s();!(v=g.n()).done;){var A=v.value;u.push({seq:A,quotedMessage:(0,s.A)((0,s.A)({},p),{},{seq:m})})}}catch(b){g.e(b)}finally{g.f()}var E=e.imStore.messageInputStore.getDraft(n);(null==(i=E.quotedMsg)?void 0:i.seq)===m&&e.imStore.messageInputStore.updateDraft(n,{quotedMsg:(0,s.A)((0,s.A)({},E.quotedMsg),p)}),e.driver.quotedMsgController.removeLinksFrom(n,m),u.push(p)}}catch(b){l.e(b)}finally{l.f()}return u},e.updateStoresFromMessagePatches=function(n,t){var r,a,i=null==(r=e.imStore.conversationStore.conversationMap[n])?void 0:r.lastUserMsg,c=e.imStore.conversationStore.activeConversationId===n,u=(0,o.A)(t);try{for(u.s();!(a=u.n()).done;){var l=a.value;i&&+(null==i?void 0:i.seq)===l.seq&&e.imStore.conversationStore.updateConversation({channelId:n,lastUserMsg:(0,s.A)((0,s.A)({},i),l)}),c&&l.quotedMessage&&e.imStore.messageStore.patchQuoteMessage(l.seq,l.quotedMessage),c&&!l.quotedMessage&&e.imStore.messageStore.patchMessage(l)}}catch(d){u.e(d)}finally{u.f()}},e.handleRecallMessageReception=function(){e.emitter.on(b.C.ON_RECV_C2C_RECALL_MESSAGE,function(){var n=(0,u.A)((0,c.A)().mark((function n(t){var r,a,o,i,u;return(0,c.A)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a=t.data,o=null==(r=a[0])?void 0:r.channelId,null==(i=e.imStore.conversationStore.conversationMap[o])?void 0:i.isLoaded){n.next=5;break}return n.abrupt("return");case 5:u=e.createMessagePatchesFromRecallList(o,a),e.updateStoresFromMessagePatches(o,u),e.cache.fetchMessages(u.map((function(e){return e.seq})),o).then((function(n){if(n.length){var t=n.map((function(e){var n=u.find((function(n){return n.seq===e.seq}));return(0,s.A)((0,s.A)((0,s.A)({},e),n),{},{quotedMessage:(null==n?void 0:n.quotedMessage)?(0,s.A)((0,s.A)({},null==e?void 0:e.quotedMessage),n.quotedMessage):e.quotedMessage})}));return e.cache.writeMessages(t)}})).catch((function(e){console.error("handleRecallMessageReception error",e)}));case 8:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())},e.registReconnectEvent=function(){e.imWS.addEventListener(E.C.Reconnect,(0,u.A)((0,c.A)().mark((function n(){var t,r,a,o,i,s;return(0,c.A)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(null==(t=e.driver.initConfig)?void 0:t.anonymousMode)){n.next=4;break}return setTimeout((function(){e.imStore.conversationStore.activeConversationId&&e.driver.conversationController.refreshConversationNewestSeq(e.imStore.conversationStore.activeConversationId)})),e.emitter.emit(b.C.ON_RECONNECT,{success:!0}),n.abrupt("return");case 4:if(n.prev=4,0!==(r=new Set(e.imStore.conversationStore.conversationList.map((function(e){return e.channelId})))).size){n.next=8;break}return n.abrupt("return");case 8:return n.next=10,e.driver.conversationController.fetchAllSimplifiedChannels();case 10:for(a=n.sent,o=a.map((function(n){var t=n.channelId;return r.has(t)?e.imStore.conversationStore.conversationMap[t]:n})),i=[],a.some((function(e){return!r.size||(i.push(e.channelId),r.delete(e.channelId),!1)})),e.imStore.conversationStore.setConversationList(o),s=[];i.length;)s.push(e.driver.conversationController.getConversationList({channelIds:i.splice(0,200)}));return n.next=19,Promise.all(s).catch((function(e){return console.error("onReconnect error",e),null}));case 19:e.emitter.emit(b.C.ON_RECONNECT,{success:!0}),n.next=25;break;case 22:n.prev=22,n.t0=n.catch(4),e.emitter.emit(b.C.ON_RECONNECT,{success:!1,reason:"error_refetch_channel_details"});case 25:case"end":return n.stop()}}),n,null,[[4,22]])}))))},e.updateDataFromSystemMessage=function(){var n=(0,u.A)((0,c.A)().mark((function n(t,r){var a,o,i;return(0,c.A)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o={needReloadGroupInfo:!1,needReloadGroupMemberList:!1,needEmitAnnouncementEvent:!1,needReloadChannelInfo:!1,isKicked:!1},i={isActiveChannel:e.imStore.conversationStore.activeConversationId===r,isLoadedChannel:Boolean(null==(a=e.imStore.conversationStore.conversationMap[r])?void 0:a.isLoaded),userUid:e.userInfo.userUid,fetchContactInfoList:[],finalSystemMessageList:[]},t.forEach((function(n){e.handleSingleSystemMessage(n,r,o,i)})),n.next=5,e.handlePostMessageUpdates(r,o,i);case 5:return n.abrupt("return",i.finalSystemMessageList);case 6:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}(),e.broadcastNewMessagesReceived=(0,u.A)((0,c.A)().mark((function n(){var t,r,a,o,i,s=arguments;return(0,c.A)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t=s.length>0&&void 0!==s[0]?s[0]:[],r=s.length>1?s[1]:void 0,e.shouldReceiveMessages){n.next=4;break}return n.abrupt("return");case 4:if(t.length){n.next=6;break}return n.abrupt("return");case 6:a=r||t[0].data.messageList[0].channelId,o=e.imStore.conversationStore.conversationMap[a],i={ON_RECV_C2C_READ_RECEIPT:[],ON_RECV_C2C_RECALL_MESSAGE:[],ON_RECV_NEW_MESSAGE:[],ON_RECV_SYSTEM_MESSAGE:[],ON_RECV_VOICE_CALL_MESSAGE:[]},t.forEach((function(n){n.data.messageList.forEach((function(n){var t,r,a;ue(n,e.driver)&&(0,_.V)("IMChatMessagePushAckSuccess",{group_type:null!==(a=null==(t=null==o?void 0:o.groupInfo)?void 0:t.type)&&void 0!==a?a:null,chat_name:(0,_.h)(null==o?void 0:o.entityInfo,e.imStore.userRegistryStore),channel_type:null==n?void 0:n.channelType,channel_id:null==n?void 0:n.channelId,message_type:null==n?void 0:n.contentType,timestamp:Date.now(),message_id:null==(r=null==n?void 0:n.extra)?void 0:r.tempId});return n.loading=!1,le(B(n,e.userInfo.userUid),i)}))})),Object.keys(i).forEach((function(n){i[n].length&&e.emitter.emit(b.C[n],i[n])}));case 11:case"end":return n.stop()}}),n)}))),e}return(0,v.A)(n,e),(0,l.A)(n,[{key:"init",value:function(){this.handleNewMessageReception(),this.handleSystemMessageReception(),this.handleReceiptMessageReception(),this.handleRecallMessageReception(),this.registReconnectEvent()}},{key:"stopReceivingMessages",value:function(){this.shouldReceiveMessages=!1}},{key:"handleSingleSystemMessage",value:function(e,n,t,r){var a=e.systemMessage.actingUid,o=e.systemMessage.systemAction,i=(0,A.g)(o),s=a===r.userUid;switch(e.seq>0&&(e.visible=!0,r.finalSystemMessageList.push(e)),i){case"refreshConversation":return void this.driver.conversationController.updateConversationFromOtherDevice(e);case"groupAnnouncement":r.isActiveChannel&&(t.needEmitAnnouncementEvent=!0);break;case"groupSetting":t.needReloadGroupInfo=!0;break;case"groupMember":this.handleAddGroupMember({message:e,channelId:n,flags:t,context:r,isMe:s});break;case"groupMember+5":this.handleAddGroupMemberPlus({message:e,channelId:n,flags:t,context:r});break;case"removeGroupMember":this.handleRemoveGroupMember({message:e,channelId:n,flags:t,context:r});break;case"removeGroupMember+5":this.handleRemoveGroupMemberPlus({message:e,channelId:n,flags:t,context:r});break;case"groupAdmin":this.handleGroupAdmin({message:e,channelId:n,flags:t,context:r});break;case"groupOwnership":this.handleGroupOwnership({message:e,channelId:n,flags:t,context:r});break;case"contact":this.handleContact({message:e,flags:t,context:r});break;case"disbandGroup":s||(t.needReloadChannelInfo=!0);break;case"groupInfo":t.needReloadGroupInfo=!0,t.needReloadChannelInfo=!0}}},{key:"handlePostMessageUpdates",value:function(){var e=(0,u.A)((0,c.A)().mark((function e(n,t,r){var a,o,i=this;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=r.fetchContactInfoList,!t.needReloadChannelInfo){e.next=4;break}return e.next=4,this.driver.conversationController.getConversationList({channelIds:[n]});case 4:if(t.needEmitAnnouncementEvent&&this.emitter.emit(b.C.ON_ANNOUNCEMENT_CHANGED,{channelId:n}),!t.needReloadGroupInfo){e.next=8;break}return e.next=8,this.driver.groupController.getGroupInfo({channelId:n});case 8:if(!t.needReloadGroupMemberList){e.next=11;break}return e.next=11,this.driver.groupController.getMemberList({channelId:n});case 11:if(!t.isKicked){e.next=14;break}return e.next=14,this.driver.conversationController.getConversationList({channelIds:[n]});case 14:if(!a.length){e.next=18;break}return o=a.map((function(e){return i.driver.contactController.getContactInfo({contactUid:e})})),e.next=18,Promise.allSettled(o);case 18:case"end":return e.stop()}}),e,this)})));return function(n,t,r){return e.apply(this,arguments)}}()},{key:"handleAddGroupMember",value:function(e){var n=e.message,t=e.channelId,r=e.flags,a=e.context,o=e.isMe;a.isLoadedChannel&&(n.systemMessage.systemAction===_.a7.MEMBER_QUIT_GROUP&&o||(n.systemMessage.targetUidsList.includes(a.userUid)&&(r.needReloadChannelInfo=!0),this.driver.groupController.manuallyAddGroupMember(n.systemMessage,t)))}},{key:"handleAddGroupMemberPlus",value:function(e){var n=e.message,t=e.flags,r=e.context;r.isLoadedChannel&&(n.systemMessage.targetUidsList.includes(r.userUid)&&(t.needReloadChannelInfo=!0),n.systemMessage.systemAction===_.a7.ADD_GROUP_ADMIN_MORE_THAN_5&&(t.needReloadGroupInfo=!0,t.needReloadGroupMemberList=!0))}},{key:"handleRemoveGroupMember",value:function(e){var n=e.message,t=e.channelId,r=e.flags,a=e.context;n.systemMessage.targetUidsList.includes(a.userUid)?r.isKicked=!0:a.isLoadedChannel&&this.driver.groupController.manuallyRemoveGroupMember(n.systemMessage,t)}},{key:"handleRemoveGroupMemberPlus",value:function(e){var n=e.message,t=e.flags,r=e.context;n.systemMessage.targetUidsList.includes(r.userUid)?t.isKicked=!0:r.isLoadedChannel&&(t.needReloadGroupInfo=!0,t.needReloadGroupMemberList=!0)}},{key:"handleGroupAdmin",value:function(e){var n=e.message,t=e.flags,r=e.context,a=n.systemMessage.targetUidsList;r.isLoadedChannel&&(a.includes(r.userUid)&&(t.needReloadChannelInfo=!0),t.needReloadGroupInfo=!0,t.needReloadGroupMemberList=!0)}},{key:"handleGroupOwnership",value:function(e){var n=e.message,t=e.flags,r=e.context,a=n.systemMessage,o=a.targetUidsList,i=a.actingUid;(o.includes(r.userUid)||i===r.userUid)&&(t.needReloadChannelInfo=!0),t.needReloadGroupInfo=!0,t.needReloadGroupMemberList=!0}},{key:"handleContact",value:function(e){var n=e.message,t=e.context,r=n.systemMessage,a=r.targetUidsList,o=r.actingUid;(a.includes(t.userUid)||o===t.userUid)&&t.fetchContactInfoList.push(o)}}])}(x.C);function me(e,n,t){return fe.apply(this,arguments)}function fe(){return(fe=(0,u.A)((0,c.A)().mark((function e(n,t,r){var a,o;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=(0,X.g)(n,r),o="".concat(n.channelId,"-").concat(n.seq),(0,A.b)((0,_.i)(t),a,o);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var pe=function(e){function n(){var e;return(0,d.A)(this,n),(e=ee(this,n,arguments)).defaultHandleNotificationSound=function(){var n=(0,u.A)((0,c.A)().mark((function n(t){var r,a,o;return(0,c.A)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a=t[t.length-1]){n.next=3;break}return n.abrupt("return");case 3:if(!(a.contentType===_.Y.SYSTEM_MESSAGE||a.isSender||"visible"===document.visibilityState&&a.channelId===e.imStore.conversationStore.activeConversationId)){n.next=5;break}return n.abrupt("return");case 5:if(o=e.imStore.conversationStore.conversationMap[a.channelId]){n.next=8;break}return n.abrupt("return");case 8:if(o.receiveMsgOption!==_.a8.RECEIVE_SILENTLY||(null==(r=null==a?void 0:a.textMessage)?void 0:r.atType)===_.M.AT_ALL){n.next=11;break}return n.abrupt("return");case 11:(0,A.a)(ne);case 12:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),e.defaultHandleNotificationCard=function(){var n=(0,u.A)((0,c.A)().mark((function n(t){var r,a,o;return(0,c.A)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a=t[t.length-1]){n.next=3;break}return n.abrupt("return");case 3:if(!(a.contentType===_.Y.SYSTEM_MESSAGE||a.isSender||"visible"===document.visibilityState&&a.channelId===e.imStore.conversationStore.activeConversationId)){n.next=5;break}return n.abrupt("return");case 5:if(o=e.imStore.conversationStore.conversationMap[a.channelId]){n.next=8;break}return n.abrupt("return");case 8:if(o.receiveMsgOption!==_.a8.RECEIVE_SILENTLY||(null==(r=null==a?void 0:a.textMessage)?void 0:r.atType)===_.M.AT_ALL){n.next=11;break}return n.abrupt("return");case 11:me(a,o.entityInfo,e.imStore);case 12:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),e.notifyNewMessage=function(){var n=(0,u.A)((0,c.A)().mark((function n(t){var r,a;return(0,c.A)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:(null==(r=e.notificationHandler)?void 0:r.sound)?e.notificationHandler.sound(t,e.defaultHandleNotificationSound):e.defaultHandleNotificationSound(t),(null==(a=e.notificationHandler)?void 0:a.card)?e.notificationHandler.card(t,e.defaultHandleNotificationCard):e.defaultHandleNotificationCard(t);case 2:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),e}return(0,v.A)(n,e),(0,l.A)(n,[{key:"setNotificationHandler",value:function(e){this.notificationHandler=e}}])}(x.C),ve=function(e){function n(e){var t;return(0,d.A)(this,n),(t=ee(this,n,[e])).clearChannelMsg=function(){var e=(0,u.A)((0,c.A)().mark((function e(n){return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.cachedLinks.delete(n);case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),t.cachedLinks=new Map,t}return(0,v.A)(n,e),(0,l.A)(n,[{key:"init",value:function(){var e=(0,u.A)((0,c.A)().mark((function e(){var n=this;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.cachedLinks=new Map,e.abrupt("return",this.cache.getAllLinks().then((function(e){e.forEach((function(e){n.addLinks(e.channelId,e.seq,e.refSeq)}))})).catch((function(){})));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"addLinks",value:function(e,n,t){var r;this.cachedLinks.has(e)||this.cachedLinks.set(e,new Map);var a=this.cachedLinks.get(e);(null==a?void 0:a.has(n))||null==a||a.set(n,new Set),null==(r=null==a?void 0:a.get(n))||r.add(t)}},{key:"getLinksTo",value:function(e,n){var t;return null==(t=this.cachedLinks.get(e))?void 0:t.get(n)}},{key:"removeLinksFrom",value:function(e,n){var t=this.cachedLinks.get(e);if(t){var r,a=(0,o.A)(t);try{for(a.s();!(r=a.n()).done;){var s=(0,i.A)(r.value,2),c=s[0],u=s[1];if(u.has(n))return u.delete(n),void this.cache.removeLink({channelId:e,seq:c,refSeq:n})}}catch(l){a.e(l)}finally{a.f()}}}},{key:"processNewMsg",value:function(e,n){var t;if(!(null==e?void 0:e.quotedMessage))return e;var r=n||this.imStore.conversationStore.conversationMap[e.channelId];if(!r)return e;var a=Number(null==(t=e.quotedMessage)?void 0:t.seq);return a<Number(null==r?void 0:r.startMsgSeq)?(0,s.A)((0,s.A)({},e),{},{quotedMessage:null}):(this.addLinks(r.channelId,a,Number(e.seq)),this.cache.addLinkedMessage({channelId:r.channelId,seq:a,refSeq:Number(e.seq)}),e)}}])}(x.C);function he(e){return(0,s.A)((0,s.A)({},e),{},{message:(0,s.A)((0,s.A)({},e.message),{},{quotedMessage:null,senderUid:null,seq:null})})}function ge(e,n){return(0,s.A)((0,s.A)({},e),{},{quotedMessage:e.quotedMessage||n.quotedMessage,senderUid:e.senderUid||n.senderUid,seq:e.seq||n.seq})}var _e=function(e){function n(){var e;return(0,d.A)(this,n),(e=ee(this,n,arguments)).sendTimeout=5e3,e.sendMessageTimers={},e.messageSendTransformer=null,e.getUploadApiUrl=function(){var n,t,r;return null!==(n=null==(r=null==(t=e.imConfig)?void 0:t.customApiOverrides)?void 0:r.upload)&&void 0!==n?n:x.S},e.setSendMessageTransformer=function(n){e.messageSendTransformer=n},e.uploadFile=function(){var n=(0,u.A)((0,c.A)().mark((function n(t){var r,a,o,i,s,u=arguments;return(0,c.A)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:for(r=u.length>1&&void 0!==u[1]?u[1]:{},a=u.length>2&&void 0!==u[2]?u[2]:e.getUploadApiUrl(),o=new FormData,i=Object.keys(r),o.append("file",t),s=0;s<i.length;s++)o.append(i[s],r[i[s]]);return n.abrupt("return",e.imHttp.post(a,o,{skipErrorAlert:!0,timeout:6e4}));case 7:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),e.resendMessage=function(){var n=(0,u.A)((0,c.A)().mark((function n(t){var r,a;return(0,c.A)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r=t.channelId,a=t.tempMessage,e.sendMessage({channelId:r,tempMessage:a,isResend:!0});case 2:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),e.sendMessage=function(){var n=(0,u.A)((0,c.A)().mark((function n(t){var r,a,o,i,u,l;return(0,c.A)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,a={},t.isResend){n.next=8;break}return n.next=5,e.formatTempMessage(t);case 5:a=n.sent,n.next=9;break;case 8:a={message:(0,s.A)((0,s.A)({},t.tempMessage),{},{loading:!0}),channelId:t.channelId};case 9:return e.messageSendTransformer&&(a.message=e.messageSendTransformer(a.message)),o=a.message.extra.tempId,e.sendMessageTimers[o]&&(window.clearTimeout(e.sendMessageTimers[o]),delete e.sendMessageTimers[o]),e.sendMessageTimers[o]=window.setTimeout((function(){e.imStore.messageStore.updateMessage((0,s.A)((0,s.A)({},a.message),{},{loading:!1,needResend:!0})),delete e.sendMessageTimers[o]}),e.sendTimeout),e.imStore.conversationStore.activeConversationId===a.channelId&&(t.isResend?e.imStore.messageStore.updateMessage(a.message):e.imStore.messageStore.pushLocalMessage(a.message)),n.next=16,e.sendMessageWithTrack(a);case 16:return(i=n.sent).data.message.visible=!0,window.clearTimeout(e.sendMessageTimers[i.data.message.extra.tempId]),u=B(i.data.message,e.userInfo.userUid),e.imStore.messageStore.updateMessage(u),e.imStore.conversationStore.activeConversationId===a.channelId&&Number(null==u?void 0:u.seq)>(null==(r=e.imStore.messageStore)?void 0:r.loadedLatestMsgSeq)&&e.imStore.messageStore.setLoadedLatestMsgSeq(Number(u.seq)),delete e.sendMessageTimers[o],n.abrupt("return",{success:!0,data:i.data});case 26:return n.prev=26,n.t0=n.catch(0),l=n.t0,_.L.error("Failed to send message. ".concat((null==l?void 0:l.status)||(null==l?void 0:l.message)||""),{errorName:"SendMessageFailed - ".concat(t.contentType),error:l,data:{channelId:t.channelId,contentType:t.contentType,isResend:t.isResend},tags:{feErrorType:"UserAction",feCallOrigin:"sendMessage"}}),n.abrupt("return",{success:!1});case 31:case"end":return n.stop()}}),n,null,[[0,26]])})));return function(e){return n.apply(this,arguments)}}(),e.formatTempMessage=function(){var n=(0,u.A)((0,c.A)().mark((function n(t){var r,a,o,i,s,u,l,d,m,f,p,v;return(0,c.A)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=t.channelId,o=t.contentType,i=t.messageContent,s=t.quotedMessage,u=e.imStore.conversationStore.conversationMap[a],l=null!==(r=u.channelType)&&void 0!==r?r:_.C.PRIVATE,d=u.lastReceivedMsgSeq||1,m=e.imStore.conversationStore.incrementUnsendCount(a),n.next=7,z({channelId:a,contentType:o,messageContent:i,seq:(Number(d)||1)+.001*m,quotedMessage:s},e.driver,l,e.uploadFile);case 7:return f=n.sent,(p=f.tempMessage).visible=!0,v={message:p,channelId:a},n.abrupt("return",v);case 12:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),e.getChannelTypeById=function(n){var t=e.imStore.conversationStore.conversationMap[n];return t?t.channelType:_.C.PRIVATE},e.sendMessageReceipt=function(){var n=(0,u.A)((0,c.A)().mark((function n(t){var r,a,o,i,s,u;return(0,c.A)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=t.channelId,a=t.lastReadMsgSeq,o=e.userInfo.userUid,i=e.getChannelTypeById(r),(s=(0,L.a)({channelId:r,seq:a},o,i)).channelType!==_.C.GROUP){n.next=6;break}return n.abrupt("return");case 6:u={channelId:r,message:s},e.sendMessageWithTrack(u);case 8:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),e.recallMessage=function(){var n=(0,u.A)((0,c.A)().mark((function n(t){var r,a,o,i,s,u,l,d;return(0,c.A)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r=t.channelId,a=t.seq,o=t.adminRecallOthersMessage,i=void 0!==o&&o,s=e.userInfo.userUid,u=e.getChannelTypeById(r),l=(0,L.b)({seq:String(a),channelId:r},s,u),i&&(l=(0,L.d)({seq:String(a),channelId:r},s,u)),e.messageSendTransformer&&(l=e.messageSendTransformer(l)),d={channelId:r,message:l},e.sendMessageWithTrack(d);case 8:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),e}return(0,v.A)(n,e),(0,l.A)(n,[{key:"sendMessageWithTrack",value:function(){var e=(0,u.A)((0,c.A)().mark((function e(n){var t,r,a,o,i,s,u,l,d,m,f;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ue(l=n.message,this.driver)){e.next=7;break}return e.next=4,this.imWS.sendMessage(he(n));case 4:return d=e.sent,(null==(a=null==d?void 0:d.data)?void 0:a.message)&&(d.data.message=ge(d.data.message,l)),e.abrupt("return",d);case 7:return m=this.imStore.conversationStore.activeConversation,(0,_.V)("IMChatMessageSendClick",{group_type:null!==(t=null==(o=null==m?void 0:m.groupInfo)?void 0:o.type)&&void 0!==t?t:null,channel_type:null==m?void 0:m.channelType,chat_name:(0,_.h)(null==m?void 0:m.entityInfo,this.imStore.userRegistryStore),channel_id:null==m?void 0:m.channelId,message_type:l.contentType,timestamp:Date.now(),message_id:null==(i=null==l?void 0:l.extra)?void 0:i.tempId}),e.next=11,this.imWS.sendMessage(he(n));case 11:return(f=e.sent).data.message&&(f.data.message=ge(f.data.message,l)),(0,_.V)("IMChatMessageSentAckSuccess",{group_type:null!==(r=null==(s=null==m?void 0:m.groupInfo)?void 0:s.type)&&void 0!==r?r:null,channel_type:null==m?void 0:m.channelType,chat_name:(0,_.h)(null==m?void 0:m.entityInfo,this.imStore.userRegistryStore),channel_id:null==m?void 0:m.channelId,message_type:l.contentType,timestamp:Date.now(),message_id:null==(u=null==l?void 0:l.extra)?void 0:u.tempId}),e.abrupt("return",f);case 15:case"end":return e.stop()}}),e,this)})));return function(n){return e.apply(this,arguments)}}()}])}(x.C),Ae=function(){return(0,l.A)((function e(){(0,d.A)(this,e),this.isIndexedDbEnabled=!0,this.isIndexedDbEnabled="indexedDB"in window,_.L.setGlobalTag("indexedDb",this.isIndexedDbEnabled)}),[{key:"init",value:function(){var e=(0,u.A)((0,c.A)().mark((function e(n){var t,r;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isIndexedDbEnabled){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,this.cleanOtherUserDb(n),this.db=new y.Ay("IM-DB-v2-".concat(n)),e.next=7,this.db.openStore("messages",{keyPath:["channelId","seq"]});case 7:return t=e.sent,e.next=10,t.get("fake_index");case 10:return this.messagesStore=t,e.next=13,this.db.openStore("message_links",{keyPath:["channelId","seq","refSeq"]});case 13:return r=e.sent,e.next=16,r.get("fake_index");case 16:this.messageLinkStore=r,e.next=24;break;case 19:e.prev=19,e.t0=e.catch(2),this.isIndexedDbEnabled=!1,_.L.setGlobalTag("indexedDb",!1),_.L.error("Error initializing cache manager",{error:e.t0,tags:{feErrorType:"ImClient"}});case 24:case"end":return e.stop()}}),e,this,[[2,19]])})));return function(n){return e.apply(this,arguments)}}()},{key:"writeMessages",value:function(){var e=(0,u.A)((0,c.A)().mark((function e(n){var t,r,a;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isIndexedDbEnabled){e.next=2;break}return e.abrupt("return");case 2:t=(0,o.A)(n);try{for(t.s();!(r=t.n()).done;)a=r.value,this.messagesStore.set((0,s.A)((0,s.A)({},a),{},{seq:Number(a.seq)}))}catch(i){t.e(i)}finally{t.f()}case 4:case"end":return e.stop()}}),e,this)})));return function(n){return e.apply(this,arguments)}}()},{key:"fetchMessages",value:function(){var e=(0,u.A)((0,c.A)().mark((function e(n,t){var r,a,o;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isIndexedDbEnabled){e.next=2;break}return e.abrupt("return",[]);case 2:if(n.length){e.next=4;break}return e.abrupt("return",[]);case 4:return r=n.map(Number).sort((function(e,n){return e-n})),a=IDBKeyRange.bound([t,r[0]],[t,r[r.length-1]]),e.next=8,this.messagesStore.getAll(a);case 8:return o=e.sent,e.abrupt("return",o.filter((function(e){return r.includes(Number(e.seq))})));case 10:case"end":return e.stop()}}),e,this)})));return function(n,t){return e.apply(this,arguments)}}()},{key:"withMessageCache",value:function(e){var n=this,t=e.channelId,r=e.seqList,a=e.fetchFn;return function(){var e=(0,u.A)((0,c.A)().mark((function e(o){var i;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.fetchMessages(r,t);case 2:if((i=e.sent).length!==r.length){e.next=5;break}return e.abrupt("return",i);case 5:return e.abrupt("return",a(o).then((function(e){return n.writeMessages(e),e})).catch((function(e){return console.error(e),i})));case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()}},{key:"addLinkedMessage",value:function(){var e=(0,u.A)((0,c.A)().mark((function e(n){return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isIndexedDbEnabled){e.next=2;break}return e.abrupt("return");case 2:this.messageLinkStore.set((0,s.A)({},n));case 3:case"end":return e.stop()}}),e,this)})));return function(n){return e.apply(this,arguments)}}()},{key:"getAllLinks",value:function(){var e=(0,u.A)((0,c.A)().mark((function e(){return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isIndexedDbEnabled){e.next=2;break}return e.abrupt("return",[]);case 2:return e.abrupt("return",this.messageLinkStore.getAll());case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"removeLink",value:function(){var e=(0,u.A)((0,c.A)().mark((function e(n){return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isIndexedDbEnabled){e.next=2;break}return e.abrupt("return");case 2:this.messageLinkStore.delete([n.channelId,n.seq,n.refSeq]);case 3:case"end":return e.stop()}}),e,this)})));return function(n){return e.apply(this,arguments)}}()},{key:"deleteMessagesOfChannel",value:function(){var e=(0,u.A)((0,c.A)().mark((function e(n){return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isIndexedDbEnabled){e.next=2;break}return e.abrupt("return");case 2:this.messagesStore.delete(IDBKeyRange.bound([n,0],[n,Number.MAX_SAFE_INTEGER])),this.messageLinkStore.delete(IDBKeyRange.bound([n,0,0],[n,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER]));case 4:case"end":return e.stop()}}),e,this)})));return function(n){return e.apply(this,arguments)}}()},{key:"cleanOtherUserDb",value:function(){var e=(0,u.A)((0,c.A)().mark((function e(n){return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isIndexedDbEnabled&&indexedDB.databases&&indexedDB.deleteDatabase){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,indexedDB.databases();case 4:e.sent.filter((function(e){var t,r=e.name;if(!r)return!1;var a=null!==(t=null==r?void 0:r.toUpperCase())&&void 0!==t?t:"";return-1!==a.indexOf("IM-DB-V2-")&&-1===a.indexOf("IM-DB-V2-".concat(n))})).forEach((function(e){(null==e?void 0:e.name)&&indexedDB.deleteDatabase(e.name)}));case 6:case"end":return e.stop()}}),e,this)})));return function(n){return e.apply(this,arguments)}}()}])}(),Ee=[x.h,x.i];function be(e,n){var t=e.status,r=e.data;if((200===t||304===t)&&0===(null==r?void 0:r.code))return r.data;var a="".concat((null==r?void 0:r.error_message)||(null==r?void 0:r.detailMsg)||(null==r?void 0:r.code)),o=new Error(a);throw o.code=null==r?void 0:r.code,o.status=t,o.data=r,o}function Ce(e,n,t,r){var a,o,i;if((!t||!0!==t)&&(!t||!(null==t?void 0:t(e)))){var s=e.status===(null==(a=J.STATUS_CODE)?void 0:a.ERR_CANCELED),c=401===e.status||403===e.status;if(!s&&!c){var u=navigator.onLine?(null==(o=e.data)?void 0:o.detailMsg)||e.message||(null==(i=e.data)?void 0:i.error_message):"";_.L.error("".concat(u," - ").concat(n),{errorName:"ApiError - ".concat(e.status||e.code),error:e,data:{url:n,errorSource:r},tags:{feErrorType:"ApiError"}}),(0,_.a9)({title:u||(0,_.t)("register_mid_label_server_error")})}}}var ye=function(){return(0,l.A)((function e(n){(0,d.A)(this,e),this.deviceId="",this.imToken="",this.okToken="",this.requestClient=J,this.customHeaders={platform:"web"},this.mode="anonymous",this.whitelist=[].concat((0,a.A)(n),Ee)}),[{key:"init",value:function(){var e=(0,u.A)((0,c.A)().mark((function e(n){var t,r,a,o,i,s,u,l,d;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.mode,a=n.imToken,o=n.useImTokenInHeader,this.mode=r,this.setImToken(a,o),e.next=5,null==(s=null==(i=this.requestClient)?void 0:i.getDevId)?void 0:s.call(i);case 5:if(e.t1=t=e.sent,e.t0=null!==e.t1,!e.t0){e.next=9;break}e.t0=void 0!==t;case 9:if(!e.t0){e.next=13;break}e.t2=t,e.next=14;break;case 13:e.t2="";case 14:if(this.deviceId=e.t2,"anonymous"===r){e.next=28;break}return e.next=18,null==(l=null==(u=null==this?void 0:this.requestClient)?void 0:u.getToken)?void 0:l.call(u);case 18:if(e.t4=d=e.sent,e.t3=null!==e.t4,!e.t3){e.next=22;break}e.t3=void 0!==d;case 22:if(!e.t3){e.next=26;break}e.t5=d,e.next=27;break;case 26:e.t5="";case 27:this.okToken=e.t5;case 28:case"end":return e.stop()}}),e,this)})));return function(n){return e.apply(this,arguments)}}()},{key:"setImToken",value:function(e,n){S.A.set("im-token",e),!1!==n&&(this.customHeaders["im-token"]=e)}},{key:"setImHttpRequestClient",value:function(e){Object.assign(this.requestClient,e)}},{key:"isValidRequest",value:function(e){return!("authorized"!==this.mode&&!this.whitelist.includes(e))||((0,_.$)()||console.trace("Invalid anonymous mode request",{url:e}),_.L.error("Invalid anonymous mode request",{errorName:"InvalidRequest-Anonymous",data:{url:e},tags:{feErrorType:"ApiError"}}),!1)}},{key:"get",value:function(e,n){if(!this.isValidRequest(e))return Promise.reject(new Error("Invalid anonymous request"));var t=n||{},a=t.ignoreFormat,o=t.skipErrorAlert,i=(0,r.A)(t,Z),c=(0,s.A)((0,s.A)({},this.customHeaders),null==i?void 0:i.headers);return this.requestClient.get(e,(0,s.A)((0,s.A)({},i),{},{headers:c})).then((function(e){return a?e:be(e)})).catch((function(t){throw t.method="get",t.url=e,Ce(t,e,o,null==n?void 0:n.source),t}))}},{key:"post",value:function(e,n,t){if(!this.isValidRequest(e))return Promise.reject(new Error("Invalid anonymous request"));var a=t||{},o=a.ignoreFormat,i=a.skipErrorAlert,c=(0,r.A)(a,$),u=(0,s.A)((0,s.A)({},this.customHeaders),null==c?void 0:c.headers);return this.requestClient.post(e,n,(0,s.A)((0,s.A)({},c),{},{headers:u})).then((function(e){return o?e:be(e)})).catch((function(n){throw n.method="post",n.url=e,Ce(n,e,i,null==t?void 0:t.source),n}))}}])}(),Se=(0,l.A)((function e(n){var t=this;(0,d.A)(this,e),this.initConfig={},this.imStore={},this.callController=(0,A.d)("voiceCall"),this.autoReplyController=(0,A.d)("autoReply"),this.groupMgmtController=(0,A.d)("groupManagement"),this.contactManagementController=(0,A.d)("contactManagement"),this.massSendMessageController=(0,A.d)("massSendMessage"),this.announcementController=(0,A.d)("announcement"),this._devtool=null,this.pluginList=[],this.pluginModules={},this.openIM=null,this.userInfo={},this.currentChannelId=null,this.micOccupancyState=null,this.messageFilters={},this.registerPlugin=function(e){t.pluginList=Array.isArray(e)?e:[e],t.pluginList.forEach((function(e){e.init(t)}))},this.setImStore=function(e){t.imStore=e},this.filterMessageList=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!e.length)return[];var n=[];return e.forEach((function(e){var r=B(e,t.queryUserInfo().userUid);if(!(0,A.s)(r,t.messageFilters))if(r.contentType!==_.Y.RECALL_MESSAGE&&r.contentType!==_.Y.RECALL_MESSAGE_BY_ADMIN)if(r.contentType!==_.Y.RECEIPT_MESSAGE){if(!(0,A.i)(r)){r.visible=!0;var a=t.quotedMsgController.processNewMsg(r);n.push((0,s.A)((0,s.A)({},a),{},{visible:!0,seq:Number(r.seq)}))}}else t.emitter.emit(b.C.ON_RECV_C2C_READ_RECEIPT,[r]);else t.emitter.emit(b.C.ON_RECV_C2C_RECALL_MESSAGE,[r])})),n},this.emitProfileChangedEvent=function(){t.emitter.emit(b.C.ON_PROFILE_CHANGED,t.userInfo)},this.setMessageFilters=function(e){t.messageFilters=e},this.checkPermission=(0,u.A)((0,c.A)().mark((function e(){return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,_.aa)(t.imHttp.get(x.i),(function(){return null}));case 2:return e.abrupt("return",e.sent.isOk());case 3:case"end":return e.stop()}}),e)}))),this.anonymousConnect=function(){var e=(0,u.A)((0,c.A)().mark((function e(n){var r,a,o,i,u;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==(r=null==n?void 0:n.auth)?void 0:r.imToken){e.next=2;break}throw new Error("config.auth.imToken is required in anonymous mode");case 2:if(null==(a=null==n?void 0:n.auth)?void 0:a.userInfo){e.next=4;break}throw new Error("config.auth.userInfo is required in anonymous mode");case 4:return o=n.auth.imToken,e.next=7,t.imHttp.init({imToken:o,mode:"anonymous",useImTokenInHeader:n.auth.useImTokenInHeader});case 7:return t.userInfo=(0,s.A)((0,s.A)({},n.auth.userInfo),{},{enNickname:n.auth.userInfo.nickname,tags:[]}),e.next=10,t.cache.init(t.userInfo.userUid);case 10:return e.next=12,Promise.all([t.quotedMsgController.init()]);case 12:return i=(0,x.j)(!0),e.next=15,t.imWS.connect({url:i,loginData:{imToken:o},onOpen:function(){},onStatusChange:function(e){var n;null==(n=t._devtool)||n.report({type:"STATUS",status:e})}}).catch((function(e){throw e}));case 15:return u=e.sent,_.L.setGlobalTag("wsConnected",!0),t.emitter.emit(b.C.ON_CONNECT,{code:0}),e.abrupt("return",u);case 19:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),this.connect=(0,u.A)((0,c.A)().mark((function e(){var n,r,o,i,l,d,m,f,p,v,h,g,A,E,C,y,S,M;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(g=null!==(n=null==(o=t.initConfig)?void 0:o.anonymousMode)&&void 0!==n&&n,A="",!g){e.next=4;break}return e.abrupt("return",t.anonymousConnect(t.initConfig));case 4:if(!(null==(l=null==(i=t.initConfig)?void 0:i.auth)?void 0:l.imToken)){e.next=8;break}A=null==(d=t.initConfig)?void 0:d.auth.imToken,e.next=11;break;case 8:return e.next=10,t.imHttp.get(x.h);case 10:A=e.sent;case 11:return e.next=13,t.imHttp.init({imToken:A,mode:"authorized",useImTokenInHeader:null==(f=null==(m=t.initConfig)?void 0:m.auth)?void 0:f.useImTokenInHeader});case 13:return E=function(){var e=(0,u.A)((0,c.A)().mark((function e(){var n,r,a,o;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(null==(r=null==(n=t.initConfig)?void 0:n.auth)?void 0:r.userInfo)){e.next=4;break}t.userInfo=(0,s.A)((0,s.A)({},null==(a=t.initConfig)?void 0:a.auth.userInfo),{},{enNickname:null==(o=t.initConfig)?void 0:o.auth.userInfo.nickname,tags:[]}),e.next=7;break;case 4:return e.next=6,t.imHttp.get(x.m);case 6:t.userInfo=e.sent;case 7:return e.next=9,t.cache.init(t.userInfo.userUid);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),C=Boolean(null==(p=t.initConfig)?void 0:p.initConversationId),y=function(){var e=(0,u.A)((0,c.A)().mark((function e(){var n,r,a,o,i;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(null==(n=t.initConfig)?void 0:n.initConversationId)){e.next=5;break}return e.next=3,t.conversationController.getConversationList({channelIds:[null==(r=t.initConfig)?void 0:r.initConversationId],unreadCountCalculation:!1});case 3:i=e.sent,(null==(a=null==i?void 0:i.data)?void 0:a[0])&&t.imStore.conversationStore.setActiveConversationId(null==(o=i.data)?void 0:o[0].channelId);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),S=t.imHttp.okToken,M=null!==(r=null==(h=null==(v=t.initConfig)?void 0:v.customApiOverrides)?void 0:h.wsUrl)&&void 0!==r?r:(0,x.j)(),e.next=20,Promise.all([E(),C&&y()].concat((0,a.A)(t.pluginList.map((function(e){return e.connect()}))),[t.imWS.connect({url:M,loginData:{token:S,imToken:A},onOpen:function(){_.L.setGlobalTag("imUserId",t.userInfo.userUid)},onClose:function(e){},onStatusChange:function(e){var n;null==(n=t._devtool)||n.report({type:"STATUS",status:e})}}).catch((function(e){throw e}))]));case 20:return _.L.setGlobalTag("wsConnected",!0),t.emitter.emit(b.C.ON_CONNECT,{code:0}),e.abrupt("return",!0);case 23:case"end":return e.stop()}}),e)}))),this.getMessageListFromWS=function(){var e=(0,u.A)((0,c.A)().mark((function e(n){var r,a,o,i,s,u;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.lastSeq,a=n.limit,o=n.channelId,e.next=3,t.imWS.getHistoryMessageList({lastSeq:r,limit:a,channelId:o});case 3:return s=e.sent,u=null==(i=s.data.messageList)?void 0:i.map((function(e){return B(e,t.queryUserInfo().userUid)})),t.emitter.emit(b.C.ON_HISTORY_MESSAGE_FETCHED,{channelId:o,messageList:null!==u&&void 0!==u?u:[]}),e.abrupt("return",u);case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),this.sendMessageReceipt=function(e){return t.sendMsgController.sendMessageReceipt(e)},this.recallMessage=function(e){return t.sendMsgController.recallMessage(e)},this.read=function(){var e=(0,u.A)((0,c.A)().mark((function e(n){var r,a,o,i,s;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.channelId,a=n.lastReadMsgSeq,o=n.clientMsgId,a&&r&&o){e.next=4;break}return console.error("invalid read params"),e.abrupt("return");case 4:if(i=t.imStore.conversationStore.conversationMap[r],s=Number(a)||0,i&&!(Number(s)<=Number(i.lastReadMsgSeq))){e.next=8;break}return e.abrupt("return");case 8:t.sendMessageReceipt({lastReadMsgSeq:a,channelId:r}),t.conversationController.syncChannelToServer({channelId:r,lastReadMsgSeq:a}),t.imStore.conversationStore.updateConversation({channelId:r,lastReadMsgSeq:String(s)}),t.conversationController.getUnreadCountUpdates(t.imStore.conversationStore.conversationMap[r]).then((function(e){t.imStore.conversationStore.updateConversation(e)})).catch(console.warn);case 12:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),this.resendMessage=function(e){return t.sendMsgController.resendMessage(e)},this.sendMessage=function(){var e;return(e=t.sendMsgController).sendMessage.apply(e,arguments)},this.queryUserInfo=function(){return t.userInfo},this.getMyQrCode=(0,u.A)((0,c.A)().mark((function e(){var n;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.imHttp.get(x.k);case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)}))),this.updateMyPrivacySettings=function(){var e=(0,u.A)((0,c.A)().mark((function e(n){var r;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.imHttp.post(x.l,n);case 2:return r=e.sent,t.userInfo.userPrivacySettingsDto&&(t.userInfo.userPrivacySettingsDto=(0,s.A)((0,s.A)({},t.userInfo.userPrivacySettingsDto),n)),t.emitProfileChangedEvent(),e.abrupt("return",r);case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),this.checkMicOccupancyState=function(){return t.micOccupancyState},this.updateMicOccupancyState=(0,u.A)((0,c.A)().mark((function e(){var n,r,a,o,i=arguments;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(n=i.length>0&&void 0!==i[0]?i[0]:{}).occupancyInfo,!(a=n.resetName)){e.next=4;break}return t.micOccupancyState&&t.micOccupancyState.name!==a||(t.micOccupancyState=null),e.abrupt("return",{code:0});case 4:if(!t.micOccupancyState||r.name===t.micOccupancyState.name){e.next=7;break}return k.A.error((0,_.t)(null!==(o=t.micOccupancyState.errorKey)&&void 0!==o?o:"")),e.abrupt("return",{code:1,data:t.micOccupancyState});case 7:return t.micOccupancyState=(0,s.A)({},r),e.abrupt("return",{code:0});case 9:case"end":return e.stop()}}),e)}))),this.fetchHistoryMessagesByPage=function(){var e=(0,u.A)((0,c.A)().mark((function e(n){var r,a,o,i,s,l,d,m,f,p,v,h,g,_;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.lastSeq,i=n.limit,s=n.channelId,m=ae(Number(o)-i+1,Number(o)),f=function(){var e=(0,u.A)((0,c.A)().mark((function e(n){var r,a;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.imWS.getHistoryMessageList(n);case 2:return a=e.sent,e.abrupt("return",null==(r=null==a?void 0:a.data)?void 0:r.messageList);case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),e.next=5,t.cache.withMessageCache({channelId:s,seqList:m,fetchFn:f})({lastSeq:o,limit:i,channelId:s});case 5:return(p=e.sent).sort((function(e,n){return e.seq-n.seq})),v=Number(null!==(r=null==(l=p[0])?void 0:l.seq)&&void 0!==r?r:0),h=Number(null!==(a=null==(d=p[p.length-1])?void 0:d.seq)&&void 0!==a?a:0),g=!0,(v<=1||p.length<i)&&(g=!1),p.length||(g=!1,v=-1,h=Number.MAX_SAFE_INTEGER),_=t.filterMessageList(p),e.abrupt("return",{lowestSeq:v,highestSeq:h,hasMore:g,messageList:_,channelId:s});case 14:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),this.fetchMessagesBySeqList=function(){var e=(0,u.A)((0,c.A)().mark((function e(n){var r,a,o,i;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.channelId,a=n.seqList,o=function(){var e=(0,u.A)((0,c.A)().mark((function e(n){var r,a;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.imWS.getHistoryMessageListBySeq(n);case 2:return a=e.sent,e.abrupt("return",null==(r=null==a?void 0:a.data)?void 0:r.messageList);case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),e.next=4,t.cache.withMessageCache({channelId:r,seqList:a,fetchFn:o})({seqList:a,channelId:r});case 4:return i=e.sent,e.abrupt("return",t.filterMessageList(i));case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),this.destroy=function(){t.imWS.close(),t.imStore.conversationStore.setActiveConversationId(null),t.emitter.unmountAll(),_.L.resetGlobalTag()},this.getGroupMemberList=function(e){return t.groupController.getMemberList(e)},this.getGroupInfo=function(e){return t.groupController.getGroupInfo(e)},this.initConfig=n,this.emitter=new E.E,this.msgHandingController=new de(this),this.imWS=new E.S(this.msgHandingController.broadcastNewMessagesReceived,"channelId",{messageHandlerThrottleDuration:200,debug:!(0,_.$)()}),this.imHttp=new ye(Object.values((null==n?void 0:n.customApiOverrides)||{})),this.cache=new Ae,this.conversationController=new se(this),this.quotedMsgController=new ve(this),this.sendMsgController=new _e(this),this.notificationController=new pe(this),this.groupController=new ce(this,n),this.contactController=new ie(this),this.msgHandingController.init(),this.imWS.addEventListener(E.C.DisconnectWithoutReconnect,(function(e){var n,r;_.L.setGlobalTag("wsConnected",!1),_.L.info("IM WS closed with ".concat(null==(n=null==e?void 0:e.data)?void 0:n.code),{errorName:"IMConnection",data:{closeEvent:e},tags:{feErrorType:"ImClient"}}),4001===(null==(r=null==e?void 0:e.data)?void 0:r.code)&&t.connect()}))}));function Me(e,n){var t,r=n,a=(0,o.A)(e);try{for(a.s();!(t=a.n()).done;){var i=t.value;Number(i.seq)<Number(r)&&(r=i.seq)}}catch(s){a.e(s)}finally{a.f()}return r}var Ie=function(){return(0,l.A)((function e(n){var t,r,a,o=this;(0,d.A)(this,e),this.connectPromise=null,this.localeData=null,this.onDestroy=null,this.init=(0,u.A)((0,c.A)().mark((function e(){var n,t,r,a,s,u,l;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Promise.all([(0,M.V)(_.ab.imFetchConfig),o.connect()]);case 3:return t=e.sent,r=(0,i.A)(t,1),a=r[0],_.L.setGlobalTag("initialized",!0),a&&(o.localeData=a),e.abrupt("return",!0);case 11:throw e.prev=11,e.t0=e.catch(0),u=e.t0,l=function(){return(null==u?void 0:u.event)?null==u?void 0:u.event:(null==u?void 0:u.url)?"ImSdkInitApiFailed":"ImSdkInitOthersFailed"},_.L.error("IM SDK init failed - ".concat((null==u?void 0:u.errMsg)||(null==(n=null==u?void 0:u.data)?void 0:n.message)||(null==u?void 0:u.status)||"Others"," ").concat(null!==(s=u.url)&&void 0!==s?s:""),{errorName:l(),error:u,tags:{feErrorType:"ImClient"}}),u;case 17:case"end":return e.stop()}}),e,null,[[0,11]])}))),this.setImStore=function(e){o.driver.setImStore(e)},this.setImHttpRequestClient=function(e){o.driver.imHttp.setImHttpRequestClient(e)},this.on=function(e,n){return o.driver.emitter.on(e,n)},this.off=function(e,n){if(o.driver)return o.driver.emitter.off(e,n)},this.connect=(0,u.A)((0,c.A)().mark((function e(){return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!o.connectPromise){e.next=2;break}return e.abrupt("return",o.connectPromise);case 2:return o.connectPromise=o.driver.connect(),e.abrupt("return",o.connectPromise);case 4:case"end":return e.stop()}}),e)}))),this.sendMessage=function(){var e=(0,u.A)((0,c.A)().mark((function e(n){return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",o.driver.sendMessage(n));case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),this.getConversationList=function(){var e=(0,u.A)((0,c.A)().mark((function e(n,t){var r;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.driver.conversationController.getConversationList(n,t);case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}(),this.read=function(){var e=(0,u.A)((0,c.A)().mark((function e(n){var t;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.driver.read(n);case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),this.setChannelPinnedStatus=function(){var e=(0,u.A)((0,c.A)().mark((function e(n){var t;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.driver.conversationController.setChannelPinnedStatus(n);case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),this.recallMessage=function(){var e=(0,u.A)((0,c.A)().mark((function e(n){var t;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.driver.recallMessage(n);case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),this.queryUserInfo=function(){return o.driver.queryUserInfo()},this.getMyQrCode=(0,u.A)((0,c.A)().mark((function e(){var n;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.driver.getMyQrCode();case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)}))),this.updateMyPrivacySettings=function(){var e=(0,u.A)((0,c.A)().mark((function e(n){var t;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.driver.updateMyPrivacySettings(n);case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),this.getGroupMemberList=function(){var e=(0,u.A)((0,c.A)().mark((function e(n){var t;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.driver.getGroupMemberList(n);case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),this.createIndividualChat=function(){var e=(0,u.A)((0,c.A)().mark((function e(n){var t;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.driver.conversationController.createIndividualChat(n);case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),this.getGroupInfo=function(){var e=(0,u.A)((0,c.A)().mark((function e(n){var t;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.driver.getGroupInfo(n);case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),this.setChannelMute=function(){var e=(0,u.A)((0,c.A)().mark((function e(n){var t;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.driver.conversationController.setChannelMute(n);case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),this.setNotificationHandler=function(e){o.driver.notificationController.setNotificationHandler(e)},this.setShouldCountAsUnread=function(e){o.driver.conversationController.setShouldCountAsUnread(e)},this.resendMessage=function(){var e=(0,u.A)((0,c.A)().mark((function e(n){var t;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.driver.resendMessage(n);case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),this.checkPermission=(0,u.A)((0,c.A)().mark((function e(){var n;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.driver.checkPermission();case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)}))),this.updateMicOccupancyState=function(){var e=(0,u.A)((0,c.A)().mark((function e(n){var t;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.driver.updateMicOccupancyState(n);case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),this.deleteConversations=function(){var e=(0,u.A)((0,c.A)().mark((function e(n){var t;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.driver.conversationController.deleteConversations(n);case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),this.setSendMessageTransformer=function(e){o.driver.sendMsgController.setSendMessageTransformer(e)},this.stopReceivingMessages=function(){o.driver.msgHandingController.stopReceivingMessages()},this.setOnDestroyHandler=function(e){o.onDestroy=e},this.destroy=function(){o.onDestroy&&o.onDestroy(),o.driver.destroy()},this.destroyOverlayDialog=function(){o.driver.imStore.overlayStore.destroy()},this.config=n,this.app=(null==n?void 0:n.app)||oe.DEV,this.driver=new Se(n),null!=(null==(t=null==n?void 0:n.driver)?void 0:t.notificationHandler)&&this.driver.notificationController.setNotificationHandler(n.driver.notificationHandler),null!=(null==(r=null==n?void 0:n.driver)?void 0:r.messageFilters)&&this.driver.setMessageFilters(n.driver.messageFilters),null!=(null==(a=null==n?void 0:n.driver)?void 0:a.conversationFilter)&&this.driver.conversationController.setConversationFilter(n.driver.conversationFilter)}),[{key:"seekMessages",value:function(e){var n=this;return(0,g.A)((0,c.A)().mark((function t(){var r,a,i,s,u,l,d,m,f,p,v,g,_;return(0,c.A)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=Number.MAX_SAFE_INTEGER,a=!0,i=40;case 3:if(!a){t.next=52;break}return t.next=6,(0,h.A)(n.driver.getMessageListFromWS({channelId:e.channelId,lastSeq:r,limit:i}));case 6:if(s=t.sent,(u=s.some((function(n){return Number(n.seq)<=e.startingSeq})))&&(a=!1),s.length<i&&(a=!1),l=Me(s,r),r=Math.max(l-1,0),!u){t.next=33;break}d=s.filter((function(n){return Number(n.seq)>=e.startingSeq})),m=(0,o.A)(d),t.prev=15,m.s();case 17:if((f=m.n()).done){t.next=23;break}return p=f.value,t.next=21,p;case 21:t.next=17;break;case 23:t.next=28;break;case 25:t.prev=25,t.t0=t.catch(15),m.e(t.t0);case 28:return t.prev=28,m.f(),t.finish(28);case 31:t.next=50;break;case 33:v=(0,o.A)(s),t.prev=34,v.s();case 36:if((g=v.n()).done){t.next=42;break}return _=g.value,t.next=40,_;case 40:t.next=36;break;case 42:t.next=47;break;case 44:t.prev=44,t.t1=t.catch(34),v.e(t.t1);case 47:return t.prev=47,v.f(),t.finish(47);case 50:t.next=3;break;case 52:case"end":return t.stop()}}),t,null,[[15,25,28,31],[34,44,47,50]])})))()}}])}();function ke(e,n,t){var r=window.__IM_DEVTOOL_HOOK__;r&&(r.inject({id:e,client:n,store:t}),(0,N.reaction)((function(){return(0,N.toJS)(t.messageStore)}),(function(){window.postMessage({type:"IM_DEVTOOL_HOOK:STORE_UPDATE",content:{target:"messageStore"}})})),(0,N.reaction)((function(){return(0,N.toJS)(t.conversationStore)}),(function(){window.postMessage({type:"IM_DEVTOOL_HOOK:STORE_UPDATE",content:{target:"conversationStore"}})})))}function xe(e,n,t){if(!(0,I.f)()&&!(0,_.$)()){var r=e;return window.__IM_DEVTOOL_HOOK__?ke(r,n,t):window.addEventListener("message",(function(e){var a;e.origin===window.location.origin&&"IM_DEVTOOL_HOOK:INJECTED"===(null==(a=e.data)?void 0:a.type)&&ke(r,n,t)})),{report:function(e){window.__IM_DEVTOOL_HOOK__&&"STATUS"===e.type&&window.postMessage({type:"IM_DEVTOOL_HOOK:STATUS_UPDATE",content:{instanceId:r,status:e.status}})}}}}var we=function(e){var n,t;if((0,I.f)())return console.warn("IM SDK is not supported in server side rendering. Please make sure to bootstrap it in client side."),{client:null,store:null};(0,_.ac)(null!==(n=null==e?void 0:e.app)&&void 0!==n?n:"dev");var r=new Ie(e),a=(0,_.ad)({client:r});return r.setImStore(a),r.driver._devtool=xe(null!==(t=null==e?void 0:e.app)&&void 0!==t?t:"dev",r,a),(null==e?void 0:e.requestClient)&&r.setImHttpRequestClient(e.requestClient),(null==e?void 0:e.plugins)&&r.driver.registerPlugin(e.plugins),{client:r,store:a}}},33350:(e,n,t)=>{t.d(n,{M:()=>a,T:()=>r,a:()=>o});var r=22,a="mentionid",o=2e3},71929:(e,n,t)=>{t.d(n,{A:()=>k});var r=t(92901),a=t(23029),o=t(50388),i=t(52176),s=t(53954),c=t(85501),u=t(5544),l=t(64467),d=t(25721),m=t(41594),f=t(99420),p=t(57394),v=t(47322),h=t(83573),g=t(67146),_=t(85349),A=t(33350);var E=function(e){return!!e&&((0,_.h)(e.currentUser.role)||e.allowMentionOthers)},b=function(e){var n=e.className,t=e.channel,r=e.searchKeyProp,a=e.onClickItemHandler,o=e.onClickMentionAll,i=(0,m.useMemo)((function(){return!t||!E(t.groupInfo)}),[t]),s=(0,m.useMemo)((function(){var e,n;if(!t||t.channelType!==p.C.GROUP)return!1;var a=r;return!!(0,p.b)(p.B.localeKey).toLowerCase().includes(a.toLowerCase())&&(null==(n=null==(e=null==t?void 0:t.groupInfo)?void 0:e.userGroupPermission)?void 0:n.atAll)}),[t,r]);return m.createElement("div",{className:h("im-mention-members-box","mess-input-mention",n)},s?m.createElement(g.A,{"aria-labelledby":"mention_all_label",className:"all-item-box",tabIndex:0,onClick:function(){null==o||o()},onKeyDown:function(e){"Enter"===e.key&&(null==o||o())}},m.createElement(p.S,{userInfo:{nickname:"*"},className:"all-item-avatar",height:24,width:24}),m.createElement("div",{className:"all-item-name-box"},m.createElement("span",{className:"all-text"},(0,p.t)(p.B.localeKey)),m.createElement("span",{className:"all-subtext",id:"mention_all_label"},(0,p.t)("im_mention_text_notify_all_group_members")))):null,m.createElement("div",{className:"mention-members-box-title"},(0,p.t)("im_group_chat_drawer_in_chat")),m.createElement(_.M,{className:"mention-members-list",hideSearchBox:!0,searchKeyProp:r,onClickItemHandler:a,excludeMe:!0,onlyShowAdmin:i,avatarSize:24}))},C="OK-IM-INPUT-MENTION-USER",y=function(e){return(0,p.E)({type:C,data:e})},S=function(e,n,t,r){var a=e.getDraft(n),o=t.current;if(o){var i=Array.from(o.querySelectorAll('[data-immention="true"]')),s=new Set,c=!1;i.forEach((function(e){var n,t,r=e.innerText,o=null==(n=e.dataset)?void 0:n[A.M];if(o){s.add(o);var i=a.mentionedUsers.get(o);r&&i&&r===i.privateContent||(null==(t=e.parentElement)||t.removeChild(e),a.mentionedUsers.delete(o),c=!0)}})),a.mentionedUsers.forEach((function(e,n){s.has(n)||a.mentionedUsers.delete(n)})),c&&"\u200b"===t.current.innerText&&(o.innerText="",r(""))}},M=function(e,n,t,r,a){var o=a.handleContentChange,i=a.closeMentionList,s=a.updateRangePosition,c=(0,p.u)().store.messageInputStore,u=null==e?void 0:e.channelId,d=(0,m.useCallback)((function(){S(c,u,n,o)}),[u,n,c,o]);return(0,m.useCallback)((function(e){if(n.current){var a=n.current;d();var m=c.getDraft(u),v=window.getSelection(),h=n.current.innerText.length-t;if(a&&v&&!(h+e.publicContent.length>A.a))if(r.current.range&&(v.removeAllRanges(),v.addRange(r.current.range),v.collapseToEnd()),m.mentionedUsers.has(e.mentionKey))i();else{var g=function(e){var n=e.content,t=e.className,r=void 0===t?"":t,a=e.dataset,o=void 0===a?{}:a,i=document.createElement("span");return i.className=r,i.innerHTML=(0,p.G)((0,f.YW)(n)),Object.keys(o).forEach((function(e){i.dataset[e]=(0,p.G)(o[e])})),i}({content:e.privateContent,dataset:(0,l.A)((0,l.A)({},A.M,e.mentionKey),"immention","true")});m.mentionedUsers.set(e.mentionKey,{privateContent:g.innerText,publicContent:e.publicContent});var _=v.getRangeAt(0);a.focus(),_.insertNode(g);var E=g.previousSibling;if(E&&E.nodeValue&&(_.setEnd(E,E.nodeValue.length),_.setStart(E,Math.max(0,E.nodeValue.length-t)),_.deleteContents()),!(null==E?void 0:E.nodeValue)&&!(null==E?void 0:E.previousSibling)){var b=document.createTextNode("\u200b");_.insertNode(b),_.setStartAfter(b),_.collapse(!0)}_.setStartAfter(g),_.collapse(!0);var C=document.createTextNode("\xa0");_.insertNode(C),_.setStartAfter(C),_.collapse(!0),v.removeAllRanges(),v.addRange(_),c.updateDraft(u,{messageText:a.innerText,mentionedUsers:m.mentionedUsers}),o(a.innerText),s(),d(),i()}}}),[u,r,n,c,i,t,d,o,s])},I=function(e){var n=e.channel,t=e.inputRef,r=e.lastRangeRef,a=e.updateRangePosition,o=e.handleContentChange,i=(0,m.useState)(""),s=(0,u.A)(i,2),c=s[0],l=s[1],d=(0,m.useState)(!1),h=(0,u.A)(d,2),g=h[0],y=h[1],I=null==n?void 0:n.channelId,k=(null==n?void 0:n.channelType)===p.C.GROUP,x=(0,p.u)().store.messageInputStore,w=(0,m.useCallback)((function(){l(""),y(!1)}),[]),T=(0,m.useCallback)((function(){!function(e,n,t){var r=e.getDraft(n).mentionedUsers,a=t.current;if(a){var o=(0,p.G)(a.innerText);r.forEach((function(e,n){e.privateContent&&(o=o.replace(e.privateContent,(function(){return'<span data-immention="true" data-'.concat(A.M,'="').concat((0,p.G)(n),'">').concat((0,p.G)(e.privateContent),"</span>")})))})),a.innerHTML=(0,f.YW)(o)}}(x,I,t)}),[I,t,x]),N=(0,m.useCallback)((function(){S(x,I,t,o)}),[I,t,x,o]),R=function(e,n,t,r){var a=(0,p.u)().store,o=(0,m.useCallback)((function(){n({mentionKey:p.B.key,privateContent:"@".concat((0,p.t)(p.B.localeKey)),publicContent:p.B.publicText})}),[n]),i=(0,m.useCallback)((function(e){var t;n({mentionKey:null==(t=null==e?void 0:e.userInfo)?void 0:t.userUid,privateContent:"@".concat((0,p.h)(null==e?void 0:e.userInfo,a.userRegistryStore)),publicContent:"@".concat((0,p.i)(null==e?void 0:e.userInfo))})}),[n,a]);return{selectMentionMember:i,selectMentionAll:o,MentionListDisplay:t?m.createElement(b,{channel:e,onClickItemHandler:i,onClickMentionAll:o,searchKeyProp:r}):null}}(n,M(n,t,g?c.length+1:0,r,{handleContentChange:o,closeMentionList:w,updateRangePosition:a}),g,c),L=R.selectMentionAll,O=R.selectMentionMember,U=R.MentionListDisplay;!function(e,n,t,r){var a=(0,p.u)().store,o=a.messageInputStore,i=a.groupStore,s=null==e?void 0:e.channelId,c=(null==e?void 0:e.channelType)===p.C.GROUP;(0,m.useEffect)((function(){if(c)return(0,p.H)(C,(function(e){if("STORE"===e.from&&n.current){var a=o.getDraft(s),c=e.groupMember;c.groupId!==s||a.mentionedUsers.has(c.memberUid)||!(0,_.h)(c.role)&&!E(i.groupInfoMap[s])||((0,v.m)(n.current),r(),t(c),(0,v.a)(n.current))}}))}),[c,n,t,r,i,o,s])}(n,t,O,a);var P=(0,m.useCallback)((function(e,n){n&&T(),e||w(),N()}),[w,T,N]),D=function(e,n,t,r,a){return(0,m.useCallback)((function(){var o=e.current.range;if(n&&o){var i=o.startContainer,s=e.current.endOffset;if(null==i?void 0:i.textContent){var c=i.textContent.slice(0,s).split("@");if(c.length>1){var u=c[c.length-1];u.endsWith("\xa0")?r():t(u)}else a(!1)}else r()}}),[r,e,n])}(r,g,l,w,y),G=function(e,n){return(0,m.useCallback)((function(t){"@"===t.key&&e(!0),"Escape"===t.key&&n()}),[n])}(y,w),q=(0,m.useCallback)((function(e){N();var n=x.getDraft(I),t=[],r=e;return n.mentionedUsers.size&&(n.mentionedUsers.forEach((function(e,n){r.includes(e.privateContent)&&(t.push(n),r=r.replace(e.privateContent,(function(){return"@ ".concat(e.publicContent.slice(1))})))})),r=r.replace(/@\s/g,"@")),{content:r=r.replace(/\u200b@/g,"@"),mentionidsList:t.filter((function(e){return e!==p.B.key})).map((function(e){var t;return{uid:e,atText:null==(t=n.mentionedUsers.get(e))?void 0:t.publicContent}})),mentionType:t.includes(p.B.key)?p.M.AT_ALL:p.M.NORMAL}}),[I,x,N]);return k?{selectMentionMember:O,selectMentionAll:L,trackMentionSearchKey:D,closeMentionList:w,onInputValueChange:P,onKeyDown:G,computeMentionMessageContent:q,MentionListDisplay:U}:{MentionListDisplay:null,trackMentionSearchKey:void 0,closeMentionList:void 0,onInputValueChange:void 0,onKeyDown:void 0,selectMentionMember:void 0,computeMentionMessageContent:void 0,selectMentionAll:void 0}},k=function(e){function n(){var e,t,r,c;return(0,a.A)(this,n),t=this,r=n,c=["mentionUser"],r=(0,s.A)(r),(e=(0,o.A)(t,(0,i.A)()?Reflect.construct(r,c||[],(0,s.A)(t).constructor):r.apply(t,c))).init=function(e){var n=e;n.pluginModules.useMentionAction=I,n.pluginModules.mentionUser=y},e}return(0,c.A)(n,e),(0,r.A)(n)}(d.I)},99137:(e,n,t)=>{t.d(n,{M:()=>In,s:()=>Oe});var r=t(89379),a=t(5544),o=t(90675),i=t(10467),s=t(64467),c=t(41594),u=t(57394),l=t(96188),d=t(83573),m=t(15696),f=t(58252),p=t(67146),v=t(62576),h=t(76951),g=t(89208),_=t(95736),A=t(49047),E=t(7686),b=t(13826),C=t(46042),y=t(53986),S=t(47322),M=t(33350),I=t(22822),k=t(99420),x=function(e){return e[e.all=0]="all",e[e.senderOnly=1]="senderOnly",e[e.receiverOnly=2]="receiverOnly",e[e.hide=3]="hide",e[e.strategy=4]="strategy",e}(x||{}),w=["channel","className","disabled","keepInputInViewport","keepValueAfterSend","customPlaceHolder","onContentChange","handleSend","id","autoFocus"],T="_boxContainer_xjyu2_1",N="_placeholder_xjyu2_7",R="_contenteditable_xjyu2_20",L=(0,m.observer)((function(e,n){var t=e.channel,o=e.className,i=e.disabled,s=e.keepInputInViewport,l=void 0!==s&&s,m=e.keepValueAfterSend,f=void 0!==m&&m,p=e.customPlaceHolder,v=e.onContentChange,h=e.handleSend,g=e.id,_=void 0===g?"im-input-contenteditable-div":g,A=e.autoFocus,E=(0,y.A)(e,w),b=(0,u.u)().store.messageInputStore,C=h,I=null==t?void 0:t.channelId,k=(0,c.useRef)({range:null,endOffset:0}),x=(0,c.useState)(!0),L=(0,a.A)(x,2),O=L[0],U=L[1],P=(0,c.useRef)(null),D=(0,c.useRef)(null),G=function(){var e;return(null==(e=P.current)?void 0:e.innerText)||""},q=function(e,n){return(0,c.useCallback)((function(){if(e.current&&n.current){e.current&&(e.current.style.height="".concat(M.T,"px"));var t=e.current.scrollHeight;t>M.T?(n.current.style.flex="unset",n.current.style.width="100%",(t=e.current.scrollHeight)>M.T&&e.current&&(e.current.style.height="".concat(t,"px"))):(n.current.style.flex="1 1 auto",n.current.style.width="unset",(t=e.current.scrollHeight)>M.T&&(n.current.style.flex="unset",n.current.style.width="100%"))}}),[e,n])}(P,D),B=(0,c.useCallback)((function(){if(P.current){var e=window.getSelection();if(e&&e.rangeCount){var n=e.getRangeAt(0);n&&P.current.contains(n.endContainer)&&(k.current.range=n,k.current.endOffset=n.endOffset)}}}),[]),H=(0,c.useCallback)((function(e){null==v||v(e),U(!e),B()}),[v,B]),F=(0,u.p)("useMentionAction"),V=(null==F?void 0:F({channel:t,inputRef:P,lastRangeRef:k,updateRangePosition:B,handleContentChange:H}))||{},W=V.MentionListDisplay,Y=V.trackMentionSearchKey,j=V.closeMentionList,z=V.onInputValueChange,K=V.onKeyDown,X=V.computeMentionMessageContent,J=(0,c.useCallback)((function(e){var n,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a="\n"===e?"":e;H(a),r||b.updateDraft(I,{messageText:a}),t&&(n=a,P.current&&(P.current.innerText=n)),null==z||z(a,t),window.setTimeout(q)}),[I,H,b,z,q]),Q=(0,c.useCallback)((function(){if(!i){var e=(G()||"").trim();if(e){var n=null==X?void 0:X(e);C({contentType:u.Y.TEXT_MESSAGE,messageContent:(0,r.A)({content:e,mentionidsList:[],mentionType:u.M.NORMAL},n)}),f||(J(""),setTimeout((function(){var e;null==j||j(),b.clearDraft(I),i&&(null==(e=P.current)||e.blur())})))}}}),[i,X,C,f,J,j,b,I]),Z=function(e,n,t,r){return(0,c.useCallback)((function(a){var o=a.target.innerText||"",i=o.slice(0,M.a);"insertFromPaste"===a.nativeEvent.inputType?(n(i),(0,S.a)(e.current),t.current.endOffset=i.length):n(i,!1),o.length>M.a&&(n(i),(0,S.a)(e.current)),null==r||r()}),[e,t,r,n])}(P,J,k,Y);(0,c.useImperativeHandle)(n,(function(){return{send:Q,dom:P.current,updateTextValue:J,getTextValue:G,moveCursorToEnd:function(){return(0,S.a)(P.current)}}})),function(e,n,t){var r=(0,u.u)().store.messageInputStore;(0,c.useEffect)((function(){var a=r.getDraft(e);a.messageText?window.setTimeout((function(){n(a.messageText,!0,!0)})):(null==t||t(),n(""))}),[e,t])}(I,J,j),(0,c.useEffect)((function(){i&&(null==j||j(),J(""))}),[i,j]),(0,c.useEffect)((function(){return(0,u.H)("OK-IM-INPUT-SET-TEXT-CONTENT",(function(e){J(e.textContent,!0,"STORE"===e.from),(0,S.a)(P.current)}))}),[J]);var $=function(e,n,t,r,a){(0,c.useEffect)((function(){var t;n&&(null==(t=null==e?void 0:e.current)||t.focus())}),[t]),(0,c.useEffect)((function(){var n=[(0,u.H)("OK-IM-INPUT-FOCUS",(function(){var n;null==(n=e.current)||n.focus();var t=window.getSelection();t&&r.current.range&&(t.removeAllRanges(),t.addRange(r.current.range),t.collapseToEnd())})),(0,u.H)("OK-IM-INPUT-BLUR",(function(){var n;null==(n=e.current)||n.blur()})),(0,u.H)("OK-IM-INPUT-MOVE-CURSOR-TO-END",(function(){(0,S.a)(e.current)}))];return function(){n.forEach((function(e){return e()}))}}),[]);var o=(0,c.useRef)(null);return{onFocus:function(){o.current=setTimeout((function(){var n,t;if(a&&e.current){if("scrollIntoViewIfNeeded"in e.current)return void(null==(t=(n=e.current).scrollIntoViewIfNeeded)||t.call(n,!1));e.current.scrollIntoView({behavior:"smooth",block:"end"})}}),300)},onBlur:function(){clearTimeout(o.current)}}}(P,A,I,k,l),ee=$.onFocus,ne=$.onBlur;return c.createElement(c.Fragment,null,c.createElement("div",{className:T,ref:D},function(e,n,t){var r=n?(0,u.b)("im_group_chat_placeholder_chat_disabled"):(0,u.b)("im_group_chat_placeholder_write_message");return e&&c.createElement("div",{className:N},t||r)}(O,i,p),c.createElement("div",(0,r.A)((0,r.A)({id:_,"data-testid":"im-input-element",role:"textbox",tabIndex:0,enterKeyHint:"send",onFocus:ee,onBlur:ne,contentEditable:!i,style:{lineHeight:"".concat(M.T,"px"),height:M.T,touchAction:"none"},className:d(o,R),ref:P},E),{},{onInput:Z,onDrop:function(e){e.preventDefault()},onKeyDown:function(e){var n,t;e.shiftKey||(null==(n=null==e?void 0:e.nativeEvent)?void 0:n.isComposing)||"Enter"!==e.key||(e.preventDefault(),Q(),null==(t=P.current)||t.focus()),null==K||K(e)}}))),W)}),{forwardRef:!0}),O=function(e){var n=e.size,t=void 0===n?24:n;return c.createElement("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none"},c.createElement("path",{d:"M19 5L10.2 13.8M19 5L13.4 21L10.2 13.8M19 5L3 10.6L10.2 13.8",stroke:"currentColor",strokeWidth:"1.3",strokeLinecap:"round",strokeLinejoin:"round"}))},U="_sendButton_xf8p6_1",P=(0,c.memo)((function(e){var n=e.onClick,t=e.disabled,r=void 0!==t&&t,a=(0,I.A)().isSm;return c.createElement(h.A,{disabled:a,title:(0,u.t)("im_general_chat_hover_send"),placement:h.A.DIRECTION.top,alwaysUpdatePopper:!0},c.createElement(v.A,{category:v.A.CATEGORY.fill,disabled:r,strictCircle:!0,type:v.A.TYPE.primary,"aria-label":(0,u.t)("im_general_chat_hover_send"),className:U,"data-testid":"send-button",onClick:n,htmlType:"submit"},c.createElement(O,{size:20})))})),D="_compact_vz4vh_7",G="_im-message-time-line_vz4vh_12";function q(e){var n=e.time,t=e.mode,r=e.className;return c.createElement("div",{"data-copy-ignore":!0,className:d(r,G,"compact"===t&&D)},(0,u.f)(n))}function B(e){var n=e.when,t=e.children;return n&&t?t:null}var H="_msgWrapper_liz9d_16",F="_grouped_liz9d_23",V="_customMsgWrapper_liz9d_33",W="_selectable_liz9d_36";function Y(e,n,t){var r=e.current;if(r&&t){var a=(0,u.aM)(n),o=r.querySelector("#".concat(a));if(o){var i=(0,u.aN)(n,o),s=i.length?i.join(" "):a;return(0,k.YW)(s)}}}var j=function(e){if(!e)return!1;var n=null==e?void 0:e.querySelector("[data-message-clickable]");if(!n)return!1;if("VIDEO"===n.tagName){var t=n;return(null==t?void 0:t.paused)?null==t||t.play():null==t||t.pause(),!0}return n.click(),!0};function z(e){0===e.button&&1===e.buttons&&(j(e.currentTarget)&&(e.preventDefault(),e.stopPropagation()))}function K(e){"Enter"===e.key&&(j(e.currentTarget)&&(e.preventDefault(),e.stopPropagation()))}function X(e){var n;if(-1===e.button&&0===e.buttons){var t=null==(n=e.target)?void 0:n.querySelector("[data-context-menu]");t&&(e.preventDefault(),e.stopPropagation(),t.dispatchEvent(new CustomEvent("contextmenu",{bubbles:!0,cancelable:!0,composed:!0,detail:e.detail})))}}var J=(0,m.observer)((function(e){var n,t=e.message,r=e.children,a=e.prevMessage,o=e.displayTimestamp,i=(0,u.u)(),s=i.config,l=i.store,d=null==(n=s.message)?void 0:n.mode,m=l.configStore.message.displayMessageDateDivider,f=t.sendTime,p=null==a?void 0:a.sendTime,v=(0,c.useMemo)((function(){return!1!==o&&(!!m&&(0,u.f)(p)!==(0,u.f)(f))}),[m,p,f,o]);return c.createElement(c.Fragment,null,c.createElement(B,{when:v},c.createElement(q,{time:f,mode:d})),r)}));var Q=(0,m.observer)((function(e){var n=e.message,t=e.prevMessage,r=e.lastReadMsgSeq,a=e.channel,o=e.className,i=e.bubbleOptions,l=e.displayTimestamp,m=void 0===l||l,f=e.selectable,p=void 0!==f&&f,v=(0,u.u)(),h=v.store,g=v.registry,_=v.client,A=(0,u.aO)(n),E=(0,c.useRef)(null),b=(0,u.J)().activeConversation,C=(0,c.useMemo)((function(){return function(e,n){var t,r,a,o=null==(r=null==(t=null==e?void 0:e.config)?void 0:t.customApiOverrides)?void 0:r.ossUrl,i=null==(a=null==e?void 0:e.config)?void 0:a.anonymousMode;return n.contentType===u.Y.MEDIA_MESSAGE?(0,u.aL)(n.mediaMessage.urlPaths,n.mediaMessage.fileId,o,i):n.contentType===u.Y.VIDEO_MESSAGE?(0,u.aL)(n.videoMessage.urlPaths,n.videoMessage.fileId,o,i):n.contentType===u.Y.PICTURE_MESSAGE?(0,u.aL)(n.imageMessage.urlPaths,n.imageMessage.fileId,o,i):n.contentType===u.Y.VOICE_MESSAGE?(0,u.aL)(n.voiceMessage.urlPaths,n.voiceMessage.fileId,o,i):""}(_,n)}),[null==_?void 0:_.config,n]),y=(0,c.useMemo)((function(){return c.createElement(A,{message:n,store:h,prevMessage:t,oppositeLastReadMsgSeq:r,channel:a,bubbleOptions:i,src:C})}),[A,t,r,a,i,C]),S=(0,c.useMemo)((function(){var e,o=null!==(e=null==g?void 0:g.message)&&void 0!==e?e:{};if(function(e){var n,t,r;if(e.contentType!==u.Y.CUSTOM_MESSAGE)return!1;if(!["OneToOnePayment","CryptoGift"].includes(null==(n=e.customMessage)?void 0:n.serviceName))return!1;var a=(0,u.aS)(null==(t=e.customMessage)?void 0:t.frontendOption);if(a.isErr())return!1;var o=a.value.visibility,i=o===x.senderOnly&&e.isSender,s=o===x.receiverOnly&&!e.isSender,c=o===x.all;switch(null==(r=e.customMessage)?void 0:r.serviceName){case"OneToOnePayment":if([c,i].includes(!0))return!0;break;case"CryptoGift":if([c,i,s].includes(!0))return!0;break;default:return!1}return!1}(n))return y;var i=o[n.contentType];return"function"===typeof i?i({message:n,prevMessage:t,channel:a,activeConversation:b,id:(0,u.aM)(n),wrapMessage:function(e){return c.createElement(u.aP,{prevMessage:t,message:n,oppositeLastReadMsgSeq:r},c.createElement("span",{id:(0,u.aQ)(n),className:V},e))},defaultRender:y}):n.contentType===u.Y.CUSTOM_MESSAGE?(0,u.aE)().renderDom({message:n}):y}),[g,r,b,n,a,t,y]),M=(0,c.useMemo)((function(){return Y(E,n,S)}),[n,S]),I=n.seq,k=n.clientMsgId,w=n.isSender,T=(0,u.aR)(n,t);return S?c.createElement(J,{message:n,prevMessage:t,displayTimestamp:m},c.createElement("div",{ref:E,"aria-labelledby":M,className:d(H,W,o,(0,s.A)({},F,T)),"data-client-msg-id":k,"data-seq":I,"data-im-comp":"message-item","data-dir":w?"outgoing":"incoming","data-me":w?1:0,"data-msgselection":"true",tabIndex:p?0:-1,role:"group","aria-roledescription":(0,u.t)("im_chat_alt_desc_message"),onClick:z,onKeyDown:K,onContextMenu:X},S)):null})),Z=t(19018),$=t(44497),ee=t(8358),ne=t(99692),te=t(34738),re=t(47649),ae=t(60713),oe="_message_ckcgy_47",ie="_outgoing_ckcgy_70",se="_line_ckcgy_82",ce="_row_ckcgy_85",ue="_reverse_ckcgy_90",le="_bubble_ckcgy_93",de="_hideAvatar_ckcgy_101";function me(e){var n=e.reverse;return c.createElement("div",{className:d(ce,(0,s.A)({},ue,n))},c.createElement(f.A.Avatar,{active:!0,style:{height:24,width:24}}),c.createElement(f.A.Input,{active:!0,style:{width:"120",height:16}}))}var fe=(0,c.memo)(me);function pe(e){var n=e.hideAvatar,t=void 0!==n&&n;return c.createElement("div",{className:d(oe,t&&de)},c.createElement(fe,null),c.createElement("div",{className:le},t&&c.createElement(f.A.Input,{className:se,active:!0,style:{width:"60%"}}),c.createElement(f.A.Input,{className:se,active:!0,style:{width:"60%"}}),c.createElement(f.A.Input,{className:se,active:!0,style:{width:"20%"}})))}function ve(e){var n=e.hideAvatar,t=void 0!==n&&n;return c.createElement("div",{className:d(oe,ie,t&&de)},c.createElement(fe,{reverse:!0}),c.createElement("div",{className:le},t&&c.createElement(f.A.Input,{className:se,active:!0,style:{width:"60%"}}),c.createElement(f.A.Input,{className:se,active:!0,style:{width:"60%"}}),c.createElement(f.A.Input,{className:se,active:!0,style:{width:"20%"}})))}var he=(0,c.memo)(pe),ge=(0,c.memo)(ve),_e="_container_cfuw7_18",Ae="_wrapper_cfuw7_40",Ee="_hidden_cfuw7_50",be="_empty_cfuw7_54",Ce="_emptyText_cfuw7_66";var ye="_disabled_pb1b0_1",Se="_blocked_pb1b0_10",Me="_blockedContent_pb1b0_15",Ie="_navLink_pb1b0_18",ke="_unblockBtn_pb1b0_22",xe=(0,m.observer)((function(e){var n=e.className,t=e.contact,r=(0,u.u)().store,o=(0,Z.u)(),i=(0,a.A)(o,2)[1],s=r.conversationStore.routerReady,l=(0,u.p)("useContacts"),m=((null==l?void 0:l())||{}).promptUnblockContact;return c.createElement("div",{className:d(Se,n)},c.createElement("p",{className:Me},i&&s?(0,u.t)("im_block_user_text_blocked_this_user",{blockedUsers:c.createElement(p.A,{"aria-label":(0,u.t)("im_block_user_text_check_blocked"),key:"blockedUsers",className:Ie,onClick:function(){i(Z.R.blockedContacts)}},(0,u.t)("im_block_user_text_check_blocked"))}):(0,u.t)("im_block_user_text_youve_blocked_this_user")),c.createElement(v.A,{className:ke,category:v.A.CATEGORY.outline,type:v.A.TYPE.default,size:v.A.SIZE.sm,onClick:function(){return null==m?void 0:m(t)}},(0,u.t)("im_block_user_btn_unblock")))})),we=function(e){var n=e.children,t=e.className;return c.createElement("div",{className:d(ye,t)},n)},Te="_container_h8cma_1",Ne="_mess-input-content-box-reply_h8cma_8",Re="_mess-reply-close-btn_h8cma_12",Le=(0,m.observer)((function(e){var n=e.channelId,t=(0,u.u)().store.messageInputStore,r=t.getDraft,a=t.updateDraft,o=r(n).quotedMsg;return o?c.createElement("div",{className:Te},c.createElement(u.aF,{className:Ne,message:o,enableJumpToMsg:!0,offColor:!0}),c.createElement(u.I,{tipTitle:(0,u.t)("im_general_use_btn_cancel"),iconClassName:"okds-close",className:Re,as:"icon",clickHandler:function(){n&&a(n,{quotedMsg:null})}})):null}));var Oe={"voice-input-wrapper":"_voice-input-wrapper_ucwjj_1",voiceButton:"_voiceButton_ucwjj_8"},Ue=function(e){var n=function(e){var n=(0,u.u)().client;return(0,c.useCallback)((0,i.A)((0,o.A)().mark((function t(){var r,a;return(0,o.A)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n){t.next=3;break}return(0,u.w)(),t.abrupt("return");case 3:return t.prev=3,t.next=6,n.updateMicOccupancyState({occupancyInfo:u.a1.AUDIO_MESSAGE});case 6:if(!t.sent.code){t.next=9;break}return t.abrupt("return");case 9:return t.next=11,null==navigator?void 0:navigator.mediaDevices.getUserMedia({audio:!0});case 11:r=t.sent,e(!0),t.next=19;break;case 15:t.prev=15,t.t0=t.catch(3),"NotAllowedError"===(a=t.t0).name?(e(!1),u.D.tip({title:(0,u.t)("im_voice_message_modaltitle_allow_microphone"),hideCloseBtn:!1,children:c.createElement("div",null,(0,u.t)("im_voice_message_modaldesc_allow_microphone")),cancelText:(0,u.t)("im_general_use_btn_ok_error")})):u.L.warn("Unable to initialize audio stream",{error:a,tags:{feErrorType:"UserAction"}});case 19:r&&r.getTracks().forEach((function(e){e.stop()}));case 20:case"end":return t.stop()}}),t,null,[[3,15]])}))),[n])}(e.onToggleVoiceInput),t=(0,I.A)().isSm;return c.createElement(h.A,{disabled:t,title:(0,u.t)("im_voice_message_hover_voice_message"),placement:h.A.DIRECTION.top,alwaysUpdatePopper:!0},c.createElement(v.A,{category:v.A.CATEGORY.fill,strictCircle:!0,type:v.A.TYPE.primary,"aria-label":(0,u.t)("im_general_chat_hover_send"),"data-testid":"voice-button",onClick:n,className:Oe.voiceButton,htmlType:"submit"},c.createElement(u.aG,{size:20})))},Pe="_container_11f4x_24",De="_actionBtn_11f4x_33",Ge="_contentBox_11f4x_38",qe="_utilsBox_11f4x_58",Be="_inputBtn_11f4x_65",He="_withQuote_11f4x_69",Fe="_row_11f4x_73",Ve="_uploading_11f4x_80",We=c.lazy((function(){return t.e(7473).then(t.bind(t,54997))})),Ye=c.lazy((function(){return t.e(7473).then(t.bind(t,42418))})),je=c.lazy((function(){return t.e(7473).then(t.bind(t,56301))}));var ze=(0,m.observer)((function(e){var n,t,r,o=e.channel,i=e.keepInputInViewport,l=e.customPlaceHolder,m=(0,u.u)(),f=m.config,p=m.store,v=(0,u.ao)().sendMessage,h=f.message.inputBox,_=null==(n=f.message.auto)?void 0:n.focus,A=(0,c.useState)("text"),E=(0,a.A)(A,2),b=E[0],C=E[1],y=(0,c.useState)(""),S=(0,a.A)(y,2),M=S[0],I=S[1],k=null==o?void 0:o.channelId,x=(0,u.d)(),w=x.isGroupDisbanded,T=x.isGroupChatDisabled,N=x.isKickedFromGroup,R=(0,c.useRef)(null),O=(0,c.useCallback)((function(){C("text")}),[]);(0,c.useEffect)((function(){O()}),[k,O]);var U=(0,c.useCallback)((function(){var e,n;(null==(e=R.current)?void 0:e.getTextValue())&&(null==(n=R.current)||n.send())}),[]),D=w||T,G=(0,u.n)(null==o?void 0:o.contactInfo),q=Boolean(p.messageInputStore.getDraft(k).quotedMsg),B=function(e,n,t,r){return n&&e.contactInfo?c.createElement("div",{className:Pe},c.createElement(xe,{contact:e.contactInfo})):t?c.createElement(we,null,(0,u.t)("im_group_chat_placeholder_chat_disabled")):r?c.createElement(we,null,(0,u.t)("im_group_chat_placeholder_not_member")):null}(o,G,D,N),H=(0,c.useMemo)((function(){return function(e,n,t,r){return!e.length&&(null==n?void 0:n.audioInput)?c.createElement("div",{className:De},c.createElement(Ue,{onToggleVoiceInput:function(e){t(e?"voice":"text")}})):c.createElement("div",{className:De},c.createElement(P,{onClick:r,disabled:e.trim().length<=0}))}(M,h,C,U)}),[M,h,U]);return"function"===typeof(null==h?void 0:h.render)&&o?c.createElement("div",{className:Pe},null==(t=null==h?void 0:h.renderSuggestion)?void 0:t.call(h,{content:M,activeConversation:o,mode:b}),h.render(o)):B||c.createElement(c.Fragment,null,p.messageStore.hasUploadingFile&&c.createElement("div",{className:Ve},c.createElement(g.A.Circle,{size:g.A.SIZE.sm}),(0,u.t)("im_general_text_uploading")),c.createElement("section",{"aria-label":(0,u.t)("im_chat_alt_message_input_box"),className:d(Pe,(0,s.A)({},He,q))},null==(r=null==h?void 0:h.renderSuggestion)?void 0:r.call(h,{content:M,activeConversation:o,mode:b}),q&&c.createElement(Le,{channelId:k}),"voice"===b?c.createElement(c.Suspense,null,c.createElement(We,{channel:o,onDelete:O,onSendClick:O})):c.createElement("div",{className:Fe,style:{pointerEvents:o?"auto":"none"}},c.createElement("div",{className:Ge},c.createElement(L,{autoFocus:_,channel:o,ref:R,customPlaceHolder:l,onContentChange:I,keepInputInViewport:i,handleSend:v}),c.createElement(c.Suspense,{fallback:null},c.createElement("div",{className:qe},(null==h?void 0:h.mediaInput)&&o&&c.createElement(Ye,{channel:o,className:Be,handleSend:v}),(null==h?void 0:h.emojiInput)&&c.createElement(je,{className:Be,textInputRef:R})))),H)))})),Ke=(0,C.W)(ze,"InputBox"),Xe="_header_1s79y_4",Je="_toolBox_1s79y_15",Qe="_profile_1s79y_22",Ze="_userName_1s79y_34",$e="_userNameText_1s79y_38",en=function(e){var n=e.channel,t=e.conversationActions,r=(0,u.u)().store,a=r.configStore.message,o=(0,u.p)("CallUtil"),i=(0,c.useMemo)((function(){return c.createElement(u.A,{userInfo:n.entityInfo,width:40,height:40,channelType:n.channelType,withProfile:n.channelType===u.C.PRIVATE,getContainer:function(){return document.getElementById("im-sdk-popup-container")}})}),[n]),s=r.userRegistryStore.userInfoMap,l=(0,c.useMemo)((function(){return(null==n?void 0:n.entityInfo)?n.entityInfo&&"relatedId"in n.entityInfo?(0,u.a3)(n.entityInfo,null!==(e=s[n.entityInfo.relatedId])&&void 0!==e?e:{}):n.entityInfo:(u.L.info("[IM]: user entityInfo is null",{errorName:"IMError",data:{channel:n},tags:{feErrorType:"DataError"}}),{relatedId:"",avatar:"",nickname:"",tags:[]});var e}),[s,n]),m=(0,c.useMemo)((function(){if("function"===typeof(null==a?void 0:a.renderHeaderProfile)){var e=(0,u.aH)(l.tags,n.channelType===u.C.GROUP).map((function(e){return c.createElement(u.aI,{className:"im-name-tag-".concat(e.desc),tag:(0,u.t)(e.key),key:e.key})}));return a.renderHeaderProfile(n,e,i)}return c.createElement(c.Fragment,null,i,c.createElement(u.U,{userInfo:n.entityInfo,className:Ze,nameTextClassName:$e,isGroupName:n.channelType===u.C.GROUP}))}),[n,a,l,i]),f=(0,c.useMemo)((function(){return"function"===typeof(null==a?void 0:a.renderHeaderToolbar)?a.renderHeaderToolbar(n):null}),[n,a]);return c.createElement("section",{"aria-label":(0,u.t)("im_chat_alt_chat_name"),className:d("im-focusable",Xe),"data-testid":"message-list-title"},c.createElement("div",{className:Qe},m),c.createElement("div",{className:Je},t,o&&c.createElement(o,{"data-testid":"im-call-btn",channel:n,placement:_.M8.bottom}),f))},nn="_container_y3p5q_1",tn=function(e){var n=e.containerClassName,t=e.isAtScrollBottom,r=e.onClick,s=e.customRender,l=(0,c.useState)(!1),m=(0,a.A)(l,2),f=m[0],p=m[1],h=(0,c.useDeferredValue)(f),g=function(){var e=(0,i.A)((0,o.A)().mark((function e(){return(0,o.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p(!0),e.prev=1,e.next=4,r();case 4:return e.prev=4,p(!1),e.finish(4);case 7:case"end":return e.stop()}}),e,null,[[1,,4,7]])})));return function(){return e.apply(this,arguments)}}(),_=(0,c.useMemo)((function(){return function(e){var t=e.children,r=e.className;return c.createElement("div",{className:d(nn,n,r)},t)}}),[n]);return s?s({loading:h,isAtScrollBottom:t,onClick:g,Wrapper:_}):t?null:c.createElement("div",{className:nn},c.createElement(v.A,{onClick:g,"data-test-id":"scroll-to-bottom",category:v.A.CATEGORY.outline,type:v.A.TYPE.primary,strictCircle:!h,loading:h,loadingText:(0,u.t)("im_general_text_loading"),style:{background:"var(--okd-color-background-base-primary)"}},c.createElement(A.A,{iconName:"okds-arrow-pointer-down-sm"})))};function rn(e,n){var t;return Boolean(e&&n.length>0&&Number(null==(t=n[0])?void 0:t.seq)<=e)}var an=50;function on(e,n){var t=(0,u.u)().store,r=t.messageStore,a=(0,u.an)(),s=a.loadMoreMessagesFromTop,l=a.loadMoreMessagesFromBottom,d=rn(e,r.messages);return{loadMoreOlderMessages:(0,c.useCallback)((0,i.A)((0,o.A)().mark((function e(){return(0,o.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!d){e.next=2;break}return e.abrupt("return",void 0);case 2:if("loading"!==r.messagesStatus){e.next=4;break}return e.abrupt("return",void 0);case 4:if("loadingMore"!==r.messagesStatus){e.next=6;break}return e.abrupt("return",void 0);case 6:return e.abrupt("return",s(an,n,{updateLoadingStatus:!0},t.conversationStore.abortSignal));case 7:case"end":return e.stop()}}),e)}))),[d,n]),loadMoreNewerMessages:(0,c.useCallback)((0,i.A)((0,o.A)().mark((function e(){return(0,o.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",l(an,n,{updateLoadingStatus:!0},t.conversationStore.abortSignal));case 1:case"end":return e.stop()}}),e)}))),[l,n,d])}}var sn=null;function cn(e){return new Promise((function(n){var t=new IntersectionObserver((function(e){var r=e[0];n(r.isIntersecting),t.disconnect()}));t.observe(e)}))}var un=function(e){var n=e.onReached,t=(0,u.c)().activeConversation,r=(null==t?void 0:t.channelType)===u.C.PRIVATE,s=(0,c.useState)(null),l=(0,a.A)(s,2),d=l[0],m=l[1],f=(0,c.useCallback)((0,i.A)((0,o.A)().mark((function e(){return(0,o.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!d){e.next=7;break}return e.next=3,n();case 3:return e.next=5,cn(d);case 5:e.sent&&setTimeout((function(){f()}),200);case 7:case"end":return e.stop()}}),e)}))),[d]),p=function(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=n.threshold,r=void 0===t?0:t,o=n.root,i=void 0===o?null:o,s=n.rootMargin,u=void 0===s?"0%":s,l=n.freezeOnceVisible,d=void 0!==l&&l,m=n.initialIsIntersecting,f=void 0!==m&&m,p=n.onChange,v=(0,c.useState)(null),h=(0,a.A)(v,2),g=h[0],_=h[1],A=(0,c.useState)((function(){return{isIntersecting:f,entry:void 0}})),E=(0,a.A)(A,2),b=E[0],C=E[1],y=(0,c.useRef)();y.current=p;var S=(null==(e=b.entry)?void 0:e.isIntersecting)&&d;(0,c.useEffect)((function(){if(g&&"IntersectionObserver"in window&&!S){var e,n=new IntersectionObserver((function(t){var r=Array.isArray(n.thresholds)?n.thresholds:[n.thresholds];t.forEach((function(n){var t=n.isIntersecting&&r.some((function(e){return n.intersectionRatio>=e}));C({isIntersecting:t,entry:n}),y.current&&y.current(t,n),t&&d&&e&&(e(),e=void 0)}))}),{threshold:r,root:i,rootMargin:u});return n.observe(g),function(){n.disconnect()}}}),[g,JSON.stringify(r),i,u,S,d]);var M=(0,c.useRef)(null);(0,c.useEffect)((function(){var e;g||!(null==(e=b.entry)?void 0:e.target)||d||S||M.current===b.entry.target||(M.current=b.entry.target,C({isIntersecting:f,entry:void 0}))}),[g,b.entry,d,S,f]);var I=[_,!!b.isIntersecting,b.entry];return I.ref=I[0],I.isIntersecting=I[1],I.entry=I[2],I}({threshold:.01,onChange:function(e){e&&f()}}),v=p.ref;return c.createElement("div",{"data-testid":"message-list-top-end",ref:function(e){v(e),m(e)}},c.createElement(he,{hideAvatar:r}),c.createElement(ge,{hideAvatar:!0}),c.createElement(he,{hideAvatar:r}),c.createElement(ge,{hideAvatar:!0}),c.createElement(he,{hideAvatar:r}),c.createElement(ge,{hideAvatar:!0}))};var ln=(0,c.memo)((function(e){var n=e.seq,t=e.isPrivate;return c.createElement("div",{"data-purged":"true","data-seq":n},Number(n)%2===0?c.createElement(he,{hideAvatar:t}):c.createElement(ge,{hideAvatar:!0}))}));function dn(e){var n,t;return null!==(n=null==(t=e.at(-1))?void 0:t.seq)&&void 0!==n?n:-1}function mn(e){var n;return(null==e?void 0:e.querySelector("[data-msgselection]"))&&(null==(n=null==e?void 0:e.querySelector("[data-msgselection]"))?void 0:n.childNodes.length)}var fn=128,pn=64;function vn(){return(vn=(0,i.A)((0,o.A)().mark((function e(n){var t;return(0,o.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=document.getElementById(n),re.T.isIOS&&t){e.next=3;break}return e.abrupt("return");case 3:return t.style.overflowY="hidden",e.next=6,new Promise((function(e){return setTimeout(e,100)}));case 6:t.style.overflowY="auto";case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var hn="_listContainer_1mmzj_1",gn="_blocking_1mmzj_23",_n="_vList_1mmzj_31",An="_bannerContainer_1mmzj_40",En="_msgWithBannerPadding_1mmzj_47";function bn(e,n){return d((0,s.A)({},En,e&&n))}function Cn(e){return e.loading?e.extra.tempId:e.seq}var yn=(0,m.observer)((function(e){var n=e.className,t=e.channel,r=e.onMessageListScroll,s=e.seqCap,m=void 0===s?null:s,f=e.purge,p=void 0===f||f,v=e.bannerComp,h=(0,c.useId)(),_=(0,u.u)(),A=_.client,b=_.store,C=_.theme,y=b.messageStore,S=b.configStore,M=y.messagesStatus,I=null==t?void 0:t.channelId,k=(0,u.an)(),x=k.loadLatestMessages,w=k.jumpToMessage,T=(0,$.computed)((function(){return function(e,n){var t=e.messages.filter((function(e){return!1!==e.visible}));if(null==n)return t;var r=t.findIndex((function(e){return Number(e.seq)>=n}));return-1===r?[]:t.slice(r)}(y,m)})),N=T.get(),R=(0,c.useState)(!1),L=(0,a.A)(R,2),O=L[0],U=L[1],P=(0,c.useRef)(!1),D=(0,c.useRef)(null),G=(0,c.useRef)({startIndex:0,endIndex:0}),q=function(e,n,t,r,a){var s=(0,u.u)(),l=s.store,d=s.client,m=l.messageStore,f=(0,c.useRef)(!1);function p(){return v.apply(this,arguments)}function v(){return(v=(0,i.A)((0,o.A)().mark((function t(){var a,i,s,c,l,p,v,h;return(0,o.A)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=e.get(),n.current){t.next=3;break}return t.abrupt("return");case 3:if(a.length){t.next=5;break}return t.abrupt("return");case 5:if(f.current){t.next=7;break}return t.abrupt("return");case 7:for(i=n.current,s=Math.max(i.startIndex-180,0),c=Math.min(i.endIndex+180,a.length),m.purgeMessages(s,c),l=[],p=s;p<c;p++)v=a[p],(0,u.aJ)(v)&&l.push(v.seq);if(!r||!l.length){t.next=18;break}return t.next=16,null==d?void 0:d.driver.fetchMessagesBySeqList({channelId:r,seqList:l});case 16:h=t.sent,m.restoreMessages(h);case 18:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return(0,c.useEffect)((function(){f.current=!1,t?setTimeout((function(){f.current=!0}),3e3):f.current=!1}),[t,r]),(0,c.useEffect)((function(){if(f.current){if(a){var e=setInterval((function(){p()}),500);return function(){clearInterval(e)}}p()}}),[t,a,e]),{purgeAndRestore:p,pausePurge:function(){f.current=!1,setTimeout((function(){f.current=!0}),1e3)},shouldUsePurgeMechanism:f}}(T,G,p,I,O),B=q.pausePurge,H=(0,c.useCallback)((function(){return function(e){return vn.apply(this,arguments)}(h)}),[h]),F=function(e,n,t,r,a){var s=(0,u.an)().loadLatestMessages,l=null==e?void 0:e.channelId,d=(0,c.useRef)(!1),m=(0,u.u)().store,f=m.messageStore,p=(0,c.useCallback)(function(){var e=(0,i.A)((0,o.A)().mark((function e(i){var c;return(0,o.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.force||!d.current){e.next=2;break}return e.abrupt("return");case 2:if(n.current){e.next=4;break}return e.abrupt("return");case 4:if("detached"!==f.listMode){e.next=11;break}return c=m.conversationStore.abortSignal,f.resetListStates(!0),e.next=9,s({channelId:l,lastSeq:Number.MAX_SAFE_INTEGER,signal:c});case 9:e.next=15;break;case 11:return t&&r(),e.next=14,a();case 14:n.current.scrollToIndex(Number.MAX_SAFE_INTEGER,{align:"end",smooth:i.smooth});case 15:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),[l,s,f,t,a]);return p}(t,D,p,B,H),V=function(e,n,t,r,a){var s,l=(0,u.u)(),d=l.client,m=l.store,f=l.config,p=(0,c.useRef)(!1),v=n.get(),h=(0,c.useCallback)((function(){m.messageStore.setMaintainScrollPositionFromBottom(!1),p.current=!1,m.messageStore.setIsAtScrollBottom(!0)}),[m]),g=!1===(null==(s=f.message.auto)?void 0:s.scroll)||!!f.message.disableAutoScroll||"detached"===m.messageStore.listMode,_=(0,c.useCallback)(function(){var e=(0,i.A)((0,o.A)().mark((function e(r){var i,s=arguments;return(0,o.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=s.length>1&&void 0!==s[1]?s[1]:{align:"center",smooth:!1},t){e.next=3;break}return e.abrupt("return",void 0);case 3:return e.next=5,a();case 5:return e.next=7,(0,Z.f)();case 7:return e.abrupt("return",new Promise((function(e){var a=n.get().findIndex((function(e){return e.seq==r}));if(-1===a)return e(!1);t.scrollToIndex(a+1,i),e(!0),(0,Z.f)().then((function(){var e=document.querySelector('[data-seq="'.concat(r,'"]'));e&&!e.getAttribute("data-purged")||setTimeout((function(){a=n.get().findIndex((function(e){return e.seq==r})),t.scrollToIndex(a+1,i)}),400)})).catch(console.error)})));case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),[t,a,n]),A=(0,c.useCallback)(function(){var e=(0,i.A)((0,o.A)().mark((function e(r){var a,i;return(0,o.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",void 0);case 2:if(-1!==(a=n.get().findIndex((function(e){return e.seq==r})))){e.next=5;break}return e.abrupt("return",!1);case 5:if(t.scrollToIndex(a+1,{align:"center",smooth:!1}),i=document.querySelector('[data-seq="'.concat(r,'"][data-msgselection]'))){e.next=9;break}return e.abrupt("return",!1);case 9:return i.focus(),e.abrupt("return",void 0);case 11:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),[t,a,n]),E=(0,c.useCallback)(function(){var e=(0,i.A)((0,o.A)().mark((function e(n){var t,r;return(0,o.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,Z.f)();case 2:return e.next=4,new Promise((function(e){return setTimeout(e,300)}));case 4:if(t=document.querySelector('[data-seq="'.concat(n,'"]'))){e.next=7;break}return e.abrupt("return");case 7:if(r=t.parentElement){e.next=10;break}return e.abrupt("return");case 10:r.setAttribute("data-highlighted","true"),setTimeout((function(){r.removeAttribute("data-highlighted")}),1e3);case 12:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),[]);(0,c.useEffect)((function(){return(0,u.H)("OK-IM-SCROLL-TO-MESSAGE",function(){var n=(0,i.A)((0,o.A)().mark((function n(t){return(0,o.A)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t.channelId===e){n.next=2;break}return n.abrupt("return");case 2:return n.next=4,_(t.seq,t.scrollOptions);case 4:t.shouldHighlight&&E(t.seq);case 5:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())}),[e,E,_]);var b=v.length>0;return(0,c.useEffect)((function(){var n=(0,u.H)("MESSAGE_LIST_SCROLL_TO_BOTTOM",(function(n){var t;if(n.channelId===e){var a,o=null===(t=n.force)||void 0===t||t;m.messageStore.isAtScrollBottom?r({smooth:!0,force:o}):(m.messageStore.setIsAtScrollBottom(!0),r({smooth:null!==(a=n.smooth)&&void 0!==a&&a,force:o}))}})),t=function(){p.current=!0};return null==d||d.on("onRecvNewMessage",t),function(){n(),null==d||d.off("onRecvNewMessage",t),h()}}),[b,e,r,h]),(0,c.useLayoutEffect)((function(){m.messageStore.setMaintainScrollPositionFromBottom(!1)})),(0,c.useLayoutEffect)((function(){t&&!(0,ne.f)()&&(document.hidden||v.length&&(g||m.messageStore.isAtScrollBottom&&r({smooth:p.current,force:!0})))}),[m,v.length,e,g,t]),{scrollToBottom:r,hasScrolledToBottomForInitialLoad:p,resetScrollStates:h,scrollToSeq:_,highlightMessage:E,scrollAndFocusToSeq:A}}(I,T,D.current,F,H),W=V.scrollAndFocusToSeq,Y=N.length?c.createElement("div",{className:An},v):null;!function(e,n){var t=(0,u.u)(),r=t.store,a=t.client,s=r.messageStore,l=s.setMessagesStatus,d=s.setLoadedEarliestMsgSeq,m=function(){var t=(0,i.A)((0,o.A)().mark((function t(){var i,c,u;return(0,o.A)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return l("loading"),t.next=3,null==a?void 0:a.driver.conversationController.refreshConversationNewestSeq(e);case 3:(null==(i=t.sent)?void 0:i.channelId)===r.conversationStore.activeConversationId&&d(null!==(c=Number(null==i?void 0:i.seq))&&void 0!==c?c:Number.MAX_SAFE_INTEGER),u=r.conversationStore.abortSignal,n({channelId:e,lastSeq:s.loadedEarliestMsgSeq,signal:u}).then((function(){u.aborted||l("success")})).catch((function(e){u.aborted||(console.error(e),l("error"))}));case 7:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();(0,c.useEffect)((function(){return m(),function(){s.resetListStates()}}),[e])}(I,x),function(e,n){var t=(0,l.a)(e),r=on(e,n).loadMoreOlderMessages;(0,c.useEffect)((function(){null==e&&null!=t&&r()}),[e,t,r])}(m,I);var j=function(e){var n=(0,u.u)().store.messageStore,t=(0,c.useRef)({prevViewportSize:0,upperThreshold:fn,lowerThreshold:pn}),r=(0,c.useMemo)((function(){return(0,te.A)((function(){if(!e.current||!e.current.viewportSize)return null;var r=t.current,a=r.lowerThreshold,o=r.prevViewportSize;0!==o&&o!==e.current.viewportSize&&(t.current.upperThreshold=a+100+Math.abs(o-e.current.viewportSize)),t.current.prevViewportSize=e.current.viewportSize;var i=t.current.upperThreshold,s=e.current.scrollSize-e.current.viewportSize-e.current.scrollOffset,c=n.isAtScrollBottom;return!c&&s<a?n.setIsAtScrollBottom(!0):c&&s>i&&n.setIsAtScrollBottom(!1),{offsetFromBottom:s}}),200,{leading:!1})}),[n]);return(0,c.useEffect)((function(){t.current.upperThreshold=fn,r()}),[n.messagesCount]),(0,c.useEffect)((function(){var e=function(){document.hidden||r()};return document.addEventListener("visibilitychange",e),function(){document.removeEventListener("visibilitychange",e)}}),[]),r}(D),z=function(e){var n,t,r=(0,u.u)(),a=r.store,o=r.client,i=r.config,s=(0,c.useMemo)((function(){return(0,u.ai)(a.messageStore,o)}),[a.messageStore,o]),l=null==e?void 0:e.channelId,d=a.messageStore.messages,m=null==e?void 0:e.unreadCount,f=Number(null!==(n=null==e?void 0:e.lastReadMsgSeq)&&void 0!==n?n:0),p=!1===(null==(t=i.message.auto)?void 0:t.read);return(0,c.useMemo)((function(){return(0,ae.A)((function(e,n){if(!document.hidden&&!p){var t=d.slice(e,n+1).filter((function(e){return e&&!(0,u.aJ)(e)&&!e.isSender&&f<Number(e.seq)}));if(t.length){var r=t[t.length-1];r.channelId===l&&s(r)}}}),100)}),[l,f,s,d,m,p])}(t),K=function(e,n,t){var r=null==e?void 0:e.channelId,a=(0,u.u)().store.messageStore,o=rn(t,a.messages),i=on(t,r),s=i.loadMoreNewerMessages,l=i.loadMoreOlderMessages;return{header:(0,c.useMemo)((function(){return o||"idle"===a.messagesStatus||"loading"===a.messagesStatus||a.topEndReached?sn:c.createElement(un,{onReached:l})}),[o,a.messagesStatus,a.topEndReached,l]),footer:"normal"!==a.listMode&&Number(a.loadedLatestMsgSeq)<Number(e.lastReceivedMsgSeq)?"normal"===a.listMode?c.createElement("div",{style:{paddingBottom:"var(--message-gap, 24px)"}}):n.length?c.createElement(un,{onReached:s}):sn:c.createElement("div",{style:{paddingBottom:"var(--message-gap, 24px)"}})}}(t,N,m),X=K.header,J=K.footer,re=function(e,n,t,r){var o=(0,c.useState)(-1),i=(0,a.A)(o,2),s=i[0],u=i[1];(0,c.useEffect)((function(){u(-1)}),[e]);var l=document.getElementById(r),d=(0,c.useCallback)((function(){u((function(e){var r,a;if(-1===e)return dn(n.get());var o=null==(r=null==l?void 0:l.querySelector('[data-seq="'.concat(e,'"]')))?void 0:r.parentElement;if(o){for(var i=o.nextElementSibling;i&&!mn(i);)i=i.nextElementSibling;if(i){var s=Number(null==(a=i.querySelector("[data-seq]"))?void 0:a.getAttribute("data-seq"));return t(s),Number(s)}}else t(e);return e}))}),[n,t]),m=(0,c.useCallback)((function(){u((function(e){var r,a;if(-1===e)return dn(n.get());var o=null==(r=null==l?void 0:l.querySelector('[data-seq="'.concat(e,'"]')))?void 0:r.parentElement;if(o){for(var i=o.previousElementSibling;i&&!mn(i);)i=i.previousElementSibling;if(i){var s=Number(null==(a=i.querySelector("[data-seq]"))?void 0:a.getAttribute("data-seq"));return t(s),Number(s)}}else t(e);return e}))}),[n,t]),f=(0,c.useCallback)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ArrowDown";return"ArrowDown"===e?d():"ArrowUp"===e?m():void 0}),[n]),p=(0,c.useCallback)((function(e){if("ArrowDown"===e.key||"ArrowUp"===e.key){var r=n.get().at(-1);if(!r)return;if(e.preventDefault(),-1===s)return u(r.seq),void t(r.seq);f(e.key)}}),[s,n]);return{focusedSeq:s,setFocusedSeq:u,moveFocusedSeq:f,keyDownHandler:p}}(I,T,W,h),oe=re.keyDownHandler;return function(e,n){(0,c.useEffect)((function(){var t=(0,u.H)("MESSAGE_LIST_JUMP_TO_MESSAGE",(function(t){t.channelId===e&&n({seq:t.seq,channelId:t.channelId,shouldHighlight:t.shouldHighlight})}));return function(){t()}}),[e])}(I,w),c.createElement("section",{className:d(hn,n,"im-theme-".concat(C||"light")),id:"mess-list-wrapper","data-testid":"message-list","aria-label":(0,u.t)("im_chat_alt_messages_in_this_chat"),onKeyDown:oe},["idle","loading","loadingBlocking"].includes(M)&&c.createElement("div",{className:gn,style:{cursor:"loadingBlocking"===M?"wait":"auto",display:["loading","loadingBlocking"].includes(M)?"block":"none"}},c.createElement("div",{className:"im-delayed-spinner"},c.createElement(g.A,null))),Y,c.createElement(ee.n,{key:I,style:{display:["success","loadingMore","loadingBlocking"].includes(M)?"block":"none"},id:h,"data-name":"im-message-list","data-instance":null==A?void 0:A.app,className:_n,role:"feed","aria-roledescription":(0,u.t)("im_chat_alt_desc_chat"),"aria-busy":["loadingBlocking","loadingMore"].includes(M),"aria-label":(0,u.t)("im_chat_alt_selected_message",{channelName:(0,u.i)(t.entityInfo)}),ref:D,overscan:5,onRangeChange:function(e,n){var t=Math.max(e-1,0),r=Math.max(n-1,t);G.current.startIndex=t,G.current.endIndex=r,z(t,r)},shift:y.maintainScrollPositionFromBottom,onScrollEnd:function(){P.current=!1,(0,c.startTransition)((function(){U(!1)})),j()},onScroll:function(){P.current=!0,(0,c.startTransition)((function(){U(!0)}));var e=(j()||{}).offsetFromBottom;e&&"function"===typeof r&&r({offsetFromBottom:e})}},X,N.map((function(e,n){var r,a,o,i,s=e.seq==N[0].seq,l=e.seq==N[N.length-1].seq,d=s?{}:N[n-1];return(0,u.aJ)(e)?c.createElement(ln,{key:null!==(o=null!==(i=e.seq)&&void 0!==i?i:null==(a=null==e?void 0:e.extra)?void 0:a.tempId)&&void 0!==o?o:e.clientMsgId,isPrivate:(null==t?void 0:t.channelType)===u.C.PRIVATE,seq:e.seq}):c.createElement(Q,{className:bn(s,v),selectable:l,key:Cn(e),"data-key":Cn(e),message:e,prevMessage:d,lastReadMsgSeq:Number(null!==(r=t.oppositeLastReadMsgSeq)&&void 0!==r?r:0),channel:t})})),J),c.createElement(tn,{onClick:function(){return F({smooth:!1,force:!0})},customRender:S.message.renderScrollToBottom,isAtScrollBottom:null==y?void 0:y.isAtScrollBottom}),c.createElement(E.A,{id:u.aK.comma,"aria-label":","}),c.createElement(E.A,{id:u.aK.isMe,"aria-label":(0,u.t)("im_chat_alt_sender_you")}))})),Sn=(0,c.memo)((function(e){var n=e.loading,t=e.title,r=(0,u.u)().theme;return n?c.createElement("div",{className:"im-delayed-spinner"},c.createElement(g.A,null)):c.createElement(b.A,{className:be,imgSrc:"".concat((0,u.g)(),"light"===r?"/cdn/assets/imgs/2412/E166B7CA4C7315BA.png":"/cdn/assets/imgs/2412/4CE58C7F6250D465.png"),title:c.createElement("span",{className:Ce},t)})}));var Mn=(0,m.observer)((function(e){var n,t,a,m=e.messBoxClassName,f=e.managementBoxClassName,p=e.announcementBoxClassName,v=e.config,h=e.useLoadingAsEmptyUI,g=void 0!==h&&h,_=e.seqCap,A=e.onMessageListScroll,E=e.keepInputInViewport,b=void 0!==E&&E,C=e.purge,y=e.customPlaceHolder,S=(0,u.u)(),M=S.config,I=S.client,k=(0,u.c)(),x=k.activeConversation,w=k.conversationId,T=k.isPrivateChat,N=k.relatedEntityId;!function(){var e=(0,u.u)(),n=e.client,t=e.ready,r=(0,u.d)(),a=r.isGroup,s=r.groupMemberMap,l=r.groupInfo,d=r.groupId,m=r.isGroupInactive,f=(0,c.useCallback)(function(){var e=(0,i.A)((0,o.A)().mark((function e(t){return(0,o.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=3;break}return(0,u.w)(),e.abrupt("return",void 0);case 3:return e.abrupt("return",n.getGroupInfo({channelId:t}));case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),[n]),p=(0,c.useCallback)(function(){var e=(0,i.A)((0,o.A)().mark((function e(t){return(0,o.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=3;break}return(0,u.w)(),e.abrupt("return",void 0);case 3:return e.abrupt("return",n.getGroupMemberList({channelId:t}));case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),[n]),v=t&&a&&!l&&!m;(0,c.useEffect)((function(){var e;d&&v&&((null==(e=null==n?void 0:n.config)?void 0:e.anonymousMode)||f(d))}),[n,v,d,f]);var h=t&&a&&!(null==s?void 0:s.size)&&!m;(0,c.useEffect)((function(){var e;d&&h&&((null==(e=null==n?void 0:n.config)?void 0:e.anonymousMode)||p(d))}),[n,h,d,p])}();var R=(0,u.p)("useGroupManagement"),L=null==R?void 0:R({channel:x,managementBoxClassName:f});!function(e){var n=(0,u.u)().client,t=(0,u.d)().isKickedFromGroup;(0,c.useEffect)((function(){if(e&&t)var r=u.D.confirmation({title:(0,u.t)("im_group_chat_modaltitle_not_member"),children:c.createElement("span",{className:"im-dialog-confirmation-content"},(0,u.t)("im_group_chat_modaldesc_not_member")),confirmText:(0,u.t)("im_general_use_btn_ok_error"),onConfirm:function(){null==n||n.driver.groupController.hideGroup(e),r.destroy()}})}),[t,n,e])}(w),function(e){var n=(0,u.u)().client,t=(0,u.d)(),r=t.isGroupDisbanded,a=t.isGroupOwner;(0,c.useEffect)((function(){if(e&&r&&!a)var t=u.D.confirmation({title:(0,u.t)("im_group_chat_modaltitle_group_disbanded"),children:c.createElement("span",{className:"im-dialog-confirmation-content"},(0,u.t)("im_group_chat_modaldesc_group_disbanded")),confirmText:(0,u.t)("im_general_use_btn_ok_error"),onConfirm:function(){null==n||n.driver.groupController.hideGroup(e),t.destroy()}})}),[e,n,r,a])}(w);var O=(0,Z.a)().fetchUserInfo,U=(0,u.p)("useAnnouncement"),P=(null==U?void 0:U({announcementBoxClassName:p}))||{},D=P.pinBanner,G=P.bannersComponent,q=P.AnnouncementContent,B=P.AnnouncementToggle,H=P.showAnnouncementSettings,F=(0,c.useCallback)((function(){return null==D?void 0:D({id:"bewareScamAlert_".concat(w),order:20,title:(0,u.t)("im_add_contact_alert_title_beware_of_scams"),content:(0,u.t)("im_add_contact_alert_text_official_users_scam"),type:"info"})}),[D,w]);(0,c.useEffect)((function(){T&&N&&O({userId:N}).catch((function(e){return console.log(e)}))}),[T,N,O]);var V=M.message;!function(e){var n=(0,u.u)().store;(0,c.useEffect)((function(){e&&(n.configStore.updateMessageConfig(e),"compact"===e.mode&&n.configStore.updateMessageConfig((0,r.A)((0,r.A)({},e),{},{outMessageUserTag:!1})))}),[e,n])}(v);var W=T&&!(0,u.m)(null==x?void 0:x.contactInfo)&&!(0,u.j)(null==(n=null==I?void 0:I.queryUserInfo())?void 0:n.tags)&&!(0,u.j)(null==(t=null==x?void 0:x.contactInfo)?void 0:t.tags)&&(null==(a=M.message)?void 0:a.displayScamWarningBanner);(0,c.useEffect)((function(){if(W)return F()}),[F,W]);var Y=(0,u.p)("contactManagement"),j=(null!==Y&&void 0!==Y?Y:{}).StrangerBottomBanner,z=(0,c.useMemo)((function(){switch(!0){case!T:case!j:case!(null==x?void 0:x.contactInfo):return null;default:return c.createElement(j,{contactInfo:x.contactInfo})}}),[j,null==x?void 0:x.contactInfo,T]);return function(){var e=(0,u.u)().store,n=(0,u.J)().activeConversation,t=(0,l.u)((null==n?void 0:n.channelType)===u.C.GROUP?!(null==n?void 0:n.groupInfo)||"idle"===e.messageStore.messagesStatus||"loading"===e.messageStore.messagesStatus:(null==n?void 0:n.channelId)?"idle"===e.messageStore.messagesStatus||"loading"===e.messageStore.messagesStatus:void 0);(0,c.useEffect)((function(){var r,a;t&&(0,u.V)("IMChatFullPageView",{channel_id:null==n?void 0:n.channelId,chat_name:(0,u.h)(null==n?void 0:n.entityInfo,e.userRegistryStore),channel_type:null==n?void 0:n.channelType,group_type:null!==(a=null==(r=null==n?void 0:n.groupInfo)?void 0:r.type)&&void 0!==a?a:null,load_time:t})}),[t])}(),c.createElement(u.aA,null,c.createElement("div",{"data-mode":null==v?void 0:v.mode,className:_e},c.createElement("div",{className:d(m,Ae,(0,s.A)({},Ee,H))},x?c.createElement(c.Fragment,null,!1!==(null==v?void 0:v.header)&&!1!==V.header&&c.createElement(en,{channel:x,conversationActions:c.createElement(c.Fragment,null,B,null==L?void 0:L.groupMgmtToggle)}),"function"===typeof(null==v?void 0:v.renderBanner)&&v.renderBanner(x),c.createElement(yn,{channel:x,seqCap:_,onMessageListScroll:A,purge:C,bannerComp:G}),z,c.createElement(Ke,{channel:x,keepInputInViewport:b,customPlaceHolder:y})):c.createElement(Sn,{title:(0,u.t)("im_landing_empty_stay_connected"),loading:g})),q,null==L?void 0:L.groupMgmtPanel))})),In=(0,C.W)(Mn,"MessageBox")},74286:(e,n,t)=>{t.r(n),t.d(n,{IMChatBtmSendClick:()=>o,IMChatBtmSendClick_TRD:()=>i,IMChatFileOpenClick:()=>A,IMChatFileOpenClick_TRD:()=>E,IMChatFullPageView:()=>s,IMChatFullPageView_TRD:()=>c,IMChatLinkOpenClick:()=>g,IMChatLinkOpenClick_TRD:()=>_,IMChatMessagePushAckSuccess:()=>v,IMChatMessagePushAckSuccess_TRD:()=>h,IMChatMessageSendClick:()=>d,IMChatMessageSendClick_TRD:()=>m,IMChatMessageSentAckSuccess:()=>f,IMChatMessageSentAckSuccess_TRD:()=>p,IMHomepageFullPageView:()=>u,IMHomepageFullPageView_TRD:()=>l,monitorIm:()=>a});var r={act:function(){}};"undefined"!==typeof window&&(r=window.utils.monitor.newInstance({product:"im",commonParams:{}}));var a=r,o=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).button_name;a.act({action:"IMChat_Btm_Send_Click",anchor:"IMChat_Btm_Send_Click",params:{button_name:e},actionType:"",elementType:"",ampProject:"okx"})},i=function(){a.triggerReportDuration("IMChat_Btm_Send_Click")},s=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.group_type,t=e.channel_type,r=e.chat_name,o=e.channel_id,i=e.load_time;a.act({action:"IMChat_Full_Page_View",anchor:"IMChat_Full_Page_View",params:{group_type:n,channel_type:t,chat_name:r,channel_id:o,load_time:i},actionType:"",elementType:"",ampProject:""})},c=function(){a.triggerReportDuration("IMChat_Full_Page_View")},u=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.origin,t=e.load_time;a.act({action:"IMHomepage_Full_Page_View",anchor:"IMHomepage_Full_Page_View",params:{origin:n,load_time:t},actionType:"",elementType:"",ampProject:""})},l=function(){a.triggerReportDuration("IMHomepage_Full_Page_View")},d=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.group_type,t=e.channel_type,r=e.chat_name,o=e.channel_id,i=e.message_type,s=e.timestamp,c=e.message_id;a.act({action:"IMChat_Message_Send_Click",anchor:"IMChat_Message_Send_Click",params:{group_type:n,channel_type:t,chat_name:r,channel_id:o,message_type:i,timestamp:s,message_id:c},actionType:"",elementType:"",ampProject:"okx"})},m=function(){a.triggerReportDuration("IMChat_Message_Send_Click")},f=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.group_type,t=e.channel_type,r=e.chat_name,o=e.channel_id,i=e.message_type,s=e.timestamp,c=e.message_id;a.act({action:"IMChat_Message_SentAck_Success",anchor:"IMChat_Message_SentAck_Success",params:{group_type:n,channel_type:t,chat_name:r,channel_id:o,message_type:i,timestamp:s,message_id:c},actionType:"",elementType:"",ampProject:"okx"})},p=function(){a.triggerReportDuration("IMChat_Message_SentAck_Success")},v=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.group_type,t=e.channel_type,r=e.chat_name,o=e.channel_id,i=e.message_type,s=e.timestamp,c=e.message_id;a.act({action:"IMChat_Message_PushAck_Success",anchor:"IMChat_Message_PushAck_Success",params:{group_type:n,channel_type:t,chat_name:r,channel_id:o,message_type:i,timestamp:s,message_id:c},actionType:"",elementType:"",ampProject:"okx"})},h=function(){a.triggerReportDuration("IMChat_Message_PushAck_Success")},g=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.group_type,t=e.channel_type,r=e.chat_name,o=e.channel_id,i=e.sender_group_role,s=e.link_location,c=e.link_url;a.act({action:"IMChat_Link_Open_Click",anchor:"IMChat_Link_Open_Click",params:{group_type:n,channel_type:t,chat_name:r,channel_id:o,sender_group_role:i,link_location:s,link_url:c},actionType:"",elementType:"",ampProject:"okx"})},_=function(){a.triggerReportDuration("IMChat_Link_Open_Click")},A=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.group_type,t=e.channel_type,r=e.chat_name,o=e.channel_id,i=e.sender_group_role,s=e.file_type;a.act({action:"IMChat_File_Open_Click",anchor:"IMChat_File_Open_Click",params:{group_type:n,channel_type:t,chat_name:r,channel_id:o,sender_group_role:i,file_type:s},actionType:"",elementType:"",ampProject:"okx"})},E=function(){a.triggerReportDuration("IMChat_File_Open_Click")}},47322:(e,n,t)=>{t.d(n,{a:()=>a,m:()=>r});var r=function(e){var n=window.getSelection();if(e&&n){var t=document.createRange(),r=e.firstChild;r&&(r.nodeType===Node.TEXT_NODE?t.setStart(r,0):t.setStartBefore(r),t.collapse(!0),n.removeAllRanges(),n.addRange(t))}},a=function(e){var n,t=window.getSelection();if(e&&t){var r=t.getRangeAt(0),a=e.lastChild;a&&(a.nodeType===Node.TEXT_NODE?r.setStart(a,(null==(n=null==a?void 0:a.nodeValue)?void 0:n.length)||0):r.setStartAfter(a),r.collapse(!0),t.removeAllRanges(),t.addRange(r))}}},65603:(e,n,t)=>{t.d(n,{a:()=>s,b:()=>c,c:()=>f,d:()=>u,e:()=>d,f:()=>p,g:()=>g,h:()=>m,i:()=>v,j:()=>l,k:()=>h});var r=t(89379),a=t(57394),o=t(8675);function i(e){var n=e.data,t=e.senderUid,r=e.channelType;return{senderUid:t,channelId:n.channelId,senderPlatformType:a.av.WEB,channelType:r,messageContentType:a.au.USER_MSG_TYPE,extra:n.extra||{},sendTime:String((new Date).getTime()),createTime:""}}var s=function(e,n,t){return(0,r.A)((0,r.A)({},i({data:e,senderUid:n,channelType:t})),{},{contentType:a.Y.RECEIPT_MESSAGE,readReceiptMessage:{lastMsgSeq:e.seq}})},c=function(e,n,t){return(0,r.A)((0,r.A)({},i({data:e,senderUid:n,channelType:t})),{},{contentType:a.Y.RECALL_MESSAGE,senderRecallMessage:{msgSeq:e.seq}})},u=function(e,n,t){return(0,r.A)((0,r.A)({},i({data:e,senderUid:n,channelType:t})),{},{contentType:a.Y.RECALL_MESSAGE_BY_ADMIN,adminRecallMessage:{msgSeq:e.seq}})},l=function(e,n,t){return(0,r.A)((0,r.A)({},i({data:e,senderUid:n,channelType:t})),{},{contentType:a.Y.TEXT_MESSAGE,textMessage:(0,r.A)({},e.messageContent),seq:e.seq,isSender:!0})},d=function(e,n,t){return(0,r.A)((0,r.A)({},i({data:e,senderUid:n,channelType:t})),{},{contentType:a.Y.PICTURE_MESSAGE,imageMessage:(0,r.A)({},e.messageContent),seq:e.seq,isSender:!0})},m=function(e,n,t){return(0,r.A)((0,r.A)({},i({data:e,senderUid:n,channelType:t})),{},{contentType:a.Y.MEDIA_MESSAGE,mediaMessage:(0,r.A)({},e.messageContent),seq:e.seq,isSender:!0})},f=function(e,n,t){return(0,r.A)((0,r.A)({},i({data:e,senderUid:n,channelType:t})),{},{contentType:a.Y.VOICE_CALL_MESSAGE,callMessage:(0,r.A)({},e.messageContent),isSender:!0})},p=function(e,n,t){return(0,r.A)((0,r.A)({},i({data:e,senderUid:n,channelType:t})),{},{contentType:a.Y.VIDEO_MESSAGE,videoMessage:(0,r.A)({},e.messageContent),seq:e.seq,isSender:!0})},v=function(e,n,t){return(0,r.A)((0,r.A)({},i({data:e,senderUid:n,channelType:t})),{},{contentType:a.Y.VOICE_MESSAGE,voiceMessage:(0,r.A)({},e.messageContent),seq:e.seq,isSender:!0})},h=function(e,n,t){return(0,r.A)((0,r.A)({},i({data:e,senderUid:n,channelType:t})),{},{contentType:a.Y.CUSTOM_MESSAGE,customMessage:(0,r.A)({},e.messageContent),seq:e.seq,isSender:!0})},g=function(e){var n="".concat("tmp-im","-").concat((0,o.n)());return e&&(n+="-".concat(e)),n}},96188:(e,n,t)=>{t.d(n,{a:()=>o,u:()=>i});var r=t(5544),a=t(41594);function o(e){var n=(0,a.useRef)();return(0,a.useEffect)((function(){n.current=e}),[e]),n.current}var i=function(e){var n=o(e),t=(0,a.useState)(0),i=(0,r.A)(t,2),s=i[0],c=i[1],u=(0,a.useRef)(Date.now());return(0,a.useEffect)((function(){n!==e&&!0===e&&(u.current=Date.now(),c(0)),n!==e&&!1===e&&c(Date.now()-u.current)}),[s,e,n]),s}},72446:(e,n,t)=>{t.d(n,{a:()=>c,b:()=>u,c:()=>l,d:()=>p,g:()=>f,i:()=>h,p:()=>m,s:()=>v});var r=t(89379),a=t(24765),o=t(90675),i=t(10467),s=t(57394),c=function(e){var n,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return function(){};var r=document.querySelector('audio[src="'.concat(e,'"]'));return r||((r=document.createElement("audio")).src=e,document.body.appendChild(r)),r.loop=t,null==(n=r.play())||n.catch((function(e){console.warn("Audio playback failed. Note that Audio cannot play before DOM interaction",e)})),function(){r&&(r.pause(),r.currentTime=0)}},u=function(){var e=(0,i.A)((0,o.A)().mark((function e(n,t,r){var a;return(0,o.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Notification"in window){e.next=2;break}return e.abrupt("return");case 2:if(e.prev=2,"granted"===Notification.permission){e.next=9;break}return e.next=6,Notification.requestPermission();case 6:if("denied"!==e.sent){e.next=9;break}return e.abrupt("return");case 9:(a=new Notification(n||"Hi",{body:t,requireInteraction:!1,silent:!0,tag:r})).onclick=function(){window.focus(),a.close()},a.onclose=window.clearTimeout.bind(null,setTimeout((function(){a.close()}),3e3)),e.next=16;break;case 14:e.prev=14,e.t0=e.catch(2);case 16:case"end":return e.stop()}}),e,null,[[2,14]])})));return function(n,t,r){return e.apply(this,arguments)}}(),l=function(e){var n,t=e.message,r=e.myUid,a=!1;return!t.isSender&&t.textMessage&&(null==(n=t.textMessage.atUserList)||n.some((function(e){return e.uid===r&&(a=!0,!0)}))),a};function d(e,n){return e.contentType!==s.Y.SYSTEM_MESSAGE&&!e.isSender&&Number(e.seq)>n}var m=function(e){var n,t,o=e.myUid,i=e.channel,c=e.newMsgList,u=e.shouldCountAsUnread;if(null==c?void 0:c.length){c.sort((function(e,n){return Number(e.sendTime)-Number(n.sendTime)}));var m,f=0,p=i.groupAtType===s.M.AT_ME,v=i.groupAtType===s.M.AT_ALL,h=Number(i.lastReadMsgSeq),g=(0,a.A)(c);try{for(g.s();!(m=g.n()).done;){var _=m.value;d(_,h)&&(u(_)&&f++,p=p||l({message:_,myUid:o}),v=v||(null==(n=null==_?void 0:_.textMessage)?void 0:n.atType)===s.M.AT_ALL)}}catch(y){g.e(y)}finally{g.f()}var A=c[c.length-1];String(i.lastReceivedMsgSeq)===String(null==A?void 0:A.seq)&&(f=0);var E=null==(t=null==A?void 0:A.systemMessage)?void 0:t.systemAction,b=A.contentType===s.Y.SYSTEM_MESSAGE&&(!Object.values(s.a7).includes(E)||s.a5.includes(E)),C=s.M.NORMAL;return p?C=s.M.AT_ME:v&&(C=s.M.AT_ALL),(0,r.A)((0,r.A)((0,r.A)({},i),b?{}:{lastUserMsg:A}),{},{lastReceivedMsgSeq:String(A.seq),unreadCount:i.unreadCount+f,groupAtType:C})}};function f(e){return[s.a7.REFRESH_CONVERSATION].includes(e)?"refreshConversation":[s.a7.NEW_GROUP_ANNOUNCEMENT,s.a7.REMOVE_GROUP_ANNOUNCEMENT].includes(e)?"groupAnnouncement":[s.a7.ENABLE_GROUP_CHAT,s.a7.DISABLE_GROUP_CHAT,s.a7.ENABLE_GROUP_LINK,s.a7.DISABLE_GROUP_LINK,s.a7.ENABLE_GROUP_MENTION,s.a7.DISABLE_GROUP_MENTION].includes(e)?"groupSetting":[s.a7.INVITE_GROUP_MEMBER,s.a7.MEMBER_QUIT_GROUP].includes(e)?"groupMember":[s.a7.ADD_GROUP_ADMIN_MORE_THAN_5,s.a7.REMOVE_GROUP_ADMIN_MORE_THAN_5,s.a7.INVITE_GROUP_MEMBER_MORE_THAN_5].includes(e)?"groupMember+5":s.a7.REMOVE_GROUP_MEMBER===e?"removeGroupMember":s.a7.REMOVE_GROUP_MEMBER_MORE_THAN_5===e?"removeGroupMember+5":[s.a7.ADD_GROUP_ADMIN,s.a7.REMOVE_GROUP_ADMIN].includes(e)?"groupAdmin":[s.a7.TRANSFER_GROUP_OWNER].includes(e)?"groupOwnership":[s.a7.DISBAND_GROUP].includes(e)?"disbandGroup":[s.a7.GROUP_AVATAR_CHANGED,s.a7.GROUP_NAME_CHANGED].includes(e)?"groupInfo":[s.a7.CONTACT_ADDED].includes(e)?"contact":void 0}function p(e){return new Proxy({},{get:function(n,t){throw Error("".concat(e," plugin not registered. Cannot get ").concat(t))},set:function(n,t){throw Error("".concat(e," plugin not registered. Cannot set ").concat(t))}})}function v(e,n){var t,r,a;return!(null==e?void 0:e.channelId)||(!e.isSender&&e.status===s.a6.REJECTED||(!(e.contentType!==s.Y.VOICE_CALL_MESSAGE||!e.callMessage||s.Z.includes(null==(t=e.callMessage)?void 0:t.signalType))||(!(!n[e.contentType]||(null==(r=n[e.contentType])?void 0:r.call(n,e)))||!!s.a5.includes(null==(a=e.systemMessage)?void 0:a.systemAction))))}function h(e){if(e.contentType!==s.Y.CUSTOM_MESSAGE)return!1;if(!e.customMessage)return!1;var n=e.customMessage;return("CryptoGiftProcessing"!==n.bizName||!e.isSender)&&(!("CryptoGiftSendSuccess"===n.bizName&&!e.isSender)&&("CryptoGift"===(null==n?void 0:n.serviceName)||("OneToOnePaymentProcessing"!==n.bizName||!e.isSender)&&(!("OneToOnePaymentSent"===n.bizName&&!e.isSender)&&"OneToOnePayment"===(null==n?void 0:n.serviceName))))}},22715:(e,n,t)=>{t.r(n),t.d(n,{Form:()=>c,Recorder:()=>s,default:()=>d,record:()=>l});var r=t(23029),a=t(92901);function o(e){return(e|=0)<10?"0".concat(e):"".concat(Math.min(e,99))}function i(){function e(e,n){return new Promise((function(t,r){var a=new XMLHttpRequest;a.open("GET",e),a.responseType="arraybuffer",a.onload=function(){t(WebAssembly.instantiate(a.response,n))},a.onerror=r,a.send()}))}var n=null,t=5242880;function r(e){var n=t;return t+=e,n}function a(e){postMessage({type:"internal-error",data:e})}var o=null,i=null,s=null;onmessage=function(t){var c,u=t.data;switch(u.type){case"init":var l=u.data,d=l.wasmURL,m=l.shimURL;Promise.resolve().then((function(){return self.WebAssembly&&!function(){var e=new Uint8Array([0,97,115,109,1,0,0,0,1,6,1,96,1,127,1,127,3,2,1,0,5,3,1,0,1,7,8,1,4,116,101,115,116,0,0,10,16,1,14,0,32,0,65,1,54,2,0,32,0,40,2,0,11]),n=new WebAssembly.Module(e);return 0!==new WebAssembly.Instance(n,{}).exports.test(4)}()&&delete self.WebAssembly,self.WebAssembly||importScripts(m),{memory:n=new WebAssembly.Memory({initial:256,maximum:256}),pow:Math.pow,exit:a,powf:Math.pow,exp:Math.exp,sqrtf:Math.sqrt,cos:Math.cos,log:Math.log,sin:Math.sin,sbrk:r}})).then((function(n){return function(n,t){if(!WebAssembly.instantiateStreaming)return e(n,t);var r=fetch(n,{credentials:"same-origin"});return WebAssembly.instantiateStreaming(r,t).catch((function(r){if(r.message&&r.message.indexOf("Argument 0 must be provided and must be a Response")>0)return e(n,t);throw r}))}(d,{env:n})})).then((function(e){o=e.instance.exports,postMessage({type:"init",data:null})})).catch((function(e){postMessage({type:"init-error",data:e.toString()})}));break;case"start":if(!function(e){if(!(i=o.vmsg_init(e)))return!1;var t=new Uint32Array(n.buffer,i,1)[0];return s=new Float32Array(n.buffer,t),!0}(u.data))return postMessage({type:"error",data:"vmsg_init"});break;case"data":if(c=u.data,s.set(c),!(o.vmsg_encode(i,c.length)>=0))return postMessage({type:"error",data:"vmsg_encode"});break;case"stop":var f=function(){if(o.vmsg_flush(i)<0)return null;var e=new Uint32Array(n.buffer,i+4,1)[0],t=new Uint32Array(n.buffer,i+8,1)[0],r=new Uint8Array(n.buffer,e,t),a=new Blob([r],{type:"audio/mpeg"});return o.vmsg_free(i),i=null,s=null,a}();if(!f)return postMessage({type:"error",data:"vmsg_flush"});postMessage({type:"stop",data:f})}}}var s=function(){return(0,a.A)((function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;(0,r.A)(this,e),this.wasmURL=new URL(n.wasmURL||"/static/js/vmsg.wasm",location).href,this.shimURL=new URL(n.shimURL||"/static/js/wasm-polyfill.js",location).href,this.onStop=t,this.pitch=n.pitch||0,this.stream=null,this.audioCtx=null,this.gainNode=null,this.pitchFX=null,this.encNode=null,this.worker=null,this.workerURL=null,this.blob=null,this.blobURL=null,this.resolve=null,this.reject=null,Object.seal(this)}),[{key:"close",value:function(){this.encNode&&this.encNode.disconnect(),this.encNode&&(this.encNode.onaudioprocess=null),this.stream&&this.stopTracks(),this.audioCtx&&this.audioCtx.close(),this.worker&&(this.worker.terminate(),this.worker=null),this.workerURL&&URL.revokeObjectURL(this.workerURL),this.blobURL&&URL.revokeObjectURL(this.blobURL)}},{key:"initAudio",value:function(){var e=this;return(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?function(e){return navigator.mediaDevices.getUserMedia(e)}:function(e){var n=navigator.webkitGetUserMedia||navigator.mozGetUserMedia;return n?new Promise((function(t,r){n.call(navigator,e,t,r)})):Promise.reject(new Error("getUserMedia is not implemented in this browser"))})({audio:!0}).then((function(n){e.stream=n;var t=e.audioCtx=new(window.AudioContext||window.webkitAudioContext),r=t.createMediaStreamSource(n),a=e.gainNode=(t.createGain||t.createGainNode).call(t);a.gain.value=1,r.connect(a);var o=e.pitchFX=new h(t);o.setPitchOffset(e.pitch);var i=e.encNode=(t.createScriptProcessor||t.createJavaScriptNode).call(t,0,1,1);o.output.connect(i),a.connect(0===e.pitch?i:o.input)}))}},{key:"initWorker",value:function(){var e=this;if(this.worker)return Promise.resolve();var n=new Blob(["(",i.toString(),")()"],{type:"application/javascript"}),t=this.workerURL=URL.createObjectURL(n),r=this.worker=new Worker(t),a=this.wasmURL,o=this.shimURL;return r.postMessage({type:"init",data:{wasmURL:a,shimURL:o}}),new Promise((function(n,t){r.onmessage=function(r){var a=r.data;switch(a.type){case"init":n();break;case"init-error":e.close(),t(new Error(a.data));break;case"error":case"internal-error":e.close(),console.error("Worker error:",a.data),e.reject&&e.reject(a.data);break;case"stop":e.blob=a.data,e.blobURL=URL.createObjectURL(a.data),e.onStop&&e.onStop(),e.resolve&&e.resolve(e.blob)}}}))}},{key:"init",value:function(){return this.initAudio().then(this.initWorker.bind(this))}},{key:"startRecording",value:function(){var e=this;if(!this.stream)throw new Error("missing audio initialization");if(!this.worker)throw new Error("missing worker initialization");this.blob=null,this.blobURL&&URL.revokeObjectURL(this.blobURL),this.blobURL=null,this.resolve=null,this.reject=null,this.worker.postMessage({type:"start",data:this.audioCtx.sampleRate}),this.encNode.onaudioprocess=function(n){var t=n.inputBuffer.getChannelData(0);e.worker.postMessage({type:"data",data:t})},this.encNode.connect(this.audioCtx.destination)}},{key:"stopRecording",value:function(){var e=this;if(!this.stream)throw new Error("missing audio initialization");if(!this.worker)throw new Error("missing worker initialization");return this.encNode.disconnect(),this.encNode.onaudioprocess=null,this.stopTracks(),this.audioCtx.close(),this.worker.postMessage({type:"stop",data:null}),new Promise((function(n,t){e.resolve=n,e.reject=t}))}},{key:"stopTracks",value:function(){this.stream.getTracks&&this.stream.getTracks().forEach((function(e){return e.stop()}))}}])}(),c=function(){return(0,a.A)((function e(){var n=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=arguments.length>1?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0;(0,r.A)(this,e),this.recorder=new s(t,this.onStop.bind(this)),this.resolve=a,this.reject=o,this.backdrop=null,this.popup=null,this.recordBtn=null,this.stopBtn=null,this.timer=null,this.audio=null,this.saveBtn=null,this.tid=0,this.start=0,Object.seal(this),this.recorder.initAudio().then((function(){return n.drawInit()})).then((function(){return n.recorder.initWorker()})).then((function(){return n.drawAll()})).catch((function(e){return n.drawError(e)}))}),[{key:"drawInit",value:function(){var e=this;if(!this.backdrop){var n=this.backdrop=document.createElement("div");n.className="vmsg-backdrop",n.addEventListener("click",(function(){return e.close(null)}));var t=this.popup=document.createElement("div");t.className="vmsg-popup",t.addEventListener("click",(function(e){return e.stopPropagation()}));var r=document.createElement("div");r.className="vmsg-progress";for(var a=0;a<3;a++){var o=document.createElement("div");o.className="vmsg-progress-dot",r.appendChild(o)}t.appendChild(r),n.appendChild(t),document.body.appendChild(n)}}},{key:"drawTime",value:function(e){var n=Math.round(e/1e3);this.timer.textContent=o(n/60)+":"+o(n%60)}},{key:"drawAll",value:function(){var e=this;this.drawInit(),this.clearAll();var n=document.createElement("div");n.className="vmsg-record-row",this.popup.appendChild(n);var t=this.recordBtn=document.createElement("button");t.className="vmsg-button vmsg-record-button",t.textContent="\u25cf",t.title="Start Recording",t.addEventListener("click",(function(){return e.startRecording()})),n.appendChild(t);var r=this.stopBtn=document.createElement("button");r.className="vmsg-button vmsg-stop-button",r.style.display="none",r.textContent="\u25a0",r.title="Stop Recording",r.addEventListener("click",(function(){return e.stopRecording()})),n.appendChild(r);var a=this.audio=new Audio;a.autoplay=!0;var o=this.timer=document.createElement("span");o.className="vmsg-timer",o.title="Preview Recording",o.addEventListener("click",(function(){a.paused?e.recorder.blobURL&&(a.src=e.recorder.blobURL):a.pause()})),this.drawTime(0),n.appendChild(o);var i=this.saveBtn=document.createElement("button");i.className="vmsg-button vmsg-save-button",i.textContent="\u2713",i.title="Save Recording",i.disabled=!0,i.addEventListener("click",(function(){return e.close(e.recorder.blob)})),n.appendChild(i);var s=document.createElement("div");s.className="vmsg-slider-wrapper vmsg-gain-slider-wrapper";var c=document.createElement("input");c.className="vmsg-slider vmsg-gain-slider",c.setAttribute("type","range"),c.min=0,c.max=2,c.step=.2,c.value=1,c.onchange=function(){var n=+c.value;e.recorder.gainNode.gain.value=n},s.appendChild(c),this.popup.appendChild(s);var u=document.createElement("div");u.className="vmsg-slider-wrapper vmsg-pitch-slider-wrapper";var l=document.createElement("input");l.className="vmsg-slider vmsg-pitch-slider",l.setAttribute("type","range"),l.min=-1,l.max=1,l.step=.2,l.value=this.recorder.pitch,l.onchange=function(){var n=+l.value;e.recorder.pitchFX.setPitchOffset(n),e.recorder.gainNode.disconnect(),e.recorder.gainNode.connect(0===n?e.recorder.encNode:e.recorder.pitchFX.input)},u.appendChild(l),this.popup.appendChild(u),t.focus()}},{key:"drawError",value:function(e){console.error(e),this.drawInit(),this.clearAll();var n=document.createElement("div");n.className="vmsg-error",n.textContent=e.toString(),this.popup.appendChild(n)}},{key:"clearAll",value:function(){this.popup&&(this.popup.innerHTML="")}},{key:"close",value:function(e){this.audio&&this.audio.pause(),this.tid&&clearTimeout(this.tid),this.recorder.close(),this.backdrop.remove(),e?this.resolve(e):this.reject(new Error("No record made"))}},{key:"onStop",value:function(){this.recordBtn.style.display="",this.stopBtn.style.display="none",this.stopBtn.disabled=!1,this.saveBtn.disabled=!1}},{key:"startRecording",value:function(){this.audio.pause(),this.start=Date.now(),this.updateTime(),this.recordBtn.style.display="none",this.stopBtn.style.display="",this.saveBtn.disabled=!0,this.stopBtn.focus(),this.recorder.startRecording()}},{key:"stopRecording",value:function(){clearTimeout(this.tid),this.tid=0,this.stopBtn.disabled=!0,this.recordBtn.focus(),this.recorder.stopRecording()}},{key:"updateTime",value:function(){var e=this;this.drawTime(Date.now()-this.start),this.tid=setTimeout((function(){return e.updateTime()}),300)}}])}(),u=!1;function l(e){return new Promise((function(n,t){if(u)throw new Error("Record form is already opened");u=!0,new c(e,n,t)})).then((function(e){return u=!1,e}),(function(e){throw u=!1,e}))}var d={Recorder:s,Form:c,record:l},m=.1,f=.05,p=.1;function v(e,n,t,r){for(var a=n*e.sampleRate,o=a+(n-2*t)*e.sampleRate,i=e.createBuffer(1,o,e.sampleRate),s=i.getChannelData(0),c=0;c<a;++c)s[c]=r?(a-c)/o:c/a;for(c=a;c<o;++c)s[c]=0;return i}function h(e){this.context=e;var n=(e.createGain||e.createGainNode).call(e),t=(e.createGain||e.createGainNode).call(e);this.input=n,this.output=t;var r=e.createBufferSource(),a=e.createBufferSource(),o=e.createBufferSource(),i=e.createBufferSource();this.shiftDownBuffer=v(e,p,f,!1),this.shiftUpBuffer=v(e,p,f,!0),r.buffer=this.shiftDownBuffer,a.buffer=this.shiftDownBuffer,o.buffer=this.shiftUpBuffer,i.buffer=this.shiftUpBuffer,r.loop=!0,a.loop=!0,o.loop=!0,i.loop=!0;var s=(e.createGain||e.createGainNode).call(e),c=(e.createGain||e.createGainNode).call(e),u=(e.createGain||e.createGainNode).call(e);u.gain.value=0;var l=(e.createGain||e.createGainNode).call(e);l.gain.value=0,r.connect(s),a.connect(c),o.connect(u),i.connect(l);var d=(e.createGain||e.createGainNode).call(e),h=(e.createGain||e.createGainNode).call(e),g=(e.createDelay||e.createDelayNode).call(e),_=(e.createDelay||e.createDelayNode).call(e);s.connect(d),c.connect(h),u.connect(d),l.connect(h),d.connect(g.delayTime),h.connect(_.delayTime);var A=e.createBufferSource(),E=e.createBufferSource(),b=function(e,n,t){for(var r=n*e.sampleRate,a=r+(n-2*t)*e.sampleRate,o=e.createBuffer(1,a,e.sampleRate),i=o.getChannelData(0),s=t*e.sampleRate,c=s,u=r-s,l=0;l<r;++l){var d;d=l<c?Math.sqrt(l/s):l>=u?Math.sqrt(1-(l-u)/s):1,i[l]=d}for(l=r;l<a;++l)i[l]=0;return o}(e,p,f);A.buffer=b,E.buffer=b,A.loop=!0,E.loop=!0;var C=(e.createGain||e.createGainNode).call(e),y=(e.createGain||e.createGainNode).call(e);C.gain.value=0,y.gain.value=0,A.connect(C.gain),E.connect(y.gain),n.connect(g),n.connect(_),g.connect(C),_.connect(y),C.connect(t),y.connect(t);var S=e.currentTime+.05,M=S+p-f;r.start(S),a.start(M),o.start(S),i.start(M),A.start(S),E.start(M),this.mod1=r,this.mod2=a,this.mod1Gain=s,this.mod2Gain=c,this.mod3Gain=u,this.mod4Gain=l,this.modGain1=d,this.modGain2=h,this.fade1=A,this.fade2=E,this.mix1=C,this.mix2=y,this.delay1=g,this.delay2=_,this.setDelay(m)}h.prototype.setDelay=function(e){this.modGain1.gain.setTargetAtTime(.5*e,0,.01),this.modGain2.gain.setTargetAtTime(.5*e,0,.01)},h.prototype.setPitchOffset=function(e){e>0?(this.mod1Gain.gain.value=0,this.mod2Gain.gain.value=0,this.mod3Gain.gain.value=1,this.mod4Gain.gain.value=1):(this.mod1Gain.gain.value=1,this.mod2Gain.gain.value=1,this.mod3Gain.gain.value=0,this.mod4Gain.gain.value=0),this.setDelay(m*Math.abs(e))}},33709:(e,n,t)=>{t.d(n,{A:()=>G,q:()=>R});var r=t(90675),a=t(10467),o=t(23029),i=t(92901),s=t(50388),c=t(52176),u=t(53954),l=t(85501),d=t(89379),m=t(53986),f=t(5544),p=t(25721),v=t(41594),h=t(83573),g=t(15696),_=t(74002),A=t(67146),E=t(11943),b=t(26204),C=t(57394),y=t(44497),S=t(98911),M=t(72446),I=t(65603),k=t(55355),x=["className","disabled"];function w(e,n,t){return n=(0,u.A)(n),(0,s.A)(e,(0,c.A)()?Reflect.construct(n,t||[],(0,u.A)(e).constructor):n.apply(e,t))}var T=function(e){var n=e.type,t=e.handler,r=e.showText,a=void 0!==r&&r,o=e.isLarge,i=void 0!==o&&o,s={accept:{url:"".concat((0,C.g)(),"/cdn/assets/imgs/2311/BD0F09FA78AF938F.svg"),text:(0,C.t)("im_voice_call_label_accept")},end:{url:"".concat((0,C.g)(),"/cdn/assets/imgs/2311/124AA094F341F23C.svg"),text:(0,C.t)("im_voice_call_text_end")},decline:{url:"".concat((0,C.g)(),"/cdn/assets/imgs/2311/124AA094F341F23C.svg"),text:(0,C.t)("im_voice_call_label_decline")},micNotMuted:{url:"".concat((0,C.g)(),"/cdn/assets/imgs/2311/D41DA0A3976E81B6.svg"),text:(0,C.t)("im_voice_call_text_mute")},micMuted:{url:"".concat((0,C.g)(),"/cdn/assets/imgs/2311/077676ACEF2E8DAA.svg"),text:(0,C.t)("im_voice_call_text_mute")}};return v.createElement(A.A,{className:h(i?"large":"normal","im-voice-call-action-box"),onClick:t},v.createElement("img",{"aria-label":s[n].text,alt:"",src:s[n].url,className:"im-voice-call-action-btn"}),a&&v.createElement("div",{className:"im-voice-call-action-text"},s[n].text))};var N=(0,g.observer)((function(){var e,n,t,r=(0,C.u)().store,a=r.callStore.callInfo,o=a.channelId,i=a.visible,s=a.isCaller,c=a.gotThrough,u=a.micIsMuted,l=(0,C.J)().findConversationByChannelId,d=(0,v.useState)(0),m=(0,f.A)(d,2),p=m[0],h=m[1],g=(0,v.useRef)(null);!function(e,n){var t=(0,v.useRef)(),r=(0,v.useRef)(n),a=function(){t.current||(t.current=(0,_.c)(1e3)),(0,_.e)(t.current,(function(){e((function(e){return e+1})),r.current&&t.current&&a()}))};(0,v.useEffect)((function(){n?a():(t.current&&(0,_.s)(t.current),t.current=null,e(0)),r.current=n}),[!!n])}(h,c);var A=(0,v.useMemo)((function(){if(o)return l(o)}),[o,l]),b=(0,v.useMemo)((function(){if(a.pendingCallRequest){var e=a.pendingCallRequest,n=e.channelId,t=e.callerUid;return{channelInfo:l(n),callerUid:t}}return null}),[a.pendingCallRequest,l]),y=(0,v.useCallback)((function(){var e;null==(e=a.hangupHandler)||e.call(a,{duration:p,channelId:a.channelId})}),[a,p]),S=function(){var e;b&&(null==(e=a.hangupHandler)||e.call(a,{channelId:b.channelInfo.channelId}))};(0,v.useEffect)((function(){if(i)return window.onbeforeunload=function(e){return e.preventDefault(),e.returnValue=(0,C.t)("im_general_chat_toast_leave_page"),(0,C.t)("im_general_chat_toast_leave_page")},window.onunload=y,function(){window.onbeforeunload=null,window.onunload=null}}),[y,i]);return(0,v.useEffect)((function(){h(0)}),[]),i?v.createElement(E.A,{onDragMove:function(e){var n=e.left,t=e.top,r=e.viewportWidth,a=e.viewportHeight,o=e.moveDom;return{left:Math.max(o.offsetWidth/2,Math.min(r-o.offsetWidth/2,n)),top:Math.max(o.offsetHeight/2,Math.min(a-o.offsetHeight/2,t))}},getMoveRef:function(){return g.current},noTextSelection:!0},v.createElement("div",{className:"im-calling-wrapper",ref:g},b&&v.createElement("div",{className:"im-call-waiting-box"},v.createElement("div",{className:"waiting-info-box"},v.createElement(C.A,{userInfo:null==(e=b.channelInfo)?void 0:e.entityInfo,width:40,height:40,channelType:null==(n=null==b?void 0:b.channelInfo)?void 0:n.channelType,className:"waiting-info-avatar"}),v.createElement("div",{className:"waiting-info-name-status"},v.createElement(C.U,{userInfo:null==(t=b.channelInfo)?void 0:t.entityInfo,showOfficialTag:!1,nameTextClassName:"waiting-info-name"}),v.createElement("div",{className:"waiting-info-status text-overflow"},(0,C.t)("im_voice_call_text_incoming_call")))),v.createElement("div",{className:"im-call-waiting-btn-box"},v.createElement(T,{type:"end",handler:S}),v.createElement(T,{type:"accept",handler:function(){var e=C.D.confirmation({title:(0,C.t)("im_voice_call_modaltitle_accept_incoming_call"),children:v.createElement("span",{className:"im-dialog-confirmation-content"},(0,C.t)("im_voice_call_modaldesc_accept_incoming_call",{user:(0,C.h)(null==A?void 0:A.entityInfo,r.userRegistryStore)})),confirmText:(0,C.t)("im_voice_call_btn_accept_call"),cancelText:(0,C.t)("im_voice_call_btn_decline_call"),onConfirm:function(){!function(){var e;b&&(y(),null==(e=a.getThroughHandler)||e.call(a,{channelId:b.channelInfo.channelId}))}(),e.destroy()},onCancel:function(){S(),e.destroy()}})}}))),v.createElement("div",{className:"im-calling-box"},v.createElement("div",{className:"im-call-user-info"},v.createElement(C.A,{userInfo:null==A?void 0:A.entityInfo,channelType:null==A?void 0:A.channelType,width:80,height:80}),v.createElement(C.U,{userInfo:null==A?void 0:A.entityInfo,className:"im-voice-call-user-name",nameTextClassName:"im-voice-call-user-name-text",showOfficialTag:!1})),s&&!c&&v.createElement("div",{className:"im-call-waiting call-status-text"},(0,C.t)("im_voice_call_text_calling")),!s&&!c&&v.createElement("div",{className:"im-call-waiting call-status-text"},(0,C.t)("im_voice_call_text_incoming_call")),c&&v.createElement("div",{className:"im-call-duration call-status-text"},(0,C.K)(p)),v.createElement("div",{className:"im-call-btn-box"},c&&v.createElement(T,{type:u?"micMuted":"micNotMuted",showText:!0,isLarge:!0,handler:function(){var e;null==(e=a.updateMicStatus)||e.call(a,!u)}}),v.createElement(T,{type:c?"end":"decline",showText:!0,isLarge:!0,handler:y}),!s&&!c&&v.createElement(T,{type:"accept",showText:!0,isLarge:!0,handler:function(){var e;null==(e=a.getThroughHandler)||e.call(a,{channelId:a.channelId})}}))))):null}));function R(){var e=(0,C.u)().client,n=(0,C.N)().checkIfUserCanChat,t=(0,C.J)().findConversationByChannelId;return{startCall:(0,v.useCallback)((function(r){if(r)if(e){var a=t(r);a&&!n(a)||(e.driver.callController.startCall({channelId:r,mediaType:C.P.AUDIO,isCaller:!0,callType:C.Q.AUDIO,shouldRecord:(0,C.j)(e.driver.userInfo.tags)}),(0,C.V)("IMChatBtmSendClick",{button_name:C.W.VOICE_CALL}))}else(0,C.w)();else console.error("channelId is required")}),[n,e,t])}}var L=function(e){var n=e.className,t=e.disabled,r=(0,m.A)(e,x),a=(0,C.u)(),o=a.client,i=a.store,s=R().startCall,c=i.conversationStore.activeConversationId,u=(0,v.useState)(!1),l=(0,f.A)(u,2),p=l[0],h=l[1];return(0,v.useEffect)((function(){var e=new AbortController,n=e.signal,t=i.conversationStore.conversationMap[null!==c&&void 0!==c?c:""];if(c&&t&&t.channelType===C.C.PRIVATE)return null==o||o.driver.callController.checkCallPermission({channelId:c}).then((function(e){if(!n.aborted)return h(e)})).catch((function(){if(!n.aborted)return h(!1)})),function(){e.abort(),h(!1)}}),[c]),p?v.createElement(C.I,(0,d.A)({as:"icon",tipTitle:(0,C.t)("im_voice_call_tooltips_voice_call"),iconClassName:"okds-communication-call",className:n,clickHandler:function(){if(c)return s(c)},disabled:t},r)):null},O={GET_AGORA_TOKEN:"".concat(S.I,"/rtc/v1/token"),POST_REJECT_CALL:"".concat(S.I,"/rtc/v1/reject"),GET_CHECK_CALL_PERMISSION:"".concat(S.I,"/rtc/v1/permission")};function U(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).needAlert,n=void 0===e||e;if(C.L.info("AgoraRTC is not loaded, voice call is disabled",{errorName:"AgoraNotLoaded"}),n)var t=C.D.tip({title:(0,C.t)("im_voice_call_dialog_header_unable_to_use_voice"),children:(0,C.t)("im_voice_call_dialog_some_browser_extensions"),confirmText:(0,C.t)("im_general_use_btn_ok_error"),onConfirm:function(){t.destroy()}})}var P=function(e){function n(e){var t;return(0,o.A)(this,n),(t=w(this,n,[e])).enabled=!1,t.callWaitingTimer=null,t.callQueue=[],t.stopRingFn=null,t.options={appId:"2a28cd89c902484694784c1c653623fd",uid:""},t.acceptCall=function(){var e=(0,a.A)((0,r.A)().mark((function e(n){var a,o;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.channelId,o=n.callType,e.next=3,t.launchCallChannel({channelId:a,isCaller:t.currentCallInfo.isCaller});case 3:t.sendVoiceCallMessage({channelId:a,messageContent:{callType:o,signalType:C.X.ACCEPT,callerUid:t.currentCallInfo.callerUid}});case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),t.hangUpCall=function(){var e=(0,a.A)((0,r.A)().mark((function e(n){var a,o,i;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=n.channelId,o=n.duration,i=n.callType,t.sendVoiceCallMessage({channelId:a,messageContent:{callType:i,signalType:C.X.COMPLETE,callerUid:t.currentCallInfo.callerUid,duration:o}});case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),t.rejectCall=function(){var e=(0,a.A)((0,r.A)().mark((function e(n){var a,o;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.channelId,o=n.callType,e.next=3,t.imHttp.post(O.POST_REJECT_CALL,{channelId:a,callType:o,rejectReason:5});case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),t.cancelCall=function(){var e=(0,a.A)((0,r.A)().mark((function e(n){var a,o;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=n.channelId,o=n.callType,t.sendVoiceCallMessage({channelId:a,messageContent:{callType:o,signalType:C.X.CANCEL,callerUid:t.currentCallInfo.callerUid}});case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),t.noAnswer=function(){var e=(0,a.A)((0,r.A)().mark((function e(n){var a,o;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=n.channelId,o=n.callType,t.sendVoiceCallMessage({channelId:a,messageContent:{callType:o,signalType:C.X.NO_ANSWER,callerUid:t.currentCallInfo.callerUid}});case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),t.updateMicStatus=function(){var e=(0,a.A)((0,r.A)().mark((function e(n){var a;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null==(a=t.localAudioTrack)?void 0:a.setEnabled(!n).catch((function(e){var n=e;return b.A.error(n),null}));case 2:void 0===e.sent&&t.updateCurrentCallInfo({micIsMuted:n});case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),t.sendVoiceCallMessage=function(){var e=(0,a.A)((0,r.A)().mark((function e(n){var a,o,i,s,c,u,l,d;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.channelId,o=n.messageContent,s=t.userInfo.userUid,c=(null==(i=t.imStore.conversationStore.conversationMap[a])?void 0:i.channelType)||C.C.PRIVATE,u=(0,I.g)(t.imHttp.deviceId),l=(0,I.c)({channelId:a,messageContent:o,extra:{tempId:u}},s,c),d={channelId:a,message:l},e.abrupt("return",t.driver.sendMsgController.sendMessageWithTrack(d).catch((function(e){throw C.L.error("Failed to send message. ".concat((null==e?void 0:e.status)||(null==e?void 0:e.message)||""),{errorName:"SendMessageFailed - ".concat(C.Y.VOICE_CALL_MESSAGE),error:e,data:{channelId:a,contentType:C.Y.VOICE_CALL_MESSAGE},tags:{feErrorType:"UserAction",feCallOrigin:"sendVoiceCallMessage"}}),e})));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),t.handleCallMessageReception=function(){t.emitter.on(k.C.ON_RECV_VOICE_CALL_MESSAGE,function(){var e=(0,a.A)((0,r.A)().mark((function e(n){var a,o,i,s,c,u;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=n.data,i=null==(a=o[0])?void 0:a.channelId,s=[],null==(c=t.imStore.conversationStore.conversationMap[i])?void 0:c.isLoaded){e.next=8;break}return e.next=7,t.driver.conversationController.getConversationList({channelIds:[i]});case 7:c=t.imStore.conversationStore.conversationMap[i];case 8:if(!c||!1!==t.driver.conversationController.conversationFilter(c)){e.next=10;break}return e.abrupt("return");case 10:if(o.forEach((function(e){var n,r=e.callMessage,a=r.callerUid,o=r.signalType,c=r.callType;o!==C.X.INIT||e.isSender||t.initCallBox({channelId:i,callerUid:a,callType:c,isCaller:!1}),e.isSender&&o===C.X.ACCEPT&&!(null==(n=t.currentCallInfo)?void 0:n.gotThrough)&&t.closeCallBox({channelId:i}),C.Z.includes(o)&&(t.closeCallBox({channelId:i}),Object.assign(e,{visible:!0,isSender:a===t.userInfo.userUid}),s.push(e),t.driver.notificationController.notifyNewMessage([e]))})),t.imStore.conversationStore.activeConversationId===i&&t.imStore.messageStore.pushNewMessages(s),u=(0,M.p)({myUid:t.userInfo.userUid,channel:t.imStore.conversationStore.conversationMap[i],newMsgList:s,shouldCountAsUnread:t.driver.conversationController.shouldCountAsUnread})){e.next=15;break}return e.abrupt("return");case 15:(0,y.runInAction)((function(){t.imStore.conversationStore.updateConversation(u),t.imStore.conversationStore.pushConversationToTop(u.channelId)}));case 16:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}())},t.options.uid=e.userInfo.userUid,t}return(0,l.A)(n,e),(0,i.A)(n,[{key:"currentCallInfo",get:function(){return this.callStore.callInfo||{}}},{key:"callStore",get:function(){return this.imStore.callStore}},{key:"loadAgoraSdk",value:function(){var e=(0,a.A)((0,r.A)().mark((function e(){return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.loadSdkPromise){e.next=2;break}return e.abrupt("return",this.loadSdkPromise);case 2:return this.loadSdkPromise=new Promise(function(){var e=(0,a.A)((0,r.A)().mark((function e(n){return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,C._)("".concat((0,C.g)(),"/cdn/assets/okfe/libs/agora/AgoraRTC_N-4.19.0.js")).catch((0,a.A)((0,r.A)().mark((function e(){return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,C._)("".concat((0,C.g)(),"/cdndev/assets/okfe/libs/agora/AgoraRTC_N-4.19.0.js"));case 2:case"end":return e.stop()}}),e)}))));case 2:n(!0);case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()),e.abrupt("return",this.loadSdkPromise);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"init",value:function(){var e=(0,a.A)((0,r.A)().mark((function e(){var n=this;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.handleCallMessageReception(),!this.AgoraRTC||!this.enabled){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,this.loadAgoraSdk();case 5:if(window.AgoraRTC){e.next=9;break}return C.L.setGlobalTag("noAgora",!0),U({needAlert:!1}),e.abrupt("return");case 9:this.AgoraRTC=window.AgoraRTC,(0,C.$)()&&this.AgoraRTC.setLogLevel(4),this.rtcClient=this.AgoraRTC.createClient({mode:"rtc",codec:"vp8"}),this.rtcClient.on("user-published",function(){var e=(0,a.A)((0,r.A)().mark((function e(t,a){var o,i;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a!==C.P.AUDIO){e.next=7;break}return e.next=3,null==(o=n.rtcClient)?void 0:o.subscribe(t,a);case 3:n.updateGotThroughStatus(!0),n.removeCallWaitingTimer(),null==(i=t.audioTrack)||i.play();case 7:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}()),this.enabled=!0;case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updateCurrentCallInfo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.callStore.updateCallInfo(e)}},{key:"updateGotThroughStatus",value:function(e){var n;e===this.currentCallInfo.gotThrough||(!0===e&&this.emitter.emit(k.C.ON_CALL_STATUS_CHANGE,{status:"start",channelId:this.currentCallInfo.channelId}),!1===e&&this.emitter.emit(k.C.ON_CALL_STATUS_CHANGE,{status:"stop",channelId:this.currentCallInfo.channelId})),this.updateCurrentCallInfo({gotThrough:e}),null==(n=this.stopRingFn)||n.call(this)}},{key:"removeCallWaitingTimer",value:function(){this.callWaitingTimer&&window.clearTimeout(this.callWaitingTimer)}},{key:"join",value:function(){var e=(0,a.A)((0,r.A)().mark((function e(n){var t,a,o,i,s;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.channel,a=n.token,o=n.mediaType,(void 0===o?C.P.AUDIO:o)===C.P.AUDIO){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,null==(i=this.AgoraRTC)?void 0:i.createMicrophoneAudioTrack().catch((function(e){throw C.D.tip({title:(0,C.t)("im_voice_message_modaltitle_allow_microphone"),cancelText:(0,C.t)("im_general_use_btn_ok_error"),children:(0,C.t)("im_voice_message_modaldesc_call_allow_microphone")}),e}));case 5:if(this.localAudioTrack=e.sent,this.rtcClient){e.next=8;break}return e.abrupt("return");case 8:return e.next=10,null==(s=this.rtcClient)?void 0:s.join(this.options.appId,t,a,this.options.uid);case 10:return e.next=12,this.rtcClient.publish([this.localAudioTrack]);case 12:case"end":return e.stop()}}),e,this)})));return function(n){return e.apply(this,arguments)}}()},{key:"leave",value:function(){var e=(0,a.A)((0,r.A)().mark((function e(){var n,t,a,o;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==(t=null==(n=this.rtcClient)?void 0:n.unpublish())||t.catch((function(){})),null==(a=this.localAudioTrack)||a.close(),this.localAudioTrack=void 0,this.AgoraRTC){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,null==(o=this.rtcClient)?void 0:o.leave();case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getToken",value:function(){var e=(0,a.A)((0,r.A)().mark((function e(n){var t,a,o;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.channelId,a=n.role,e.next=3,this.imHttp.get(O.GET_AGORA_TOKEN,{params:{channelId:t,role:a}});case 3:return(o=e.sent)&&(this.options.appId=o.appId,this.options.uid=o.uid),e.abrupt("return",o.token);case 6:case"end":return e.stop()}}),e,this)})));return function(n){return e.apply(this,arguments)}}()},{key:"launchCallChannel",value:function(){var e=(0,a.A)((0,r.A)().mark((function e(n){var t,a,o,i;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.channelId,a=n.mediaType,o=n.isCaller,e.next=3,this.getToken({channelId:t,role:o?C.a0.CALLER:C.a0.CALLEE});case 3:return i=e.sent,e.next=6,this.join({channel:t,token:i,mediaType:a});case 6:case"end":return e.stop()}}),e,this)})));return function(n){return e.apply(this,arguments)}}()},{key:"initCallBox",value:function(e){var n,t,o=this,i=e.channelId,s=e.isCaller,c=e.callerUid,u=e.muteRing,l=e.callType,m=void 0===l?C.Q.AUDIO:l;if(function(e,n){return e.visible&&e.channelId!==n}(this.currentCallInfo,i))return this.callQueue.push({channelId:i,isCaller:s,callerUid:c,callType:m}),void this.updateCurrentCallInfo({pendingCallRequest:null==(n=this.callQueue)?void 0:n[0]});(function(e,n){return!e&&!n})(u,s)&&(this.stopRingFn=(0,M.a)("".concat((0,C.g)(),"/cdn/assets/files/2112/77107B6C6BA3CAFA.mp3"),!0)),function(e,n){return!e&&n}(u,s)&&(this.stopRingFn=(0,M.a)("".concat((0,C.g)(),"/cdn/assets/files/2112/A071891A0728271C.mp3"),!0));var f=function(){var e=(0,a.A)((0,r.A)().mark((function e(n){var t;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.channelId,e.next=3,o.driver.updateMicOccupancyState({occupancyInfo:C.a1.VOICE_CALL});case 3:if(!e.sent.code){e.next=6;break}return e.abrupt("return");case 6:if(o.AgoraRTC){e.next=10;break}return U(),o.cancelCall({channelId:t,callType:m}),e.abrupt("return");case 10:return e.next=12,o.acceptCall({channelId:t,callType:m});case 12:o.updateGotThroughStatus(!0);case 13:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();this.callStore.initCallInfo({visible:!0,channelId:i,isCaller:s,callRole:s?C.a0.CALLER:C.a0.CALLEE,pendingCallRequest:null==(t=this.callQueue)?void 0:t[0],micIsMuted:!1,isCalling:!0,callerUid:c||this.userInfo.userUid,getThroughHandler:f,hangupHandler:function(e){var n=e.duration,t=e.channelId;t===o.currentCallInfo.channelId?function(e,n,t,r,a){var o=a.hangUpCall,i=a.cancelCall,s=a.rejectCall;e.gotThrough?(Object.assign(e,{duration:t}),o((0,d.A)((0,d.A)({},r),{},{duration:t}))):n?i(r):s(r)}(o.currentCallInfo,s,n,{callType:m,channelId:t},{hangUpCall:o.hangUpCall,cancelCall:o.cancelCall,rejectCall:o.rejectCall}):o.rejectCall({channelId:t,callType:m}),o.closeCallBox({channelId:t})},updateMicStatus:this.updateMicStatus})}},{key:"closeCallBox",value:function(){var e=(0,a.A)((0,r.A)().mark((function e(n){var t,a,o,i,s;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t=n.channelId)!==this.currentCallInfo.channelId){e.next=11;break}return null==(a=this.stopRingFn)||a.call(this),e.next=5,this.leave();case 5:this.updateGotThroughStatus(!1),this.callStore.removeCallInfo(),this.removeCallWaitingTimer(),this.callQueue.length?(i=this.callQueue.shift())&&this.initCallBox((0,d.A)((0,d.A)({},i),{},{muteRing:!0})):this.driver.updateMicOccupancyState({resetName:C.a1.VOICE_CALL.name}),e.next=13;break;case 11:(s=this.callQueue.findIndex((function(e){return t===e.channelId})))>=0&&(this.callQueue.splice(s,1),this.updateCurrentCallInfo({pendingCallRequest:null==(o=this.callQueue)?void 0:o[0]}));case 13:case"end":return e.stop()}}),e,this)})));return function(n){return e.apply(this,arguments)}}()},{key:"startCall",value:function(){var e=(0,a.A)((0,r.A)().mark((function e(n){var t,a,o,i,s,c,u,l=this;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.channelId,a=n.mediaType,o=n.isCaller,i=n.callType,s=void 0===i?C.Q.AUDIO:i,c=n.shouldRecord,u=void 0!==c&&c,this.AgoraRTC){e.next=4;break}return U(),e.abrupt("return");case 4:if(!o){e.next=15;break}return e.next=7,this.driver.updateMicOccupancyState({occupancyInfo:C.a1.VOICE_CALL});case 7:if(!e.sent.code){e.next=12;break}return e.abrupt("return");case 12:if(!this.currentCallInfo.isCalling){e.next=15;break}return b.A.error((0,C.t)("im_voice_call_alert_ongoing_call")),e.abrupt("return");case 15:return e.next=17,this.launchCallChannel({channelId:t,mediaType:a,isCaller:o});case 17:this.initCallBox({channelId:t,isCaller:o,callType:s}),o&&(this.removeCallWaitingTimer(),this.callWaitingTimer=window.setTimeout((function(){l.noAnswer({channelId:t,callType:s}),l.closeCallBox({channelId:t})}),3e4)),this.sendVoiceCallMessage({channelId:t,messageContent:{callType:s,signalType:C.X.INIT,callerUid:this.driver.userInfo.userUid,recording:u?C.a2.YES:C.a2.NO}});case 20:case"end":return e.stop()}}),e,this)})));return function(n){return e.apply(this,arguments)}}()},{key:"checkCallPermission",value:function(){var e=(0,a.A)((0,r.A)().mark((function e(n){var t,a,o;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.channelId,!(null==(a=this.driver.initConfig)?void 0:a.anonymousMode)){e.next=3;break}return e.abrupt("return",!1);case 3:return e.next=5,this.imHttp.get(O.GET_CHECK_CALL_PERMISSION,{params:{channelId:t}});case 5:return o=e.sent,e.abrupt("return",o);case 7:case"end":return e.stop()}}),e,this)})));return function(n){return e.apply(this,arguments)}}()}])}(S.C),D={visible:!1,channelId:"",isCaller:!1,callerUid:"",micIsMuted:!1,isCalling:!1,duration:0,gotThrough:!1};var G=function(e){function n(){var e;return(0,o.A)(this,n),(e=w(this,n,["voiceCall"])).init=function(n){e.callController=new P(n);var t=n;t.callController=e.callController,t.imStore.callStore=(0,y.makeAutoObservable)({callInfo:(0,d.A)({},D),initCallInfo:function(e){this.callInfo=e},updateCallInfo:function(e){this.callInfo=(0,C.a3)(this.callInfo,e)},removeCallInfo:function(){this.callInfo=(0,d.A)({},D)}},{},{autoBind:!0}),t.pluginModules.useVoiceCall=R,t.pluginModules.CallUtil=L,t.pluginModules.CallOverlay=N},e.connect=(0,a.A)((0,r.A)().mark((function n(){var t;return(0,r.A)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",null==(t=e.callController)?void 0:t.init());case 1:case"end":return n.stop()}}),n)}))),e}return(0,l.A)(n,e),(0,i.A)(n)}(p.I)}}]);
//# sourceMappingURL=https://static-daily.okg.com/crash/okfe/p2p/im/index.6e3f6c25.js.map