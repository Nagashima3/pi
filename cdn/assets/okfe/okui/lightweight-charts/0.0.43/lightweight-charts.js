!function(t,i){if("object"==typeof exports&&"object"==typeof module)module.exports=i();else if("function"==typeof define&&define.amd)define([],i);else{var n=i();for(var s in n)("object"==typeof exports?exports:t)[s]=n[s]}}(self,(()=>(()=>{"use strict";var t={d:(i,n)=>{for(var s in n)t.o(n,s)&&!t.o(i,s)&&Object.defineProperty(i,s,{enumerable:!0,get:n[s]})},o:(t,i)=>Object.prototype.hasOwnProperty.call(t,i),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},i={};t.r(i),t.d(i,{ColorType:()=>Dn,CrosshairMode:()=>lt,LastPriceAnimationMode:()=>On,LineStyle:()=>u,LineType:()=>_,MismatchDirection:()=>Bi,PriceLineSource:()=>Rn,PriceScaleMode:()=>cn,TickMarkType:()=>Vn,TrackingModeExitMode:()=>Tn,createChart:()=>pr,createChartEx:()=>vr,createFunnelChart:()=>Cr,createPieChart:()=>Mr,createPixelChart:()=>Sr,createRadarChart:()=>xr,createScatterChart:()=>yr,customSeriesDefaultOptions:()=>kr,isBusinessDay:()=>zn,isUTCTimestamp:()=>An,version:()=>Pr});const n={upColor:"#26a69a",downColor:"#ef5350",wickVisible:!0,borderVisible:!0,borderColor:"#378658",borderUpColor:"#26a69a",borderDownColor:"#ef5350",wickColor:"#737375",wickUpColor:"#26a69a",wickDownColor:"#ef5350"},s={upColor:"#26a69a",downColor:"#ef5350",openVisible:!0,thinBars:!0},e={color:"#2196f3",lineStyle:0,lineWidth:3,shadowColor:null,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,lineType:0,lineVisible:!0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBorderWidth:2,crosshairMarkerBackgroundColor:"",lastPriceAnimation:0,pointMarkersVisible:!1},r={topColor:"rgba( 46, 220, 135, 0.4)",bottomColor:"rgba( 40, 221, 100, 0)",invertFilledArea:!1,lineColor:"#33D778",lineStyle:0,lineWidth:3,lineType:0,lineVisible:!0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBorderWidth:2,crosshairMarkerBackgroundColor:"",lastPriceAnimation:0,pointMarkersVisible:!1},h={baseValue:{type:"price",price:0},topFillColor1:"rgba(38, 166, 154, 0.28)",topFillColor2:"rgba(38, 166, 154, 0.05)",topLineColor:"rgba(38, 166, 154, 1)",bottomFillColor1:"rgba(239, 83, 80, 0.05)",bottomFillColor2:"rgba(239, 83, 80, 0.28)",bottomLineColor:"rgba(239, 83, 80, 1)",lineWidth:3,lineStyle:0,lineType:0,lineVisible:!0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBorderWidth:2,crosshairMarkerBackgroundColor:"",lastPriceAnimation:0,pointMarkersVisible:!1},l={color:"#26a69a",base:0},a={color:"#2196f3"},o={title:"",visible:!0,lastValueVisible:!0,priceLineVisible:!0,priceLineSource:0,priceLineWidth:1,priceLineColor:"",priceLineStyle:2,baseLineVisible:!0,baseLineWidth:1,baseLineColor:"#B2B5BE",baseLineStyle:0,priceFormat:{type:"price",precision:2,minMove:.01}};var _,u;function c(t,i){const n={0:[],1:[t.lineWidth,t.lineWidth],2:[2*t.lineWidth,2*t.lineWidth],3:[6*t.lineWidth,6*t.lineWidth],4:[t.lineWidth,4*t.lineWidth]}[i];t.setLineDash(n)}function d(t,i,n,s){t.beginPath();const e=t.lineWidth%2?.5:0;t.moveTo(n,i+e),t.lineTo(s,i+e),t.stroke()}function f(t,i){if(!t)throw new Error("Assertion failed"+(i?": "+i:""))}function v(t){if(void 0===t)throw new Error("Value is undefined");return t}function p(t){if(null===t)throw new Error("Value is null");return t}function m(t){return p(v(t))}!function(t){t[t.Simple=0]="Simple",t[t.WithSteps=1]="WithSteps",t[t.Curved=2]="Curved"}(_||(_={})),function(t){t[t.Solid=0]="Solid",t[t.Dotted=1]="Dotted",t[t.Dashed=2]="Dashed",t[t.LargeDashed=3]="LargeDashed",t[t.SparseDotted=4]="SparseDotted"}(u||(u={}));const b={khaki:"#f0e68c",azure:"#f0ffff",aliceblue:"#f0f8ff",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",gray:"#808080",green:"#008000",honeydew:"#f0fff0",floralwhite:"#fffaf0",lightblue:"#add8e6",lightcoral:"#f08080",lemonchiffon:"#fffacd",hotpink:"#ff69b4",lightyellow:"#ffffe0",greenyellow:"#adff2f",lightgoldenrodyellow:"#fafad2",limegreen:"#32cd32",linen:"#faf0e6",lightcyan:"#e0ffff",magenta:"#f0f",maroon:"#800000",olive:"#808000",orange:"#ffa500",oldlace:"#fdf5e6",mediumblue:"#0000cd",transparent:"#0000",lime:"#0f0",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",midnightblue:"#191970",orchid:"#da70d6",mediumorchid:"#ba55d3",mediumturquoise:"#48d1cc",orangered:"#ff4500",royalblue:"#4169e1",powderblue:"#b0e0e6",red:"#f00",coral:"#ff7f50",turquoise:"#40e0d0",white:"#fff",whitesmoke:"#f5f5f5",wheat:"#f5deb3",teal:"#008080",steelblue:"#4682b4",bisque:"#ffe4c4",aquamarine:"#7fffd4",aqua:"#0ff",sienna:"#a0522d",silver:"#c0c0c0",springgreen:"#00ff7f",antiquewhite:"#faebd7",burlywood:"#deb887",brown:"#a52a2a",beige:"#f5f5dc",chocolate:"#d2691e",chartreuse:"#7fff00",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cadetblue:"#5f9ea0",tomato:"#ff6347",fuchsia:"#f0f",blue:"#00f",salmon:"#fa8072",blanchedalmond:"#ffebcd",slateblue:"#6a5acd",slategray:"#708090",thistle:"#d8bfd8",tan:"#d2b48c",cyan:"#0ff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",blueviolet:"#8a2be2",black:"#000",darkmagenta:"#8b008b",darkslateblue:"#483d8b",darkkhaki:"#bdb76b",darkorchid:"#9932cc",darkorange:"#ff8c00",darkgreen:"#006400",darkred:"#8b0000",dodgerblue:"#1e90ff",darkslategray:"#2f4f4f",dimgray:"#696969",deepskyblue:"#00bfff",firebrick:"#b22222",forestgreen:"#228b22",indigo:"#4b0082",ivory:"#fffff0",lavenderblush:"#fff0f5",feldspar:"#d19275",indianred:"#cd5c5c",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightskyblue:"#87cefa",lightslategray:"#789",lightslateblue:"#8470ff",snow:"#fffafa",lightseagreen:"#20b2aa",lightsalmon:"#ffa07a",darksalmon:"#e9967a",darkviolet:"#9400d3",mediumpurple:"#9370d8",mediumaquamarine:"#66cdaa",skyblue:"#87ceeb",lavender:"#e6e6fa",lightsteelblue:"#b0c4de",mediumvioletred:"#c71585",mintcream:"#f5fffa",navajowhite:"#ffdead",navy:"#000080",olivedrab:"#6b8e23",palevioletred:"#d87093",violetred:"#d02090",yellow:"#ff0",yellowgreen:"#9acd32",lawngreen:"#7cfc00",pink:"#ffc0cb",paleturquoise:"#afeeee",palegoldenrod:"#eee8aa",darkolivegreen:"#556b2f",darkseagreen:"#8fbc8f",darkturquoise:"#00ced1",peachpuff:"#ffdab9",deeppink:"#ff1493",violet:"#ee82ee",palegreen:"#98fb98",mediumseagreen:"#3cb371",peru:"#cd853f",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",purple:"#800080",seagreen:"#2e8b57",seashell:"#fff5ee",papayawhip:"#ffefd5",mediumslateblue:"#7b68ee",plum:"#dda0dd",mediumspringgreen:"#00fa9a"};function w(t){return t<0?0:t>255?255:Math.round(t)||0}function g(t){return t<=0||t>1?Math.min(Math.max(t,0),1):Math.round(1e4*t)/1e4}const M=/^#([0-9a-f])([0-9a-f])([0-9a-f])([0-9a-f])?$/i,x=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i,S=/^rgb\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*\)$/,y=/^rgba\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d*\.?\d+)\s*\)$/;function C(t){(t=t.toLowerCase())in b&&(t=b[t]);{const i=y.exec(t)||S.exec(t);if(i)return[w(parseInt(i[1],10)),w(parseInt(i[2],10)),w(parseInt(i[3],10)),g(i.length<5?1:parseFloat(i[4]))]}{const i=x.exec(t);if(i)return[w(parseInt(i[1],16)),w(parseInt(i[2],16)),w(parseInt(i[3],16)),1]}{const i=M.exec(t);if(i)return[w(17*parseInt(i[1],16)),w(17*parseInt(i[2],16)),w(17*parseInt(i[3],16)),1]}throw new Error(`Cannot parse color: ${t}`)}function k(t,i){if("transparent"===t)return t;const n=C(t),s=n[3];return`rgba(${n[0]}, ${n[1]}, ${n[2]}, ${i*s})`}function P(t){const i=C(t);return{t:`rgb(${i[0]}, ${i[1]}, ${i[2]})`,i:(n=i,.199*n[0]+.687*n[1]+.114*n[2]>160?"black":"white")};var n}class T{constructor(){this.h=[]}l(t,i,n){const s={_:t,u:i,v:!0===n};this.h.push(s)}p(t){const i=this.h.findIndex((i=>t===i._));i>-1&&this.h.splice(i,1)}m(t){this.h=this.h.filter((i=>i.u!==t))}M(t,i,n){const s=[...this.h];this.h=this.h.filter((t=>!t.v)),s.forEach((s=>s._(t,i,n)))}S(){return this.h.length>0}C(){this.h=[]}}function O(t,...i){for(const n of i)for(const i in n)void 0!==n[i]&&("object"!=typeof n[i]||void 0===t[i]||Array.isArray(n[i])?t[i]=n[i]:O(t[i],n[i]));return t}function R(t){return"number"==typeof t&&isFinite(t)}function D(t){return"number"==typeof t&&t%1==0}function V(t){return"string"==typeof t}function B(t){return"boolean"==typeof t}function z(t){const i=t;if(!i||"object"!=typeof i)return i;let n,s,e;for(s in n=Array.isArray(i)?[]:{},i)i.hasOwnProperty(s)&&(e=i[s],n[s]=e&&"object"==typeof e?z(e):e);return n}function A(t){return null!==t}function I(t){return null===t?void 0:t}function L(){return"undefined"!=typeof window&&window.getComputedStyle&&document.body?window.getComputedStyle(document.body).fontFamily:"-apple-system, BlinkMacSystemFont, 'Trebuchet MS', Roboto, Ubuntu, sans-serif"}function F(t,i,n){return n=void 0!==n?`${n} `:"",void 0===i&&(i=L()),`${n}${t}px ${i}`}class E{constructor(t){this.k={P:1,T:5,O:NaN,R:"",D:"",V:"",B:"",A:0,I:0,L:0,F:0,N:0},this.j=t}W(){const t=this.k,i=this.H(),n=this.$();return t.O===i&&t.D===n||(t.O=i,t.D=n,t.R=F(i,n),t.F=2.5/12*i,t.A=t.F,t.I=i/12*t.T,t.L=i/12*t.T,t.N=0),t.V=this.U(),t.B=this.q(),this.k}U(){return this.j.W().layout.textColor}q(){return this.j.G()}H(){return this.j.W().layout.fontSize}$(){return this.j.W().layout.fontFamily}}class N{constructor(){this.Y=[]}X(t){this.Y=t}Z(t,i,n){this.Y.forEach((s=>{s.Z(t,i,n)}))}}class j{Z(t,i,n){t.useBitmapCoordinateSpace((t=>this.K(t,i,n)))}}class W extends j{constructor(){super(...arguments),this.J=null}tt(t){this.J=t}K({context:t,horizontalPixelRatio:i,verticalPixelRatio:n}){if(null===this.J||null===this.J.it)return;const s=this.J.it,e=this.J,r=Math.max(1,Math.floor(i))%2/2,h=h=>{t.beginPath();for(let l=s.to-1;l>=s.from;--l){const s=e.nt[l],a=Math.round(s.st*i)+r,o=s.et*n,_=h*n+r;t.moveTo(a,o),t.arc(a,o,_,0,2*Math.PI)}t.fill()};e.rt>0&&(t.fillStyle=e.ht,h(e.lt+e.rt)),t.fillStyle=e.ot,h(e.lt)}}function H(){return{nt:[{st:0,et:0,_t:0,ut:0}],ot:"",ht:"",lt:0,rt:0,it:null}}const $={from:0,to:1};class U{constructor(t,i){this.ct=new N,this.dt=[],this.ft=[],this.vt=!0,this.j=t,this.bt=i,this.ct.X(this.dt)}wt(t){const i=this.j.gt();i.length!==this.dt.length&&(this.ft=i.map(H),this.dt=this.ft.map((t=>{const i=new W;return i.tt(t),i})),this.ct.X(this.dt)),this.vt=!0}Mt(){return this.vt&&(this.xt(),this.vt=!1),this.ct}xt(){const t=2===this.bt.W().mode,i=this.j.gt(),n=this.bt.St(),s=this.j.yt();i.forEach(((i,e)=>{var r;const h=this.ft[e],l=i.Ct(n);if(t||null===l||!i.kt())return void(h.it=null);const a=p(i.Pt());h.ot=l.Tt,h.lt=l.lt,h.rt=l.Ot,h.nt[0].ut=l.ut,h.nt[0].et=i.Dt().Rt(l.ut,a.Vt),h.ht=null!==(r=l.Bt)&&void 0!==r?r:this.j.zt(h.nt[0].et/i.Dt().At()),h.nt[0]._t=n,h.nt[0].st=s.It(n),h.it=$}))}}class q extends j{constructor(t){super(),this.Lt=t}K({context:t,bitmapSize:i,horizontalPixelRatio:n,verticalPixelRatio:s}){if(null===this.Lt)return;const e=this.Lt.Ft.kt,r=this.Lt.Et.kt;if(!e&&!r)return;const h=Math.round(this.Lt.st*n),l=Math.round(this.Lt.et*s);t.lineCap="butt",e&&h>=0&&(t.lineWidth=Math.floor(this.Lt.Ft.rt*n),t.strokeStyle=this.Lt.Ft.V,t.fillStyle=this.Lt.Ft.V,c(t,this.Lt.Ft.Nt),function(t,i,n,s){t.beginPath();const e=t.lineWidth%2?.5:0;t.moveTo(i+e,n),t.lineTo(i+e,s),t.stroke()}(t,h,0,i.height)),r&&l>=0&&(t.lineWidth=Math.floor(this.Lt.Et.rt*s),t.strokeStyle=this.Lt.Et.V,t.fillStyle=this.Lt.Et.V,c(t,this.Lt.Et.Nt),d(t,l,0,i.width))}}class G{constructor(t){this.vt=!0,this.jt={Ft:{rt:1,Nt:0,V:"",kt:!1},Et:{rt:1,Nt:0,V:"",kt:!1},st:0,et:0},this.Wt=new q(this.jt),this.Ht=t}wt(){this.vt=!0}Mt(){return this.vt&&(this.xt(),this.vt=!1),this.Wt}xt(){const t=this.Ht.kt(),i=p(this.Ht.$t()),n=i.Ut().W().crosshair,s=this.jt;if(2===n.mode)return s.Et.kt=!1,void(s.Ft.kt=!1);s.Et.kt=t&&this.Ht.qt(i),s.Ft.kt=t&&this.Ht.Gt(),s.Et.rt=n.horzLine.width,s.Et.Nt=n.horzLine.style,s.Et.V=n.horzLine.color,s.Ft.rt=n.vertLine.width,s.Ft.Nt=n.vertLine.style,s.Ft.V=n.vertLine.color,s.st=this.Ht.Yt(),s.et=this.Ht.Xt()}}function Y(t,i,n,s,e,r){t.fillRect(i+r,n,s-2*r,r),t.fillRect(i+r,n+e-r,s-2*r,r),t.fillRect(i,n,r,e),t.fillRect(i+s-r,n,r,e)}function X(t,i,n,s,e,r){t.save(),t.globalCompositeOperation="copy",t.fillStyle=r,t.fillRect(i,n,s,e),t.restore()}function Z(t,i){return t.map((t=>0===t?t:t+i))}function K(t,i,n,s,e,r){t.beginPath(),t.lineTo(i+s-r[1],n),0!==r[1]&&t.arcTo(i+s,n,i+s,n+r[1],r[1]),t.lineTo(i+s,n+e-r[2]),0!==r[2]&&t.arcTo(i+s,n+e,i+s-r[2],n+e,r[2]),t.lineTo(i+r[3],n+e),0!==r[3]&&t.arcTo(i,n+e,i,n+e-r[3],r[3]),t.lineTo(i,n+r[0]),0!==r[0]&&t.arcTo(i,n,i+r[0],n,r[0])}function J(t,i,n,s,e,r,h=0,l=[0,0,0,0],a=""){if(t.save(),!h||!a||a===r)return K(t,i,n,s,e,l),t.fillStyle=r,t.fill(),void t.restore();const o=h/2;if("transparent"!==r){K(t,i+h,n+h,s-2*h,e-2*h,Z(l,-h)),t.fillStyle=r,t.fill()}if("transparent"!==a){K(t,i+o,n+o,s-h,e-h,Z(l,-o)),t.lineWidth=h,t.strokeStyle=a,t.closePath(),t.stroke()}t.restore()}function Q(t,i,n,s,e,r,h){t.save(),t.globalCompositeOperation="copy";const l=t.createLinearGradient(0,0,0,e);l.addColorStop(0,r),l.addColorStop(1,h),t.fillStyle=l,t.fillRect(i,n,s,e),t.restore()}class tt{constructor(t,i){this.tt(t,i)}tt(t,i){this.Lt=t,this.Zt=i}At(t,i){return this.Lt.kt?t.O+t.F+t.A:0}Z(t,i,n,s){if(!this.Lt.kt||0===this.Lt.Kt.length)return;const e=this.Lt.V,r=this.Zt.t,h=t.useBitmapCoordinateSpace((t=>{const h=t.context;h.font=i.R;const l=this.Jt(t,i,n,s),a=l.Qt,o=(t,i)=>{l.ti?J(h,a.ii,a.ni,a.si,a.ei,t,a.ri,[a.lt,0,0,a.lt],i):J(h,a.hi,a.ni,a.si,a.ei,t,a.ri,[0,a.lt,a.lt,0],i)};return o(r,"transparent"),this.Lt.li&&(h.fillStyle=e,h.fillRect(a.hi,a.ai,a.oi-a.hi,a._i)),o("transparent",r),this.Lt.ui&&(h.fillStyle=i.B,h.fillRect(l.ti?a.ci-a.ri:0,a.ni,a.ri,a.di-a.ni)),l}));t.useMediaCoordinateSpace((({context:t})=>{const n=h.fi;t.font=i.R,t.textAlign=h.ti?"right":"left",t.textBaseline="middle",t.fillStyle=e,t.fillText(this.Lt.Kt,n.pi,(n.ni+n.di)/2+n.mi)}))}Jt(t,i,n,s){var e;const{context:r,bitmapSize:h,mediaSize:l,horizontalPixelRatio:a,verticalPixelRatio:o}=t,_=this.Lt.li||!this.Lt.bi?i.T:0,u=this.Lt.wi?i.P:0,c=i.F+this.Zt.gi,d=i.A+this.Zt.Mi,f=i.I,v=i.L,p=this.Lt.Kt,m=i.O,b=n.xi(r,p),w=Math.ceil(n.Si(r,p)),g=m+c+d,M=i.P+f+v+w+_,x=Math.max(1,Math.floor(o));let S=Math.round(g*o);S%2!=x%2&&(S+=1);const y=u>0?Math.max(1,Math.floor(u*a)):0,C=Math.round(M*a),k=Math.round(_*a),P=null!==(e=this.Zt.yi)&&void 0!==e?e:this.Zt.Ci,T=Math.round(P*o)-Math.floor(.5*o),O=Math.floor(T+x/2-S/2),R=O+S,D="right"===s,V=D?l.width-u:u,B=D?h.width-y:y;let z,A,I;return D?(z=B-C,A=B-k,I=V-_-f-u):(z=B+C,A=B+k,I=V+_+f),{ti:D,Qt:{ni:O,ai:T,di:R,si:C,ei:S,lt:2*a,ri:y,ii:z,hi:B,oi:A,_i:x,ci:h.width},fi:{ni:O/o,di:R/o,pi:I,mi:b}}}}class it{constructor(t){this.ki={Ci:0,t:"#000",Mi:0,gi:0},this.Pi={Kt:"",kt:!1,li:!0,bi:!1,Bt:"",V:"#FFF",ui:!1,wi:!1},this.Ti={Kt:"",kt:!1,li:!1,bi:!0,Bt:"",V:"#FFF",ui:!0,wi:!0},this.vt=!0,this.Oi=new(t||tt)(this.Pi,this.ki),this.Ri=new(t||tt)(this.Ti,this.ki)}Kt(){return this.Di(),this.Pi.Kt}Ci(){return this.Di(),this.ki.Ci}wt(){this.vt=!0}At(t,i=!1){return Math.max(this.Oi.At(t,i),this.Ri.At(t,i))}Vi(){return this.ki.yi||0}Bi(t){this.ki.yi=t}zi(){return this.Di(),this.Pi.kt||this.Ti.kt}Ai(){return this.Di(),this.Pi.kt}Mt(t){return this.Di(),this.Pi.li=this.Pi.li&&t.W().ticksVisible,this.Ti.li=this.Ti.li&&t.W().ticksVisible,this.Oi.tt(this.Pi,this.ki),this.Ri.tt(this.Ti,this.ki),this.Oi}Ii(){return this.Di(),this.Oi.tt(this.Pi,this.ki),this.Ri.tt(this.Ti,this.ki),this.Ri}Di(){this.vt&&(this.Pi.li=!0,this.Ti.li=!1,this.Li(this.Pi,this.Ti,this.ki))}}class nt extends it{constructor(t,i,n){super(),this.Ht=t,this.Fi=i,this.Ei=n}Li(t,i,n){if(t.kt=!1,2===this.Ht.W().mode)return;const s=this.Ht.W().horzLine;if(!s.labelVisible)return;const e=this.Fi.Pt();if(!this.Ht.kt()||this.Fi.Ni()||null===e)return;const r=P(s.labelBackgroundColor);n.t=r.t,t.V=r.i;const h=2/12*this.Fi.O();n.gi=h,n.Mi=h;const l=this.Ei(this.Fi);n.Ci=l.Ci,t.Kt=this.Fi.ji(l.ut,e),t.kt=!0}}const st=/[1-9]/g;class et{constructor(){this.Lt=null}tt(t){this.Lt=t}Z(t,i){if(null===this.Lt||!1===this.Lt.kt||0===this.Lt.Kt.length)return;const n=t.useMediaCoordinateSpace((({context:t})=>(t.font=i.R,Math.round(i.Wi.Si(t,p(this.Lt).Kt,st)))));if(n<=0)return;const s=i.Hi,e=n+2*s,r=e/2,h=this.Lt.$i;let l=this.Lt.Ci,a=Math.floor(l-r)+.5;a<0?(l+=Math.abs(0-a),a=Math.floor(l-r)+.5):a+e>h&&(l-=Math.abs(h-(a+e)),a=Math.floor(l-r)+.5);const o=a+e,_=Math.ceil(0+i.P+i.T+i.F+i.O+i.A);t.useBitmapCoordinateSpace((({context:t,horizontalPixelRatio:n,verticalPixelRatio:s})=>{const e=p(this.Lt);t.fillStyle=e.t;const r=Math.round(a*n),h=Math.round(0*s),l=Math.round(o*n),u=Math.round(_*s),c=Math.round(2*n);if(t.beginPath(),t.moveTo(r,h),t.lineTo(r,u-c),t.arcTo(r,u,r+c,u,c),t.lineTo(l-c,u),t.arcTo(l,u,l,u-c,c),t.lineTo(l,h),t.fill(),e.li){const r=Math.round(e.Ci*n),l=h,a=Math.round((l+i.T)*s);t.fillStyle=e.V;const o=Math.max(1,Math.floor(n)),_=Math.floor(.5*n);t.fillRect(r-_,l,o,a-l)}})),t.useMediaCoordinateSpace((({context:t})=>{const n=p(this.Lt),e=0+i.P+i.T+i.F+i.O/2;t.font=i.R,t.textAlign="left",t.textBaseline="middle",t.fillStyle=n.V;const r=i.Wi.xi(t,"Apr0");t.translate(a+s,e+r),t.fillText(n.Kt,0,0)}))}}class rt{constructor(t,i,n){this.vt=!0,this.Wt=new et,this.jt={kt:!1,t:"#4c525e",V:"white",Kt:"",$i:0,Ci:NaN,li:!0},this.bt=t,this.Ui=i,this.Ei=n}wt(){this.vt=!0}Mt(){return this.vt&&(this.xt(),this.vt=!1),this.Wt.tt(this.jt),this.Wt}xt(){const t=this.jt;if(t.kt=!1,2===this.bt.W().mode)return;const i=this.bt.W().vertLine;if(!i.labelVisible)return;const n=this.Ui.yt();if(n.Ni())return;t.$i=n.$i();const s=this.Ei();if(null===s)return;t.Ci=s.Ci;const e=n.qi(this.bt.St());t.Kt=n.Gi(p(e)),t.kt=!0;const r=P(i.labelBackgroundColor);t.t=r.t,t.V=r.i,t.li=n.W().ticksVisible}}class ht{constructor(){this.Yi=null,this.Xi=0}Zi(){return this.Xi}Ki(t){this.Xi=t}Dt(){return this.Yi}Ji(t){this.Yi=t}Qi(t){return[]}tn(){return[]}kt(){return!0}}var lt;!function(t){t[t.Normal=0]="Normal",t[t.Magnet=1]="Magnet",t[t.Hidden=2]="Hidden"}(lt||(lt={}));class at extends ht{constructor(t,i){super(),this.nn=null,this.sn=NaN,this.en=0,this.rn=!0,this.hn=new Map,this.ln=!1,this.an=NaN,this._n=NaN,this.un=NaN,this.cn=NaN,this.Ui=t,this.dn=i,this.fn=new U(t,this);this.vn=((t,i)=>n=>{const s=i(),e=t();if(n===p(this.nn).pn())return{ut:e,Ci:s};{const t=p(n.Pt());return{ut:n.mn(s,t),Ci:s}}})((()=>this.sn),(()=>this._n));const n=((t,i)=>()=>{const n=this.Ui.yt().bn(t()),s=i();return n&&Number.isFinite(s)?{_t:n,Ci:s}:null})((()=>this.en),(()=>this.Yt()));this.wn=new rt(this,t,n),this.gn=new G(this)}W(){return this.dn}Mn(t,i){this.un=t,this.cn=i}xn(){this.un=NaN,this.cn=NaN}Sn(){return this.un}yn(){return this.cn}Cn(t,i,n){this.ln||(this.ln=!0),this.rn=!0,this.kn(t,i,n)}St(){return this.en}Yt(){return this.an}Xt(){return this._n}kt(){return this.rn}Pn(){this.rn=!1,this.Tn(),this.sn=NaN,this.an=NaN,this._n=NaN,this.nn=null,this.xn()}On(t){return null!==this.nn?[this.gn,this.fn]:[]}qt(t){return t===this.nn&&this.dn.horzLine.visible}Gt(){return this.dn.vertLine.visible}Rn(t,i){this.rn&&this.nn===t||this.hn.clear();const n=[];return this.nn===t&&n.push(this.Dn(this.hn,i,this.vn)),n}tn(){return this.rn?[this.wn]:[]}$t(){return this.nn}Vn(){this.gn.wt(),this.hn.forEach((t=>t.wt())),this.wn.wt(),this.fn.wt()}Bn(t){return t&&!t.pn().Ni()?t.pn():null}kn(t,i,n){this.zn(t,i,n)&&this.Vn()}zn(t,i,n){const s=this.an,e=this._n,r=this.sn,h=this.en,l=this.nn,a=this.Bn(n);this.en=t,this.an=isNaN(t)?NaN:this.Ui.yt().It(t),this.nn=n;const o=null!==a?a.Pt():null;return null!==a&&null!==o?(this.sn=i,this._n=a.Rt(i,o)):(this.sn=NaN,this._n=NaN),s!==this.an||e!==this._n||h!==this.en||r!==this.sn||l!==this.nn}Tn(){const t=this.Ui.gt().map((t=>t.In().An())).filter(A),i=0===t.length?null:Math.max(...t);this.en=null!==i?i:NaN}Dn(t,i,n){let s=t.get(i);return void 0===s&&(s=new nt(this,i,n),t.set(i,s)),s}}function ot(t){return"left"===t||"right"===t}class _t{constructor(t){this.Ln=new Map,this.Fn=[],this.En=t}Nn(t,i){const n=function(t,i){return void 0===t?i:{jn:Math.max(t.jn,i.jn),Wn:t.Wn||i.Wn}}(this.Ln.get(t),i);this.Ln.set(t,n)}Hn(){return this.En}$n(t){const i=this.Ln.get(t);return void 0===i?{jn:this.En}:{jn:Math.max(this.En,i.jn),Wn:i.Wn}}Un(){this.qn(),this.Fn=[{Gn:0}]}Yn(t){this.qn(),this.Fn=[{Gn:1,Vt:t}]}Xn(t){this.Zn(),this.Fn.push({Gn:5,Vt:t})}qn(){this.Zn(),this.Fn.push({Gn:6})}Kn(){this.qn(),this.Fn=[{Gn:4}]}Jn(t){this.qn(),this.Fn.push({Gn:2,Vt:t})}Qn(t){this.qn(),this.Fn.push({Gn:3,Vt:t})}ts(){return this.Fn}ns(t){for(const i of t.Fn)this.ss(i);this.En=Math.max(this.En,t.En),t.Ln.forEach(((t,i)=>{this.Nn(i,t)}))}static es(){return new _t(2)}static rs(){return new _t(3)}ss(t){switch(t.Gn){case 0:this.Un();break;case 1:this.Yn(t.Vt);break;case 2:this.Jn(t.Vt);break;case 3:this.Qn(t.Vt);break;case 4:this.Kn();break;case 5:this.Xn(t.Vt);break;case 6:this.Zn()}}Zn(){const t=this.Fn.findIndex((t=>5===t.Gn));-1!==t&&this.Fn.splice(t,1)}}const ut=".";function ct(t,i){if(!R(t))return"n/a";if(!D(i))throw new TypeError("invalid length");if(i<0||i>16)throw new TypeError("invalid length");if(0===i)return t.toString();return("0000000000000000"+t.toString()).slice(-i)}class dt{constructor(t,i){if(i||(i=1),R(t)&&D(t)||(t=100),t<0)throw new TypeError("invalid base");this.Fi=t,this.hs=i,this.ls()}format(t){const i=t<0?"−":"";return t=Math.abs(t),i+this.os(t)}ls(){if(this._s=0,this.Fi>0&&this.hs>0){let t=this.Fi;for(;t>1;)t/=10,this._s++}}os(t){const i=this.Fi/this.hs;let n=Math.floor(t),s="";const e=void 0!==this._s?this._s:NaN;if(i>1){let r=+(Math.round(t*i)-n*i).toFixed(this._s);r>=i&&(r-=i,n+=1),s=ut+ct(+r.toFixed(this._s)*this.hs,e)}else n=Math.round(n*i)/i,e>0&&(s=ut+ct(0,e));return n.toFixed(0)+s}}class ft extends dt{constructor(t=100){super(t)}format(t){return`${super.format(t)}%`}}class vt{constructor(t){this.us=t}format(t){let i="";return t<0&&(i="-",t=-t),t<995?i+this.cs(t):t<999995?i+this.cs(t/1e3)+"K":t<999999995?(t=1e3*Math.round(t/1e3),i+this.cs(t/1e6)+"M"):(t=1e6*Math.round(t/1e6),i+this.cs(t/1e9)+"B")}cs(t){let i;const n=Math.pow(10,this.us);return i=(t=Math.round(t*n)/n)>=1e-15&&t<1?t.toFixed(this.us).replace(/\.?0+$/,""):String(t),i.replace(/(\.[1-9]*)0+$/,((t,i)=>i))}}function pt(t,i,n,s,e,r,h){if(0===i.length||s.from>=i.length||s.to<=0)return;const{context:l,horizontalPixelRatio:a,verticalPixelRatio:o}=t,_=i[s.from];let u=r(t,_),c=_;if(s.to-s.from<2){const i=e/2;l.beginPath();const n={st:_.st-i,et:_.et},s={st:_.st+i,et:_.et};l.moveTo(n.st*a,n.et*o),l.lineTo(s.st*a,s.et*o),h(t,u,n,s)}else{const e=(i,n)=>{h(t,u,c,n),l.beginPath(),u=i,c=n};let d=c;l.beginPath(),l.moveTo(_.st*a,_.et*o);let f=i[0].st,v=i[0].et;for(let h=s.from+1;h<s.to;++h){d=i[h];const s=r(t,d);switch(n){case 0:l.lineTo(d.st*a,d.et*o);break;case 1:l.lineTo(d.st*a,i[h-1].et*o),s!==u&&(e(s,d),l.lineTo(d.st*a,i[h-1].et*o)),l.lineTo(d.st*a,d.et*o);break;case 2:{const[t,n,s]=mt(i,h,f,v);f=s.st,v=s.et,l.bezierCurveTo(t.st*a,t.et*o,n.st*a,n.et*o,d.st*a,d.et*o);break}}1!==n&&s!==u&&(e(s,d),l.moveTo(d.st*a,d.et*o))}(c!==d||c===d&&1===n)&&h(t,u,c,d)}}function mt(t,i,n,s){const e=n,r=s;let h,l;const a=t[i].st,o=t[i].et;let _=.5,u=0,c=0,d=a,f=o;if(i===t.length-1)h=a,l=o;else{const n=t[i-1].st,s=t[i-1].et,e=t[i+1].st,r=t[i+1].et;u=e-n,c=r-s;const v=a-n,p=e-a,m=o-s,b=r-o,w=Math.sqrt(v*v+m*m),g=Math.sqrt(p*p+b*b);_=g/(g+w),h=a-.5*u*(1-_),l=o-.5*c*(1-_),d=a+.5*u*_,f=o+.5*c*_,d=Math.min(d,Math.max(e,a)),f=Math.min(f,Math.max(r,o)),d=Math.max(d,Math.min(e,a)),f=Math.max(f,Math.min(r,o)),u=d-a,c=f-o,h=a-u*w/g,l=o-c*w/g,h=Math.min(h,Math.max(n,a)),l=Math.min(l,Math.max(s,o)),h=Math.max(h,Math.min(n,a)),l=Math.max(l,Math.min(s,o)),u=a-h,c=o-l,d=a+u*g/w,f=o+c*g/w}return[{st:e,et:r},{st:h,et:l},{st:d,et:f}]}function bt(t,i,n,s,e){const{context:r,horizontalPixelRatio:h,verticalPixelRatio:l}=i;r.lineTo(e.st*h,t*l),r.lineTo(s.st*h,t*l),r.closePath(),r.fillStyle=n,r.fill()}class wt extends j{constructor(){super(...arguments),this.J=null}tt(t){this.J=t}K(t){var i;if(null===this.J)return;const{nt:n,it:s,ds:e,rt:r,Nt:h,fs:l}=this.J,a=null!==(i=this.J.vs)&&void 0!==i?i:this.J.ps?0:t.mediaSize.height;if(null===s)return;const o=t.context;o.lineCap="butt",o.lineJoin="round",o.lineWidth=r,c(o,h),o.lineWidth=1,pt(t,n,l,s,e,this.bs.bind(this),bt.bind(null,a))}}function gt(t,i,n){return Math.min(Math.max(t,i),n)}function Mt(t,i,n){return i-t<=n}function xt(t){const i=Math.ceil(t);return i%2==0?i-1:i}class St{ws(t,i){const n=this.gs,{Ms:s,xs:e,Ss:r,ys:h,Cs:l,vs:a}=i;if(void 0===this.ks||void 0===n||n.Ms!==s||n.xs!==e||n.Ss!==r||n.ys!==h||n.vs!==a||n.Cs!==l){const n=t.context.createLinearGradient(0,0,0,l);if(n.addColorStop(0,s),null!=a){const i=gt(a*t.verticalPixelRatio/l,0,1);n.addColorStop(i,e),n.addColorStop(i,r)}n.addColorStop(1,h),this.ks=n,this.gs=i}return this.ks}}class yt extends wt{constructor(){super(...arguments),this.Ps=new St}bs(t,i){return this.Ps.ws(t,{Ms:i.Ts,xs:"",Ss:"",ys:i.Os,Cs:t.bitmapSize.height})}}function Ct(t,i){const n=t.context;n.strokeStyle=i,n.stroke()}class kt extends j{constructor(){super(...arguments),this.J=null}tt(t){this.J=t}K(t){if(null===this.J)return;const{nt:i,it:n,ds:s,fs:e,rt:r,Nt:h,Rs:l,Ds:a,Vs:o,Bs:_,zs:u}=this.J;if(null===n)return;const d=t.context;d.lineCap="butt",d.lineWidth=r*t.verticalPixelRatio,c(d,h),a&&(d.shadowColor=a,d.shadowBlur=o,d.shadowOffsetX=_,d.shadowOffsetY=u),d.lineJoin="round";const f=this.As.bind(this);void 0!==e&&pt(t,i,e,n,s,f,Ct),l&&function(t,i,n,s,e){const{horizontalPixelRatio:r,verticalPixelRatio:h,context:l}=t;let a=null;const o=Math.max(1,Math.floor(r))%2/2,_=n*h+o;for(let n=s.to-1;n>=s.from;--n){const s=i[n];if(s){const i=e(t,s);i!==a&&(l.beginPath(),null!==a&&l.fill(),l.fillStyle=i,a=i);const n=Math.round(s.st*r)+o,u=s.et*h;l.moveTo(n,u),l.arc(n,u,_,0,2*Math.PI)}}l.fill()}(t,i,l,n,f)}}class Pt extends kt{As(t,i){return i.ot}}function Tt(t,i,n,s,e=0,r=i.length){let h=r-e;for(;0<h;){const r=h>>1,l=e+r;s(i[l],n)===t?(e=l+1,h-=r+1):h=r}return e}const Ot=Tt.bind(null,!0),Rt=Tt.bind(null,!1);function Dt(t,i){return t._t<i}function Vt(t,i){return i<t._t}function Bt(t,i,n){const s=i.Is(),e=i.ci(),r=Ot(t,s,Dt),h=Rt(t,e,Vt);if(!n)return{from:r,to:h};let l=r,a=h;return r>0&&r<t.length&&t[r]._t>=s&&(l=r-1),h>0&&h<t.length&&t[h-1]._t<=e&&(a=h+1),{from:l,to:a}}class zt{constructor(t,i,n){this.Ls=!0,this.Fs=!0,this.Es=!0,this.Ns=[],this.js=null,this.Ws=t,this.Hs=i,this.$s=n}wt(t){this.Ls=!0,"data"===t&&(this.Fs=!0),"options"===t&&(this.Es=!0)}Mt(){return this.Ws.kt()?(this.Us(),null===this.js?null:this.qs):null}Gs(){this.Ns=this.Ns.map((t=>Object.assign(Object.assign({},t),this.Ws.Xs().Ys(t._t))))}Zs(){this.js=null}Us(){this.Fs&&(this.Ks(),this.Fs=!1),this.Es&&(this.Gs(),this.Es=!1),this.Ls&&(this.Js(),this.Ls=!1)}Js(){const t=this.Ws.Dt(),i=this.Hs.yt();if(this.Zs(),i.Ni()||t.Ni())return;const n=i.Qs();if(null===n)return;if(0===this.Ws.In().te())return;const s=this.Ws.Pt();null!==s&&(this.js=Bt(this.Ns,n,this.$s),this.ie(t,i,s.Vt),this.ne())}}class At extends zt{constructor(t,i){super(t,i,!0)}ie(t,i,n){i.se(this.Ns,I(this.js)),t.ee(this.Ns,n,I(this.js))}re(t,i){return{_t:t,ut:i,st:NaN,et:NaN}}Ks(){const t=this.Ws.Xs();this.Ns=this.Ws.In().he().map((i=>{const n=i.Vt[3];return this.le(i.ae,n,t)}))}}class It extends At{constructor(t,i){super(t,i),this.qs=new N,this.oe=new yt,this._e=new Pt,this.qs.X([this.oe,this._e])}le(t,i,n){return Object.assign(Object.assign({},this.re(t,i)),n.Ys(t))}ne(){const t=this.Ws.W();this.oe.tt({fs:t.lineType,nt:this.Ns,Nt:t.lineStyle,rt:t.lineWidth,vs:null,ps:t.invertFilledArea,it:this.js,ds:this.Hs.yt().ue()}),this._e.tt({fs:t.lineVisible?t.lineType:void 0,nt:this.Ns,Nt:t.lineStyle,rt:t.lineWidth,Ds:null,Vs:0,Bs:0,zs:0,it:this.js,ds:this.Hs.yt().ue(),Rs:t.pointMarkersVisible?t.pointMarkersRadius||t.lineWidth/2+2:void 0})}}class Lt extends j{constructor(){super(...arguments),this.Lt=null,this.ce=0,this.de=0}tt(t){this.Lt=t}K({context:t,horizontalPixelRatio:i,verticalPixelRatio:n}){if(null===this.Lt||0===this.Lt.In.length||null===this.Lt.it)return;if(this.ce=this.fe(i),this.ce>=2){Math.max(1,Math.floor(i))%2!=this.ce%2&&this.ce--}this.de=this.Lt.ve?Math.min(this.ce,Math.floor(i)):this.ce;let s=null;const e=this.de<=this.ce&&this.Lt.ue>=Math.floor(1.5*i);for(let r=this.Lt.it.from;r<this.Lt.it.to;++r){const h=this.Lt.In[r];s!==h.pe&&(t.fillStyle=h.pe,s=h.pe);const l=Math.floor(.5*this.de),a=Math.round(h.st*i),o=a-l,_=this.de,u=o+_-1,c=Math.min(h.me,h.be),d=Math.max(h.me,h.be),f=Math.round(c*n)-l,v=Math.round(d*n)+l,p=Math.max(v-f,this.de);t.fillRect(o,f,_,p);const m=Math.ceil(1.5*this.ce);if(e){if(this.Lt.we){const i=a-m;let s=Math.max(f,Math.round(h.ge*n)-l),e=s+_-1;e>f+p-1&&(e=f+p-1,s=e-_+1),t.fillRect(i,s,o-i,e-s+1)}const i=a+m;let s=Math.max(f,Math.round(h.Me*n)-l),e=s+_-1;e>f+p-1&&(e=f+p-1,s=e-_+1),t.fillRect(u+1,s,i-u,e-s+1)}}}fe(t){const i=Math.floor(t);return Math.max(i,Math.floor(function(t,i){return Math.floor(.3*t*i)}(p(this.Lt).ue,t)))}}class Ft extends zt{constructor(t,i){super(t,i,!1)}ie(t,i,n){i.se(this.Ns,I(this.js)),t.xe(this.Ns,n,I(this.js))}Se(t,i,n){return{_t:t,ye:i.Vt[0],Ce:i.Vt[1],ke:i.Vt[2],Pe:i.Vt[3],st:NaN,ge:NaN,me:NaN,be:NaN,Me:NaN}}Ks(){const t=this.Ws.Xs();this.Ns=this.Ws.In().he().map((i=>this.le(i.ae,i,t)))}}class Et extends Ft{constructor(){super(...arguments),this.qs=new Lt}le(t,i,n){return Object.assign(Object.assign({},this.Se(t,i,n)),n.Ys(t))}ne(){const t=this.Ws.W();this.qs.tt({In:this.Ns,ue:this.Hs.yt().ue(),we:t.openVisible,ve:t.thinBars,it:this.js})}}class Nt extends wt{constructor(){super(...arguments),this.Ps=new St}bs(t,i){const n=this.J;return this.Ps.ws(t,{Ms:i.Te,xs:i.Oe,Ss:i.Re,ys:i.De,Cs:t.bitmapSize.height,vs:n.vs})}}class jt extends kt{constructor(){super(...arguments),this.Ve=new St}As(t,i){const n=this.J;return this.Ve.ws(t,{Ms:i.Be,xs:i.Be,Ss:i.ze,ys:i.ze,Cs:t.bitmapSize.height,vs:n.vs})}}class Wt extends At{constructor(t,i){super(t,i),this.qs=new N,this.Ae=new Nt,this.Ie=new jt,this.qs.X([this.Ae,this.Ie])}le(t,i,n){return Object.assign(Object.assign({},this.re(t,i)),n.Ys(t))}ne(){const t=this.Ws.Pt();if(null===t)return;const i=this.Ws.W(),n=this.Ws.Dt().Rt(i.baseValue.price,t.Vt),s=this.Hs.yt().ue();this.Ae.tt({nt:this.Ns,rt:i.lineWidth,Nt:i.lineStyle,fs:i.lineType,vs:n,ps:!1,it:this.js,ds:s}),this.Ie.tt({nt:this.Ns,rt:i.lineWidth,Nt:i.lineStyle,Ds:null,Vs:0,Bs:0,zs:0,fs:i.lineVisible?i.lineType:void 0,Rs:i.pointMarkersVisible?i.pointMarkersRadius||i.lineWidth/2+2:void 0,vs:n,it:this.js,ds:s})}}class Ht extends j{constructor(){super(...arguments),this.Lt=null,this.ce=0}tt(t){this.Lt=t}K(t){if(null===this.Lt||0===this.Lt.In.length||null===this.Lt.it)return;const{horizontalPixelRatio:i}=t;if(this.ce=function(t,i){if(t>=2.5&&t<=4)return Math.floor(3*i);const n=1-.2*Math.atan(Math.max(4,t)-4)/(.5*Math.PI),s=Math.floor(t*n*i),e=Math.floor(t*i),r=Math.min(s,e);return Math.max(Math.floor(i),r)}(this.Lt.ue,i),this.ce>=2){Math.floor(i)%2!=this.ce%2&&this.ce--}const n=this.Lt.In;this.Lt.Le&&this.Fe(t,n,this.Lt.it),this.Lt.ui&&this.Ee(t,n,this.Lt.it);const s=this.Ne(i);(!this.Lt.ui||this.ce>2*s)&&this.je(t,n,this.Lt.it)}Fe(t,i,n){if(null===this.Lt)return;const{context:s,horizontalPixelRatio:e,verticalPixelRatio:r}=t;let h="",l=Math.min(Math.floor(e),Math.floor(this.Lt.ue*e));l=Math.max(Math.floor(e),Math.min(l,this.ce));const a=Math.floor(.5*l);let o=null;for(let t=n.from;t<n.to;t++){const n=i[t];n.We!==h&&(s.fillStyle=n.We,h=n.We);const _=Math.round(Math.min(n.ge,n.Me)*r),u=Math.round(Math.max(n.ge,n.Me)*r),c=Math.round(n.me*r),d=Math.round(n.be*r);let f=Math.round(e*n.st)-a;const v=f+l-1;null!==o&&(f=Math.max(o+1,f),f=Math.min(f,v));const p=v-f+1;s.fillRect(f,c,p,_-c),s.fillRect(f,u+1,p,d-u),o=v}}Ne(t){let i=Math.floor(1*t);this.ce<=2*i&&(i=Math.floor(.5*(this.ce-1)));const n=Math.max(Math.floor(t),i);return this.ce<=2*n?Math.max(Math.floor(t),Math.floor(1*t)):n}Ee(t,i,n){if(null===this.Lt)return;const{context:s,horizontalPixelRatio:e,verticalPixelRatio:r}=t;let h="";const l=this.Ne(e);let a=null;for(let t=n.from;t<n.to;t++){const n=i[t];n.He!==h&&(s.fillStyle=n.He,h=n.He);let o=Math.round(n.st*e)-Math.floor(.5*this.ce);const _=o+this.ce-1,u=Math.round(Math.min(n.ge,n.Me)*r),c=Math.round(Math.max(n.ge,n.Me)*r);if(null!==a&&(o=Math.max(a+1,o),o=Math.min(o,_)),this.Lt.ue*e>2*l)Y(s,o,u,_-o+1,c-u+1,l);else{const t=_-o+1;s.fillRect(o,u,t,c-u+1)}a=_}}je(t,i,n){if(null===this.Lt)return;const{context:s,horizontalPixelRatio:e,verticalPixelRatio:r}=t;let h="";const l=this.Ne(e);for(let t=n.from;t<n.to;t++){const n=i[t];let a=Math.round(Math.min(n.ge,n.Me)*r),o=Math.round(Math.max(n.ge,n.Me)*r),_=Math.round(n.st*e)-Math.floor(.5*this.ce),u=_+this.ce-1;if(n.pe!==h){const t=n.pe;s.fillStyle=t,h=t}this.Lt.ui&&(_+=l,a+=l,u-=l,o-=l),a>o||s.fillRect(_,a,u-_+1,o-a+1)}}}class $t extends Ft{constructor(){super(...arguments),this.qs=new Ht}le(t,i,n){return Object.assign(Object.assign({},this.Se(t,i,n)),n.Ys(t))}ne(){const t=this.Ws.W();this.qs.tt({In:this.Ns,ue:this.Hs.yt().ue(),Le:t.wickVisible,ui:t.borderVisible,it:this.js})}}class Ut{constructor(t,i){this.$e=t,this.Fi=i}Z(t,i,n){this.$e.draw(t,this.Fi,i,n)}}class qt extends zt{constructor(t,i,n){super(t,i,!1),this.gn=n,this.qs=new Ut(this.gn.renderer(),(i=>{const n=t.Pt();return null===n?null:t.Dt().Rt(i,n.Vt)}))}Ue(t){return this.gn.priceValueBuilder(t)}qe(t){return this.gn.isWhitespace(t)}Ks(){const t=this.Ws.Xs();this.Ns=this.Ws.In().he().map((i=>Object.assign(Object.assign({_t:i.ae,st:NaN},t.Ys(i.ae)),{Ge:i.Ye})))}ie(t,i){i.se(this.Ns,I(this.js))}ne(){this.gn.update({bars:this.Ns.map(Gt),barSpacing:this.Hs.yt().ue(),visibleRange:this.js},this.Ws.W())}}function Gt(t){return{x:t.st,time:t._t,originalData:t.Ge,barColor:t.pe}}class Yt extends j{constructor(){super(...arguments),this.Lt=null,this.Xe=[]}tt(t){this.Lt=t,this.Xe=[]}K({context:t,horizontalPixelRatio:i,verticalPixelRatio:n}){if(null===this.Lt||0===this.Lt.nt.length||null===this.Lt.it)return;this.Xe.length||this.Ze(i);const s=Math.max(1,Math.floor(n)),e=Math.round(this.Lt.Ke*n)-Math.floor(s/2),r=e+s;for(let i=this.Lt.it.from;i<this.Lt.it.to;i++){const h=this.Lt.nt[i],l=this.Xe[i-this.Lt.it.from],a=Math.round(h.et*n);let o,_;t.fillStyle=h.pe,a<=e?(o=a,_=r):(o=e,_=a-Math.floor(s/2)+s),t.fillRect(l.Is,o,l.ci-l.Is+1,_-o),h.He&&(t.strokeStyle=h.He,t.lineWidth=1,t.strokeRect(l.Is,o,l.ci-l.Is+1,_-o))}}Ze(t){if(null===this.Lt||0===this.Lt.nt.length||null===this.Lt.it)return void(this.Xe=[]);const i=Math.ceil(this.Lt.ue*t)<=1?0:Math.max(1,Math.floor(t)),n=(this.Lt.Je||0)*t||Math.round(this.Lt.ue*t)-i;this.Xe=new Array(this.Lt.it.to-this.Lt.it.from);for(let i=this.Lt.it.from;i<this.Lt.it.to;i++){const s=this.Lt.nt[i],e=Math.round(s.st*t);let r,h;if(n%2){const t=(n-1)/2;r=e-t,h=e+t}else{const t=n/2;r=e-t,h=e+t-1}this.Xe[i-this.Lt.it.from]={Is:r,ci:h,Qe:e,tr:s.st*t,_t:s._t}}for(let t=this.Lt.it.from+1;t<this.Lt.it.to;t++){const n=this.Xe[t-this.Lt.it.from],s=this.Xe[t-this.Lt.it.from-1];n._t===s._t+1&&(this.Lt.Je||n.Is-s.ci===i+1||(s.Qe>s.tr?s.ci=n.Is-i-1:n.Is=s.ci+i+1))}let s=Math.ceil(this.Lt.ue*t);for(let t=this.Lt.it.from;t<this.Lt.it.to;t++){const i=this.Xe[t-this.Lt.it.from];i.ci<i.Is&&(i.ci=i.Is);const n=i.ci-i.Is+1;s=Math.min(n,s)}if(i>0&&s<4)for(let t=this.Lt.it.from;t<this.Lt.it.to;t++){const i=this.Xe[t-this.Lt.it.from];i.ci-i.Is+1>s&&(i.Qe>i.tr?i.ci-=1:i.Is+=1)}}}class Xt extends At{constructor(){super(...arguments),this.qs=new Yt}le(t,i,n){return Object.assign(Object.assign({},this.re(t,i)),n.Ys(t))}ne(){const t={nt:this.Ns,ue:this.Hs.yt().ue(),it:this.js,Ke:this.Ws.Dt().Rt(this.Ws.W().base,p(this.Ws.Pt()).Vt),Je:this.Ws.W().fixedWidth};this.qs.tt(t)}}class Zt extends At{constructor(){super(...arguments),this.qs=new Pt}le(t,i,n){return Object.assign(Object.assign({},this.re(t,i)),n.Ys(t))}ne(){const t=this.Ws.W(),i={nt:this.Ns,Nt:t.lineStyle,Ds:t.shadowColor,Vs:t.shadowBlur,Bs:t.shadowOffsetX,zs:t.shadowOffsetY,fs:t.lineVisible?t.lineType:void 0,rt:t.lineWidth,Rs:t.pointMarkersVisible?t.pointMarkersRadius||t.lineWidth/2+2:void 0,it:this.js,ds:this.Hs.yt().ue()};this.qs.tt(i)}}const Kt=/[2-9]/g;class Jt{constructor(t=50){this.ir=0,this.nr=1,this.sr=1,this.er={},this.rr=new Map,this.hr=t}lr(){this.ir=0,this.rr.clear(),this.nr=1,this.sr=1,this.er={}}Si(t,i,n){return this.ar(t,i,n).width}xi(t,i,n){const s=this.ar(t,i,n);return((s.actualBoundingBoxAscent||0)-(s.actualBoundingBoxDescent||0))/2}ar(t,i,n){const s=n||Kt,e=String(i).replace(s,"0");if(this.rr.has(e))return v(this.rr.get(e))._r;if(this.ir===this.hr){const t=this.er[this.sr];delete this.er[this.sr],this.rr.delete(t),this.sr++,this.ir--}t.save(),t.textBaseline="middle";const r=t.measureText(e);return t.restore(),0===r.width&&i.length||(this.rr.set(e,{_r:r,ur:this.nr}),this.er[this.nr]=e,this.ir++,this.nr++),r}}class Qt{constructor(t){this.cr=null,this.k=null,this.dr="right",this.vr=t}pr(t,i,n){this.cr=t,this.k=i,this.dr=n}Z(t){null!==this.k&&null!==this.cr&&this.cr.Z(t,this.k,this.vr,this.dr)}}class ti{constructor(t,i,n){this.mr=t,this.vr=new Jt(50),this.br=i,this.j=n,this.H=-1,this.Wt=new Qt(this.vr)}Mt(){const t=this.j.wr(this.br);if(null===t)return null;const i=t.gr(this.br)?t.Mr():this.br.Dt();if(null===i)return null;const n=t.Sr(i);if("overlay"===n)return null;const s=this.j.yr();return s.O!==this.H&&(this.H=s.O,this.vr.lr()),this.Wt.pr(this.mr.Ii(),s,n),this.Wt}}class ii extends j{constructor(){super(...arguments),this.Lt=null}tt(t){this.Lt=t}Cr(t,i){var n;if(!(null===(n=this.Lt)||void 0===n?void 0:n.kt))return null;const{et:s,rt:e,kr:r}=this.Lt;return i>=s-e-7&&i<=s+e+7?{Pr:this.Lt,kr:r}:null}K({context:t,bitmapSize:i,horizontalPixelRatio:n,verticalPixelRatio:s}){if(null===this.Lt)return;if(!1===this.Lt.kt)return;const e=Math.round(this.Lt.et*s);e<0||e>i.height||(t.lineCap="butt",t.strokeStyle=this.Lt.V,t.lineWidth=Math.floor(this.Lt.rt*n),c(t,this.Lt.Nt),d(t,e,0,i.width))}}class ni{constructor(t){this.Tr={et:0,V:"rgba(0, 0, 0, 0)",rt:1,Nt:0,kt:!1},this.Or=new ii,this.vt=!0,this.Ws=t,this.Hs=t.Ut(),this.Or.tt(this.Tr)}wt(){this.vt=!0}Mt(){return this.Ws.kt()?(this.vt&&(this.Rr(),this.vt=!1),this.Or):null}}class si extends ni{constructor(t){super(t)}Rr(){this.Tr.kt=!1;const t=this.Ws.Dt(),i=t.Dr().Dr;if(2!==i&&3!==i)return;const n=this.Ws.W();if(!n.baseLineVisible||!this.Ws.kt())return;const s=this.Ws.Pt();null!==s&&(this.Tr.kt=!0,this.Tr.et=t.Rt(s.Vt,s.Vt),this.Tr.V=n.baseLineColor,this.Tr.rt=n.baseLineWidth,this.Tr.Nt=n.baseLineStyle)}}class ei extends j{constructor(){super(...arguments),this.Lt=null}tt(t){this.Lt=t}Ye(){return this.Lt}K({context:t,horizontalPixelRatio:i,verticalPixelRatio:n}){const s=this.Lt;if(null===s)return;const e=Math.max(1,Math.floor(i)),r=e%2/2,h=Math.round(s.tr.x*i)+r,l=s.tr.y*n;t.fillStyle=s.Vr,t.beginPath();const a=Math.max(2,1.5*s.Br)*i;t.arc(h,l,a,0,2*Math.PI,!1),t.fill(),t.fillStyle=s.zr,t.beginPath(),t.arc(h,l,s.lt*i,0,2*Math.PI,!1),t.fill(),t.lineWidth=e,t.strokeStyle=s.Ar,t.beginPath(),t.arc(h,l,s.lt*i+e/2,0,2*Math.PI,!1),t.stroke()}}const ri=[{Ir:0,Lr:.25,Fr:4,Er:10,Nr:.25,jr:0,Wr:.4,Hr:.8},{Ir:.25,Lr:.525,Fr:10,Er:14,Nr:0,jr:0,Wr:.8,Hr:0},{Ir:.525,Lr:1,Fr:14,Er:14,Nr:0,jr:0,Wr:0,Hr:0}];function hi(t,i,n,s){return k(t,n+(s-n)*i)}function li(t,i){const n=t%2600/2600;let s;for(const t of ri)if(n>=t.Ir&&n<=t.Lr){s=t;break}f(void 0!==s,"Last price animation internal logic error");const e=(n-s.Ir)/(s.Lr-s.Ir);return{zr:hi(i,e,s.Nr,s.jr),Ar:hi(i,e,s.Wr,s.Hr),lt:(r=e,h=s.Fr,l=s.Er,h+(l-h)*r)};var r,h,l}class ai{constructor(t){this.Wt=new ei,this.vt=!0,this.$r=!0,this.Ur=performance.now(),this.qr=this.Ur-1,this.Gr=t}Yr(){this.qr=this.Ur-1,this.wt()}Xr(){if(this.wt(),2===this.Gr.W().lastPriceAnimation){const t=performance.now(),i=this.qr-t;if(i>0)return void(i<650&&(this.qr+=2600));this.Ur=t,this.qr=t+2600}}wt(){this.vt=!0}Zr(){this.$r=!0}kt(){return 0!==this.Gr.W().lastPriceAnimation}Kr(){switch(this.Gr.W().lastPriceAnimation){case 0:return!1;case 1:return!0;case 2:return performance.now()<=this.qr}}Mt(){return this.vt?(this.xt(),this.vt=!1,this.$r=!1):this.$r&&(this.Jr(),this.$r=!1),this.Wt}xt(){this.Wt.tt(null);const t=this.Gr.Ut().yt(),i=t.Qs(),n=this.Gr.Pt();if(null===i||null===n)return;const s=this.Gr.Qr(!0);if(s.th||!i.ih(s.ae))return;const e={x:t.It(s.ae),y:this.Gr.Dt().Rt(s.ut,n.Vt)},r=s.V,h=this.Gr.W().lineWidth,l=li(this.nh(),r);this.Wt.tt({Vr:r,Br:h,zr:l.zr,Ar:l.Ar,lt:l.lt,tr:e})}Jr(){const t=this.Wt.Ye();if(null!==t){const i=li(this.nh(),t.Vr);t.zr=i.zr,t.Ar=i.Ar,t.lt=i.lt}}nh(){return this.Kr()?performance.now()-this.Ur:2599}}function oi(t,i){return xt(Math.min(Math.max(t,12),30)*i)}function _i(t,i){switch(t){case"arrowDown":case"arrowUp":return oi(i,1);case"circle":return oi(i,.8);case"square":return oi(i,.7)}}function ui(t){return function(t){const i=Math.ceil(t);return i%2!=0?i-1:i}(oi(t,1))}function ci(t){return Math.max(oi(t,.1),3)}function di(t,i,n){return i?t:n?Math.ceil(t/2):0}function fi(t,i,n,s,e){const r=_i("square",n),h=(r-1)/2,l=t-h,a=i-h;return s>=l&&s<=l+r&&e>=a&&e<=a+r}function vi(t,i,n,s){const e=(_i("arrowUp",s)-1)/2*n.sh,r=(xt(s/2)-1)/2*n.sh;i.beginPath(),t?(i.moveTo(n.st-e,n.et),i.lineTo(n.st,n.et-e),i.lineTo(n.st+e,n.et),i.lineTo(n.st+r,n.et),i.lineTo(n.st+r,n.et+e),i.lineTo(n.st-r,n.et+e),i.lineTo(n.st-r,n.et)):(i.moveTo(n.st-e,n.et),i.lineTo(n.st,n.et+e),i.lineTo(n.st+e,n.et),i.lineTo(n.st+r,n.et),i.lineTo(n.st+r,n.et-e),i.lineTo(n.st-r,n.et-e),i.lineTo(n.st-r,n.et)),i.fill()}function pi(t,i,n,s,e,r){return fi(i,n,s,e,r)}class mi extends j{constructor(){super(...arguments),this.Lt=null,this.vr=new Jt,this.H=-1,this.$="",this.eh=""}tt(t){this.Lt=t}pr(t,i){this.H===t&&this.$===i||(this.H=t,this.$=i,this.eh=F(t,i),this.vr.lr())}Cr(t,i){if(null===this.Lt||null===this.Lt.it)return null;for(let n=this.Lt.it.from;n<this.Lt.it.to;n++){const s=this.Lt.nt[n];if(wi(s,t,i))return{Pr:s.rh,kr:s.kr}}return null}K({context:t,horizontalPixelRatio:i,verticalPixelRatio:n},s,e){if(null!==this.Lt&&null!==this.Lt.it){t.textBaseline="middle",t.font=this.eh;for(let s=this.Lt.it.from;s<this.Lt.it.to;s++){const e=this.Lt.nt[s];if(void 0!==e.Kt){e.Kt.$i=this.vr.Si(t,e.Kt.hh),e.Kt.At=this.H,e.Kt.st=e.st-e.Kt.$i/2;const n=t.canvas.width/i;e.Kt.st>-e.Kt.$i&&e.Kt.st<n&&(e.Kt.st=Math.min(Math.max(0,e.Kt.st),n-e.Kt.$i))}bi(e,t,i,n)}}}}function bi(t,i,n,s){i.fillStyle=t.V,void 0!==t.Kt&&function(t,i,n,s,e,r){t.save(),t.scale(e,r),t.fillText(i,n,s),t.restore()}(i,t.Kt.hh,t.Kt.st,t.Kt.et,n,s),function(t,i,n){if(0===t.te)return;switch(t.ah){case"arrowDown":return void vi(!1,i,n,t.te);case"arrowUp":return void vi(!0,i,n,t.te);case"circle":return void function(t,i,n){const s=(_i("circle",n)-1)/2;t.beginPath(),t.arc(i.st,i.et,s*i.sh,0,2*Math.PI,!1),t.fill()}(i,n,t.te);case"square":return void function(t,i,n){const s=_i("square",n),e=(s-1)*i.sh/2,r=i.st-e,h=i.et-e;t.fillRect(r,h,s*i.sh,s*i.sh)}(i,n,t.te)}t.ah}(t,i,function(t,i,n){const s=Math.max(1,Math.floor(i))%2/2;return{st:Math.round(t.st*i)+s,et:t.et*n,sh:i}}(t,n,s))}function wi(t,i,n){return!(void 0===t.Kt||!function(t,i,n,s,e,r){const h=s/2;return e>=t&&e<=t+n&&r>=i-h&&r<=i+h}(t.Kt.st,t.Kt.et,t.Kt.$i,t.Kt.At,i,n))||function(t,i,n){if(0===t.te)return!1;switch(t.ah){case"arrowDown":case"arrowUp":return pi(0,t.st,t.et,t.te,i,n);case"circle":return function(t,i,n,s,e){const r=2+_i("circle",n)/2,h=t-s,l=i-e;return Math.sqrt(h*h+l*l)<=r}(t.st,t.et,t.te,i,n);case"square":return fi(t.st,t.et,t.te,i,n)}}(t,i,n)}function gi(t,i,n,s,e,r,h,l,a){const o=R(n)?n:n.Pe,_=R(n)?n:n.Ce,u=R(n)?n:n.ke,c=R(i.size)?Math.max(i.size,0):1,d=ui(l.ue())*c,f=d/2;switch(t.te=d,i.position){case"inBar":return t.et=h.Rt(o,a),void(void 0!==t.Kt&&(t.Kt.et=t.et+f+r+.6*e));case"aboveBar":return t.et=h.Rt(_,a)-f-s.oh,void 0!==t.Kt&&(t.Kt.et=t.et-f-.6*e,s.oh+=1.2*e),void(s.oh+=d+r);case"belowBar":return t.et=h.Rt(u,a)+f+s._h,void 0!==t.Kt&&(t.Kt.et=t.et+f+r+.6*e,s._h+=1.2*e),void(s._h+=d+r)}i.position}class Mi{constructor(t,i){this.vt=!0,this.uh=!0,this.dh=!0,this.fh=null,this.ph=null,this.Wt=new mi,this.Gr=t,this.Ui=i,this.Lt={nt:[],it:null}}wt(t){this.vt=!0,this.dh=!0,"data"===t&&(this.uh=!0,this.ph=null)}Mt(t){if(!this.Gr.kt())return null;this.vt&&this.mh();const i=this.Ui.W().layout;return this.Wt.pr(i.fontSize,i.fontFamily),this.Wt.tt(this.Lt),this.Wt}bh(){if(this.dh){if(this.Gr.wh().length>0){const t=this.Ui.yt().ue(),i=ci(t),n=1.5*ui(t)+2*i,s=this.gh();this.fh={above:di(n,s.aboveBar,s.inBar),below:di(n,s.belowBar,s.inBar)}}else this.fh=null;this.dh=!1}return this.fh}gh(){return null===this.ph&&(this.ph=this.Gr.wh().reduce(((t,i)=>(t[i.position]||(t[i.position]=!0),t)),{inBar:!1,aboveBar:!1,belowBar:!1})),this.ph}mh(){const t=this.Gr.Dt(),i=this.Ui.yt(),n=this.Gr.wh();this.uh&&(this.Lt.nt=n.map((t=>({_t:t.time,st:0,et:0,te:0,ah:t.shape,V:t.color,rh:t.rh,kr:t.id,Kt:void 0}))),this.uh=!1);const s=this.Ui.W().layout;this.Lt.it=null;const e=i.Qs();if(null===e)return;const r=this.Gr.Pt();if(null===r)return;if(0===this.Lt.nt.length)return;let h=NaN;const l=ci(i.ue()),a={oh:l,_h:l};this.Lt.it=Bt(this.Lt.nt,e,!0);for(let e=this.Lt.it.from;e<this.Lt.it.to;e++){const o=n[e];o.time!==h&&(a.oh=l,a._h=l,h=o.time);const _=this.Lt.nt[e];_.st=i.It(o.time),void 0!==o.text&&o.text.length>0&&(_.Kt={hh:o.text,st:0,et:0,$i:0,At:0});const u=this.Gr.Mh(o.time);null!==u&&gi(_,o,u,a,s.fontSize,l,t,i,r.Vt)}this.vt=!1}}class xi extends ni{constructor(t){super(t)}Rr(){const t=this.Tr;t.kt=!1;const i=this.Ws.W();if(!i.priceLineVisible||!this.Ws.kt())return;const n=this.Ws.Qr(0===i.priceLineSource);n.th||(t.kt=!0,t.et=n.Ci,t.V=this.Ws.xh(n.V),t.rt=i.priceLineWidth,t.Nt=i.priceLineStyle)}}class Si extends it{constructor(t){super(),this.Ht=t}Li(t,i,n){t.kt=!1,i.kt=!1;const s=this.Ht;if(!s.kt())return;const e=s.W(),r=e.lastValueVisible,h=""!==s.Sh(),l=0===e.seriesLastValueMode,a=s.Qr(!1);if(a.th)return;r&&(t.Kt=this.yh(a,r,l),t.kt=0!==t.Kt.length),(h||l)&&(i.Kt=this.Ch(a,r,h,l),i.kt=i.Kt.length>0);const o=s.xh(a.V),_=P(o);n.t=_.t,n.Ci=a.Ci,i.Bt=s.Ut().zt(a.Ci/s.Dt().At()),t.Bt=o,t.V=_.i,i.V=_.i}Ch(t,i,n,s){let e="";const r=this.Ht.Sh();return n&&0!==r.length&&(e+=`${r} `),i&&s&&(e+=this.Ht.Dt().kh()?t.Ph:t.Th),e.trim()}yh(t,i,n){return i?n?this.Ht.Dt().kh()?t.Th:t.Ph:t.Kt:""}}function yi(t,i,n,s){const e=Number.isFinite(i),r=Number.isFinite(n);return e&&r?t(i,n):e||r?e?i:n:s}class Ci{constructor(t,i){this.Oh=t,this.Rh=i}Dh(t){return null!==t&&(this.Oh===t.Oh&&this.Rh===t.Rh)}Vh(){return new Ci(this.Oh,this.Rh)}Bh(){return this.Oh}zh(){return this.Rh}Ah(){return this.Rh-this.Oh}Ni(){return this.Rh===this.Oh||Number.isNaN(this.Rh)||Number.isNaN(this.Oh)}ns(t){return null===t?this:new Ci(yi(Math.min,this.Bh(),t.Bh(),-1/0),yi(Math.max,this.zh(),t.zh(),1/0))}Ih(t){if(!R(t))return;if(0===this.Rh-this.Oh)return;const i=.5*(this.Rh+this.Oh);let n=this.Rh-i,s=this.Oh-i;n*=t,s*=t,this.Rh=i+n,this.Oh=i+s}Lh(t){R(t)&&(this.Rh+=t,this.Oh+=t)}Fh(){return{minValue:this.Oh,maxValue:this.Rh}}static Eh(t){return null===t?null:new Ci(t.minValue,t.maxValue)}}class ki{constructor(t,i){this.Nh=t,this.jh=i||null}Wh(){return this.Nh}Hh(){return this.jh}Fh(){return null===this.Nh?null:{priceRange:this.Nh.Fh(),margins:this.jh||void 0}}static Eh(t){return null===t?null:new ki(Ci.Eh(t.priceRange),t.margins)}}class Pi extends ni{constructor(t,i){super(t),this.$h=i}Rr(){const t=this.Tr;t.kt=!1;const i=this.$h.W();if(!this.Ws.kt()||!i.lineVisible)return;const n=this.$h.Uh();null!==n&&(t.kt=!0,t.et=n,t.V=i.color,t.rt=i.lineWidth,t.Nt=i.lineStyle,t.kr=this.$h.W().id)}}class Ti extends it{constructor(t,i){super(),this.Gr=t,this.$h=i}Li(t,i,n){t.kt=!1,i.kt=!1;const s=this.$h.W(),e=s.axisLabelVisible,r=""!==s.title,h=this.Gr;if(!e||!h.kt())return;const l=this.$h.Uh();if(null===l)return;r&&(i.Kt=s.title,i.kt=!0),i.Bt=h.Ut().zt(l/h.Dt().At()),t.Kt=this.qh(s.price),t.kt=!0;const a=P(s.axisLabelColor||s.color);n.t=a.t;const o=s.axisLabelTextColor||a.i;t.V=o,i.V=o,n.Ci=l}qh(t){const i=this.Gr.Pt();return null===i?"":this.Gr.Dt().ji(t,i.Vt)}}class Oi{constructor(t,i){this.Gr=t,this.dn=i,this.Gh=new Pi(t,this),this.mr=new Ti(t,this),this.Yh=new ti(this.mr,t,t.Ut())}Xh(t){O(this.dn,t),this.wt(),this.Gr.Ut().Zh()}W(){return this.dn}Kh(){return this.Gh}Jh(){return this.Yh}Qh(){return this.mr}wt(){this.Gh.wt(),this.mr.wt()}Uh(){const t=this.Gr,i=t.Dt();if(t.Ut().yt().Ni()||i.Ni())return null;const n=t.Pt();return null===n?null:i.Rt(this.dn.price,n.Vt)}}class Ri extends ht{constructor(t){super(),this.Ui=t}Ut(){return this.Ui}}const Di={Bar:(t,i,n,s)=>{var e;const r=i.upColor,h=i.downColor,l=p(t(n,s)),a=m(l.Vt[0])<=m(l.Vt[3]);return{pe:null!==(e=l.V)&&void 0!==e?e:a?r:h}},Candlestick:(t,i,n,s)=>{var e,r,h;const l=i.upColor,a=i.downColor,o=i.borderUpColor,_=i.borderDownColor,u=i.wickUpColor,c=i.wickDownColor,d=p(t(n,s)),f=m(d.Vt[0])<=m(d.Vt[3]);return{pe:null!==(e=d.V)&&void 0!==e?e:f?l:a,He:null!==(r=d.Bt)&&void 0!==r?r:f?o:_,We:null!==(h=d.tl)&&void 0!==h?h:f?u:c}},Custom:(t,i,n,s)=>{var e;return{pe:null!==(e=p(t(n,s)).V)&&void 0!==e?e:i.color}},Area:(t,i,n,s)=>{var e,r,h,l;const a=p(t(n,s));return{pe:null!==(e=a.ot)&&void 0!==e?e:i.lineColor,ot:null!==(r=a.ot)&&void 0!==r?r:i.lineColor,Ts:null!==(h=a.Ts)&&void 0!==h?h:i.topColor,Os:null!==(l=a.Os)&&void 0!==l?l:i.bottomColor}},Baseline:(t,i,n,s)=>{var e,r,h,l,a,o;const _=p(t(n,s));return{pe:_.Vt[3]>=i.baseValue.price?i.topLineColor:i.bottomLineColor,Be:null!==(e=_.Be)&&void 0!==e?e:i.topLineColor,ze:null!==(r=_.ze)&&void 0!==r?r:i.bottomLineColor,Te:null!==(h=_.Te)&&void 0!==h?h:i.topFillColor1,Oe:null!==(l=_.Oe)&&void 0!==l?l:i.topFillColor2,Re:null!==(a=_.Re)&&void 0!==a?a:i.bottomFillColor1,De:null!==(o=_.De)&&void 0!==o?o:i.bottomFillColor2}},Line:(t,i,n,s)=>{var e,r;const h=p(t(n,s));return{pe:null!==(e=h.V)&&void 0!==e?e:i.color,ot:null!==(r=h.V)&&void 0!==r?r:i.color}},Histogram:(t,i,n,s)=>{var e,r;const h=p(t(n,s));return{pe:null!==(e=h.V)&&void 0!==e?e:i.color,He:null!==(r=h.Bt)&&void 0!==r?r:i.borderColor}}};class Vi{constructor(t){this.il=(t,i)=>void 0!==i?i.Vt:this.Gr.In().nl(t),this.Gr=t,this.sl=Di[t.el()]}Ys(t,i){return this.sl(this.il,this.Gr.W(),t,i)}}var Bi;!function(t){t[t.NearestLeft=-1]="NearestLeft",t[t.None=0]="None",t[t.NearestRight=1]="NearestRight"}(Bi||(Bi={}));const zi=30;class Ai{constructor(){this.rl=[],this.hl=new Map,this.ll=new Map}al(){return this.te()>0?this.rl[this.rl.length-1]:null}ol(){return this.te()>0?this._l(0):null}An(){return this.te()>0?this._l(this.rl.length-1):null}te(){return this.rl.length}Ni(){return 0===this.te()}ih(t){return null!==this.ul(t,0)}nl(t){return this.cl(t)}cl(t,i=0){const n=this.ul(t,i);return null===n?null:Object.assign(Object.assign({},this.dl(n)),{ae:this._l(n)})}he(){return this.rl}fl(t,i,n){if(this.Ni())return null;let s=null;for(const e of n){s=Ii(s,this.vl(t,i,e))}return s}tt(t){this.ll.clear(),this.hl.clear(),this.rl=t}_l(t){return this.rl[t].ae}dl(t){return this.rl[t]}ul(t,i){const n=this.pl(t);if(null===n&&0!==i)switch(i){case-1:return this.ml(t);case 1:return this.bl(t);default:throw new TypeError("Unknown search mode")}return n}ml(t){let i=this.wl(t);return i>0&&(i-=1),i!==this.rl.length&&this._l(i)<t?i:null}bl(t){const i=this.gl(t);return i!==this.rl.length&&t<this._l(i)?i:null}pl(t){const i=this.wl(t);return i===this.rl.length||t<this.rl[i].ae?null:i}wl(t){return Ot(this.rl,t,((t,i)=>t.ae<i))}gl(t){return Rt(this.rl,t,((t,i)=>t.ae>i))}Ml(t,i,n){let s=null;for(let e=t;e<i;e++){const t=this.rl[e].Vt[n];Number.isNaN(t)||(null===s?s={xl:t,Sl:t}:(t<s.xl&&(s.xl=t),t>s.Sl&&(s.Sl=t)))}return s}vl(t,i,n){if(this.Ni())return null;let s=null;const e=p(this.ol()),r=p(this.An()),h=Math.max(t,e),l=Math.min(i,r),a=Math.ceil(h/zi)*zi,o=Math.max(a,Math.floor(l/zi)*zi);{const t=this.wl(h),e=this.gl(Math.min(l,a,i));s=Ii(s,this.Ml(t,e,n))}let _=this.hl.get(n);void 0===_&&(_=new Map,this.hl.set(n,_));for(let t=Math.max(a+1,h);t<o;t+=zi){const i=Math.floor(t/zi);let e=_.get(i);if(void 0===e){const t=this.wl(i*zi),s=this.gl((i+1)*zi-1);e=this.Ml(t,s,n),_.set(i,e)}s=Ii(s,e)}{const t=this.wl(o),i=this.gl(l);s=Ii(s,this.Ml(t,i,n))}return s}}function Ii(t,i){if(null===t)return i;if(null===i)return t;return{xl:Math.min(t.xl,i.xl),Sl:Math.max(t.Sl,i.Sl)}}class Li{constructor(t){this.yl=t}Z(t,i,n){this.yl.draw(t)}Cl(t,i,n){var s,e;null===(e=(s=this.yl).drawBackground)||void 0===e||e.call(s,t)}}class Fi{constructor(t){this.rr=null,this.gn=t}Mt(){var t;const i=this.gn.renderer();if(null===i)return null;if((null===(t=this.rr)||void 0===t?void 0:t.kl)===i)return this.rr.Pl;const n=new Li(i);return this.rr={kl:i,Pl:n},n}Tl(){var t,i,n;return null!==(n=null===(i=(t=this.gn).zOrder)||void 0===i?void 0:i.call(t))&&void 0!==n?n:"normal"}}function Ei(t){var i,n,s,e,r;return{Kt:t.text(),Ci:t.coordinate(),yi:null===(i=t.fixedCoordinate)||void 0===i?void 0:i.call(t),V:t.textColor(),t:t.backColor(),kt:null===(s=null===(n=t.visible)||void 0===n?void 0:n.call(t))||void 0===s||s,li:null===(r=null===(e=t.tickVisible)||void 0===e?void 0:e.call(t))||void 0===r||r}}class Ni{constructor(t,i){this.Wt=new et,this.Ol=t,this.Rl=i}Mt(){return this.Wt.tt(Object.assign({$i:this.Rl.$i()},Ei(this.Ol))),this.Wt}}class ji extends it{constructor(t,i){super(),this.Ol=t,this.Fi=i}Li(t,i,n){const s=Ei(this.Ol);n.t=s.t,t.V=s.V;const e=2/12*this.Fi.O();n.gi=e,n.Mi=e,n.Ci=s.Ci,n.yi=s.yi,t.Kt=s.Kt,t.kt=s.kt,t.li=s.li}}class Wi{constructor(t,i){this.Dl=null,this.Vl=null,this.Bl=null,this.zl=null,this.Al=null,this.Il=t,this.Gr=i}Ll(){return this.Il}Vn(){var t,i;null===(i=(t=this.Il).updateAllViews)||void 0===i||i.call(t)}On(){var t,i,n,s;const e=null!==(n=null===(i=(t=this.Il).paneViews)||void 0===i?void 0:i.call(t))&&void 0!==n?n:[];if((null===(s=this.Dl)||void 0===s?void 0:s.kl)===e)return this.Dl.Pl;const r=e.map((t=>new Fi(t)));return this.Dl={kl:e,Pl:r},r}tn(){var t,i,n,s;const e=null!==(n=null===(i=(t=this.Il).timeAxisViews)||void 0===i?void 0:i.call(t))&&void 0!==n?n:[];if((null===(s=this.Vl)||void 0===s?void 0:s.kl)===e)return this.Vl.Pl;const r=this.Gr.Ut().yt(),h=e.map((t=>new Ni(t,r)));return this.Vl={kl:e,Pl:h},h}Rn(){var t,i,n,s;const e=null!==(n=null===(i=(t=this.Il).priceAxisViews)||void 0===i?void 0:i.call(t))&&void 0!==n?n:[];if((null===(s=this.Bl)||void 0===s?void 0:s.kl)===e)return this.Bl.Pl;const r=this.Gr.Dt(),h=e.map((t=>new ji(t,r)));return this.Bl={kl:e,Pl:h},h}Fl(){var t,i,n,s;const e=null!==(n=null===(i=(t=this.Il).priceAxisPaneViews)||void 0===i?void 0:i.call(t))&&void 0!==n?n:[];if((null===(s=this.zl)||void 0===s?void 0:s.kl)===e)return this.zl.Pl;const r=e.map((t=>new Fi(t)));return this.zl={kl:e,Pl:r},r}El(){var t,i,n,s;const e=null!==(n=null===(i=(t=this.Il).timeAxisPaneViews)||void 0===i?void 0:i.call(t))&&void 0!==n?n:[];if((null===(s=this.Al)||void 0===s?void 0:s.kl)===e)return this.Al.Pl;const r=e.map((t=>new Fi(t)));return this.Al={kl:e,Pl:r},r}Nl(t,i){var n,s,e;return null!==(e=null===(s=(n=this.Il).autoscaleInfo)||void 0===s?void 0:s.call(n,t,i))&&void 0!==e?e:null}Cr(t,i){var n,s,e;return null!==(e=null===(s=(n=this.Il).hitTest)||void 0===s?void 0:s.call(n,t,i))&&void 0!==e?e:null}}function Hi(t,i,n,s){t.forEach((t=>{i(t).forEach((t=>{t.Tl()===n&&s.push(t)}))}))}function $i(t){return t.On()}function Ui(t){return t.Fl()}function qi(t){return t.El()}class Gi extends Ri{constructor(t,i,n,s,e){super(t),this.Lt=new Ai,this.Gh=new xi(this),this.jl=[],this.Wl=new si(this),this.Hl=null,this.$l=null,this.Ul=[],this.ql=[],this.Gl=null,this.Yl=[],this.dn=i,this.Xl=n;const r=new Si(this);this.hn=[r],this.Yh=new ti(r,this,t),"Area"!==n&&"Line"!==n&&"Baseline"!==n||(this.Hl=new ai(this)),this.Zl(),this.Kl(e)}C(){null!==this.Gl&&clearTimeout(this.Gl)}xh(t){return this.dn.priceLineColor||t}Qr(t){const i={th:!0},n=this.Dt();if(this.Ut().yt().Ni()||n.Ni()||this.Lt.Ni())return i;const s=this.Ut().yt().Qs(),e=this.Pt();if(null===s||null===e)return i;let r,h;if(t){const t=this.Lt.al();if(null===t)return i;r=t,h=t.ae}else{const t=this.Lt.cl(s.ci(),-1);if(null===t)return i;if(r=this.Lt.nl(t.ae),null===r)return i;h=t.ae}const l=r.Vt[3],a=this.Xs().Ys(h,{Vt:r}),o=n.Rt(l,e.Vt);return{th:!1,ut:l,Kt:n.ji(l,e.Vt),Ph:n.Jl(l),Th:n.Ql(l,e.Vt),V:a.pe,Ci:o,ae:h}}Xs(){return null!==this.$l||(this.$l=new Vi(this)),this.$l}W(){return this.dn}Xh(t){const i=t.priceScaleId;void 0!==i&&i!==this.dn.priceScaleId&&this.Ut().ta(this,i),O(this.dn,t),void 0!==t.priceFormat&&(this.Zl(),this.Ut().ia()),this.Ut().na(this),this.Ut().sa(),this.gn.wt("options")}tt(t,i){this.Lt.tt(t),this.ea(),this.gn.wt("data"),this.fn.wt("data"),null!==this.Hl&&(i&&i.ra?this.Hl.Xr():0===t.length&&this.Hl.Yr());const n=this.Ut().wr(this);this.Ut().ha(n),this.Ut().na(this),this.Ut().sa(),this.Ut().Zh()}la(t){this.Ul=t,this.ea();const i=this.Ut().wr(this);this.fn.wt("data"),this.Ut().ha(i),this.Ut().na(this),this.Ut().sa(),this.Ut().Zh()}aa(){return this.Ul}wh(){return this.ql}oa(t){const i=new Oi(this,t);return this.jl.push(i),this.Ut().na(this),i}_a(t){const i=this.jl.indexOf(t);-1!==i&&this.jl.splice(i,1),this.Ut().na(this)}el(){return this.Xl}Pt(){const t=this.ua();return null===t?null:{Vt:t.Vt[3],ca:t._t}}ua(){const t=this.Ut().yt().Qs();if(null===t)return null;const i=t.Is();return this.Lt.cl(i,1)}In(){return this.Lt}Mh(t){const i=this.Lt.nl(t);return null===i?null:"Bar"===this.Xl||"Candlestick"===this.Xl||"Custom"===this.Xl?{ye:i.Vt[0],Ce:i.Vt[1],ke:i.Vt[2],Pe:i.Vt[3]}:i.Vt[3]}da(t){const i=[];Hi(this.Yl,$i,"top",i);const n=this.Hl;return null!==n&&n.kt()?(null===this.Gl&&n.Kr()&&(this.Gl=setTimeout((()=>{this.Gl=null,this.Ut().fa()}),0)),n.Zr(),i.push(n),i):i}On(){const t=[];this.va()||t.push(this.Wl),t.push(this.gn,this.Gh,this.fn);const i=this.jl.map((t=>t.Kh()));return t.push(...i),Hi(this.Yl,$i,"normal",t),t}pa(){return this.ma($i,"bottom")}ba(t){return this.ma(Ui,t)}wa(t){return this.ma(qi,t)}ga(t,i){return this.Yl.map((n=>n.Cr(t,i))).filter((t=>null!==t))}Qi(t){return[this.Yh,...this.jl.map((t=>t.Jh()))]}Rn(t,i){if(i!==this.Yi&&!this.va())return[];const n=[...this.hn];for(const t of this.jl)n.push(t.Qh());return this.Yl.forEach((t=>{n.push(...t.Rn())})),n}tn(){const t=[];return this.Yl.forEach((i=>{t.push(...i.tn())})),t}Nl(t,i){if(void 0!==this.dn.autoscaleInfoProvider){const n=this.dn.autoscaleInfoProvider((()=>{const n=this.Ma(t,i);return null===n?null:n.Fh()}));return ki.Eh(n)}return this.Ma(t,i)}xa(){return this.dn.priceFormat.minMove}Sa(){return this.ya}Vn(){var t;this.gn.wt(),this.fn.wt();for(const t of this.hn)t.wt();for(const t of this.jl)t.wt();this.Gh.wt(),this.Wl.wt(),null===(t=this.Hl)||void 0===t||t.wt(),this.Yl.forEach((t=>t.Vn()))}Dt(){return p(super.Dt())}Ct(t){if(!(("Line"===this.Xl||"Area"===this.Xl||"Baseline"===this.Xl)&&this.dn.crosshairMarkerVisible))return null;const i=this.Lt.nl(t);if(null===i)return null;return{ut:i.Vt[3],lt:this.Ca(),Bt:this.ka(),Ot:this.Pa(),Tt:this.Ta(t)}}Sh(){return this.dn.title}kt(){return this.dn.visible}Oa(t){this.Yl.push(new Wi(t,this))}Ra(t){this.Yl=this.Yl.filter((i=>i.Ll()!==t))}Da(){if(this.gn instanceof qt!=!1)return t=>this.gn.Ue(t)}Va(){if(this.gn instanceof qt!=!1)return t=>this.gn.qe(t)}va(){return!ot(this.Dt().Ba())}Ma(t,i){if(!D(t)||!D(i)||this.Lt.Ni())return null;const n="Line"===this.Xl||"Area"===this.Xl||"Baseline"===this.Xl||"Histogram"===this.Xl?[3]:[2,1],s=this.Lt.fl(t,i,n);let e=null!==s?new Ci(s.xl,s.Sl):null;if("Histogram"===this.el()){const t=this.dn.base,i=new Ci(t,t);e=null!==e?e.ns(i):i}let r=this.fn.bh();return this.Yl.forEach((n=>{const s=n.Nl(t,i);if(null==s?void 0:s.priceRange){const t=new Ci(s.priceRange.minValue,s.priceRange.maxValue);e=null!==e?e.ns(t):t}var h,l,a,o;(null==s?void 0:s.margins)&&(h=r,l=s.margins,r={above:Math.max(null!==(a=null==h?void 0:h.above)&&void 0!==a?a:0,l.above),below:Math.max(null!==(o=null==h?void 0:h.below)&&void 0!==o?o:0,l.below)})})),new ki(e,r)}Ca(){switch(this.Xl){case"Line":case"Area":case"Baseline":return this.dn.crosshairMarkerRadius}return 0}ka(){switch(this.Xl){case"Line":case"Area":case"Baseline":{const t=this.dn.crosshairMarkerBorderColor;if(0!==t.length)return t}}return null}Pa(){switch(this.Xl){case"Line":case"Area":case"Baseline":return this.dn.crosshairMarkerBorderWidth}return 0}Ta(t){switch(this.Xl){case"Line":case"Area":case"Baseline":{const t=this.dn.crosshairMarkerBackgroundColor;if(0!==t.length)return t}}return this.Xs().Ys(t).pe}Zl(){switch(this.dn.priceFormat.type){case"custom":this.ya={format:this.dn.priceFormat.formatter};break;case"volume":this.ya=new vt(this.dn.priceFormat.precision);break;case"percent":this.ya=new ft(this.dn.priceFormat.precision);break;default:{const t=Math.pow(10,this.dn.priceFormat.precision);this.ya=new dt(t,this.dn.priceFormat.minMove*t)}}null!==this.Yi&&this.Yi.za()}ea(){const t=this.Ut().yt();if(!t.Aa()||this.Lt.Ni())return void(this.ql=[]);const i=p(this.Lt.ol());this.ql=this.Ul.map(((n,s)=>{const e=p(t.Ia(n.time,!0)),r=e<i?1:-1;return{time:p(this.Lt.cl(e,r)).ae,position:n.position,shape:n.shape,color:n.color,id:n.id,rh:s,text:n.text,size:n.size,originalTime:n.originalTime}}))}Kl(t){switch(this.fn=new Mi(this,this.Ut()),this.Xl){case"Bar":this.gn=new Et(this,this.Ut());break;case"Candlestick":this.gn=new $t(this,this.Ut());break;case"Line":this.gn=new Zt(this,this.Ut());break;case"Custom":this.gn=new qt(this,this.Ut(),v(t));break;case"Area":this.gn=new It(this,this.Ut());break;case"Baseline":this.gn=new Wt(this,this.Ut());break;case"Histogram":this.gn=new Xt(this,this.Ut());break;default:throw Error("Unknown chart style assigned: "+this.Xl)}}ma(t,i){const n=[];return Hi(this.Yl,t,i,n),n}}class Yi{constructor(t){this.dn=t}La(t,i,n){let s=t;if(0===this.dn.mode)return s;const e=n.pn(),r=e.Pt();if(null===r)return s;const h=e.Rt(t,r),l=n.Fa().filter((t=>t instanceof Gi)).reduce(((t,s)=>{if(n.gr(s)||!s.kt())return t;const e=s.Dt(),r=s.In();if(e.Ni()||!r.ih(i))return t;const h=r.nl(i);if(null===h)return t;const l=m(s.Pt());return t.concat([e.Rt(h.Vt[3],l.Vt)])}),[]);if(0===l.length)return s;l.sort(((t,i)=>Math.abs(t-h)-Math.abs(i-h)));const a=l[0];return s=e.mn(a,r),s}}class Xi extends j{constructor(){super(...arguments),this.Lt=null}tt(t){this.Lt=t}K({context:t,bitmapSize:i,horizontalPixelRatio:n,verticalPixelRatio:s}){if(null===this.Lt)return;const e=Math.max(1,Math.floor(n));t.lineWidth=e,function(t,i){t.save(),t.lineWidth%2&&t.translate(.5,.5),i(),t.restore()}(t,(()=>{const r=p(this.Lt);if(r.Ea){t.strokeStyle=r.Na,c(t,r.ja),t.beginPath();for(const s of r.Wa){const r=Math.round(s.Ha*n);t.moveTo(r,-e),t.lineTo(r,i.height+e)}t.stroke()}if(r.$a){t.strokeStyle=r.Ua,c(t,r.qa),t.beginPath();for(const n of r.Ga){const r=Math.round(n.Ha*s);t.moveTo(-e,r),t.lineTo(i.width+e,r)}t.stroke()}}))}}class Zi{constructor(t){this.Wt=new Xi,this.vt=!0,this.nn=t}wt(){this.vt=!0}Mt(){if(this.vt){const t=this.nn.Ut().W().grid,i={$a:t.horzLines.visible,Ea:t.vertLines.visible,Ua:t.horzLines.color,Na:t.vertLines.color,qa:t.horzLines.style,ja:t.vertLines.style,Ga:this.nn.pn().Ya(),Wa:(this.nn.Ut().yt().Ya()||[]).map((t=>({Ha:t.coord})))};this.Wt.tt(i),this.vt=!1}return this.Wt}}class Ki{constructor(t){this.gn=new Zi(t)}Kh(){return this.gn}}const Ji={Xa:4,Za:1e-4};function Qi(t,i){const n=100*(t-i)/i;return i<0?-n:n}function tn(t,i){const n=Qi(t.Bh(),i),s=Qi(t.zh(),i);return new Ci(n,s)}function nn(t,i){const n=100*(t-i)/i+100;return i<0?-n:n}function sn(t,i){const n=nn(t.Bh(),i),s=nn(t.zh(),i);return new Ci(n,s)}function en(t,i){const n=Math.abs(t);if(n<1e-15)return 0;const s=Math.log10(n+i.Za)+i.Xa;return t<0?-s:s}function rn(t,i){const n=Math.abs(t);if(n<1e-15)return 0;const s=Math.pow(10,n-i.Xa)-i.Za;return t<0?-s:s}function hn(t,i){if(null===t)return null;const n=en(t.Bh(),i),s=en(t.zh(),i);return new Ci(n,s)}function ln(t,i){if(null===t)return null;const n=rn(t.Bh(),i),s=rn(t.zh(),i);return new Ci(n,s)}function an(t){if(null===t)return Ji;const i=Math.abs(t.zh()-t.Bh());if(i>=1||i<1e-15)return Ji;const n=Math.ceil(Math.abs(Math.log10(i))),s=Ji.Xa+n;return{Xa:s,Za:1/Math.pow(10,s)}}class on{constructor(t,i){if(this.Ka=t,this.Ja=i,function(t){if(t<0)return!1;for(let i=t;i>1;i/=10)if(i%10!=0)return!1;return!0}(this.Ka))this.Qa=[2,2.5,2];else{this.Qa=[];for(let t=this.Ka;1!==t;){if(t%2==0)this.Qa.push(2),t/=2;else{if(t%5!=0)throw new Error("unexpected base");this.Qa.push(2,2.5),t/=5}if(this.Qa.length>100)throw new Error("something wrong with base")}}}io(t,i,n){const s=0===this.Ka?0:1/this.Ka;let e=Math.pow(10,Math.max(0,Math.ceil(Math.log10(t-i)))),r=0,h=this.Ja[0];for(;;){const t=Mt(e,s,1e-14)&&e>s+1e-14,i=Mt(e,n*h,1e-14),l=Mt(e,1,1e-14);if(!(t&&i&&l))break;e/=h,h=this.Ja[++r%this.Ja.length]}if(e<=s+1e-14&&(e=s),e=Math.max(1,e),this.Qa.length>0&&(l=e,a=1,o=1e-14,Math.abs(l-a)<o))for(r=0,h=this.Qa[0];Mt(e,n*h,1e-14)&&e>s+1e-14;)e/=h,h=this.Qa[++r%this.Qa.length];var l,a,o;return e}}class _n{constructor(t,i,n,s){this.no=[],this.Fi=t,this.Ka=i,this.so=n,this.eo=s}io(t,i){if(t<i)throw new Error("high < low");const n=this.Fi.At(),s=(t-i)*this.ro()/n,e=new on(this.Ka,[2,2.5,2]),r=new on(this.Ka,[2,2,2.5]),h=new on(this.Ka,[2.5,2,2]),l=[];return l.push(e.io(t,i,s),r.io(t,i,s),h.io(t,i,s)),function(t){if(t.length<1)throw Error("array is empty");let i=t[0];for(let n=1;n<t.length;++n)t[n]<i&&(i=t[n]);return i}(l)}ho(){const t=this.Fi,i=t.Pt();if(null===i)return void(this.no=[]);const n=t.At(),s=this.so(n-1,i),e=this.so(0,i),r=this.Fi.W().entireTextOnly?this.lo()/2:0,h=r,l=n-1-r,a=Math.max(s,e),o=Math.min(s,e);if(a===o)return void(this.no=[]);let _=this.io(a,o),u=a%_;u+=u<0?_:0;const c=a>=o?1:-1;let d=null,f=0;for(let n=a-u;n>o;n-=_){const s=this.eo(n,i,!0);null!==d&&Math.abs(s-d)<this.ro()||(s<h||s>l||(f<this.no.length?(this.no[f].Ha=s,this.no[f].ao=t.oo(n)):this.no.push({Ha:s,ao:t.oo(n)}),f++,d=s,t._o()&&(_=this.io(n*c,o))))}this.no.length=f}Ya(){return this.no}lo(){return this.Fi.O()}ro(){return Math.ceil(2.5*this.lo())}}function un(t){return t.slice().sort(((t,i)=>p(t.Zi())-p(i.Zi())))}var cn;!function(t){t[t.Normal=0]="Normal",t[t.Logarithmic=1]="Logarithmic",t[t.Percentage=2]="Percentage",t[t.IndexedTo100=3]="IndexedTo100"}(cn||(cn={}));const dn=new ft,fn=new dt(100,1);class vn{constructor(t,i,n,s){this.uo=0,this.co=null,this.Nh=null,this.do=null,this.fo={vo:!1,po:null},this.mo=0,this.bo=0,this.wo=new T,this.Mo=new T,this.xo=[],this.So=null,this.yo=null,this.Co=null,this.ko=null,this.ya=fn,this.Po=an(null),this.To=t,this.dn=i,this.Oo=n,this.Ro=s,this.Do=new _n(this,100,this.Vo.bind(this),this.Bo.bind(this))}Ba(){return this.To}W(){return this.dn}Xh(t){if(O(this.dn,t),this.za(),void 0!==t.mode&&this.zo({Dr:t.mode}),void 0!==t.scaleMargins){const i=v(t.scaleMargins.top),n=v(t.scaleMargins.bottom);if(i<0||i>1)throw new Error(`Invalid top margin - expect value between 0 and 1, given=${i}`);if(n<0||n>1)throw new Error(`Invalid bottom margin - expect value between 0 and 1, given=${n}`);if(i+n>1)throw new Error(`Invalid margins - sum of margins must be less than 1, given=${i+n}`);this.Ao(),this.yo=null}}Io(){return this.dn.autoScale}_o(){return 1===this.dn.mode}kh(){return 2===this.dn.mode}Lo(){return 3===this.dn.mode}Dr(){return{Wn:this.dn.autoScale,Fo:this.dn.invertScale,Dr:this.dn.mode}}zo(t){const i=this.Dr();let n=null;void 0!==t.Wn&&(this.dn.autoScale=t.Wn),void 0!==t.Dr&&(this.dn.mode=t.Dr,2!==t.Dr&&3!==t.Dr||(this.dn.autoScale=!0),this.fo.vo=!1),1===i.Dr&&t.Dr!==i.Dr&&(!function(t,i){if(null===t)return!1;const n=rn(t.Bh(),i),s=rn(t.zh(),i);return isFinite(n)&&isFinite(s)}(this.Nh,this.Po)?this.dn.autoScale=!0:(n=ln(this.Nh,this.Po),null!==n&&this.Eo(n))),1===t.Dr&&t.Dr!==i.Dr&&(n=hn(this.Nh,this.Po),null!==n&&this.Eo(n));const s=i.Dr!==this.dn.mode;s&&(2===i.Dr||this.kh())&&this.za(),s&&(3===i.Dr||this.Lo())&&this.za(),void 0!==t.Fo&&i.Fo!==t.Fo&&(this.dn.invertScale=t.Fo,this.No()),this.Mo.M(i,this.Dr())}jo(){return this.Mo}O(){return this.Oo.fontSize}At(){return this.uo}Wo(t){this.uo!==t&&(this.uo=t,this.Ao(),this.yo=null)}Ho(){if(this.co)return this.co;const t=this.At()-this.$o()-this.Uo();return this.co=t,t}Wh(){return this.qo(),this.Nh}Eo(t,i){const n=this.Nh;(i||null===n&&null!==t||null!==n&&!n.Dh(t))&&(this.yo=null,this.Nh=t)}Ni(){return this.qo(),0===this.uo||!this.Nh||this.Nh.Ni()}Go(t){return this.Fo()?t:this.At()-1-t}Rt(t,i){return this.kh()?t=Qi(t,i):this.Lo()&&(t=nn(t,i)),this.Bo(t,i)}ee(t,i,n){this.qo();const s=this.Uo(),e=p(this.Wh()),r=e.Bh(),h=e.zh(),l=this.Ho()-1,a=this.Fo(),o=l/(h-r),_=void 0===n?0:n.from,u=void 0===n?t.length:n.to,c=this.Yo();for(let n=_;n<u;n++){const e=t[n],h=e.ut;if(isNaN(h))continue;let l=h;null!==c&&(l=c(e.ut,i));const _=s+o*(l-r),u=a?_:this.uo-1-_;e.et=u}}xe(t,i,n){this.qo();const s=this.Uo(),e=p(this.Wh()),r=e.Bh(),h=e.zh(),l=this.Ho()-1,a=this.Fo(),o=l/(h-r),_=void 0===n?0:n.from,u=void 0===n?t.length:n.to,c=this.Yo();for(let n=_;n<u;n++){const e=t[n];let h=e.ye,l=e.Ce,_=e.ke,u=e.Pe;null!==c&&(h=c(e.ye,i),l=c(e.Ce,i),_=c(e.ke,i),u=c(e.Pe,i));let d=s+o*(h-r),f=a?d:this.uo-1-d;e.ge=f,d=s+o*(l-r),f=a?d:this.uo-1-d,e.me=f,d=s+o*(_-r),f=a?d:this.uo-1-d,e.be=f,d=s+o*(u-r),f=a?d:this.uo-1-d,e.Me=f}}mn(t,i){const n=this.Vo(t,i);return this.Xo(n,i)}Xo(t,i){let n=t;return this.kh()?n=function(t,i){return i<0&&(t=-t),t/100*i+i}(n,i):this.Lo()&&(n=function(t,i){return t-=100,i<0&&(t=-t),t/100*i+i}(n,i)),n}Fa(){return this.xo}Zo(){if(this.So)return this.So;let t=[];for(let i=0;i<this.xo.length;i++){const n=this.xo[i];null===n.Zi()&&n.Ki(i+1),t.push(n)}return t=un(t),this.So=t,this.So}Ko(t){-1===this.xo.indexOf(t)&&(this.xo.push(t),this.za(),this.Jo())}Qo(t){const i=this.xo.indexOf(t);if(-1===i)throw new Error("source is not attached to scale");this.xo.splice(i,1),0===this.xo.length&&(this.zo({Wn:!0}),this.Eo(null)),this.za(),this.Jo()}Pt(){let t=null;for(const i of this.xo){const n=i.Pt();null!==n&&((null===t||n.ca<t.ca)&&(t=n))}return null===t?null:t.Vt}Fo(){return this.dn.invertScale}Ya(){const t=null===this.Pt();if(null!==this.yo&&(t||this.yo.t_===t))return this.yo.Ya;this.Do.ho();const i=this.Do.Ya();return this.yo={Ya:i,t_:t},this.wo.M(),i}i_(){return this.wo}n_(t){this.kh()||this.Lo()||null===this.Co&&null===this.do&&(this.Ni()||(this.Co=this.uo-t,this.do=p(this.Wh()).Vh()))}s_(t){if(this.kh()||this.Lo())return;if(null===this.Co)return;this.zo({Wn:!1}),(t=this.uo-t)<0&&(t=0);let i=(this.Co+.2*(this.uo-1))/(t+.2*(this.uo-1));const n=p(this.do).Vh();i=Math.max(i,.1),n.Ih(i),this.Eo(n)}e_(){this.kh()||this.Lo()||(this.Co=null,this.do=null)}r_(t){this.Io()||null===this.ko&&null===this.do&&(this.Ni()||(this.ko=t,this.do=p(this.Wh()).Vh()))}h_(t){if(this.Io())return;if(null===this.ko)return;const i=p(this.Wh()).Ah()/(this.Ho()-1);let n=t-this.ko;this.Fo()&&(n*=-1);const s=n*i,e=p(this.do).Vh();e.Lh(s),this.Eo(e,!0),this.yo=null}l_(){this.Io()||null!==this.ko&&(this.ko=null,this.do=null)}Sa(){return this.ya||this.za(),this.ya}ji(t,i){switch(this.dn.mode){case 2:return this.a_(Qi(t,i));case 3:return this.Sa().format(nn(t,i));default:return this.qh(t)}}oo(t){switch(this.dn.mode){case 2:return this.a_(t);case 3:return this.Sa().format(t);default:return this.qh(t)}}Jl(t){return this.qh(t,p(this.o_()).Sa())}Ql(t,i){return t=Qi(t,i),this.a_(t,dn)}__(){return this.xo}u_(t){this.fo={po:t,vo:!1}}Vn(){this.xo.forEach((t=>t.Vn()))}za(){this.yo=null;const t=this.o_();let i=100;null!==t&&(i=Math.round(1/t.xa())),this.ya=fn,this.kh()?(this.ya=dn,i=100):this.Lo()?(this.ya=new dt(100,1),i=100):null!==t&&(this.ya=t.Sa()),this.Do=new _n(this,i,this.Vo.bind(this),this.Bo.bind(this)),this.Do.ho()}Jo(){this.So=null}o_(){return this.xo[0]||null}$o(){return this.Fo()?this.dn.scaleMargins.bottom*this.At()+this.bo:this.dn.scaleMargins.top*this.At()+this.mo}Uo(){return this.Fo()?this.dn.scaleMargins.top*this.At()+this.mo:this.dn.scaleMargins.bottom*this.At()+this.bo}qo(){this.fo.vo||(this.fo.vo=!0,this.c_())}Ao(){this.co=null}Bo(t,i){if(this.qo(),this.Ni())return 0;t=this._o()&&t?en(t,this.Po):t;const n=p(this.Wh()),s=this.Uo()+(this.Ho()-1)*(t-n.Bh())/n.Ah();return this.Go(s)}Vo(t,i){if(this.qo(),this.Ni())return 0;const n=this.Go(t),s=p(this.Wh()),e=s.Bh()+s.Ah()*((n-this.Uo())/(this.Ho()-1));return this._o()?rn(e,this.Po):e}No(){this.yo=null,this.Do.ho()}c_(){const t=this.fo.po;if(null===t)return;let i=null;const n=this.__();let s=0,e=0;for(const r of n){if(!r.kt())continue;const n=r.Pt();if(null===n)continue;const h=r.Nl(t.Is(),t.ci());let l=h&&h.Wh();if(null!==l){switch(this.dn.mode){case 1:l=hn(l,this.Po);break;case 2:l=tn(l,n.Vt);break;case 3:l=sn(l,n.Vt)}if(i=null===i?l:i.ns(p(l)),null!==h){const t=h.Hh();null!==t&&(s=Math.max(s,t.above),e=Math.max(e,t.below))}}}if(s===this.mo&&e===this.bo||(this.mo=s,this.bo=e,this.yo=null,this.Ao()),null!==i){if(i.Bh()===i.zh()){const t=this.o_(),n=5*(null===t||this.kh()||this.Lo()?1:t.xa());this._o()&&(i=ln(i,this.Po)),i=new Ci(i.Bh()-n,i.zh()+n),this._o()&&(i=hn(i,this.Po))}if(this._o()){const t=ln(i,this.Po),n=an(t);if(r=n,h=this.Po,r.Xa!==h.Xa||r.Za!==h.Za){const s=null!==this.do?ln(this.do,this.Po):null;this.Po=n,i=hn(t,n),null!==s&&(this.do=hn(s,n))}}this.Eo(i)}else null===this.Nh&&(this.Eo(new Ci(-.5,.5)),this.Po=an(null));var r,h;this.fo.vo=!0}Yo(){return this.kh()?Qi:this.Lo()?nn:this._o()?t=>en(t,this.Po):null}d_(t,i,n){return void 0===i?(void 0===n&&(n=this.Sa()),n.format(t)):i(t)}qh(t,i){return this.d_(t,this.Ro.priceFormatter,i)}a_(t,i){return this.d_(t,this.Ro.percentageFormatter,i)}}class pn{constructor(t,i){this.xo=[],this.f_=new Map,this.uo=0,this.v_=0,this.p_=1e3,this.So=null,this.m_=new T,this.Rl=t,this.Ui=i,this.b_=new Ki(this);const n=i.W();this.w_=this.g_("left",n.leftPriceScale),this.M_=this.g_("right",n.rightPriceScale),this.w_.jo().l(this.x_.bind(this,this.w_),this),this.M_.jo().l(this.x_.bind(this,this.M_),this),this.S_(n)}S_(t){if(t.leftPriceScale&&this.w_.Xh(t.leftPriceScale),t.rightPriceScale&&this.M_.Xh(t.rightPriceScale),t.localization&&(this.w_.za(),this.M_.za()),t.overlayPriceScales){const i=Array.from(this.f_.values());for(const n of i){const i=p(n[0].Dt());i.Xh(t.overlayPriceScales),t.localization&&i.za()}}}y_(t){switch(t){case"left":return this.w_;case"right":return this.M_}return this.f_.has(t)?v(this.f_.get(t))[0].Dt():null}C(){this.Ut().C_().m(this),this.w_.jo().m(this),this.M_.jo().m(this),this.xo.forEach((t=>{t.C&&t.C()})),this.m_.M()}k_(){return this.p_}P_(t){this.p_=t}Ut(){return this.Ui}$i(){return this.v_}At(){return this.uo}T_(t){this.v_=t,this.O_()}Wo(t){this.uo=t,this.w_.Wo(t),this.M_.Wo(t),this.xo.forEach((i=>{if(this.gr(i)){const n=i.Dt();null!==n&&n.Wo(t)}})),this.O_()}Fa(){return this.xo}gr(t){const i=t.Dt();return null===i||this.w_!==i&&this.M_!==i}Ko(t,i,n){const s=void 0!==n?n:this.D_().R_+1;this.V_(t,i,s)}Qo(t){const i=this.xo.indexOf(t);f(-1!==i,"removeDataSource: invalid data source"),this.xo.splice(i,1);const n=p(t.Dt()).Ba();if(this.f_.has(n)){const i=v(this.f_.get(n)),s=i.indexOf(t);-1!==s&&(i.splice(s,1),0===i.length&&this.f_.delete(n))}const s=t.Dt();s&&s.Fa().indexOf(t)>=0&&s.Qo(t),null!==s&&(s.Jo(),this.B_(s)),this.So=null}Sr(t){return t===this.w_?"left":t===this.M_?"right":"overlay"}z_(){return this.w_}A_(){return this.M_}I_(t,i){t.n_(i)}L_(t,i){t.s_(i),this.O_()}F_(t){t.e_()}E_(t,i){t.r_(i)}N_(t,i){t.h_(i),this.O_()}j_(t){t.l_()}O_(){this.xo.forEach((t=>{t.Vn()}))}pn(){let t=null;return this.Ui.W().rightPriceScale.visible&&0!==this.M_.Fa().length?t=this.M_:this.Ui.W().leftPriceScale.visible&&0!==this.w_.Fa().length?t=this.w_:0!==this.xo.length&&(t=this.xo[0].Dt()),null===t&&(t=this.M_),t}Mr(){let t=null;return this.Ui.W().rightPriceScale.visible?t=this.M_:this.Ui.W().leftPriceScale.visible&&(t=this.w_),t}B_(t){null!==t&&t.Io()&&this.W_(t)}H_(t){const i=this.Rl.Qs();t.zo({Wn:!0}),null!==i&&t.u_(i),this.O_()}U_(){this.W_(this.w_),this.W_(this.M_)}q_(){this.B_(this.w_),this.B_(this.M_),this.xo.forEach((t=>{this.gr(t)&&this.B_(t.Dt())})),this.O_(),this.Ui.Zh()}Zo(){return null===this.So&&(this.So=un(this.xo)),this.So}G_(){return this.m_}Y_(){return this.b_}W_(t){const i=t.__();if(i&&i.length>0&&!this.Rl.Ni()){const i=this.Rl.Qs();null!==i&&t.u_(i)}t.Vn()}D_(){const t=this.Zo();if(0===t.length)return{X_:0,R_:0};let i=0,n=0;for(let s=0;s<t.length;s++){const e=t[s].Zi();null!==e&&(e<i&&(i=e),e>n&&(n=e))}return{X_:i,R_:n}}V_(t,i,n){let s=this.y_(i);if(null===s&&(s=this.g_(i,this.Ui.W().overlayPriceScales)),this.xo.push(t),!ot(i)){const n=this.f_.get(i)||[];n.push(t),this.f_.set(i,n)}s.Ko(t),t.Ji(s),t.Ki(n),this.B_(s),this.So=null}x_(t,i,n){i.Dr!==n.Dr&&this.W_(t)}g_(t,i){const n=Object.assign({visible:!0,autoScale:!0},z(i)),s=new vn(t,n,this.Ui.W().layout,this.Ui.W().localization);return s.Wo(this.At()),s}}class mn{constructor(t,i,n=50){this.ir=0,this.nr=1,this.sr=1,this.rr=new Map,this.er=new Map,this.Z_=t,this.K_=i,this.hr=n}J_(t){const i=t.time,n=this.K_.cacheKey(i),s=this.rr.get(n);if(void 0!==s)return s.Q_;if(this.ir===this.hr){const t=this.er.get(this.sr);this.er.delete(this.sr),this.rr.delete(v(t)),this.sr++,this.ir--}const e=this.Z_(t);return this.rr.set(n,{Q_:e,ur:this.nr}),this.er.set(this.nr,n),this.ir++,this.nr++,e}}class bn{constructor(t,i){f(t<=i,"right should be >= left"),this.tu=t,this.iu=i}Is(){return this.tu}ci(){return this.iu}nu(){return this.iu-this.tu+1}ih(t){return this.tu<=t&&t<=this.iu}Dh(t){return this.tu===t.Is()&&this.iu===t.ci()}}function wn(t,i){return null===t||null===i?t===i:t.Dh(i)}class gn{constructor(){this.su=new Map,this.rr=null,this.eu=!1}ru(t){this.eu=t,this.rr=null}hu(t,i){this.lu(i),this.rr=null;for(let n=i;n<t.length;++n){const i=t[n];let s=this.su.get(i.timeWeight);void 0===s&&(s=[],this.su.set(i.timeWeight,s)),s.push({index:n,time:i.time,weight:i.timeWeight,originalTime:i.originalTime})}}au(t,i){const n=Math.ceil(i/t);return null!==this.rr&&this.rr.ou===n||(this.rr={Ya:this._u(n),ou:n}),this.rr.Ya}lu(t){if(0===t)return void this.su.clear();const i=[];this.su.forEach(((n,s)=>{t<=n[0].index?i.push(s):n.splice(Ot(n,t,(i=>i.index<t)),1/0)}));for(const t of i)this.su.delete(t)}_u(t){let i=[];for(const n of Array.from(this.su.keys()).sort(((t,i)=>i-t))){if(!this.su.get(n))continue;const s=i;i=[];const e=s.length;let r=0;const h=v(this.su.get(n)),l=h.length;let a=1/0,o=-1/0;for(let n=0;n<l;n++){const l=h[n],_=l.index;for(;r<e;){const t=s[r],n=t.index;if(!(n<_)){a=n;break}r++,i.push(t),o=n,a=1/0}if(a-_>=t&&_-o>=t)i.push(l),o=_;else if(this.eu)return s}for(;r<e;r++)i.push(s[r])}return i}}class Mn{constructor(t){this.uu=t}cu(){return null===this.uu?null:new bn(Math.floor(this.uu.Is()),Math.ceil(this.uu.ci()))}du(){return this.uu}static fu(){return new Mn(null)}}function xn(t,i){return t.weight>i.weight?t:i}class Sn{constructor(t,i,n,s){this.v_=0,this.vu=null,this.pu=[],this.ko=null,this.Co=null,this.mu=new gn,this.bu=new Map,this.wu=Mn.fu(),this.gu=!0,this.Mu=new T,this.xu=new T,this.Su=new T,this.yu=null,this.Cu=null,this.ku=[],this.dn=i,this.Ro=n,this.Pu=i.rightOffset,this.Tu=i.barSpacing,this.Ui=t,this.K_=s,this.Ou(),this.mu.ru(i.uniformDistribution)}W(){return this.dn}Ru(t){O(this.Ro,t),this.Du(),this.Ou()}Xh(t,i){var n;O(this.dn,t),this.dn.fixLeftEdge&&this.Vu(),this.dn.fixRightEdge&&this.Bu(),void 0!==t.barSpacing&&this.Ui.Jn(t.barSpacing),void 0!==t.rightOffset&&this.Ui.Qn(t.rightOffset),void 0!==t.minBarSpacing&&this.Ui.Jn(null!==(n=t.barSpacing)&&void 0!==n?n:this.Tu),this.Du(),this.Ou(),this.Su.M()}bn(t){var i,n;return null!==(n=null===(i=this.pu[t])||void 0===i?void 0:i.time)&&void 0!==n?n:null}qi(t){var i;return null!==(i=this.pu[t])&&void 0!==i?i:null}Ia(t,i){if(this.pu.length<1)return null;if(this.K_.key(t)>this.K_.key(this.pu[this.pu.length-1].time))return i?this.pu.length-1:null;const n=Ot(this.pu,this.K_.key(t),((t,i)=>this.K_.key(t.time)<i));return this.K_.key(t)<this.K_.key(this.pu[n].time)?i?n:null:n}Ni(){return 0===this.v_||0===this.pu.length||null===this.vu}Aa(){return this.pu.length>0}Qs(){return this.zu(),this.wu.cu()}Au(){return this.zu(),this.wu.du()}Iu(){const t=this.Qs();if(null===t)return null;const i={from:t.Is(),to:t.ci()};return this.Lu(i)}Lu(t){const i=Math.round(t.from),n=Math.round(t.to),s=p(this.Fu()),e=p(this.Eu());return{from:p(this.qi(Math.max(s,i))),to:p(this.qi(Math.min(e,n)))}}Nu(t){return{from:p(this.Ia(t.from,!0)),to:p(this.Ia(t.to,!0))}}$i(){return this.v_}T_(t){if(!isFinite(t)||t<=0)return;if(this.v_===t)return;const i=this.Au(),n=this.v_;if(this.v_=t,this.gu=!0,this.dn.lockVisibleTimeRangeOnResize&&0!==n){const i=this.Tu*t/n;this.Tu=i}if(this.dn.fixLeftEdge&&null!==i&&i.Is()<=0){const i=n-t;this.Pu-=Math.round(i/this.Tu)+1,this.gu=!0}this.ju(),this.Wu()}It(t){if(this.Ni()||!D(t))return 0;const i=this.Hu()+this.Pu-t;return this.v_-(i+.5)*this.Tu-1}se(t,i){const n=this.Hu(),s=void 0===i?0:i.from,e=void 0===i?t.length:i.to;for(let i=s;i<e;i++){const s=t[i]._t,e=n+this.Pu-s,r=this.v_-(e+.5)*this.Tu-1;t[i].st=r}}$u(t){return Math.ceil(this.Uu(t))}Qn(t){this.gu=!0,this.Pu=t,this.Wu(),this.Ui.qu(),this.Ui.Zh()}ue(){return this.Tu}Jn(t){this.Gu(t),this.Wu(),this.Ui.qu(),this.Ui.Zh()}Yu(){return this.Pu}Ya(){if(this.Ni())return null;if(null!==this.Cu)return this.Cu;const t=this.Tu,i=5*(this.Ui.W().layout.fontSize+4)/8*(this.dn.tickMarkMaxCharacterLength||8),n=Math.round(i/t),s=p(this.Qs()),e=Math.max(s.Is(),s.Is()-n),r=Math.max(s.ci(),s.ci()-n),h=this.mu.au(t,i),l=this.Fu()+n,a=this.Eu()-n,o=this.Xu(),_=this.dn.fixLeftEdge||o,u=this.dn.fixRightEdge||o;let c=0;for(const t of h){if(!(e<=t.index&&t.index<=r))continue;let n;c<this.ku.length?(n=this.ku[c],n.coord=this.It(t.index),n.label=this.Zu(t),n.weight=t.weight):(n={needAlignCoordinate:!1,coord:this.It(t.index),label:this.Zu(t),weight:t.weight},this.ku.push(n)),this.Tu>i/2&&!o?n.needAlignCoordinate=!1:n.needAlignCoordinate=_&&t.index<=l||u&&t.index>=a,c++}return this.ku.length=c,this.Cu=this.ku,this.ku}Ku(){this.gu=!0,this.Jn(this.dn.barSpacing),this.Qn(this.dn.rightOffset)}Ju(t){this.gu=!0,this.vu=t,this.Wu(),this.Vu()}Qu(t,i){const n=this.Uu(t),s=this.ue(),e=s+i*(s/10);this.Jn(e),this.dn.rightBarStaysOnScroll||this.Qn(this.Yu()+(n-this.Uu(t)))}n_(t){this.ko&&this.l_(),null===this.Co&&null===this.yu&&(this.Ni()||(this.Co=t,this.tc()))}s_(t){if(null===this.yu)return;const i=gt(this.v_-t,0,this.v_),n=gt(this.v_-p(this.Co),0,this.v_);0!==i&&0!==n&&this.Jn(this.yu.ue*i/n)}e_(){null!==this.Co&&(this.Co=null,this.nc())}r_(t){null===this.ko&&null===this.yu&&(this.Ni()||(this.ko=t,this.tc()))}h_(t){if(null===this.ko)return;const i=(this.ko-t)/this.ue();this.Pu=p(this.yu).Yu+i,this.gu=!0,this.Wu()}l_(){null!==this.ko&&(this.ko=null,this.nc())}sc(){this.ec(this.dn.rightOffset)}ec(t,i=400){if(!isFinite(t))throw new RangeError("offset is required and must be finite number");if(!isFinite(i)||i<=0)throw new RangeError("animationDuration (optional) must be finite positive number");const n=this.Pu,s=performance.now();this.Ui.Xn({rc:t=>(t-s)/i>=1,hc:e=>{const r=(e-s)/i;return r>=1?t:n+(t-n)*r}})}wt(t,i){this.gu=!0,this.pu=t,this.mu.hu(t,i),this.Wu()}lc(){return this.Mu}ac(){return this.xu}oc(){return this.Su}Hu(){return this.vu||0}_c(t){const i=t.nu();this.Gu(this.v_/i),this.Pu=t.ci()-this.Hu(),this.Wu(),this.gu=!0,this.Ui.qu(),this.Ui.Zh()}uc(){const t=this.Fu(),i=this.Eu();null!==t&&null!==i&&this._c(new bn(t,i+this.dn.rightOffset))}cc(t){const i=new bn(t.from,t.to);this._c(i)}Gi(t){return void 0!==this.Ro.timeFormatter?this.Ro.timeFormatter(t.originalTime):this.K_.formatHorzItem(t.time)}Xu(){const{handleScroll:t,handleScale:i}=this.Ui.W();return!(t.horzTouchDrag||t.mouseWheel||t.pressedMouseMove||t.vertTouchDrag||i.axisDoubleClickReset.time||i.axisPressedMouseMove.time||i.mouseWheel||i.pinch)}Fu(){return 0===this.pu.length?null:0}Eu(){return 0===this.pu.length?null:this.pu.length-1}dc(t){return(this.v_-1-t)/this.Tu}Uu(t){const i=this.dc(t),n=this.Hu()+this.Pu-i;return Math.round(1e6*n)/1e6}Gu(t){const i=this.Tu;this.Tu=t,this.ju(),i!==this.Tu&&(this.gu=!0,this.fc())}zu(){if(!this.gu)return;if(this.gu=!1,this.Ni())return void this.vc(Mn.fu());const t=this.Hu(),i=this.v_/this.Tu,n=this.Pu+t,s=new bn(n-i+1,n);this.vc(new Mn(s))}ju(){const t=this.mc();if(this.Tu<t&&(this.Tu=t,this.gu=!0),0!==this.v_){const t=.5*this.v_;this.Tu>t&&(this.Tu=t,this.gu=!0)}}mc(){return this.dn.fixLeftEdge&&this.dn.fixRightEdge&&0!==this.pu.length?this.v_/this.pu.length:this.dn.minBarSpacing}Wu(){const t=this.bc();this.Pu>t&&(this.Pu=t,this.gu=!0);const i=this.wc();null!==i&&this.Pu<i&&(this.Pu=i,this.gu=!0)}wc(){const t=this.Fu(),i=this.vu;if(null===t||null===i)return null;return t-i-1+(this.dn.fixLeftEdge?this.v_/this.Tu:Math.min(2,this.pu.length))}bc(){return this.dn.fixRightEdge?0:this.v_/this.Tu-Math.min(2,this.pu.length)}tc(){this.yu={ue:this.ue(),Yu:this.Yu()}}nc(){this.yu=null}Zu(t){let i=this.bu.get(t.weight);return void 0===i&&(i=new mn((t=>this.gc(t)),this.K_),this.bu.set(t.weight,i)),i.J_(t)}gc(t){return this.K_.formatTickmark(t,this.Ro)}vc(t){const i=this.wu;this.wu=t,wn(i.cu(),this.wu.cu())||this.Mu.M(),wn(i.du(),this.wu.du())||this.xu.M(),this.fc()}fc(){this.Cu=null}Du(){this.fc(),this.bu.clear()}Ou(){this.K_.updateFormatter(this.Ro)}Vu(){if(!this.dn.fixLeftEdge)return;const t=this.Fu();if(null===t)return;const i=this.Qs();if(null===i)return;const n=i.Is()-t;if(n<0){const t=this.Pu-n-1;this.Qn(t)}this.ju()}Bu(){this.Wu(),this.ju()}}class yn{Z(t,i,n){t.useMediaCoordinateSpace((t=>this.K(t,i,n)))}Cl(t,i,n){t.useMediaCoordinateSpace((t=>this.Mc(t,i,n)))}Mc(t,i,n){}}class Cn extends yn{constructor(t){super(),this.xc=new Map,this.Lt=t}K(t){}Mc(t){if(!this.Lt.kt)return;const{context:i,mediaSize:n}=t;let s=0;for(const t of this.Lt.Sc){if(0===t.Kt.length)continue;i.font=t.R;const e=this.yc(i,t.Kt);e>n.width?t.Qu=n.width/e:t.Qu=1,s+=t.Cc*t.Qu}let e=0;switch(this.Lt.kc){case"top":e=0;break;case"center":e=Math.max((n.height-s)/2,0);break;case"bottom":e=Math.max(n.height-s,0)}i.fillStyle=this.Lt.V;for(const t of this.Lt.Sc){i.save();let s=0;switch(this.Lt.Pc){case"left":i.textAlign="left",s=t.Cc/2;break;case"center":i.textAlign="center",s=n.width/2;break;case"right":i.textAlign="right",s=n.width-1-t.Cc/2}i.translate(s,e),i.textBaseline="top",i.font=t.R,i.scale(t.Qu,t.Qu),i.fillText(t.Kt,0,t.Tc),i.restore(),e+=t.Cc*t.Qu}}yc(t,i){const n=this.Oc(t.font);let s=n.get(i);return void 0===s&&(s=t.measureText(i).width,n.set(i,s)),s}Oc(t){let i=this.xc.get(t);return void 0===i&&(i=new Map,this.xc.set(t,i)),i}}class kn{constructor(t){this.vt=!0,this.jt={kt:!1,V:"",Sc:[],kc:"center",Pc:"center"},this.Wt=new Cn(this.jt),this.Ht=t}wt(){this.vt=!0}Mt(){return this.vt&&(this.xt(),this.vt=!1),this.Wt}xt(){const t=this.Ht.W(),i=this.jt;i.kt=t.visible,i.kt&&(i.V=t.color,i.Pc=t.horzAlign,i.kc=t.vertAlign,i.Sc=[{Kt:t.text,R:F(t.fontSize,t.fontFamily,t.fontStyle),Cc:1.2*t.fontSize,Tc:0,Qu:0}])}}class Pn extends ht{constructor(t,i){super(),this.dn=i,this.gn=new kn(this)}Rn(){return[]}On(){return[this.gn]}W(){return this.dn}Vn(){this.gn.wt()}}var Tn,On,Rn,Dn,Vn;!function(t){t[t.OnTouchEnd=0]="OnTouchEnd",t[t.OnNextTap=1]="OnNextTap"}(Tn||(Tn={}));class Bn{constructor(t,i,n){this.Rc=[],this.Dc=[],this.v_=0,this.Vc=null,this.Bc=new T,this.zc=new T,this.Ac=null,this.Ic=t,this.dn=i,this.K_=n,this.Lc=new E(this),this.Rl=new Sn(this,i.timeScale,this.dn.localization,n),this.bt=new at(this,i.crosshair),this.Fc=new Yi(i.crosshair),this.Ec=new Pn(this,i.watermark),this.Nc(),this.Rc[0].P_(2e3),this.jc=this.Wc(0),this.Hc=this.Wc(1)}ia(){this.$c(_t.rs())}Zh(){this.$c(_t.es())}fa(){this.$c(new _t(1))}na(t){const i=this.Uc(t);this.$c(i)}qc(){return this.Vc}Gc(t){const i=this.Vc;this.Vc=t,null!==i&&this.na(i.Yc),null!==t&&this.na(t.Yc)}W(){return this.dn}Xh(t){O(this.dn,t),this.Rc.forEach((i=>i.S_(t))),void 0!==t.timeScale&&this.Rl.Xh(t.timeScale),void 0!==t.localization&&this.Rl.Ru(t.localization),(t.leftPriceScale||t.rightPriceScale)&&this.Bc.M(),this.jc=this.Wc(0),this.Hc=this.Wc(1),this.ia()}Xc(t,i){if("left"===t)return void this.Xh({leftPriceScale:i});if("right"===t)return void this.Xh({rightPriceScale:i});const n=this.Zc(t);null!==n&&(n.Dt.Xh(i),this.Bc.M())}Zc(t){for(const i of this.Rc){const n=i.y_(t);if(null!==n)return{$t:i,Dt:n}}return null}yt(){return this.Rl}Kc(){return this.Rc}Jc(){return this.Ec}Qc(){return this.bt}td(){return this.zc}nd(t,i){t.Wo(i),this.qu()}T_(t){this.v_=t,this.Rl.T_(this.v_),this.Rc.forEach((i=>i.T_(t))),this.qu()}Nc(t){const i=new pn(this.Rl,this);void 0!==t?this.Rc.splice(t,0,i):this.Rc.push(i);const n=void 0===t?this.Rc.length-1:t,s=_t.rs();return s.Nn(n,{jn:0,Wn:!0}),this.$c(s),i}I_(t,i,n){t.I_(i,n)}L_(t,i,n){t.L_(i,n),this.sa(),this.$c(this.sd(t,2))}F_(t,i){t.F_(i),this.$c(this.sd(t,2))}E_(t,i,n){i.Io()||t.E_(i,n)}N_(t,i,n){i.Io()||(t.N_(i,n),this.sa(),this.$c(this.sd(t,2)))}j_(t,i){i.Io()||(t.j_(i),this.$c(this.sd(t,2)))}H_(t,i){t.H_(i),this.$c(this.sd(t,2))}ed(t){this.Rl.n_(t)}rd(t,i){const n=this.yt();if(n.Ni()||0===i)return;const s=n.$i();t=Math.max(1,Math.min(t,s)),n.Qu(t,i),this.qu()}hd(t){this.ld(0),this.ad(t),this.od()}_d(t){this.Rl.s_(t),this.qu()}ud(){this.Rl.e_(),this.Zh()}ld(t){this.Rl.r_(t)}ad(t){this.Rl.h_(t),this.qu()}od(){this.Rl.l_(),this.Zh()}gt(){return this.Dc}dd(t,i,n,s,e){this.bt.Mn(t,i);let r=NaN,h=this.Rl.$u(t);const l=this.Rl.Qs();null!==l&&(h=Math.min(Math.max(l.Is(),h),l.ci()));const a=s.pn(),o=a.Pt();null!==o&&(r=a.mn(i,o)),r=this.Fc.La(r,h,s),this.bt.Cn(h,r,s),this.fa(),e||this.zc.M(this.bt.St(),{x:t,y:i},n)}fd(t,i,n){const s=n.pn(),e=s.Pt(),r=s.Rt(t,p(e)),h=this.Rl.Ia(i,!0),l=this.Rl.It(p(h));this.dd(l,r,null,n,!0)}vd(t){this.Qc().Pn(),this.fa(),t||this.zc.M(null,null,null)}sa(){const t=this.bt.$t();if(null!==t){const i=this.bt.Sn(),n=this.bt.yn();this.dd(i,n,null,t)}this.bt.Vn()}pd(t,i,n){const s=this.Rl.bn(0);void 0!==i&&void 0!==n&&this.Rl.wt(i,n);const e=this.Rl.bn(0),r=this.Rl.Hu(),h=this.Rl.Qs();if(null!==h&&null!==s&&null!==e){const i=h.ih(r),l=this.K_.key(s)>this.K_.key(e),a=null!==t&&t>r&&!l,o=this.Rl.W().allowShiftVisibleRangeOnWhitespaceReplacement,_=i&&(!(void 0===n)||o)&&this.Rl.W().shiftVisibleRangeOnNewBar;if(a&&!_){const i=t-r;this.Rl.Qn(this.Rl.Yu()-i)}}this.Rl.Ju(t)}ha(t){null!==t&&t.q_()}wr(t){const i=this.Rc.find((i=>i.Zo().includes(t)));return void 0===i?null:i}qu(){this.Ec.Vn(),this.Rc.forEach((t=>t.q_())),this.sa()}C(){this.Rc.forEach((t=>t.C())),this.Rc.length=0,this.dn.localization.priceFormatter=void 0,this.dn.localization.percentageFormatter=void 0,this.dn.localization.timeFormatter=void 0}md(){return this.Lc}yr(){return this.Lc.W()}C_(){return this.Bc}bd(t,i,n){const s=this.Rc[0],e=this.wd(i,t,s,n);return this.Dc.push(e),1===this.Dc.length?this.ia():this.Zh(),e}gd(t){const i=this.wr(t),n=this.Dc.indexOf(t);f(-1!==n,"Series not found"),this.Dc.splice(n,1),p(i).Qo(t),t.C&&t.C()}ta(t,i){const n=p(this.wr(t));n.Qo(t);const s=this.Zc(i);if(null===s){const s=t.Zi();n.Ko(t,i,s)}else{const e=s.$t===n?t.Zi():void 0;s.$t.Ko(t,i,e)}}uc(){const t=_t.es();t.Un(),this.$c(t)}Md(t){const i=_t.es();i.Yn(t),this.$c(i)}Kn(){const t=_t.es();t.Kn(),this.$c(t)}Jn(t){const i=_t.es();i.Jn(t),this.$c(i)}Qn(t){const i=_t.es();i.Qn(t),this.$c(i)}Xn(t){const i=_t.es();i.Xn(t),this.$c(i)}qn(){const t=_t.es();t.qn(),this.$c(t)}xd(){return this.dn.rightPriceScale.visible?"right":"left"}Sd(){return this.Hc}G(){return this.jc}zt(t){const i=this.Hc,n=this.jc;if(i===n)return i;if(t=Math.max(0,Math.min(100,Math.round(100*t))),null===this.Ac||this.Ac.Ts!==n||this.Ac.Os!==i)this.Ac={Ts:n,Os:i,yd:new Map};else{const i=this.Ac.yd.get(t);if(void 0!==i)return i}const s=function(t,i,n){const[s,e,r,h]=C(t),[l,a,o,_]=C(i),u=[w(s+n*(l-s)),w(e+n*(a-e)),w(r+n*(o-r)),g(h+n*(_-h))];return`rgba(${u[0]}, ${u[1]}, ${u[2]}, ${u[3]})`}(n,i,t/100);return this.Ac.yd.set(t,s),s}sd(t,i){const n=new _t(i);if(null!==t){const s=this.Rc.indexOf(t);n.Nn(s,{jn:i})}return n}Uc(t,i){return void 0===i&&(i=2),this.sd(this.wr(t),i)}$c(t){this.Ic&&this.Ic(t),this.Rc.forEach((t=>t.Y_().Kh().wt()))}wd(t,i,n,s){const e=new Gi(this,t,i,n,s),r=void 0!==t.priceScaleId?t.priceScaleId:this.xd();return n.Ko(e,r),ot(r)||e.Xh(t),e}Wc(t){const i=this.dn.layout;return"gradient"===i.background.type?0===t?i.background.topColor:i.background.bottomColor:i.background.color}}function zn(t){return!R(t)&&!V(t)}function An(t){return R(t)}!function(t){t[t.Disabled=0]="Disabled",t[t.Continuous=1]="Continuous",t[t.OnDataUpdate=2]="OnDataUpdate"}(On||(On={})),function(t){t[t.LastBar=0]="LastBar",t[t.LastVisible=1]="LastVisible"}(Rn||(Rn={})),function(t){t.Solid="solid",t.VerticalGradient="gradient"}(Dn||(Dn={})),function(t){t[t.Year=0]="Year",t[t.Month=1]="Month",t[t.DayOfMonth=2]="DayOfMonth",t[t.Time=3]="Time",t[t.TimeWithSeconds=4]="TimeWithSeconds"}(Vn||(Vn={}));const In=t=>t.getUTCFullYear();function Ln(t,i,n){return i.replace(/yyyy/g,(t=>ct(In(t),4))(t)).replace(/yy/g,(t=>ct(In(t)%100,2))(t)).replace(/MMMM/g,((t,i)=>new Date(t.getUTCFullYear(),t.getUTCMonth(),1).toLocaleString(i,{month:"long"}))(t,n)).replace(/MMM/g,((t,i)=>new Date(t.getUTCFullYear(),t.getUTCMonth(),1).toLocaleString(i,{month:"short"}))(t,n)).replace(/MM/g,(t=>ct((t=>t.getUTCMonth()+1)(t),2))(t)).replace(/dd/g,(t=>ct((t=>t.getUTCDate())(t),2))(t))}class Fn{constructor(t="yyyy-MM-dd",i="default"){this.Cd=t,this.kd=i}J_(t){return Ln(t,this.Cd,this.kd)}}class En{constructor(t){this.Pd=t||"%h:%m:%s"}J_(t){return this.Pd.replace("%h",ct(t.getUTCHours(),2)).replace("%m",ct(t.getUTCMinutes(),2)).replace("%s",ct(t.getUTCSeconds(),2))}}const Nn={Td:"yyyy-MM-dd",Od:"%h:%m:%s",Rd:" ",Dd:"default"};class jn{constructor(t={}){const i=Object.assign(Object.assign({},Nn),t);this.Vd=new Fn(i.Td,i.Dd),this.Bd=new En(i.Od),this.zd=i.Rd}J_(t){return`${this.Vd.J_(t)}${this.zd}${this.Bd.J_(t)}`}}function Wn(t){return 60*t*60*1e3}function Hn(t){return 60*t*1e3}const $n=[{Ad:(Un=1,1e3*Un),Id:10},{Ad:Hn(1),Id:20},{Ad:Hn(5),Id:21},{Ad:Hn(30),Id:22},{Ad:Wn(1),Id:30},{Ad:Wn(3),Id:31},{Ad:Wn(6),Id:32},{Ad:Wn(12),Id:33}];var Un;function qn(t,i){if(t.getUTCFullYear()!==i.getUTCFullYear())return 70;if(t.getUTCMonth()!==i.getUTCMonth())return 60;if(t.getUTCDate()!==i.getUTCDate())return 50;for(let n=$n.length-1;n>=0;--n)if(Math.floor(i.getTime()/$n[n].Ad)!==Math.floor(t.getTime()/$n[n].Ad))return $n[n].Id;return 0}function Gn(t){let i=t;if(V(t)&&(i=Xn(t)),!zn(i))throw new Error("time must be of type BusinessDay");const n=new Date(Date.UTC(i.year,i.month-1,i.day,0,0,0,0));return{Ld:Math.round(n.getTime()/1e3),Fd:i}}function Yn(t){if(!An(t))throw new Error("time must be of type isUTCTimestamp");return{Ld:t}}function Xn(t){const i=new Date(t);if(isNaN(i.getTime()))throw new Error(`Invalid date string=${t}, expected format=yyyy-mm-dd`);return{day:i.getUTCDate(),month:i.getUTCMonth()+1,year:i.getUTCFullYear()}}function Zn(t){V(t.time)&&(t.time=Xn(t.time))}class Kn{options(){return this.dn}setOptions(t){this.dn=t,this.updateFormatter(t.localization)}preprocessData(t){Array.isArray(t)?function(t){t.forEach(Zn)}(t):Zn(t)}createConverterToInternalObj(t){return p(function(t){return 0===t.length?null:zn(t[0].time)||V(t[0].time)?Gn:Yn}(t))}key(t){return"object"==typeof t&&"Ld"in t?t.Ld:this.key(this.convertHorzItemToInternal(t))}cacheKey(t){const i=t;return void 0===i.Fd?new Date(1e3*i.Ld).getTime():new Date(Date.UTC(i.Fd.year,i.Fd.month-1,i.Fd.day)).getTime()}convertHorzItemToInternal(t){return An(i=t)?Yn(i):zn(i)?Gn(i):Gn(Xn(i));var i}updateFormatter(t){if(!this.dn)return;const i=t.dateFormat;this.dn.timeScale.timeVisible?this.Ed=new jn({Td:i,Od:this.dn.timeScale.secondsVisible?"%h:%m:%s":"%h:%m",Rd:"   ",Dd:t.locale}):this.Ed=new Fn(i,t.locale)}formatHorzItem(t){const i=t;return this.Ed.J_(new Date(1e3*i.Ld))}formatTickmark(t,i){const n=function(t,i,n){switch(t){case 0:case 10:return i?n?4:3:2;case 20:case 21:case 22:case 30:case 31:case 32:case 33:return i?3:2;case 50:return 2;case 60:return 1;case 70:return 0}}(t.weight,this.dn.timeScale.timeVisible,this.dn.timeScale.secondsVisible),s=this.dn.timeScale;if(void 0!==s.tickMarkFormatter){const e=s.tickMarkFormatter(t.originalTime,n,i.locale);if(null!==e)return e}return function(t,i,n){const s={};switch(i){case 0:s.year="numeric";break;case 1:s.month="short";break;case 2:s.day="numeric";break;case 3:s.hour12=!1,s.hour="2-digit",s.minute="2-digit";break;case 4:s.hour12=!1,s.hour="2-digit",s.minute="2-digit",s.second="2-digit"}const e=void 0===t.Fd?new Date(1e3*t.Ld):new Date(Date.UTC(t.Fd.year,t.Fd.month-1,t.Fd.day));return new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()).toLocaleString(n,s)}(t.time,n,i.locale)}maxTickMarkWeight(t){let i=t.reduce(xn,t[0]).weight;return i>30&&i<50&&(i=30),i}fillWeightsForPoints(t,i){!function(t,i=0){if(0===t.length)return;let n=0===i?null:t[i-1].time.Ld,s=null!==n?new Date(1e3*n):null,e=0;for(let r=i;r<t.length;++r){const i=t[r],h=new Date(1e3*i.time.Ld);null!==s&&(i.timeWeight=qn(h,s)),e+=i.time.Ld-(n||i.time.Ld),n=i.time.Ld,s=h}if(0===i&&t.length>1){const i=Math.ceil(e/(t.length-1)),n=new Date(1e3*(t[0].time.Ld-i));t[0].timeWeight=qn(new Date(1e3*t[0].time.Ld),n)}}(t,i)}static Nd(t){return O({localization:{dateFormat:"dd MMM 'yy"}},null!=t?t:{})}}const Jn={text:"",color:"#000000",fontSize:14,fontWeight:400,paddingTop:0,paddingBottom:0,minWidth:0};const Qn="\n\tposition:absolute;display:none;padding:12px;box-sizing:border-box;\n\tfont-size:14px;text-align:left;z-index:10;top:12px;left:12px;\n\tpointer-events:none;border:1px solid#EBEBEB;border-radius:4px;\n\tbackground-color:#FFFFFF;\n\tbox-shadow:0px 10px 15px-3px rgba(0,0,0,0.1),0px 4px 6px-2px rgba(0,0,0,0.05);\n";function ts(t,i){if("number"==typeof t)return t;if("string"==typeof t){const n=t.match(/^(\d+(?:\.\d+)?)%$/);if(n){return i*Number(n[1])/100}throw new Error(`Invalid size: ${t}`)}throw new Error("Invalid type of size: "+typeof t)}function is(t,i){const{text:n,fontSize:s,fontWeight:e,paddingTop:r,paddingBottom:h}=i;t.font=F(s,void 0,`${e}`);return{$i:Math.max(t.measureText(n).width+0+0,i.minWidth),At:s+r+h,jd:0,Wd:r}}function ns(t,i){if(!t||!t.renderContent||!i)return null;const{style:n}=t,s=document.createElement("div");return s.style=`\n\t\t${Qn}\n\t\t${n||""}\n\t`,i.style.position="relative",i.appendChild(s),s}function ss(t,i,n,s,e){if(!t||!i||!n)return;let r,h;es(t,n),t.style.display="block";const l=t.clientWidth,a=t.clientHeight;r=s.st+15+e,r>i.clientWidth-l&&(r=s.st-15-l+e),h=s.et+15,h>i.clientHeight-a&&(h=s.et-a-15),t.style.left=`${r}px`,t.style.top=`${h}px`}function es(t,i){const n=(new DOMParser).parseFromString(i,"text/html").body.firstElementChild;for(;t.firstChild;)t.removeChild(t.firstChild);n&&t.appendChild(n)}class rs{constructor(){this.Lt=null,this.Hd=null}tt(t){this.Lt=t}draw(t){t.useMediaCoordinateSpace((t=>{if(!this.Lt)return;const{$d:i,Ud:n,lt:s,Bt:e,Ot:r,qd:h}=this.Lt;this.Hd=t;const l=t.context,a=t.mediaSize.width,o=t.mediaSize.height,_=s[1],u=s[0],c=a/2,d=o/2;i.forEach(((t,i)=>{l.beginPath(),l.arc(c,d,n===i?_+h:_,t.Gd,t.Yd),l.lineTo(c,d),l.closePath(),l.fillStyle=t.V,l.fill(),r>0&&(l.strokeStyle=e,l.lineWidth=r,l.stroke())})),u>0&&(l.globalCompositeOperation="destination-out",l.beginPath(),l.arc(c,d,u,0,2*Math.PI),l.fill(),l.globalCompositeOperation="source-over"),this.Xd(l,a,o)}))}Cr(t,i){if(!this.Lt||!this.Hd)return-1;const{lt:n,qd:s}=this.Lt,e=t-this.Hd.mediaSize.width/2,r=i-this.Hd.mediaSize.height/2,h=Math.sqrt(e*e+r*r),l=Math.atan2(r,e),a=l+2*Math.PI;if(h<=n[1]+s&&h>=n[0]){const t=this.Lt.$d.find((t=>l>=t.Gd&&l<=t.Yd||a>=t.Gd&&a<=t.Yd));if(t)return t.ae}return-1}Xd(t,i,n){if(!this.Lt)return;const{Zd:s,lt:e}=this.Lt,r=i/2,h=n/2;t.textAlign="center",t.textBaseline="top";let l=h-s.reduce(((i,n)=>i+is(t,n).At),0)/2;s.forEach((i=>{const n=is(t,i);t.fillStyle=i.color,t.fillText(e[0]>0?function(t,i,n){const s=t.measureText("…").width;if(s>=n)return"";if(t.measureText(i).width<=n)return i;let e=i.length;for(;t.measureText(i.slice(0,e)).width+s>n;)e--;return i.slice(0,e)+"…"}(t,i.text,1.8*e[0]):i.text,r+n.jd,l+n.Wd),l+=n.At}))}}const hs=Math.PI/180;class ls{constructor(t,i){this.Ls=!0,this.Kd=t,this.Jd=i,this.qs=new rs}wt(){this.Ls=!0}renderer(){return this.Us(),this.qs}Us(){this.Ls&&(this.Js(),this.Ls=!1)}Js(){this.Qd()}tf(t,i,n,s){return s.reduce(((s,e)=>{const r=e.value/t*i;return s+(r<n?n-r:0)}),0)}if(t){if(0===t.data.length)return[{Gd:0,Yd:2*Math.PI,ae:0,nf:t.name,Vt:0,V:t.emptyCircleStyle.color}];const i=t.color,n=t.data.reduce(((t,i)=>t+i.value),0),s=t.data.length,e=1===s?0:t.padAngle*hs,r=e*s,h=2*Math.PI-r;let l=t.startAngle*hs-Math.PI/2,a=this.tf(n,h,t.minAngle*hs,t.data);return t.data.map(((r,o)=>{var _;let u=0===n?h/s:r.value/n*h;const c=t.minAngle*hs;if(u<c)u=c;else if(a>0){const t=u-c;a>t?(a-=t,u=c):(u-=a,a=0)}const d=l+u,f={Gd:l,Yd:d,ae:o,nf:r.name,Vt:r.value,V:(null===(_=r.itemStyle)||void 0===_?void 0:_.color)||i[o%i.length]};return l=d+e,f}))}sf(t){const{show:i,defaultRich:n,formatter:s}=t.label;if(!i)return[];const{hitIndex:e}=this.Kd,{data:r}=this.Kd.data();if(-1!==this.Kd.hitIndex){const t=r[e];return t?s?s(t).map((t=>Object.assign(Object.assign({},Jn),t))):[Object.assign(Object.assign({},Jn),{text:t.name})]:[]}return(null==n?void 0:n.map((t=>Object.assign(Object.assign({},Jn),t))))||[]}Qd(){const t=this.Kd.data(),i=this.Jd.paneSize(),{width:n,height:s}=i,e=this.if(t),r=Math.min(n,s)/2,h=ts(t.radius[1],r),l=ts(t.radius[0],r);this.qs.tt({$d:e,Ud:this.Kd.hitIndex,lt:[l,h],Ot:t.itemStyle.borderWidth,Bt:t.itemStyle.borderColor,Zd:this.sf(t.emphasis),qd:t.emphasis.scaleSize})}}class as{constructor(t,i){var n;this.hitIndex=-1,this.accuratelyHitIndex=-1,this.ef=t=>{this.rf(t)},this.Jd=t,this.Lt=i,this.hitIndex=null!==(n=i.defaultHighlightDataIndex)&&void 0!==n?n:-1,this.hf=[new ls(this,t)],this.Jd.subscribeCrosshairMove(this.ef),this.Jd.subscribeClick(this.ef)}remove(){this.Jd.remove()}data(){return this.Lt}updateAllViews(){this.hf.forEach((t=>t.wt()))}paneViews(){return this.hf}attached({requestUpdate:t}){this.requestUpdate=t}detached(){this.requestUpdate=void 0}applyOptions(t){var i;O(this.Lt,null!=t?t:{}),null===(i=this.requestUpdate)||void 0===i||i.call(this)}setHighlightDataIndex(t){var i;this.hitIndex=t,null===(i=this.requestUpdate)||void 0===i||i.call(this)}getHoverIndex(){return this.accuratelyHitIndex}onHighlight(t){this.lf=t}onMouseMove(t){this.af=t}rf(t){var i,n,s,e,r,h;const{point:l}=t,{defaultHighlightDataIndex:a,data:o}=this.Lt;if(0===o.length)return;const _="number"==typeof a;if(!l)return this.hitIndex=_?a:-1,this.accuratelyHitIndex=-1,null===(i=this.requestUpdate)||void 0===i||i.call(this),null===(n=this.lf)||void 0===n||n.call(this,this.hitIndex),void(null===(s=this.af)||void 0===s||s.call(this,{x:null,y:null,currentIndex:-1,currentItem:null}));for(const t of this.hf){const i=t.renderer();if(null!==i&&i.Cr){const t=i.Cr(l.x,l.y);this.accuratelyHitIndex=t;const n=-1===t&&_?a:t;n!==this.hitIndex&&(this.hitIndex=n,null===(e=this.requestUpdate)||void 0===e||e.call(this),null===(r=this.lf)||void 0===r||r.call(this,this.hitIndex))}}null===(h=this.af)||void 0===h||h.call(this,{x:l.x,y:l.y,currentIndex:this.accuratelyHitIndex,currentItem:o[this.accuratelyHitIndex]})}}function os(t){var i=t.width,n=t.height;if(i<0)throw new Error("Negative width is not allowed for Size");if(n<0)throw new Error("Negative height is not allowed for Size");return{width:i,height:n}}function _s(t,i){return t.width===i.width&&t.height===i.height}var us=function(){function t(t){var i=this;this._resolutionListener=function(){return i._onResolutionChanged()},this._resolutionMediaQueryList=null,this._observers=[],this._window=t,this._installResolutionListener()}return t.prototype.dispose=function(){this._uninstallResolutionListener(),this._window=null},Object.defineProperty(t.prototype,"value",{get:function(){return this._window.devicePixelRatio},enumerable:!1,configurable:!0}),t.prototype.subscribe=function(t){var i=this,n={next:t};return this._observers.push(n),{unsubscribe:function(){i._observers=i._observers.filter((function(t){return t!==n}))}}},t.prototype._installResolutionListener=function(){if(null!==this._resolutionMediaQueryList)throw new Error("Resolution listener is already installed");var t=this._window.devicePixelRatio;this._resolutionMediaQueryList=this._window.matchMedia("all and (resolution: ".concat(t,"dppx)")),this._resolutionMediaQueryList.addListener(this._resolutionListener)},t.prototype._uninstallResolutionListener=function(){null!==this._resolutionMediaQueryList&&(this._resolutionMediaQueryList.removeListener(this._resolutionListener),this._resolutionMediaQueryList=null)},t.prototype._reinstallResolutionListener=function(){this._uninstallResolutionListener(),this._installResolutionListener()},t.prototype._onResolutionChanged=function(){var t=this;this._observers.forEach((function(i){return i.next(t._window.devicePixelRatio)})),this._reinstallResolutionListener()},t}();var cs=function(){function t(t,i,n){var s;this._canvasElement=null,this._bitmapSizeChangedListeners=[],this._suggestedBitmapSize=null,this._suggestedBitmapSizeChangedListeners=[],this._devicePixelRatioObservable=null,this._canvasElementResizeObserver=null,this._canvasElement=t,this._canvasElementClientSize=os({width:this._canvasElement.clientWidth,height:this._canvasElement.clientHeight}),this._transformBitmapSize=null!=i?i:function(t){return t},this._allowResizeObserver=null===(s=null==n?void 0:n.allowResizeObserver)||void 0===s||s,this._chooseAndInitObserver()}return t.prototype.dispose=function(){var t,i;if(null===this._canvasElement)throw new Error("Object is disposed");null===(t=this._canvasElementResizeObserver)||void 0===t||t.disconnect(),this._canvasElementResizeObserver=null,null===(i=this._devicePixelRatioObservable)||void 0===i||i.dispose(),this._devicePixelRatioObservable=null,this._suggestedBitmapSizeChangedListeners.length=0,this._bitmapSizeChangedListeners.length=0,this._canvasElement=null},Object.defineProperty(t.prototype,"canvasElement",{get:function(){if(null===this._canvasElement)throw new Error("Object is disposed");return this._canvasElement},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"canvasElementClientSize",{get:function(){return this._canvasElementClientSize},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bitmapSize",{get:function(){return os({width:this.canvasElement.width,height:this.canvasElement.height})},enumerable:!1,configurable:!0}),t.prototype.resizeCanvasElement=function(t){this._canvasElementClientSize=os(t),this.canvasElement.style.width="".concat(this._canvasElementClientSize.width,"px"),this.canvasElement.style.height="".concat(this._canvasElementClientSize.height,"px"),this._invalidateBitmapSize()},t.prototype.subscribeBitmapSizeChanged=function(t){this._bitmapSizeChangedListeners.push(t)},t.prototype.unsubscribeBitmapSizeChanged=function(t){this._bitmapSizeChangedListeners=this._bitmapSizeChangedListeners.filter((function(i){return i!==t}))},Object.defineProperty(t.prototype,"suggestedBitmapSize",{get:function(){return this._suggestedBitmapSize},enumerable:!1,configurable:!0}),t.prototype.subscribeSuggestedBitmapSizeChanged=function(t){this._suggestedBitmapSizeChangedListeners.push(t)},t.prototype.unsubscribeSuggestedBitmapSizeChanged=function(t){this._suggestedBitmapSizeChangedListeners=this._suggestedBitmapSizeChangedListeners.filter((function(i){return i!==t}))},t.prototype.applySuggestedBitmapSize=function(){if(null!==this._suggestedBitmapSize){var t=this._suggestedBitmapSize;this._suggestedBitmapSize=null,this._resizeBitmap(t),this._emitSuggestedBitmapSizeChanged(t,this._suggestedBitmapSize)}},t.prototype._resizeBitmap=function(t){var i=this.bitmapSize;_s(i,t)||(this.canvasElement.width=t.width,this.canvasElement.height=t.height,this._emitBitmapSizeChanged(i,t))},t.prototype._emitBitmapSizeChanged=function(t,i){var n=this;this._bitmapSizeChangedListeners.forEach((function(s){return s.call(n,t,i)}))},t.prototype._suggestNewBitmapSize=function(t){var i=this._suggestedBitmapSize,n=os(this._transformBitmapSize(t,this._canvasElementClientSize)),s=_s(this.bitmapSize,n)?null:n;null===i&&null===s||null!==i&&null!==s&&_s(i,s)||(this._suggestedBitmapSize=s,this._emitSuggestedBitmapSizeChanged(i,s))},t.prototype._emitSuggestedBitmapSizeChanged=function(t,i){var n=this;this._suggestedBitmapSizeChangedListeners.forEach((function(s){return s.call(n,t,i)}))},t.prototype._chooseAndInitObserver=function(){var t=this;this._allowResizeObserver?new Promise((function(t){var i=new ResizeObserver((function(n){t(n.every((function(t){return"devicePixelContentBoxSize"in t}))),i.disconnect()}));i.observe(document.body,{box:"device-pixel-content-box"})})).catch((function(){return!1})).then((function(i){return i?t._initResizeObserver():t._initDevicePixelRatioObservable()})):this._initDevicePixelRatioObservable()},t.prototype._initDevicePixelRatioObservable=function(){var t=this;if(null!==this._canvasElement){var i=ds(this._canvasElement);if(null===i)throw new Error("No window is associated with the canvas");this._devicePixelRatioObservable=function(t){return new us(t)}(i),this._devicePixelRatioObservable.subscribe((function(){return t._invalidateBitmapSize()})),this._invalidateBitmapSize()}},t.prototype._invalidateBitmapSize=function(){var t,i;if(null!==this._canvasElement){var n=ds(this._canvasElement);if(null!==n){var s=null!==(i=null===(t=this._devicePixelRatioObservable)||void 0===t?void 0:t.value)&&void 0!==i?i:n.devicePixelRatio,e=this._canvasElement.getClientRects(),r=void 0!==e[0]?function(t,i){return os({width:Math.round(t.left*i+t.width*i)-Math.round(t.left*i),height:Math.round(t.top*i+t.height*i)-Math.round(t.top*i)})}(e[0],s):os({width:this._canvasElementClientSize.width*s,height:this._canvasElementClientSize.height*s});this._suggestNewBitmapSize(r)}}},t.prototype._initResizeObserver=function(){var t=this;null!==this._canvasElement&&(this._canvasElementResizeObserver=new ResizeObserver((function(i){var n=i.find((function(i){return i.target===t._canvasElement}));if(n&&n.devicePixelContentBoxSize&&n.devicePixelContentBoxSize[0]){var s=n.devicePixelContentBoxSize[0],e=os({width:s.inlineSize,height:s.blockSize});t._suggestNewBitmapSize(e)}})),this._canvasElementResizeObserver.observe(this._canvasElement,{box:"device-pixel-content-box"}))},t}();function ds(t){return t.ownerDocument.defaultView}var fs=function(){function t(t,i,n){if(0===i.width||0===i.height)throw new TypeError("Rendering target could only be created on a media with positive width and height");if(this._mediaSize=i,0===n.width||0===n.height)throw new TypeError("Rendering target could only be created using a bitmap with positive integer width and height");this._bitmapSize=n,this._context=t}return t.prototype.useMediaCoordinateSpace=function(t){try{return this._context.save(),this._context.setTransform(1,0,0,1,0,0),this._context.scale(this._horizontalPixelRatio,this._verticalPixelRatio),t({context:this._context,mediaSize:this._mediaSize})}finally{this._context.restore()}},t.prototype.useBitmapCoordinateSpace=function(t){try{return this._context.save(),this._context.setTransform(1,0,0,1,0,0),t({context:this._context,mediaSize:this._mediaSize,bitmapSize:this._bitmapSize,horizontalPixelRatio:this._horizontalPixelRatio,verticalPixelRatio:this._verticalPixelRatio})}finally{this._context.restore()}},Object.defineProperty(t.prototype,"_horizontalPixelRatio",{get:function(){return this._bitmapSize.width/this._mediaSize.width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_verticalPixelRatio",{get:function(){return this._bitmapSize.height/this._mediaSize.height},enumerable:!1,configurable:!0}),t}();function vs(t,i){var n=t.canvasElementClientSize;if(0===n.width||0===n.height)return null;var s=t.bitmapSize;if(0===s.width||0===s.height)return null;var e=t.canvasElement.getContext("2d",i);return null===e?null:new fs(e,n,s)}const ps="undefined"!=typeof window;function ms(){return!!ps&&window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1}function bs(){return!!ps&&/iPhone|iPad|iPod/.test(window.navigator.platform)}function ws(t){0}function gs(t){return t+t%2}function Ms(t,i){return t._f-i._f}function xs(t,i,n){const s=(t._f-i._f)/(t._t-i._t);return Math.sign(s)*Math.min(Math.abs(s),n)}class Ss{constructor(t,i,n,s){this.uf=null,this.cf=null,this.df=null,this.ff=null,this.vf=null,this.pf=0,this.mf=0,this.bf=t,this.wf=i,this.gf=n,this.hs=s}Mf(t,i){if(null!==this.uf){if(this.uf._t===i)return void(this.uf._f=t);if(Math.abs(this.uf._f-t)<this.hs)return}this.ff=this.df,this.df=this.cf,this.cf=this.uf,this.uf={_t:i,_f:t}}Ir(t,i){if(null===this.uf||null===this.cf)return;if(i-this.uf._t>50)return;let n=0;const s=xs(this.uf,this.cf,this.wf),e=Ms(this.uf,this.cf),r=[s],h=[e];if(n+=e,null!==this.df){const t=xs(this.cf,this.df,this.wf);if(Math.sign(t)===Math.sign(s)){const i=Ms(this.cf,this.df);if(r.push(t),h.push(i),n+=i,null!==this.ff){const t=xs(this.df,this.ff,this.wf);if(Math.sign(t)===Math.sign(s)){const i=Ms(this.df,this.ff);r.push(t),h.push(i),n+=i}}}}let l=0;for(let t=0;t<r.length;++t)l+=h[t]/n*r[t];Math.abs(l)<this.bf||(this.vf={_f:t,_t:i},this.mf=l,this.pf=function(t,i){const n=Math.log(i);return Math.log(1*n/-t)/n}(Math.abs(l),this.gf))}hc(t){const i=p(this.vf),n=t-i._t;return i._f+this.mf*(Math.pow(this.gf,n)-1)/Math.log(this.gf)}rc(t){return null===this.vf||this.xf(t)===this.pf}xf(t){const i=t-p(this.vf)._t;return Math.min(i,this.pf)}}function ys(t,i){const n=p(t.ownerDocument).createElement("canvas");t.appendChild(n);const s=function(t,i){if("device-pixel-content-box"===i.type)return new cs(t,i.transform,i.options);throw new Error("Unsupported binding target")}(n,{type:"device-pixel-content-box",options:{allowResizeObserver:!1},transform:(t,i)=>({width:Math.max(t.width,i.width),height:Math.max(t.height,i.height)})});return s.resizeCanvasElement(i),s}function Cs(t){var i;t.width=1,t.height=1,null===(i=t.getContext("2d"))||void 0===i||i.clearRect(0,0,1,1)}function ks(t,i,n,s){t.Cl&&t.Cl(i,n,s)}function Ps(t,i,n,s){t.Z(i,n,s)}function Ts(t,i,n,s){const e=t(n,s);for(const t of e){const n=t.Mt();null!==n&&i(n)}}function Os(t){ps&&void 0!==window.chrome&&t.addEventListener("mousedown",(t=>{if(1===t.button)return t.preventDefault(),!1}))}class Rs{constructor(t,i,n){this.Sf=0,this.yf=null,this.Cf={st:Number.NEGATIVE_INFINITY,et:Number.POSITIVE_INFINITY},this.kf=0,this.Pf=null,this.Tf={st:Number.NEGATIVE_INFINITY,et:Number.POSITIVE_INFINITY},this.Of=null,this.Rf=!1,this.Df=null,this.Vf=null,this.Bf=!1,this.zf=!1,this.Af=!1,this.If=null,this.Lf=null,this.Ff=null,this.Ef=null,this.Nf=null,this.jf=null,this.Wf=null,this.Hf=0,this.$f=!1,this.Uf=!1,this.qf=!1,this.Gf=0,this.Yf=null,this.Xf=!bs(),this.Zf=t=>{this.Kf(t)},this.Jf=t=>{if(this.Qf(t)){const i=this.tv(t);if(++this.kf,this.Pf&&this.kf>1){const{iv:n}=this.nv(Bs(t),this.Tf);n<30&&!this.Af&&this.sv(i,this.rv.ev),this.hv()}}else{const i=this.tv(t);if(++this.Sf,this.yf&&this.Sf>1){const{iv:n}=this.nv(Bs(t),this.Cf);n<5&&!this.zf&&this.lv(i,this.rv.av),this.ov()}}},this._v=t,this.rv=i,this.dn=n,this.uv()}C(){null!==this.If&&(this.If(),this.If=null),null!==this.Lf&&(this.Lf(),this.Lf=null),null!==this.Ef&&(this.Ef(),this.Ef=null),null!==this.Nf&&(this.Nf(),this.Nf=null),null!==this.jf&&(this.jf(),this.jf=null),null!==this.Ff&&(this.Ff(),this.Ff=null),this.cv(),this.ov()}dv(t){this.Ef&&this.Ef();const i=this.fv.bind(this);if(this.Ef=()=>{this._v.removeEventListener("mousemove",i)},this._v.addEventListener("mousemove",i),this.Qf(t))return;const n=this.tv(t);this.lv(n,this.rv.vv),this.Xf=!0}ov(){null!==this.yf&&clearTimeout(this.yf),this.Sf=0,this.yf=null,this.Cf={st:Number.NEGATIVE_INFINITY,et:Number.POSITIVE_INFINITY}}hv(){null!==this.Pf&&clearTimeout(this.Pf),this.kf=0,this.Pf=null,this.Tf={st:Number.NEGATIVE_INFINITY,et:Number.POSITIVE_INFINITY}}fv(t){if(this.qf||null!==this.Vf)return;if(this.Qf(t))return;const i=this.tv(t);this.lv(i,this.rv.pv),this.Xf=!0}mv(t){const i=As(t.changedTouches,p(this.Yf));if(null===i)return;if(this.Gf=zs(t),null!==this.Wf)return;if(this.Uf)return;this.$f=!0;const n=this.nv(Bs(i),p(this.Vf)),{jd:s,Wd:e,iv:r}=n;if(this.Bf||!(r<5)){if(!this.Bf){const t=.5*s,i=e>=t&&!this.dn.bv(),n=t>e&&!this.dn.wv();i||n||(this.Uf=!0),this.Bf=!0,this.Af=!0,this.cv(),this.hv()}if(!this.Uf){const n=this.tv(t,i);this.sv(n,this.rv.gv),Vs(t)}}}Mv(t){if(0!==t.button)return;const i=this.nv(Bs(t),p(this.Df)),{iv:n}=i;if(n>=5&&(this.zf=!0,this.ov()),this.zf){const i=this.tv(t);this.lv(i,this.rv.xv)}}nv(t,i){const n=Math.abs(i.st-t.st),s=Math.abs(i.et-t.et);return{jd:n,Wd:s,iv:n+s}}Sv(t){let i=As(t.changedTouches,p(this.Yf));if(null===i&&0===t.touches.length&&(i=t.changedTouches[0]),null===i)return;this.Yf=null,this.Gf=zs(t),this.cv(),this.Vf=null,this.jf&&(this.jf(),this.jf=null);const n=this.tv(t,i);if(this.sv(n,this.rv.yv),++this.kf,this.Pf&&this.kf>1){const{iv:t}=this.nv(Bs(i),this.Tf);t<30&&!this.Af&&this.sv(n,this.rv.ev),this.hv()}else this.Af||(this.sv(n,this.rv.Cv),this.rv.Cv&&Vs(t));0===this.kf&&Vs(t),0===t.touches.length&&this.Rf&&(this.Rf=!1,Vs(t))}Kf(t){if(0!==t.button)return;const i=this.tv(t);if(this.Df=null,this.qf=!1,this.Nf&&(this.Nf(),this.Nf=null),ms()){this._v.ownerDocument.documentElement.removeEventListener("mouseleave",this.Zf)}if(!this.Qf(t))if(this.lv(i,this.rv.kv),++this.Sf,this.yf&&this.Sf>1){const{iv:n}=this.nv(Bs(t),this.Cf);n<5&&!this.zf&&this.lv(i,this.rv.av),this.ov()}else this.zf||this.lv(i,this.rv.Pv)}cv(){null!==this.Of&&(clearTimeout(this.Of),this.Of=null)}Tv(t){if(null!==this.Yf)return;const i=t.changedTouches[0];this.Yf=i.identifier,this.Gf=zs(t);const n=this._v.ownerDocument.documentElement;this.Af=!1,this.Bf=!1,this.Uf=!1,this.Vf=Bs(i),this.jf&&(this.jf(),this.jf=null);{const i=this.mv.bind(this),s=this.Sv.bind(this);this.jf=()=>{n.removeEventListener("touchmove",i),n.removeEventListener("touchend",s)},n.addEventListener("touchmove",i,{passive:!1}),n.addEventListener("touchend",s,{passive:!1}),this.cv(),this.Of=setTimeout(this.Ov.bind(this,t),240)}const s=this.tv(t,i);this.sv(s,this.rv.Rv),this.Pf||(this.kf=0,this.Pf=setTimeout(this.hv.bind(this),500),this.Tf=Bs(i))}Dv(t){if(0!==t.button)return;const i=this._v.ownerDocument.documentElement;ms()&&i.addEventListener("mouseleave",this.Zf),this.zf=!1,this.Df=Bs(t),this.Nf&&(this.Nf(),this.Nf=null);{const t=this.Mv.bind(this),n=this.Kf.bind(this);this.Nf=()=>{i.removeEventListener("mousemove",t),i.removeEventListener("mouseup",n)},i.addEventListener("mousemove",t),i.addEventListener("mouseup",n)}if(this.qf=!0,this.Qf(t))return;const n=this.tv(t);this.lv(n,this.rv.Vv),this.yf||(this.Sf=0,this.yf=setTimeout(this.ov.bind(this),500),this.Cf=Bs(t))}uv(){this._v.addEventListener("mouseenter",this.dv.bind(this)),this._v.addEventListener("touchcancel",this.cv.bind(this));{const t=this._v.ownerDocument,i=t=>{this.rv.Bv&&(t.composed&&this._v.contains(t.composedPath()[0])||t.target&&this._v.contains(t.target)||this.rv.Bv())};this.Lf=()=>{t.removeEventListener("touchstart",i)},this.If=()=>{t.removeEventListener("mousedown",i)},t.addEventListener("mousedown",i),t.addEventListener("touchstart",i,{passive:!0})}bs()&&(this.Ff=()=>{this._v.removeEventListener("dblclick",this.Jf)},this._v.addEventListener("dblclick",this.Jf)),this._v.addEventListener("mouseleave",this.zv.bind(this)),this._v.addEventListener("touchstart",this.Tv.bind(this),{passive:!0}),Os(this._v),this._v.addEventListener("mousedown",this.Dv.bind(this)),this.Av(),this._v.addEventListener("touchmove",(()=>{}),{passive:!1})}Av(){void 0===this.rv.Iv&&void 0===this.rv.Lv&&void 0===this.rv.Fv||(this._v.addEventListener("touchstart",(t=>this.Ev(t.touches)),{passive:!0}),this._v.addEventListener("touchmove",(t=>{if(2===t.touches.length&&null!==this.Wf&&void 0!==this.rv.Lv){const i=Ds(t.touches[0],t.touches[1])/this.Hf;this.rv.Lv(this.Wf,i),Vs(t)}}),{passive:!1}),this._v.addEventListener("touchend",(t=>{this.Ev(t.touches)})))}Ev(t){1===t.length&&(this.$f=!1),2!==t.length||this.$f||this.Rf?this.Nv():this.jv(t)}jv(t){const i=this._v.getBoundingClientRect()||{left:0,top:0};this.Wf={st:(t[0].clientX-i.left+(t[1].clientX-i.left))/2,et:(t[0].clientY-i.top+(t[1].clientY-i.top))/2},this.Hf=Ds(t[0],t[1]),void 0!==this.rv.Iv&&this.rv.Iv(),this.cv()}Nv(){null!==this.Wf&&(this.Wf=null,void 0!==this.rv.Fv&&this.rv.Fv())}zv(t){if(this.Ef&&this.Ef(),this.Qf(t))return;if(!this.Xf)return;const i=this.tv(t);this.lv(i,this.rv.Wv),this.Xf=!bs()}Ov(t){const i=As(t.touches,p(this.Yf));if(null===i)return;const n=this.tv(t,i);this.sv(n,this.rv.Hv),this.Af=!0,this.Rf=!0}Qf(t){return t.sourceCapabilities&&void 0!==t.sourceCapabilities.firesTouchEvents?t.sourceCapabilities.firesTouchEvents:zs(t)<this.Gf+500}sv(t,i){i&&i.call(this.rv,t)}lv(t,i){i&&i.call(this.rv,t)}tv(t,i){const n=i||t,s=this._v.getBoundingClientRect()||{left:0,top:0};return{clientX:n.clientX,clientY:n.clientY,pageX:n.pageX,pageY:n.pageY,screenX:n.screenX,screenY:n.screenY,localX:n.clientX-s.left,localY:n.clientY-s.top,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,metaKey:t.metaKey,$v:!t.type.startsWith("mouse")&&"contextmenu"!==t.type&&"click"!==t.type,Uv:t.type,qv:n.target,Gv:t.view,Yv:()=>{"touchstart"!==t.type&&Vs(t)}}}}function Ds(t,i){const n=t.clientX-i.clientX,s=t.clientY-i.clientY;return Math.sqrt(n*n+s*s)}function Vs(t){t.cancelable&&t.preventDefault()}function Bs(t){return{st:t.pageX,et:t.pageY}}function zs(t){return t.timeStamp||performance.now()}function As(t,i){for(let n=0;n<t.length;++n)if(t[n].identifier===i)return t[n];return null}function Is(t){return{Yc:t.Yc,Xv:{kr:t.Zv.externalId},Kv:t.Zv.cursorStyle}}function Ls(t,i,n){for(const s of t){const t=s.Mt();if(null!==t&&t.Cr){const e=t.Cr(i,n);if(null!==e)return{Gv:s,Xv:e}}}return null}function Fs(t,i){return n=>{var s,e,r,h;return(null!==(e=null===(s=n.Dt())||void 0===s?void 0:s.Ba())&&void 0!==e?e:"")!==i?[]:null!==(h=null===(r=n.ba)||void 0===r?void 0:r.call(n,t))&&void 0!==h?h:[]}}class Es{constructor(t,i,n,s){this.Fi=null,this.Jv=null,this.Qv=!1,this.tp=new Jt(200),this.eh=null,this.ip=0,this.np=!1,this.sp=()=>{this.np||this.nn.ep().Ut().Zh()},this.rp=()=>{this.np||this.nn.ep().Ut().Zh()},this.nn=t,this.dn=i,this.Oo=i.layout,this.Lc=n,this.hp="left"===s,this.lp=Fs("normal",s),this.ap=Fs("top",s),this.op=Fs("bottom",s),this._p=document.createElement("div"),this._p.style.height="100%",this._p.style.overflow="hidden",this._p.style.width="25px",this._p.style.left="0",this._p.style.position="relative",this.up=ys(this._p,os({width:16,height:16})),this.up.subscribeSuggestedBitmapSizeChanged(this.sp);const e=this.up.canvasElement;e.style.position="absolute",e.style.zIndex="1",e.style.left="0",e.style.top="0",this.cp=ys(this._p,os({width:16,height:16})),this.cp.subscribeSuggestedBitmapSizeChanged(this.rp);const r=this.cp.canvasElement;r.style.position="absolute",r.style.zIndex="2",r.style.left="0",r.style.top="0";const h={Vv:this.dp.bind(this),Rv:this.dp.bind(this),xv:this.fp.bind(this),gv:this.fp.bind(this),Bv:this.vp.bind(this),kv:this.pp.bind(this),yv:this.pp.bind(this),av:this.mp.bind(this),ev:this.mp.bind(this),vv:this.bp.bind(this),Wv:this.wp.bind(this)};this.gp=new Rs(this.cp.canvasElement,h,{bv:()=>!this.dn.handleScroll.vertTouchDrag,wv:()=>!0})}C(){this.gp.C(),this.cp.unsubscribeSuggestedBitmapSizeChanged(this.rp),Cs(this.cp.canvasElement),this.cp.dispose(),this.up.unsubscribeSuggestedBitmapSizeChanged(this.sp),Cs(this.up.canvasElement),this.up.dispose(),null!==this.Fi&&this.Fi.i_().m(this),this.Fi=null}Mp(){return this._p}O(){return this.Oo.fontSize}xp(){const t=this.Lc.W();return this.eh!==t.R&&(this.tp.lr(),this.eh=t.R),t}Sp(){if(null===this.Fi)return 0;let t=0;const i=this.xp(),n=p(this.up.canvasElement.getContext("2d"));n.save();const s=this.Fi.Ya();n.font=this.yp(),s.length>0&&(t=Math.max(this.tp.Si(n,s[0].ao),this.tp.Si(n,s[s.length-1].ao)));const e=this.Cp();for(let i=e.length;i--;){const s=this.tp.Si(n,e[i].Kt());s>t&&(t=s)}const r=this.Fi.Pt();if(null!==r&&null!==this.Jv){const i=this.Fi.mn(1,r),s=this.Fi.mn(this.Jv.height-2,r);t=Math.max(t,this.tp.Si(n,this.Fi.ji(Math.floor(Math.min(i,s))+.11111111111111,r)),this.tp.Si(n,this.Fi.ji(Math.ceil(Math.max(i,s))-.11111111111111,r)))}n.restore();const h=t||34;return gs(Math.ceil(i.P+i.T+i.I+i.L+5+h))}kp(t){null!==this.Jv&&_s(this.Jv,t)||(this.Jv=t,this.np=!0,this.up.resizeCanvasElement(t),this.cp.resizeCanvasElement(t),this.np=!1,this._p.style.width=`${t.width}px`,this._p.style.height=`${t.height}px`)}Pp(){return p(this.Jv).width}Ji(t){this.Fi!==t&&(null!==this.Fi&&this.Fi.i_().m(this),this.Fi=t,t.i_().l(this.wo.bind(this),this))}Dt(){return this.Fi}lr(){const t=this.nn.Tp();this.nn.ep().Ut().H_(t,p(this.Dt()))}Op(t){if(null===this.Jv)return;if(1!==t){this.Rp(),this.up.applySuggestedBitmapSize();const t=vs(this.up);null!==t&&(t.useBitmapCoordinateSpace((t=>{this.Dp(t),this.Ee(t)})),this.nn.Vp(t,this.op),this.Bp(t),this.nn.Vp(t,this.lp),this.zp(t))}this.cp.applySuggestedBitmapSize();const i=vs(this.cp);null!==i&&(i.useBitmapCoordinateSpace((({context:t,bitmapSize:i})=>{t.clearRect(0,0,i.width,i.height)})),this.Ap(i),this.nn.Vp(i,this.ap))}Ip(){return this.up.bitmapSize}Lp(t,i,n){const s=this.Ip();s.width>0&&s.height>0&&t.drawImage(this.up.canvasElement,i,n)}wt(){var t;null===(t=this.Fi)||void 0===t||t.Ya()}dp(t){if(null===this.Fi||this.Fi.Ni()||!this.dn.handleScale.axisPressedMouseMove.price)return;const i=this.nn.ep().Ut(),n=this.nn.Tp();this.Qv=!0,i.I_(n,this.Fi,t.localY)}fp(t){if(null===this.Fi||!this.dn.handleScale.axisPressedMouseMove.price)return;const i=this.nn.ep().Ut(),n=this.nn.Tp(),s=this.Fi;i.L_(n,s,t.localY)}vp(){if(null===this.Fi||!this.dn.handleScale.axisPressedMouseMove.price)return;const t=this.nn.ep().Ut(),i=this.nn.Tp(),n=this.Fi;this.Qv&&(this.Qv=!1,t.F_(i,n))}pp(t){if(null===this.Fi||!this.dn.handleScale.axisPressedMouseMove.price)return;const i=this.nn.ep().Ut(),n=this.nn.Tp();this.Qv=!1,i.F_(n,this.Fi)}mp(t){this.dn.handleScale.axisDoubleClickReset.price&&this.lr()}bp(t){if(null===this.Fi)return;!this.nn.ep().Ut().W().handleScale.axisPressedMouseMove.price||this.Fi.kh()||this.Fi.Lo()||this.Fp(1)}wp(t){this.Fp(0)}Cp(){const t=[],i=null===this.Fi?void 0:this.Fi;return(n=>{for(let s=0;s<n.length;++s){const e=n[s].Rn(this.nn.Tp(),i);for(let i=0;i<e.length;i++)t.push(e[i])}})(this.nn.Tp().Zo()),t}Dp({context:t,bitmapSize:i}){const{width:n,height:s}=i,e=this.nn.Tp().Ut(),r=e.G(),h=e.Sd();r===h?X(t,0,0,n,s,r):Q(t,0,0,n,s,r,h)}Ee({context:t,bitmapSize:i,horizontalPixelRatio:n}){if(null===this.Jv||null===this.Fi||!this.Fi.W().borderVisible)return;t.fillStyle=this.Fi.W().borderColor;const s=Math.max(1,Math.floor(this.xp().P*n));let e;e=this.hp?i.width-s:0,t.fillRect(e,0,s,i.height)}Bp(t){if(null===this.Jv||null===this.Fi)return;const i=this.Fi.Ya(),n=this.Fi.W(),s=this.xp(),e=this.hp?this.Jv.width-s.T:0;n.borderVisible&&n.ticksVisible&&t.useBitmapCoordinateSpace((({context:t,horizontalPixelRatio:r,verticalPixelRatio:h})=>{t.fillStyle=n.borderColor;const l=Math.max(1,Math.floor(h)),a=Math.floor(.5*h),o=Math.round(s.T*r);t.beginPath();for(const n of i)t.rect(Math.floor(e*r),Math.round(n.Ha*h)-a,o,l);t.fill()})),t.useMediaCoordinateSpace((({context:t})=>{var r;t.font=this.yp(),t.fillStyle=null!==(r=n.textColor)&&void 0!==r?r:this.Oo.textColor,t.textAlign=this.hp?"right":"left",t.textBaseline="middle";const h=this.hp?Math.round(e-s.I):Math.round(e+s.T+s.I),l=i.map((i=>this.tp.xi(t,i.ao)));for(let n=i.length;n--;){const s=i[n];t.fillText(s.ao,h,s.Ha+l[n])}}))}Rp(){if(null===this.Jv||null===this.Fi)return;let t=this.Jv.height/2;const i=[],n=this.Fi.Zo().slice(),s=this.nn.Tp(),e=this.xp();this.Fi===s.Mr()&&this.nn.Tp().Zo().forEach((t=>{s.gr(t)&&n.push(t)}));const r=this.Fi.Fa()[0],h=this.Fi;n.forEach((n=>{const e=n.Rn(s,h);e.forEach((t=>{t.Bi(null),t.zi()&&i.push(t)})),r===n&&e.length>0&&(t=e[0].Ci())})),i.forEach((t=>t.Bi(t.Ci())));this.Fi.W().alignLabels&&this.Ep(i,e,t)}Ep(t,i,n){if(null===this.Jv)return;const s=t.filter((t=>t.Ci()<=n)),e=t.filter((t=>t.Ci()>n));s.sort(((t,i)=>i.Ci()-t.Ci())),s.length&&e.length&&e.push(s[0]),e.sort(((t,i)=>t.Ci()-i.Ci()));for(const n of t){const t=Math.floor(n.At(i)/2),s=n.Ci();s>-t&&s<t&&n.Bi(t),s>this.Jv.height-t&&s<this.Jv.height+t&&n.Bi(this.Jv.height-t)}for(let t=1;t<s.length;t++){const n=s[t],e=s[t-1],r=e.At(i,!1),h=n.Ci(),l=e.Vi();h>l-r&&n.Bi(l-r)}for(let t=1;t<e.length;t++){const n=e[t],s=e[t-1],r=s.At(i,!0),h=n.Ci(),l=s.Vi();h<l+r&&n.Bi(l+r)}}zp(t){if(null===this.Jv)return;const i=this.Cp(),n=this.xp(),s=this.hp?"right":"left";i.forEach((i=>{if(i.Ai()){i.Mt(p(this.Fi)).Z(t,n,this.tp,s)}}))}Ap(t){if(null===this.Jv||null===this.Fi)return;const i=this.nn.ep().Ut(),n=[],s=this.nn.Tp(),e=i.Qc().Rn(s,this.Fi);e.length&&n.push(e);const r=this.xp(),h=this.hp?"right":"left";n.forEach((i=>{i.forEach((i=>{i.Mt(p(this.Fi)).Z(t,r,this.tp,h)}))}))}Fp(t){this._p.style.cursor=1===t?"ns-resize":"default"}wo(){const t=this.Sp();this.ip<t&&this.nn.ep().Ut().ia(),this.ip=t}yp(){return F(this.Oo.fontSize,this.Oo.fontFamily)}}function Ns(t,i){var n,s;return null!==(s=null===(n=t.pa)||void 0===n?void 0:n.call(t,i))&&void 0!==s?s:[]}function js(t,i){var n,s;return null!==(s=null===(n=t.On)||void 0===n?void 0:n.call(t,i))&&void 0!==s?s:[]}function Ws(t,i){var n,s;return null!==(s=null===(n=t.Qi)||void 0===n?void 0:n.call(t,i))&&void 0!==s?s:[]}function Hs(t,i){var n,s;return null!==(s=null===(n=t.da)||void 0===n?void 0:n.call(t,i))&&void 0!==s?s:[]}class $s{constructor(t,i){this.Jv=os({width:0,height:0}),this.Np=null,this.jp=null,this.Wp=null,this.Hp=!1,this.$p=new T,this.Up=new T,this.qp=0,this.Gp=!1,this.Yp=null,this.Xp=!1,this.Zp=null,this.Kp=null,this.np=!1,this.sp=()=>{this.np||null===this.Jp||this.Ui().Zh()},this.rp=()=>{this.np||null===this.Jp||this.Ui().Zh()},this.Jd=t,this.Jp=i,this.Jp.G_().l(this.Qp.bind(this),this,!0),this.tm=document.createElement("td"),this.tm.style.padding="0",this.tm.style.position="relative";const n=document.createElement("div");n.style.width="100%",n.style.height="100%",n.style.position="relative",n.style.overflow="hidden",this.im=document.createElement("td"),this.im.style.padding="0",this.nm=document.createElement("td"),this.nm.style.padding="0",this.tm.appendChild(n),this.up=ys(n,os({width:16,height:16})),this.up.subscribeSuggestedBitmapSizeChanged(this.sp);const s=this.up.canvasElement;s.style.position="absolute",s.style.zIndex="1",s.style.left="0",s.style.top="0",this.cp=ys(n,os({width:16,height:16})),this.cp.subscribeSuggestedBitmapSizeChanged(this.rp);const e=this.cp.canvasElement;e.style.position="absolute",e.style.zIndex="2",e.style.left="0",e.style.top="0",this.sm=document.createElement("tr"),this.sm.appendChild(this.im),this.sm.appendChild(this.tm),this.sm.appendChild(this.nm),this.rm(),this.gp=new Rs(this.cp.canvasElement,this,{bv:()=>null===this.Yp&&!this.Jd.W().handleScroll.vertTouchDrag,wv:()=>null===this.Yp&&!this.Jd.W().handleScroll.horzTouchDrag})}C(){null!==this.Np&&this.Np.C(),null!==this.jp&&this.jp.C(),this.cp.unsubscribeSuggestedBitmapSizeChanged(this.rp),Cs(this.cp.canvasElement),this.cp.dispose(),this.up.unsubscribeSuggestedBitmapSizeChanged(this.sp),Cs(this.up.canvasElement),this.up.dispose(),null!==this.Jp&&this.Jp.G_().m(this),this.gp.C()}Tp(){return p(this.Jp)}hm(t){null!==this.Jp&&this.Jp.G_().m(this),this.Jp=t,null!==this.Jp&&this.Jp.G_().l($s.prototype.Qp.bind(this),this,!0),this.rm()}ep(){return this.Jd}Mp(){return this.sm}rm(){if(null!==this.Jp&&(this.lm(),0!==this.Ui().gt().length)){if(null!==this.Np){const t=this.Jp.z_();this.Np.Ji(p(t))}if(null!==this.jp){const t=this.Jp.A_();this.jp.Ji(p(t))}}}am(){null!==this.Np&&this.Np.wt(),null!==this.jp&&this.jp.wt()}k_(){return null!==this.Jp?this.Jp.k_():0}P_(t){this.Jp&&this.Jp.P_(t)}vv(t){if(!this.Jp)return;this.om();const i=t.localX,n=t.localY;this._m(i,n,t)}Vv(t){this.om(),this.um(),this._m(t.localX,t.localY,t)}pv(t){var i;if(!this.Jp)return;this.om();const n=t.localX,s=t.localY;this._m(n,s,t);const e=this.Cr(n,s);this.Jd.dm(null!==(i=null==e?void 0:e.Kv)&&void 0!==i?i:null),this.Ui().Gc(e&&{Yc:e.Yc,Xv:e.Xv})}Pv(t){null!==this.Jp&&(this.om(),this.fm(t))}av(t){null!==this.Jp&&this.vm(this.Up,t)}ev(t){this.av(t)}xv(t){this.om(),this.pm(t),this._m(t.localX,t.localY,t)}kv(t){null!==this.Jp&&(this.om(),this.Gp=!1,this.bm(t))}Cv(t){null!==this.Jp&&this.fm(t)}Hv(t){if(this.Gp=!0,null===this.Yp){const i={x:t.localX,y:t.localY};this.wm(i,i,t)}}Wv(t){null!==this.Jp&&(this.om(),this.Jp.Ut().Gc(null),this.gm())}Mm(){return this.$p}xm(){return this.Up}Iv(){this.qp=1,this.Ui().qn()}Lv(t,i){if(!this.Jd.W().handleScale.pinch)return;const n=5*(i-this.qp);this.qp=i,this.Ui().rd(t.st,n)}Rv(t){this.Gp=!1,this.Xp=null!==this.Yp,this.um();const i=this.Ui().Qc();null!==this.Yp&&i.kt()&&(this.Zp={x:i.Yt(),y:i.Xt()},this.Yp={x:t.localX,y:t.localY})}gv(t){if(null===this.Jp)return;const i=t.localX,n=t.localY;if(null===this.Yp)this.pm(t);else{this.Xp=!1;const s=p(this.Zp),e=s.x+(i-this.Yp.x),r=s.y+(n-this.Yp.y);this._m(e,r,t)}}yv(t){0===this.ep().W().trackingMode.exitMode&&(this.Xp=!0),this.Sm(),this.bm(t)}Cr(t,i){const n=this.Jp;return null===n?null:function(t,i,n){const s=t.Zo(),e=function(t,i,n){var s,e;let r,h;for(const o of t){const t=null!==(e=null===(s=o.ga)||void 0===s?void 0:s.call(o,i,n))&&void 0!==e?e:[];for(const i of t)l=i.zOrder,(!(a=null==r?void 0:r.zOrder)||"top"===l&&"top"!==a||"normal"===l&&"bottom"===a)&&(r=i,h=o)}var l,a;return r&&h?{Zv:r,Yc:h}:null}(s,i,n);if("top"===(null==e?void 0:e.Zv.zOrder))return Is(e);for(const r of s){if(e&&e.Yc===r&&"bottom"!==e.Zv.zOrder&&!e.Zv.isBackground)return Is(e);const s=Ls(r.On(t),i,n);if(null!==s)return{Yc:r,Gv:s.Gv,Xv:s.Xv};if(e&&e.Yc===r&&"bottom"!==e.Zv.zOrder&&e.Zv.isBackground)return Is(e)}return(null==e?void 0:e.Zv)?Is(e):null}(n,t,i)}ym(t,i){p("left"===i?this.Np:this.jp).kp(os({width:t,height:this.Jv.height}))}Cm(){return this.Jv}kp(t){_s(this.Jv,t)||(this.Jv=t,this.np=!0,this.up.resizeCanvasElement(t),this.cp.resizeCanvasElement(t),this.np=!1,this.tm.style.width=t.width+"px",this.tm.style.height=t.height+"px")}km(){const t=p(this.Jp);t.B_(t.z_()),t.B_(t.A_());for(const i of t.Fa())if(t.gr(i)){const n=i.Dt();null!==n&&t.B_(n),i.Vn()}}Ip(){return this.up.bitmapSize}Lp(t,i,n){const s=this.Ip();s.width>0&&s.height>0&&t.drawImage(this.up.canvasElement,i,n)}Op(t){if(0===t)return;if(null===this.Jp)return;if(t>1&&this.km(),null!==this.Np&&this.Np.Op(t),null!==this.jp&&this.jp.Op(t),1!==t){this.up.applySuggestedBitmapSize();const t=vs(this.up);null!==t&&(t.useBitmapCoordinateSpace((t=>{this.Dp(t)})),this.Jp&&(this.Pm(t,Ns),this.Tm(t),this.Om(t),this.Pm(t,js),this.Pm(t,Ws)))}this.cp.applySuggestedBitmapSize();const i=vs(this.cp);null!==i&&(i.useBitmapCoordinateSpace((({context:t,bitmapSize:i})=>{t.clearRect(0,0,i.width,i.height)})),this.Rm(i),this.Pm(i,Hs))}Dm(){return this.Np}Vm(){return this.jp}Vp(t,i){this.Pm(t,i)}Qp(){null!==this.Jp&&this.Jp.G_().m(this),this.Jp=null}fm(t){this.vm(this.$p,t)}vm(t,i){const n=i.localX,s=i.localY;t.S()&&t.M(this.Ui().yt().$u(n),{x:n,y:s},i)}Dp({context:t,bitmapSize:i}){const{width:n,height:s}=i,e=this.Ui(),r=e.G(),h=e.Sd();r===h?X(t,0,0,n,s,h):Q(t,0,0,n,s,r,h)}Tm(t){const i=p(this.Jp).Y_().Kh().Mt();null!==i&&i.Z(t,!1)}Om(t){const i=this.Ui().Jc();this.Bm(t,js,ks,i),this.Bm(t,js,Ps,i)}Rm(t){this.Bm(t,js,Ps,this.Ui().Qc())}Pm(t,i){const n=p(this.Jp).Zo();for(const s of n)this.Bm(t,i,ks,s);for(const s of n)this.Bm(t,i,Ps,s)}Bm(t,i,n,s){const e=p(this.Jp),r=e.Ut().qc(),h=null!==r&&r.Yc===s,l=null!==r&&h&&void 0!==r.Xv?r.Xv.Pr:void 0;Ts(i,(i=>n(i,t,h,l)),s,e)}lm(){if(null===this.Jp)return;const t=this.Jd,i=this.Jp.z_().W().visible,n=this.Jp.A_().W().visible;i||null===this.Np||(this.im.removeChild(this.Np.Mp()),this.Np.C(),this.Np=null),n||null===this.jp||(this.nm.removeChild(this.jp.Mp()),this.jp.C(),this.jp=null);const s=t.Ut().md();i&&null===this.Np&&(this.Np=new Es(this,t.W(),s,"left"),this.im.appendChild(this.Np.Mp())),n&&null===this.jp&&(this.jp=new Es(this,t.W(),s,"right"),this.nm.appendChild(this.jp.Mp()))}zm(t){return t.$v&&this.Gp||null!==this.Yp}Am(t){return Math.max(0,Math.min(t,this.Jv.width-1))}Im(t){return Math.max(0,Math.min(t,this.Jv.height-1))}_m(t,i,n){this.Ui().dd(this.Am(t),this.Im(i),n,p(this.Jp))}gm(){this.Ui().vd()}Sm(){this.Xp&&(this.Yp=null,this.gm())}wm(t,i,n){this.Yp=t,this.Xp=!1,this._m(i.x,i.y,n);const s=this.Ui().Qc();this.Zp={x:s.Yt(),y:s.Xt()}}Ui(){return this.Jd.Ut()}bm(t){if(!this.Hp)return;const i=this.Ui(),n=this.Tp();if(i.j_(n,n.pn()),this.Wp=null,this.Hp=!1,i.od(),null!==this.Kp){const t=performance.now(),n=i.yt();this.Kp.Ir(n.Yu(),t),this.Kp.rc(t)||i.Xn(this.Kp)}}om(){this.Yp=null}um(){if(!this.Jp)return;if(this.Ui().qn(),document.activeElement!==document.body&&document.activeElement!==document.documentElement)p(document.activeElement).blur();else{const t=document.getSelection();null!==t&&t.removeAllRanges()}!this.Jp.pn().Ni()&&this.Ui().yt().Ni()}pm(t){if(null===this.Jp)return;const i=this.Ui(),n=i.yt();if(n.Ni())return;const s=this.Jd.W(),e=s.handleScroll,r=s.kineticScroll;if((!e.pressedMouseMove||t.$v)&&(!e.horzTouchDrag&&!e.vertTouchDrag||!t.$v))return;const h=this.Jp.pn(),l=performance.now();if(null!==this.Wp||this.zm(t)||(this.Wp={x:t.clientX,y:t.clientY,Ld:l,Lm:t.localX,Fm:t.localY}),null!==this.Wp&&!this.Hp&&(this.Wp.x!==t.clientX||this.Wp.y!==t.clientY)){if(t.$v&&r.touch||!t.$v&&r.mouse){const t=n.ue();this.Kp=new Ss(.2/t,7/t,.997,15/t),this.Kp.Mf(n.Yu(),this.Wp.Ld)}else this.Kp=null;h.Ni()||i.E_(this.Jp,h,t.localY),i.ld(t.localX),this.Hp=!0}this.Hp&&(h.Ni()||i.N_(this.Jp,h,t.localY),i.ad(t.localX),null!==this.Kp&&this.Kp.Mf(n.Yu(),l))}}class Us{constructor(t,i,n,s,e){this.vt=!0,this.Jv=os({width:0,height:0}),this.sp=()=>this.Op(3),this.hp="left"===t,this.Lc=n.md,this.dn=i,this.Em=s,this.Nm=e,this._p=document.createElement("div"),this._p.style.width="25px",this._p.style.height="100%",this._p.style.overflow="hidden",this.up=ys(this._p,os({width:16,height:16})),this.up.subscribeSuggestedBitmapSizeChanged(this.sp)}C(){this.up.unsubscribeSuggestedBitmapSizeChanged(this.sp),Cs(this.up.canvasElement),this.up.dispose()}Mp(){return this._p}Cm(){return this.Jv}kp(t){_s(this.Jv,t)||(this.Jv=t,this.up.resizeCanvasElement(t),this._p.style.width=`${t.width}px`,this._p.style.height=`${t.height}px`,this.vt=!0)}Op(t){if(t<3&&!this.vt)return;if(0===this.Jv.width||0===this.Jv.height)return;this.vt=!1,this.up.applySuggestedBitmapSize();const i=vs(this.up);null!==i&&i.useBitmapCoordinateSpace((t=>{this.Dp(t),this.Ee(t)}))}Ip(){return this.up.bitmapSize}Lp(t,i,n){const s=this.Ip();s.width>0&&s.height>0&&t.drawImage(this.up.canvasElement,i,n)}Ee({context:t,bitmapSize:i,horizontalPixelRatio:n,verticalPixelRatio:s}){if(!this.Em())return;t.fillStyle=this.dn.timeScale.borderColor;const e=Math.floor(this.Lc.W().P*n),r=Math.floor(this.Lc.W().P*s),h=this.hp?i.width-e:0;t.fillRect(h,0,e,r)}Dp({context:t,bitmapSize:i}){X(t,0,0,i.width,i.height,this.Nm())}}function qs(t){return i=>{var n,s;return null!==(s=null===(n=i.wa)||void 0===n?void 0:n.call(i,t))&&void 0!==s?s:[]}}const Gs=qs("normal"),Ys=qs("top"),Xs=qs("bottom");class Zs{constructor(t,i){this.jm=null,this.Wm=null,this.k=null,this.Hm=!1,this.Jv=os({width:0,height:0}),this.$m=new T,this.tp=new Jt(5),this.np=!1,this.sp=()=>{this.np||this.Jd.Ut().Zh()},this.rp=()=>{this.np||this.Jd.Ut().Zh()},this.Jd=t,this.K_=i,this.dn=t.W().layout,this.Um=document.createElement("tr"),this.qm=document.createElement("td"),this.qm.style.padding="0",this.Gm=document.createElement("td"),this.Gm.style.padding="0",this._p=document.createElement("td"),this._p.style.height="25px",this._p.style.padding="0",this.Ym=document.createElement("div"),this.Ym.style.width="100%",this.Ym.style.height="100%",this.Ym.style.position="relative",this.Ym.style.overflow="hidden",this._p.appendChild(this.Ym),this.up=ys(this.Ym,os({width:16,height:16})),this.up.subscribeSuggestedBitmapSizeChanged(this.sp);const n=this.up.canvasElement;n.style.position="absolute",n.style.zIndex="1",n.style.left="0",n.style.top="0",this.cp=ys(this.Ym,os({width:16,height:16})),this.cp.subscribeSuggestedBitmapSizeChanged(this.rp);const s=this.cp.canvasElement;s.style.position="absolute",s.style.zIndex="2",s.style.left="0",s.style.top="0",this.Um.appendChild(this.qm),this.Um.appendChild(this._p),this.Um.appendChild(this.Gm),this.Xm(),this.Jd.Ut().C_().l(this.Xm.bind(this),this),this.gp=new Rs(this.cp.canvasElement,this,{bv:()=>!0,wv:()=>!this.Jd.W().handleScroll.horzTouchDrag})}C(){this.gp.C(),null!==this.jm&&this.jm.C(),null!==this.Wm&&this.Wm.C(),this.cp.unsubscribeSuggestedBitmapSizeChanged(this.rp),Cs(this.cp.canvasElement),this.cp.dispose(),this.up.unsubscribeSuggestedBitmapSizeChanged(this.sp),Cs(this.up.canvasElement),this.up.dispose()}Mp(){return this.Um}Zm(){return this.jm}Km(){return this.Wm}Vv(t){if(this.Hm)return;this.Hm=!0;const i=this.Jd.Ut();!i.yt().Ni()&&this.Jd.W().handleScale.axisPressedMouseMove.time&&i.ed(t.localX)}Rv(t){this.Vv(t)}Bv(){const t=this.Jd.Ut();!t.yt().Ni()&&this.Hm&&(this.Hm=!1,this.Jd.W().handleScale.axisPressedMouseMove.time&&t.ud())}xv(t){const i=this.Jd.Ut();!i.yt().Ni()&&this.Jd.W().handleScale.axisPressedMouseMove.time&&i._d(t.localX)}gv(t){this.xv(t)}kv(){this.Hm=!1;const t=this.Jd.Ut();t.yt().Ni()&&!this.Jd.W().handleScale.axisPressedMouseMove.time||t.ud()}yv(){this.kv()}av(){this.Jd.W().handleScale.axisDoubleClickReset.time&&this.Jd.Ut().Kn()}ev(){this.av()}vv(){this.Jd.Ut().W().handleScale.axisPressedMouseMove.time&&this.Fp(1)}Wv(){this.Fp(0)}Cm(){return this.Jv}Jm(){return this.$m}Qm(t,i,n){_s(this.Jv,t)||(this.Jv=t,this.np=!0,this.up.resizeCanvasElement(t),this.cp.resizeCanvasElement(t),this.np=!1,this._p.style.width=`${t.width}px`,this._p.style.height=`${t.height}px`,this.$m.M(t)),null!==this.jm&&this.jm.kp(os({width:i,height:t.height})),null!==this.Wm&&this.Wm.kp(os({width:n,height:t.height}))}tb(){const t=this.ib();return Math.ceil(t.P+t.T+t.O+t.F+t.A+t.nb)}wt(){this.Jd.Ut().yt().Ya()}Ip(){return this.up.bitmapSize}Lp(t,i,n){const s=this.Ip();s.width>0&&s.height>0&&t.drawImage(this.up.canvasElement,i,n)}Op(t){if(0===t)return;if(1!==t){this.up.applySuggestedBitmapSize();const i=vs(this.up);null!==i&&(i.useBitmapCoordinateSpace((t=>{this.Dp(t),this.Ee(t),this.sb(i,Xs)})),this.Bp(i),this.sb(i,Gs)),null!==this.jm&&this.jm.Op(t),null!==this.Wm&&this.Wm.Op(t)}this.cp.applySuggestedBitmapSize();const i=vs(this.cp);null!==i&&(i.useBitmapCoordinateSpace((({context:t,bitmapSize:i})=>{t.clearRect(0,0,i.width,i.height)})),this.eb([...this.Jd.Ut().gt(),this.Jd.Ut().Qc()],i),this.sb(i,Ys))}sb(t,i){const n=this.Jd.Ut().gt();for(const s of n)Ts(i,(i=>ks(i,t,!1,void 0)),s,void 0);for(const s of n)Ts(i,(i=>Ps(i,t,!1,void 0)),s,void 0)}Dp({context:t,bitmapSize:i}){X(t,0,0,i.width,i.height,this.Jd.Ut().Sd())}Ee({context:t,bitmapSize:i,verticalPixelRatio:n}){if(this.Jd.W().timeScale.borderVisible){t.fillStyle=this.rb();const s=Math.max(1,Math.floor(this.ib().P*n));t.fillRect(0,0,i.width,s)}}Bp(t){const i=this.Jd.Ut().yt(),n=i.Ya();if(!n||0===n.length)return;const s=this.K_.maxTickMarkWeight(n),e=this.ib(),r=i.W();r.borderVisible&&r.ticksVisible&&t.useBitmapCoordinateSpace((({context:t,horizontalPixelRatio:i,verticalPixelRatio:s})=>{t.strokeStyle=this.rb(),t.fillStyle=this.rb();const r=Math.max(1,Math.floor(i)),h=Math.floor(.5*i);t.beginPath();const l=Math.round(e.T*s);for(let s=n.length;s--;){const e=Math.round(n[s].coord*i);t.rect(e-h,0,r,l)}t.fill()})),t.useMediaCoordinateSpace((({context:t})=>{const i=e.P+e.T+e.F+e.O/2;t.textAlign="center",t.textBaseline="middle",t.fillStyle=this.U(),t.font=this.yp();for(const e of n)if(e.weight<s){const n=e.needAlignCoordinate?this.hb(t,e.coord,e.label):e.coord;t.fillText(e.label,n,i)}this.Jd.W().timeScale.allowBoldLabels&&(t.font=this.lb());for(const e of n)if(e.weight>=s){const n=e.needAlignCoordinate?this.hb(t,e.coord,e.label):e.coord;t.fillText(e.label,n,i)}}))}hb(t,i,n){const s=this.tp.Si(t,n),e=s/2,r=Math.floor(i-e)+.5;return r<0?i+=Math.abs(0-r):r+s>this.Jv.width&&(i-=Math.abs(this.Jv.width-(r+s))),i}eb(t,i){const n=this.ib();for(const s of t)for(const t of s.tn())t.Mt().Z(i,n)}rb(){return this.Jd.W().timeScale.borderColor}U(){return this.dn.textColor}H(){return this.dn.fontSize}yp(){return F(this.H(),this.dn.fontFamily)}lb(){return F(this.H(),this.dn.fontFamily,"bold")}ib(){null===this.k&&(this.k={P:1,N:NaN,F:NaN,A:NaN,Hi:NaN,T:5,O:NaN,R:"",Wi:new Jt,nb:0});const t=this.k,i=this.yp();if(t.R!==i){const n=this.H();t.O=n,t.R=i,t.F=3*n/12,t.A=3*n/12,t.Hi=9*n/12,t.N=0,t.nb=4*n/12,t.Wi.lr()}return this.k}Fp(t){this._p.style.cursor=1===t?"ew-resize":"default"}Xm(){const t=this.Jd.Ut(),i=t.W();i.leftPriceScale.visible||null===this.jm||(this.qm.removeChild(this.jm.Mp()),this.jm.C(),this.jm=null),i.rightPriceScale.visible||null===this.Wm||(this.Gm.removeChild(this.Wm.Mp()),this.Wm.C(),this.Wm=null);const n={md:this.Jd.Ut().md()},s=()=>i.leftPriceScale.borderVisible&&t.yt().W().borderVisible,e=()=>t.Sd();i.leftPriceScale.visible&&null===this.jm&&(this.jm=new Us("left",i,n,s,e),this.qm.appendChild(this.jm.Mp())),i.rightPriceScale.visible&&null===this.Wm&&(this.Wm=new Us("right",i,n,s,e),this.Gm.appendChild(this.Wm.Mp()))}}const Ks=!!ps&&!!navigator.userAgentData&&navigator.userAgentData.brands.some((t=>t.brand.includes("Chromium")))&&!!ps&&((null===(Js=null===navigator||void 0===navigator?void 0:navigator.userAgentData)||void 0===Js?void 0:Js.platform)?"Windows"===navigator.userAgentData.platform:navigator.userAgent.toLowerCase().indexOf("win")>=0);var Js;class Qs{constructor(t,i,n){var s;this.ab=[],this.ob=0,this.uo=0,this.v_=0,this._b=0,this.ub=0,this.cb=null,this.fb=!1,this.$p=new T,this.Up=new T,this.zc=new T,this.pb=null,this.mb=null,this.bb=t,this.dn=i,this.K_=n,this.Um=document.createElement("div"),this.Um.classList.add("tv-lightweight-charts"),this.Um.style.overflow="hidden",this.Um.style.direction="ltr",this.Um.style.width="100%",this.Um.style.height="100%",(s=this.Um).style.userSelect="none",s.style.webkitUserSelect="none",s.style.msUserSelect="none",s.style.MozUserSelect="none",s.style.webkitTapHighlightColor="transparent",this.wb=document.createElement("table"),this.wb.setAttribute("cellspacing","0"),this.Um.appendChild(this.wb),this.gb=this.Mb.bind(this),te(this.dn)&&this.xb(!0),this.Ui=new Bn(this.Ic.bind(this),this.dn,n),this.Ut().td().l(this.Sb.bind(this),this),this.yb=new Zs(this,this.K_),this.wb.appendChild(this.yb.Mp());const e=i.autoSize&&this.Cb();let r=this.dn.width,h=this.dn.height;if(e||0===r||0===h){const i=t.getBoundingClientRect();r=r||i.width,h=h||i.height}this.kb(r,h),this.Pb(),t.appendChild(this.Um),this.Tb(),this.Ui.yt().oc().l(this.Ui.ia.bind(this.Ui),this),this.Ui.C_().l(this.Ui.ia.bind(this.Ui),this)}Ut(){return this.Ui}W(){return this.dn}Ob(){return this.ab}Rb(){return this.yb}C(){this.xb(!1),0!==this.ob&&window.cancelAnimationFrame(this.ob),this.Ui.td().m(this),this.Ui.yt().oc().m(this),this.Ui.C_().m(this),this.Ui.C();for(const t of this.ab)this.wb.removeChild(t.Mp()),t.Mm().m(this),t.xm().m(this),t.C();this.ab=[],p(this.yb).C(),null!==this.Um.parentElement&&this.Um.parentElement.removeChild(this.Um),this.zc.C(),this.$p.C(),this.Up.C(),this.Db()}kb(t,i,n=!1){if(this.uo===i&&this.v_===t)return;const s=function(t){const i=Math.floor(t.width),n=Math.floor(t.height);return os({width:i-i%2,height:n-n%2})}(os({width:t,height:i}));this.uo=s.height,this.v_=s.width;const e=this.uo+"px",r=this.v_+"px";p(this.Um).style.height=e,p(this.Um).style.width=r,this.wb.style.height=e,this.wb.style.width=r,n?this.Vb(_t.rs(),performance.now()):this.Ui.ia()}Op(t){void 0===t&&(t=_t.rs());for(let i=0;i<this.ab.length;i++)this.ab[i].Op(t.$n(i).jn);this.dn.timeScale.visible&&this.yb.Op(t.Hn())}Xh(t){const i=te(this.dn);this.Ui.Xh(t);const n=te(this.dn);n!==i&&this.xb(n),this.Tb(),this.Bb(t)}Mm(){return this.$p}xm(){return this.Up}td(){return this.zc}zb(){null!==this.cb&&(this.Vb(this.cb,performance.now()),this.cb=null);const t=this.Ab(null),i=document.createElement("canvas");i.width=t.width,i.height=t.height;const n=p(i.getContext("2d"));return this.Ab(n),i}Ib(t){if("left"===t&&!this.Lb())return 0;if("right"===t&&!this.Fb())return 0;if(0===this.ab.length)return 0;return p("left"===t?this.ab[0].Dm():this.ab[0].Vm()).Pp()}Eb(){return this.dn.autoSize&&null!==this.pb}Nb(){return this.Um}dm(t){this.mb=t,this.mb?this.Nb().style.setProperty("cursor",t):this.Nb().style.removeProperty("cursor")}jb(){return this.mb}Wb(){return v(this.ab[0]).Cm()}Bb(t){void 0!==t.autoSize||!this.pb||void 0===t.width&&void 0===t.height?(t.autoSize&&!this.pb&&this.Cb(),!1===t.autoSize&&null!==this.pb&&this.Db(),t.autoSize||void 0===t.width&&void 0===t.height||this.kb(t.width||this.v_,t.height||this.uo)):ws()}Ab(t){let i=0,n=0;const s=this.ab[0],e=(i,n)=>{let s=0;for(let e=0;e<this.ab.length;e++){const r=this.ab[e],h=p("left"===i?r.Dm():r.Vm()),l=h.Ip();null!==t&&h.Lp(t,n,s),s+=l.height}};if(this.Lb()){e("left",0);i+=p(s.Dm()).Ip().width}for(let s=0;s<this.ab.length;s++){const e=this.ab[s],r=e.Ip();null!==t&&e.Lp(t,i,n),n+=r.height}if(i+=s.Ip().width,this.Fb()){e("right",i);i+=p(s.Vm()).Ip().width}const r=(i,n,s)=>{p("left"===i?this.yb.Zm():this.yb.Km()).Lp(p(t),n,s)};if(this.dn.timeScale.visible){const i=this.yb.Ip();if(null!==t){let e=0;this.Lb()&&(r("left",e,n),e=p(s.Dm()).Ip().width),this.yb.Lp(t,e,n),e+=i.width,this.Fb()&&r("right",e,n)}n+=i.height}return os({width:i,height:n})}Hb(){let t=0,i=0,n=0;for(const s of this.ab)this.Lb()&&(i=Math.max(i,p(s.Dm()).Sp(),this.dn.leftPriceScale.minimumWidth)),this.Fb()&&(n=Math.max(n,p(s.Vm()).Sp(),this.dn.rightPriceScale.minimumWidth)),t+=s.k_();i=gs(i),n=gs(n);const s=this.v_,e=this.uo,r=Math.max(s-i-n,0),h=this.dn.timeScale.visible;let l=h?Math.max(this.yb.tb(),this.dn.timeScale.minimumHeight):0;var a;l=(a=l)+a%2;const o=0+l,_=e<o?0:e-o,u=_/t;let c=0;for(let t=0;t<this.ab.length;++t){const s=this.ab[t];s.hm(this.Ui.Kc()[t]);let e=0,h=0;h=t===this.ab.length-1?_-c:Math.round(s.k_()*u),e=Math.max(h,2),c+=e,s.kp(os({width:r,height:e})),this.Lb()&&s.ym(i,"left"),this.Fb()&&s.ym(n,"right"),s.Tp()&&this.Ui.nd(s.Tp(),e)}this.yb.Qm(os({width:h?r:0,height:l}),h?i:0,h?n:0),this.Ui.T_(r),this._b!==i&&(this._b=i),this.ub!==n&&(this.ub=n)}xb(t){t?this.Um.addEventListener("wheel",this.gb,{passive:!1}):this.Um.removeEventListener("wheel",this.gb)}$b(t){switch(t.deltaMode){case t.DOM_DELTA_PAGE:return 120;case t.DOM_DELTA_LINE:return 32}return Ks?1/window.devicePixelRatio:1}Mb(t){if(!(0!==t.deltaX&&this.dn.handleScroll.mouseWheel||0!==t.deltaY&&this.dn.handleScale.mouseWheel))return;const i=this.$b(t),n=i*t.deltaX/100,s=-i*t.deltaY/100;if(t.cancelable&&t.preventDefault(),0!==s&&this.dn.handleScale.mouseWheel){const i=Math.sign(s)*Math.min(1,Math.abs(s)),n=t.clientX-this.Um.getBoundingClientRect().left;this.Ut().rd(n,i)}0!==n&&this.dn.handleScroll.mouseWheel&&this.Ut().hd(-80*n)}Vb(t,i){var n;const s=t.Hn();3===s&&this.Ub(),3!==s&&2!==s||(this.qb(t),this.Gb(t,i),this.yb.wt(),this.ab.forEach((t=>{t.am()})),3===(null===(n=this.cb)||void 0===n?void 0:n.Hn())&&(this.cb.ns(t),this.Ub(),this.qb(this.cb),this.Gb(this.cb,i),t=this.cb,this.cb=null)),this.Op(t)}Gb(t,i){for(const n of t.ts())this.ss(n,i)}qb(t){const i=this.Ui.Kc();for(let n=0;n<i.length;n++)t.$n(n).Wn&&i[n].U_()}ss(t,i){const n=this.Ui.yt();switch(t.Gn){case 0:n.uc();break;case 1:n.cc(t.Vt);break;case 2:n.Jn(t.Vt);break;case 3:n.Qn(t.Vt);break;case 4:n.Ku();break;case 5:t.Vt.rc(i)||n.Qn(t.Vt.hc(i))}}Ic(t){null!==this.cb?this.cb.ns(t):this.cb=t,this.fb||(this.fb=!0,this.ob=window.requestAnimationFrame((t=>{if(this.fb=!1,this.ob=0,null!==this.cb){const i=this.cb;this.cb=null,this.Vb(i,t);for(const n of i.ts())if(5===n.Gn&&!n.Vt.rc(t)){this.Ut().Xn(n.Vt);break}}})))}Ub(){this.Pb()}Pb(){const t=this.Ui.Kc(),i=t.length,n=this.ab.length;for(let t=i;t<n;t++){const t=v(this.ab.pop());this.wb.removeChild(t.Mp()),t.Mm().m(this),t.xm().m(this),t.C()}for(let s=n;s<i;s++){const i=new $s(this,t[s]);i.Mm().l(this.Yb.bind(this),this),i.xm().l(this.Xb.bind(this),this),this.ab.push(i),this.wb.insertBefore(i.Mp(),this.yb.Mp())}for(let n=0;n<i;n++){const i=t[n],s=this.ab[n];s.Tp()!==i?s.hm(i):s.rm()}this.Tb(),this.Hb()}Zb(t,i,n){var s;const e=new Map;if(null!==t){this.Ui.gt().forEach((i=>{const n=i.In().cl(t);null!==n&&e.set(i,n)}))}let r;if(null!==t){const i=null===(s=this.Ui.yt().qi(t))||void 0===s?void 0:s.originalTime;void 0!==i&&(r=i)}const h=this.Ut().qc(),l=null!==h&&h.Yc instanceof Gi?h.Yc:void 0,a=null!==h&&void 0!==h.Xv?h.Xv.kr:void 0;return{Kb:r,ae:null!=t?t:void 0,Jb:null!=i?i:void 0,Qb:l,tw:e,iw:a,nw:null!=n?n:void 0}}Yb(t,i,n){this.$p.M((()=>this.Zb(t,i,n)))}Xb(t,i,n){this.Up.M((()=>this.Zb(t,i,n)))}Sb(t,i,n){this.zc.M((()=>this.Zb(t,i,n)))}Tb(){const t=this.dn.timeScale.visible?"":"none";this.yb.Mp().style.display=t}Lb(){return this.ab[0].Tp().z_().W().visible}Fb(){return this.ab[0].Tp().A_().W().visible}Cb(){return"ResizeObserver"in window?(this.pb=new ResizeObserver((t=>{const i=t.find((t=>t.target===this.bb));i&&this.kb(i.contentRect.width,i.contentRect.height)})),this.pb.observe(this.bb,{box:"border-box"}),!0):(ws(),!1)}Db(){null!==this.pb&&this.pb.disconnect(),this.pb=null}}function te(t){return Boolean(t.handleScroll.mouseWheel||t.handleScale.mouseWheel)}function ie(t){return void 0!==t.open||void 0!==t.value}function ne(t,i){var n={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&i.indexOf(s)<0&&(n[s]=t[s]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var e=0;for(s=Object.getOwnPropertySymbols(t);e<s.length;e++)i.indexOf(s[e])<0&&Object.prototype.propertyIsEnumerable.call(t,s[e])&&(n[s[e]]=t[s[e]])}return n}Object.create;Object.create;function se(t,i,n,s){const e=n.value,r={ae:i,_t:t,Vt:[e,e,e,e],Kb:s};return void 0!==n.color&&(r.V=n.color),void 0!==n.borderColor&&(r.Bt=n.borderColor),r}function ee(t,i,n,s){const e=n.value,r={ae:i,_t:t,Vt:[e,e,e,e],Kb:s};return void 0!==n.lineColor&&(r.ot=n.lineColor),void 0!==n.topColor&&(r.Ts=n.topColor),void 0!==n.bottomColor&&(r.Os=n.bottomColor),r}function re(t,i,n,s){const e=n.value,r={ae:i,_t:t,Vt:[e,e,e,e],Kb:s};return void 0!==n.topLineColor&&(r.Be=n.topLineColor),void 0!==n.bottomLineColor&&(r.ze=n.bottomLineColor),void 0!==n.topFillColor1&&(r.Te=n.topFillColor1),void 0!==n.topFillColor2&&(r.Oe=n.topFillColor2),void 0!==n.bottomFillColor1&&(r.Re=n.bottomFillColor1),void 0!==n.bottomFillColor2&&(r.De=n.bottomFillColor2),r}function he(t,i,n,s){const e={ae:i,_t:t,Vt:[n.open,n.high,n.low,n.close],Kb:s};return void 0!==n.color&&(e.V=n.color),e}function le(t,i,n,s){const e={ae:i,_t:t,Vt:[n.open,n.high,n.low,n.close],Kb:s};return void 0!==n.color&&(e.V=n.color),void 0!==n.borderColor&&(e.Bt=n.borderColor),void 0!==n.wickColor&&(e.tl=n.wickColor),e}function ae(t,i,n,s,e){const r=v(e)(n),h=Math.max(...r),l=Math.min(...r),a=r[r.length-1],o=[a,h,l,a],_=n,{time:u,color:c}=_;return{ae:i,_t:t,Vt:o,Kb:s,Ye:ne(_,["time","color"]),V:c}}function oe(t){return void 0!==t.Vt}function _e(t,i){return void 0!==i.customValues&&(t.sw=i.customValues),t}function ue(t){return(i,n,s,e,r,h)=>function(t,i){return i?i(t):void 0===(n=t).open&&void 0===n.value;var n}(s,h)?_e({_t:i,ae:n,Kb:e},s):_e(t(i,n,s,e,r),s)}function ce(t){return{Candlestick:ue(le),Bar:ue(he),Area:ue(ee),Baseline:ue(re),Histogram:ue(se),Line:ue(se),Custom:ue(ae)}[t]}function de(t){return{ae:0,ew:new Map,ca:t}}function fe(t,i){if(void 0!==t&&0!==t.length)return{rw:i.key(t[0]._t),hw:i.key(t[t.length-1]._t)}}function ve(t){let i;return t.forEach((t=>{void 0===i&&(i=t.Kb)})),v(i)}class pe{constructor(t){this.lw=new Map,this.aw=new Map,this.ow=new Map,this._w=[],this.K_=t}C(){this.lw.clear(),this.aw.clear(),this.ow.clear(),this._w=[]}uw(t,i){let n=0!==this.lw.size,s=!1;const e=this.aw.get(t);if(void 0!==e)if(1===this.aw.size)n=!1,s=!0,this.lw.clear();else for(const i of this._w)i.pointData.ew.delete(t)&&(s=!0);let r=[];if(0!==i.length){const n=i.map((t=>t.time)),e=this.K_.createConverterToInternalObj(i),h=ce(t.el()),l=t.Da(),a=t.Va();r=i.map(((i,r)=>{const o=e(i.time),_=this.K_.key(o);let u=this.lw.get(_);void 0===u&&(u=de(o),this.lw.set(_,u),s=!0);const c=h(o,u.ae,i,n[r],l,a);return u.ew.set(t,c),c}))}n&&this.cw(),this.dw(t,r);let h=-1;if(s){const t=[];this.lw.forEach((i=>{t.push({timeWeight:0,time:i.ca,pointData:i,originalTime:ve(i.ew)})})),t.sort(((t,i)=>this.K_.key(t.time)-this.K_.key(i.time))),h=this.fw(t)}return this.pw(t,h,function(t,i,n){const s=fe(t,n),e=fe(i,n);if(void 0!==s&&void 0!==e)return{ra:s.hw>=e.hw&&s.rw>=e.rw}}(this.aw.get(t),e,this.K_))}gd(t){return this.uw(t,[])}mw(t,i){const n=i;!function(t){void 0===t.Kb&&(t.Kb=t.time)}(n),this.K_.preprocessData(i);const s=this.K_.createConverterToInternalObj([i])(i.time),e=this.ow.get(t);if(void 0!==e&&this.K_.key(s)<this.K_.key(e))throw new Error(`Cannot update oldest data, last time=${e}, new time=${s}`);let r=this.lw.get(this.K_.key(s));const h=void 0===r;void 0===r&&(r=de(s),this.lw.set(this.K_.key(s),r));const l=ce(t.el()),a=t.Da(),o=t.Va(),_=l(s,r.ae,i,n.Kb,a,o);r.ew.set(t,_),this.bw(t,_);const u={ra:oe(_)};if(!h)return this.pw(t,-1,u);const c={timeWeight:0,time:r.ca,pointData:r,originalTime:ve(r.ew)},d=Ot(this._w,this.K_.key(c.time),((t,i)=>this.K_.key(t.time)<i));this._w.splice(d,0,c);for(let t=d;t<this._w.length;++t)me(this._w[t].pointData,t);return this.K_.fillWeightsForPoints(this._w,d),this.pw(t,d,u)}bw(t,i){let n=this.aw.get(t);void 0===n&&(n=[],this.aw.set(t,n));const s=0!==n.length?n[n.length-1]:null;null===s||this.K_.key(i._t)>this.K_.key(s._t)?oe(i)&&n.push(i):oe(i)?n[n.length-1]=i:n.splice(-1,1),this.ow.set(t,i._t)}dw(t,i){0!==i.length?(this.aw.set(t,i.filter(oe)),this.ow.set(t,i[i.length-1]._t)):(this.aw.delete(t),this.ow.delete(t))}cw(){for(const t of this._w)0===t.pointData.ew.size&&this.lw.delete(this.K_.key(t.time))}fw(t){let i=-1;for(let n=0;n<this._w.length&&n<t.length;++n){const s=this._w[n],e=t[n];if(this.K_.key(s.time)!==this.K_.key(e.time)){i=n;break}e.timeWeight=s.timeWeight,me(e.pointData,n)}if(-1===i&&this._w.length!==t.length&&(i=Math.min(this._w.length,t.length)),-1===i)return-1;for(let n=i;n<t.length;++n)me(t[n].pointData,n);return this.K_.fillWeightsForPoints(t,i),this._w=t,i}ww(){if(0===this.aw.size)return null;let t=0;return this.aw.forEach((i=>{0!==i.length&&(t=Math.max(t,i[i.length-1].ae))})),t}pw(t,i,n){const s={gw:new Map,yt:{Hu:this.ww()}};if(-1!==i)this.aw.forEach(((i,e)=>{s.gw.set(e,{Ye:i,Mw:e===t?n:void 0})})),this.aw.has(t)||s.gw.set(t,{Ye:[],Mw:n}),s.yt.xw=this._w,s.yt.Sw=i;else{const i=this.aw.get(t);s.gw.set(t,{Ye:i||[],Mw:n})}return s}}function me(t,i){t.ae=i,t.ew.forEach((t=>{t.ae=i}))}function be(t){const i={value:t.Vt[3],time:t.Kb};return void 0!==t.sw&&(i.customValues=t.sw),i}function we(t){const i=be(t);return void 0!==t.V&&(i.color=t.V),i}function ge(t){const i=be(t);return void 0!==t.ot&&(i.lineColor=t.ot),void 0!==t.Ts&&(i.topColor=t.Ts),void 0!==t.Os&&(i.bottomColor=t.Os),i}function Me(t){const i=be(t);return void 0!==t.Be&&(i.topLineColor=t.Be),void 0!==t.ze&&(i.bottomLineColor=t.ze),void 0!==t.Te&&(i.topFillColor1=t.Te),void 0!==t.Oe&&(i.topFillColor2=t.Oe),void 0!==t.Re&&(i.bottomFillColor1=t.Re),void 0!==t.De&&(i.bottomFillColor2=t.De),i}function xe(t){const i={open:t.Vt[0],high:t.Vt[1],low:t.Vt[2],close:t.Vt[3],time:t.Kb};return void 0!==t.sw&&(i.customValues=t.sw),i}function Se(t){const i=xe(t);return void 0!==t.V&&(i.color=t.V),i}function ye(t){const i=xe(t),{V:n,Bt:s,tl:e}=t;return void 0!==n&&(i.color=n),void 0!==s&&(i.borderColor=s),void 0!==e&&(i.wickColor=e),i}function Ce(t){return{Area:ge,Line:we,Baseline:Me,Histogram:we,Bar:Se,Candlestick:ye,Custom:ke}[t]}function ke(t){const i=t.Kb;return Object.assign(Object.assign({},t.Ye),{time:i})}const Pe={vertLine:{color:"#9598A1",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#131722"},horzLine:{color:"#9598A1",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#131722"},mode:1},Te={vertLines:{color:"#D6DCDE",style:0,visible:!0},horzLines:{color:"#D6DCDE",style:0,visible:!0}},Oe={background:{type:"solid",color:"#FFFFFF"},textColor:"#191919",fontSize:12,fontFamily:L()},Re={autoScale:!0,mode:0,invertScale:!1,alignLabels:!0,borderVisible:!0,borderColor:"#2B2B43",entireTextOnly:!1,visible:!1,ticksVisible:!1,scaleMargins:{bottom:.1,top:.2},minimumWidth:0},De={rightOffset:0,barSpacing:6,minBarSpacing:.5,fixLeftEdge:!1,fixRightEdge:!1,lockVisibleTimeRangeOnResize:!1,rightBarStaysOnScroll:!1,borderVisible:!0,borderColor:"#2B2B43",visible:!0,timeVisible:!1,secondsVisible:!0,shiftVisibleRangeOnNewBar:!0,allowShiftVisibleRangeOnWhitespaceReplacement:!1,ticksVisible:!1,uniformDistribution:!1,minimumHeight:0,allowBoldLabels:!0},Ve={color:"rgba(0, 0, 0, 0)",visible:!1,fontSize:48,fontFamily:L(),fontStyle:"",text:"",horzAlign:"center",vertAlign:"center"};function Be(){return{width:0,height:0,autoSize:!1,layout:Oe,crosshair:Pe,grid:Te,overlayPriceScales:Object.assign({},Re),leftPriceScale:Object.assign(Object.assign({},Re),{visible:!1}),rightPriceScale:Object.assign(Object.assign({},Re),{visible:!0}),timeScale:De,watermark:Ve,localization:{locale:ps?navigator.language:"",dateFormat:"dd MMM 'yy"},handleScroll:{mouseWheel:!0,pressedMouseMove:!0,horzTouchDrag:!0,vertTouchDrag:!0},handleScale:{axisPressedMouseMove:{time:!0,price:!0},axisDoubleClickReset:{time:!0,price:!0},mouseWheel:!0,pinch:!0},kineticScroll:{mouse:!1,touch:!0},trackingMode:{exitMode:1}}}class ze{constructor(t,i){this.yw=t,this.Cw=i}applyOptions(t){this.yw.Ut().Xc(this.Cw,t)}options(){return this.Fi().W()}width(){return ot(this.Cw)?this.yw.Ib(this.Cw):0}Fi(){return p(this.yw.Ut().Zc(this.Cw)).Dt}}function Ae(t,i,n){const{time:s,originalTime:e}=t,r=ne(t,["time","originalTime"]),h=Object.assign({time:i},r);return void 0!==n&&(h.originalTime=n),h}var Ie;!function(t){t[t.Buy=1]="Buy",t[t.Sell=-1]="Sell"}(Ie||(Ie={}));let Le=null;class Fe{constructor(){this.Lt=null}tt(t){this.Lt=t}draw(t){t.useBitmapCoordinateSpace((t=>{if(!this.Lt||null===this.Lt.st||null===this.Lt.kw)return;const i=t.context,{Pw:n,Tw:s,Ow:e,Rw:r}=(Le||(Le={Pw:new Path2D("M2.75 13.5333H11.25C11.9588 13.5333 12.5333 12.9588 12.5333 12.25V5.00918C12.5333 4.58443 12.3232 4.1872 11.972 3.94823L7.39384 0.832512C7.15619 0.670777 6.84381 0.670777 6.60616 0.832512L2.02797 3.94823C1.67682 4.1872 1.46667 4.58443 1.46667 5.00918V12.25C1.46667 12.9588 2.04124 13.5333 2.75 13.5333Z"),Tw:new Path2D("M2.5 8.85h2.76c1.23 0 2.28-.78 2.28-2.11 0-1-.66-1.53-1.14-1.72v-.07c.55-.3.89-.85.89-1.55 0-1.08-.82-1.9-2.24-1.9H2.5v7.35ZM3.6 4.6V2.47h1.38c.7 0 1.18.4 1.18 1.04 0 .65-.48 1.09-1.2 1.09H3.6Zm0 3.28v-2.4h1.35c.74 0 1.41.35 1.41 1.19S5.8 7.88 5.02 7.88H3.6Z"),Ow:new Path2D("M7.9 6.8c0 .5-.1.9-.4 1.2-.2.3-.5.6-1 .7-.3.2-.8.3-1.3.3-.7 0-1.4-.2-2-.5-.5-.3-.8-.8-1-1.3l1-.5c.1.4.4.7.7 1 .4.2.8.3 1.3.3s.9 0 1.1-.3c.3-.1.4-.4.4-.7 0-.3 0-.5-.3-.7-.1-.2-.3-.3-.6-.4l-1-.3L3.6 5c-.3 0-.5-.3-.8-.5-.2-.3-.3-.6-.3-1 0-.5.1-.9.4-1.2.2-.3.5-.5 1-.7l1.3-.2a3 3 0 0 1 1.7.4c.4.3.7.7.9 1.1l-1 .5c-.3-.7-.8-1-1.6-1-.5 0-.8 0-1.1.2-.3.2-.4.5-.4.8 0 .2 0 .4.2.5l.6.4 1 .3 1.2.4.8.6c.3.3.4.7.4 1.1Z"),Rw:new Map}),Le),h=this.Lt.Dw===Ie.Sell?"#eb4b6d":"#31bd65",l=14,{st:a,kw:o,Dw:_,t:u,Vw:c,Bw:d,Kt:f,zw:v}=this.Lt;!function(t,i,n,s,e,r,h,l){t.save(),t.scale(i,n),t.translate(s,e),t.translate(-r/2,0),l(t),t.restore()}(i,t.horizontalPixelRatio,t.verticalPixelRatio,a,o,14,0,(t=>{const i=_!==Ie.Buy;let a;if(t.save(),i&&(t.rotate(Math.PI),t.translate(-14,0)),t.fillStyle=u||h,t.fill(n),c?(r.has(c)||r.set(c,new Path2D(c)),a=r.get(c)):a=i?e:s,i&&(t.translate(14,l),t.rotate(Math.PI),t.translate(0,-2)),t.translate(0,1),t.translate(2,2),t.fillStyle=d||"#FFFFFF",t.fill(a),t.restore(),f){const n=i?-14:l;t.textAlign="center",t.textBaseline=i?"bottom":"top",t.fillStyle=v||"#000000",t.translate(7,n),t.fillText(f,0,0)}}))}))}Cr(t,i){if(!this.Lt||null===this.Lt.st||null===this.Lt.kw)return null;const n=this.Lt.Dw!==Ie.Buy;let s=this.Lt.st-7,e=this.Lt.kw-(n?14:0);return t>=s&&t<=s+14&&i>=e&&i<=e+14}}class Ee{constructor(t){this.Ls=!0,this.Kd=t,this.qs=new Fe}wt(){this.Ls=!0}renderer(){return this.Us(),this.qs}Us(){this.Ls&&(this.Js(),this.Ls=!1)}Js(){this.Qd()}Qd(){var t;const i=this.Kd.data(),n=this.Kd._series,s=this.Kd._chart.timeScale().timeToCoordinate(i.time),e=null!==(t=n.priceToCoordinate(i.price))&&void 0!==t?t:0;this.qs.tt({st:s,kw:e,Dw:i.side,Kt:i.text,zw:i.textColor,Vw:i.icon,Bw:i.iconColor,t:i.background})}}class Ne{constructor(t,i,n){this.Aw=null,this.ef=t=>{this.rf(t)},this._chart=t,this._series=i,this.Lt=n,this.hf=[new Ee(this)],this._chart.subscribeCrosshairMove(this.ef),this._chart.subscribeClick(this.ef),this.Aw=ns(this.Lt.tooltip,this._chart.chartElement())}data(){return this.Lt}updateAllViews(){this.hf.forEach((t=>t.wt()))}paneViews(){return this.hf}attached({requestUpdate:t}){this.requestUpdate=t}detached(){var t,i;this.requestUpdate=void 0,this.Iw(),null===(t=this._chart)||void 0===t||t.unsubscribeCrosshairMove(this.ef),null===(i=this._chart)||void 0===i||i.unsubscribeClick(this.ef)}applyOptions(t){var i;O(this.Lt,null!=t?t:{}),null===(i=this.requestUpdate)||void 0===i||i.call(this)}rf(t){const{point:i}=t;if(this.Lt&&i)for(const t of this.hf){const n=t.renderer();if(null!==n&&n.Cr){n.Cr(i.x,i.y)?this.Iw({st:i.x,et:i.y}):this.Iw()}}}Iw(t){if(this.Lt.tooltip&&this.Aw)if(t){const{renderContent:i}=this.Lt.tooltip,n=this._chart.chartElement(),s=i(),e=this._chart.options().leftPriceScale.visible?this._chart.priceScale("left").width():0;ss(this.Aw,n,s,t,e)}else this.Aw.style.display="none"}setText(t){var i;t&&(O(this.Lt,{text:t}),null===(i=this.requestUpdate)||void 0===i||i.call(this))}setTextColor(t){var i;t&&(O(this.Lt,{textColor:t}),null===(i=this.requestUpdate)||void 0===i||i.call(this))}setIcon(t){var i;t&&(O(this.Lt,{icon:t}),null===(i=this.requestUpdate)||void 0===i||i.call(this))}setIconColor(t){var i;t&&(O(this.Lt,{iconColor:t}),null===(i=this.requestUpdate)||void 0===i||i.call(this))}setBackground(t){var i;t&&(O(this.Lt,{background:t}),null===(i=this.requestUpdate)||void 0===i||i.call(this))}setTooltip(t){var i;t&&t.renderContent&&(O(this.Lt,{tooltip:t}),null===(i=this.requestUpdate)||void 0===i||i.call(this))}}const je={color:"#FF0000",price:0,lineStyle:2,lineWidth:1,lineVisible:!0,axisLabelVisible:!0,title:"",axisLabelColor:"",axisLabelTextColor:""};class We{constructor(t){this.$h=t}applyOptions(t){this.$h.Xh(t)}options(){return this.$h.W()}Lw(){return this.$h}}class He{constructor(t,i,n,s,e){this.Fw=new T,this.Ew=[],this.Ws=t,this.Nw=i,this.jw=n,this.K_=e,this.Ww=s}C(){this.Fw.C()}priceFormatter(){return this.Ws.Sa()}priceToCoordinate(t){const i=this.Ws.Pt();return null===i?null:this.Ws.Dt().Rt(t,i.Vt)}coordinateToPrice(t){const i=this.Ws.Pt();return null===i?null:this.Ws.Dt().mn(t,i.Vt)}barsInLogicalRange(t){if(null===t)return null;const i=new Mn(new bn(t.from,t.to)).cu(),n=this.Ws.In();if(n.Ni())return null;const s=n.cl(i.Is(),1),e=n.cl(i.ci(),-1),r=p(n.ol()),h=p(n.An());if(null!==s&&null!==e&&s.ae>e.ae)return{barsBefore:t.from-r,barsAfter:h-t.to};const l={barsBefore:null===s||s.ae===r?t.from-r:s.ae-r,barsAfter:null===e||e.ae===h?h-t.to:h-e.ae};return null!==s&&null!==e&&(l.from=s.Kb,l.to=e.Kb),l}setData(t){this.K_,this.Ws.el(),this.Nw.Hw(this.Ws,t),this.$w("full")}update(t){this.Ws.el(),this.Nw.Uw(this.Ws,t),this.$w("update")}dataByIndex(t,i){const n=this.Ws.In().cl(t,i);if(null===n)return null;return Ce(this.seriesType())(n)}data(){const t=Ce(this.seriesType());return this.Ws.In().he().map((i=>t(i)))}subscribeDataChanged(t){this.Fw.l(t)}unsubscribeDataChanged(t){this.Fw.p(t)}setMarkers(t){this.K_;const i=t.map((t=>Ae(t,this.K_.convertHorzItemToInternal(t.time),t.time)));this.Ws.la(i)}markers(){return this.Ws.aa().map((t=>Ae(t,t.originalTime,void 0)))}setCustomMarkers(t){Array.isArray(t)&&(this.customMarkers().forEach((t=>{this.detachPrimitive(t)})),this.Ew=t.map((t=>{const i=new Ne(this.Ww,this,t);return this.attachPrimitive(i),i})),this.Ws.Ut().ia())}customMarkers(){return this.Ew}applyOptions(t){this.Ws.Xh(t)}options(){return z(this.Ws.W())}priceScale(){return this.jw.priceScale(this.Ws.Dt().Ba())}createPriceLine(t){const i=O(z(je),t),n=this.Ws.oa(i);return new We(n)}removePriceLine(t){this.Ws._a(t.Lw())}seriesType(){return this.Ws.el()}attachPrimitive(t){this.Ws.Oa(t),t.attached&&t.attached({chart:this.Ww,series:this,requestUpdate:()=>this.Ws.Ut().ia()})}detachPrimitive(t){this.Ws.Ra(t),t.detached&&t.detached()}$w(t){this.Fw.S()&&this.Fw.M(t)}}class $e{constructor(t,i,n){this.qw=new T,this.xu=new T,this.$m=new T,this.Ui=t,this.Rl=t.yt(),this.yb=i,this.Rl.lc().l(this.Gw.bind(this)),this.Rl.ac().l(this.Yw.bind(this)),this.yb.Jm().l(this.Xw.bind(this)),this.K_=n}C(){this.Rl.lc().m(this),this.Rl.ac().m(this),this.yb.Jm().m(this),this.qw.C(),this.xu.C(),this.$m.C()}scrollPosition(){return this.Rl.Yu()}scrollToPosition(t,i){i?this.Rl.ec(t,1e3):this.Ui.Qn(t)}scrollToRealTime(){this.Rl.sc()}getVisibleRange(){const t=this.Rl.Iu();return null===t?null:{from:t.from.originalTime,to:t.to.originalTime}}setVisibleRange(t){const i={from:this.K_.convertHorzItemToInternal(t.from),to:this.K_.convertHorzItemToInternal(t.to)},n=this.Rl.Nu(i);this.Ui.Md(n)}getVisibleLogicalRange(){const t=this.Rl.Au();return null===t?null:{from:t.Is(),to:t.ci()}}setVisibleLogicalRange(t){f(t.from<=t.to,"The from index cannot be after the to index."),this.Ui.Md(t)}resetTimeScale(){this.Ui.Kn()}fitContent(){this.Ui.uc()}logicalToCoordinate(t){const i=this.Ui.yt();return i.Ni()?null:i.It(t)}coordinateToLogical(t){return this.Rl.Ni()?null:this.Rl.$u(t)}timeToCoordinate(t){const i=this.K_.convertHorzItemToInternal(t),n=this.Rl.Ia(i,!1);return null===n?null:this.Rl.It(n)}coordinateToTime(t){const i=this.Ui.yt(),n=i.$u(t),s=i.qi(n);return null===s?null:s.originalTime}width(){return this.yb.Cm().width}height(){return this.yb.Cm().height}subscribeVisibleTimeRangeChange(t){this.qw.l(t)}unsubscribeVisibleTimeRangeChange(t){this.qw.p(t)}subscribeVisibleLogicalRangeChange(t){this.xu.l(t)}unsubscribeVisibleLogicalRangeChange(t){this.xu.p(t)}subscribeSizeChange(t){this.$m.l(t)}unsubscribeSizeChange(t){this.$m.p(t)}applyOptions(t){this.Rl.Xh(t)}options(){return Object.assign(Object.assign({},z(this.Rl.W())),{barSpacing:this.Rl.ue()})}Gw(){this.qw.S()&&this.qw.M(this.getVisibleRange())}Yw(){this.xu.S()&&this.xu.M(this.getVisibleLogicalRange())}Xw(t){this.$m.M(t.width,t.height)}}function Ue(t){if(void 0===t||"custom"===t.type)return;const i=t;void 0!==i.minMove&&void 0===i.precision&&(i.precision=function(t){if(t>=1)return 0;let i=0;for(;i<8;i++){const n=Math.round(t);if(Math.abs(n-t)<1e-8)return i;t*=10}return i}(i.minMove))}function qe(t){return function(t){if(B(t.handleScale)){const i=t.handleScale;t.handleScale={axisDoubleClickReset:{time:i,price:i},axisPressedMouseMove:{time:i,price:i},mouseWheel:i,pinch:i}}else if(void 0!==t.handleScale){const{axisPressedMouseMove:i,axisDoubleClickReset:n}=t.handleScale;B(i)&&(t.handleScale.axisPressedMouseMove={time:i,price:i}),B(n)&&(t.handleScale.axisDoubleClickReset={time:n,price:n})}const i=t.handleScroll;B(i)&&(t.handleScroll={horzTouchDrag:i,vertTouchDrag:i,mouseWheel:i,pressedMouseMove:i})}(t),t}class Ge{constructor(t,i,n){this.Zw=new Map,this.Kw=new Map,this.Jw=new T,this.Qw=new T,this.tg=new T,this.ig=new pe(i);const s=void 0===n?z(Be()):O(z(Be()),qe(n));this.K_=i,this.yw=new Qs(t,s,i),this.yw.Mm().l((t=>{this.Jw.S()&&this.Jw.M(this.ng(t()))}),this),this.yw.xm().l((t=>{this.Qw.S()&&this.Qw.M(this.ng(t()))}),this),this.yw.td().l((t=>{this.tg.S()&&this.tg.M(this.ng(t()))}),this);const e=this.yw.Ut();this.sg=new $e(e,this.yw.Rb(),this.K_)}remove(){this.yw.Mm().m(this),this.yw.xm().m(this),this.yw.td().m(this),this.sg.C(),this.yw.C(),this.Zw.clear(),this.Kw.clear(),this.Jw.C(),this.Qw.C(),this.tg.C(),this.ig.C()}resize(t,i,n){this.autoSizeActive()?ws():this.yw.kb(t,i,n)}addCustomSeries(t,i){const n=m(t),s=Object.assign(Object.assign({},a),n.defaultOptions());return this.eg("Custom",s,i,n)}addAreaSeries(t){return this.eg("Area",r,t)}addBaselineSeries(t){return this.eg("Baseline",h,t)}addBarSeries(t){return this.eg("Bar",s,t)}addCandlestickSeries(t={}){return function(t){void 0!==t.borderColor&&(t.borderUpColor=t.borderColor,t.borderDownColor=t.borderColor),void 0!==t.wickColor&&(t.wickUpColor=t.wickColor,t.wickDownColor=t.wickColor)}(t),this.eg("Candlestick",n,t)}addHistogramSeries(t){return this.eg("Histogram",l,t)}addLineSeries(t){return this.eg("Line",e,t)}removeSeries(t){const i=v(this.Zw.get(t)),n=this.ig.gd(i);this.yw.Ut().gd(i),this.rg(n),this.Zw.delete(t),this.Kw.delete(i)}Hw(t,i){this.rg(this.ig.uw(t,i))}Uw(t,i){this.rg(this.ig.mw(t,i))}subscribeTooltip(t){const{className:i,style:n,renderHTML:s,inside:e}=t,r=document.createElement("div");r.className=i||"",r.style=`\n\t\t\t${Qn}\n\t\t\t${n||""}\n\t\t`;const h=this.chartElement();h.style.position="relative",h.appendChild(r);const l=t=>{if(void 0===t.point||!t.time||t.point.x<0||t.point.x>h.clientWidth||t.point.y<0||t.point.y>h.clientHeight)r.style.display="none";else{const i=6e4*(new Date).getTimezoneOffset(),n=1e3*t.time+i;es(r,s(Object.assign(Object.assign({},t),{time:n}))),r.style.display="block";const l=r.clientWidth,a=r.clientHeight;let o,_;const u=this.options().leftPriceScale.visible?this.priceScale("left").width():0,c=t.point.y;o=t.point.x+15+u,o>h.clientWidth-l&&(o=t.point.x-15-l+u),_=c+15,_>h.clientHeight-a&&(_=c-a-15),e&&(o=Math.max(0,Math.min(h.clientWidth-l,o)),_=Math.max(0,Math.min(h.clientHeight-a,_))),r.style.left=`${o}px`,r.style.top=`${_}px`}};return this.subscribeCrosshairMove(l),()=>{this.unsubscribeCrosshairMove(l)}}subscribeClick(t){this.Jw.l(t)}unsubscribeClick(t){this.Jw.p(t)}subscribeCrosshairMove(t){this.tg.l(t)}unsubscribeCrosshairMove(t){this.tg.p(t)}subscribeDblClick(t){this.Qw.l(t)}unsubscribeDblClick(t){this.Qw.p(t)}priceScale(t){return new ze(this.yw,t)}timeScale(){return this.sg}applyOptions(t){this.yw.Xh(qe(t))}options(){return this.yw.W()}takeScreenshot(){return this.yw.zb()}autoSizeActive(){return this.yw.Eb()}chartElement(){return this.yw.Nb()}paneSize(){const t=this.yw.Wb();return{height:t.height,width:t.width}}setCrosshairPosition(t,i,n){const s=this.Zw.get(n);if(void 0===s)return;const e=this.yw.Ut().wr(s);null!==e&&this.yw.Ut().fd(t,i,e)}clearCrosshairPosition(){this.yw.Ut().vd(!0)}eg(t,i,n={},s){Ue(n.priceFormat);const e=O(z(o),z(i),n),r=this.yw.Ut().bd(t,e,s),h=new He(r,this,this,this,this.K_);return this.Zw.set(h,r),this.Kw.set(r,h),h}rg(t){const i=this.yw.Ut();i.pd(t.yt.Hu,t.yt.xw,t.yt.Sw),t.gw.forEach(((t,i)=>i.tt(t.Ye,t.Mw))),i.qu()}hg(t){return v(this.Kw.get(t))}ng(t){const i=new Map;t.tw.forEach(((t,n)=>{const s=n.el(),e=Ce(s)(t);if("Custom"!==s)f(ie(e));else{const t=n.Va();f(!t||!1===t(e))}i.set(this.hg(n),e)}));const n=void 0===t.Qb?void 0:this.hg(t.Qb);return{time:t.Kb,logical:t.ae,point:t.Jb,hoveredSeries:n,hoveredObjectId:t.iw,seriesData:i,sourceEvent:t.nw}}}const Ye={color:"#BBBBBB",lineWidth:1};class Xe{constructor(){this.Lt=null}lg(t,i,n,s){return s.map(((e,r)=>{const h=n-r*(2*Math.PI/s.length);return{st:t+e*Math.cos(h),et:i+e*Math.sin(h)}}))}ag(t,i,n){const{Ye:s,Gd:e}=this.Lt,r=i/2,h=n/2;s.forEach((i=>{const n=this.lg(r,h,e,i.value);t.save(),t.strokeStyle=i.lineStyle.color,t.lineWidth=i.lineStyle.lineWidth,t.beginPath(),n.forEach(((i,n)=>{t[n?"lineTo":"moveTo"](i.st,i.et)})),t.closePath(),t.stroke(),i.areaStyle&&(t.fillStyle=i.areaStyle.color,t.fill()),t.restore();const{pointMarkerStyle:s}=i;s&&(t.save(),n.forEach((i=>{t.fillStyle=s.color,t.beginPath(),t.arc(i.st,i.et,s.radius,0,2*Math.PI),t.fill()})),t.restore())}))}og(t,i,n){const{_g:s,ug:e}=this.Lt;0!==s.length&&(t.save(),t.textAlign="center",t.textBaseline="top",n.forEach(((n,r)=>{const h=s[r],l=h.map((i=>is(t,i)));let a=0,o=0;l.forEach((t=>{a=Math.max(a,t.$i),o+=t.At}));const _=function(t,i,n,s,e){const r=n-t,h=s-i,l=Math.sqrt(r*r+h*h);return{st:n+r/l*e,et:s+h/l*e}}(i.st,i.et,n.st,n.et,e);let u,c;n.st<i.st+20&&n.st>i.st-20?(u=i.st,c=n.et<i.et?_.et-o:_.et):n.st<i.st?(u=_.st-a/2,c=_.et-o/2):(u=_.st+a/2,c=_.et-o/2),h.forEach((i=>{const n=is(t,i);t.fillStyle=i.color,t.fillText(i.text,u,c),c+=n.At}))})),t.restore())}tt(t){this.Lt=t}draw(t){t.useMediaCoordinateSpace((t=>{if(!this.Lt)return;const{cg:i,Gd:n,lt:s,dg:e,fg:r,vg:h}=this.Lt;if(i.length<3)return;const l=t.context,a=t.mediaSize.width,o=t.mediaSize.height,_=a/2,u=o/2;let c=null;l.save(),l.strokeStyle=e.lineStyle.color,l.lineWidth=e.lineStyle.lineWidth;const d=Math.max(1,r);for(let t=1;t<=d;t++){const r=s*(t/d),h=this.lg(_,u,n,Array(i.length).fill(r));t===d&&(c=h),e.show&&(l.beginPath(),h.forEach(((t,i)=>{l[i?"lineTo":"moveTo"](t.st,t.et)})),l.closePath(),l.stroke())}l.restore(),c&&(h.show&&(l.save(),l.strokeStyle=h.lineStyle.color,l.lineWidth=h.lineStyle.lineWidth,l.beginPath(),c.forEach((t=>{l.moveTo(_,u),l.lineTo(t.st,t.et)})),l.stroke(),l.restore()),this.ag(l,a,o),this.og(l,{st:_,et:u},c))}))}}class Ze{constructor(t,i){this.Ls=!0,this.Kd=t,this.Jd=i,this.qs=new Xe}wt(){this.Ls=!0}renderer(){return this.Us(),this.qs}Us(){this.Ls&&(this.Js(),this.Ls=!1)}Js(){this.Qd()}pg(){const t=this.Kd.data(),{label:i,indicator:n,data:s}=t,{formatter:e}=i;return e?n.map(((t,i)=>{const n=s.map((t=>t.value[i]));return e(t,n).map((t=>Object.assign(Object.assign({},Jn),t)))})):[]}mg(t){const i=this.Kd.data(),{data:n,indicator:s}=i;return n.map((i=>{if(i.value.length!==s.length)throw new Error("Data length must be equal to indicator length");return{value:i.value.map(((i,n)=>t*(i/s[n].max))),lineStyle:Object.assign(Object.assign({},Ye),i.lineStyle||{}),areaStyle:i.areaStyle,pointMarkerStyle:i.pointMarkerStyle}}))}Qd(){const t=this.Kd.data(),i=this.Jd.paneSize(),{width:n,height:s}=i,{indicator:e}=t,r=Math.min(n,s)/2,h=ts(t.radius,r),l={Ye:this.mg(h),Gd:-t.startAngle*(Math.PI/180),cg:e,lt:h,fg:t.splitNumber,vg:t.axisLine,dg:t.splitLine,_g:this.pg(),ug:t.nameGap};this.qs.tt(l)}}class Ke{constructor(t,i){this.Jd=t,this.Lt=i,this.hf=[new Ze(this,t)]}remove(){this.Jd.remove()}data(){return this.Lt}updateAllViews(){this.hf.forEach((t=>t.wt()))}paneViews(){return this.hf}attached({requestUpdate:t}){this.requestUpdate=t}detached(){this.requestUpdate=void 0}applyOptions(t){var i;O(this.Lt,null!=t?t:{}),null===(i=this.requestUpdate)||void 0===i||i.call(this)}}const Je=-1,Qe={upShadowColor:"#07FF4D",downShadowColor:"#FC46AB",upColor:"#BCFF2F",downColor:"#FC46AB",gridStyle:{gridSize:4,gridGap:1},data:[],showMaxMinValue:!0,maxMinLabel:Object.assign({},{color:"rgba(255, 255, 255, 0.36)",fontSize:10,margin:3,lineHeight:12,fontWeight:500}),crosshairLabel:Object.assign({},{color:"#909090",fontSize:10,margin:1,lineHeight:12,fontWeight:500}),backgroundColor:"#000"},tr={value:0,time:0};function ir(t){return t.length<=1?0===t.length?[tr,tr]:[t[0],t[0]]:t}const nr={bg:80,wg:[{gg:.75,_t:0},{gg:0,_t:20},{gg:.4,_t:40},{gg:0,_t:60},{gg:1,_t:80}],Mg:700},sr=400;class er{constructor(){this.Lt=null}tt(t){this.Lt=t}draw(t){t.useMediaCoordinateSpace((t=>{if(!this.Lt)return;const i=t.context,n=t.mediaSize.width,s=t.mediaSize.height;this.Dp(i,n,s),i.save(),i.globalAlpha=this.Lt.xg,this.Sg(i,n,s),this.yg(i,n,s),i.restore(),this.Cg(i,n,s),i.globalAlpha=1,this.kg(i),i.globalAlpha=this.Lt.xg,this.Pg(i,n),this.Tg(i,n,s)}))}Tm(t,i,n,s,e){const{Og:r,Rg:h}=this.Lt,l=Math.min(h/2);let a=r+l;for(t.lineWidth=h,s&&t.setLineDash(s);a<n;)t.beginPath(),t.moveTo(0,a),t.lineTo(i,a),t.stroke(),a+=h+r;e&&t.setLineDash(e);let o=r+l;for(;o<i;)t.beginPath(),t.moveTo(o,0),t.lineTo(o,n),t.stroke(),o+=h+r}Dp(t,i,n){const{Tt:s}=this.Lt;t.fillStyle=s,t.fillRect(0,0,i,n)}yg(t,i,n){t.save(),this.Dg({Vg:t,$i:i,At:n,Bg:"up"});const{zg:s,Tt:e,Rg:r,Og:h}=this.Lt,{Ag:l,Ig:a}=s;t.fillStyle=e,t.fillRect(0,0,i,n);const o=t.createLinearGradient(0,0,0,n);o.addColorStop(0,l),o.addColorStop(1,a),t.strokeStyle=o,this.Tm(t,i,n,void 0,[h,r]),t.restore()}Sg(t,i,n){const{Lg:s,Tt:e}=this.Lt,{Ag:r,Ig:h}=s;t.save(),this.Dg({Vg:t,$i:i,At:n,Bg:"down"});const l=t.createLinearGradient(0,0,0,n);l.addColorStop(0,r),l.addColorStop(1,h),t.fillStyle=l,t.fillRect(0,0,i,n),t.strokeStyle=e,this.Tm(t,i,n),t.restore()}Dg({Vg:t,$i:i,At:n,Bg:s}){const{Fg:e}=this.Lt;t.beginPath(),e.forEach(((i,n)=>{t[n?"lineTo":"moveTo"](i.st,i.et)})),"up"===s?(t.lineTo(i,0),t.lineTo(0,0)):(t.lineTo(i,n),t.lineTo(0,n)),t.closePath(),t.clip()}kg(t){const{Eg:i,Og:n,Ng:s,jg:e,Wg:r}=this.Lt;t.shadowOffsetX=0,t.shadowOffsetY=0,i.forEach((i=>{let h=1!==i.opacity&&void 0!==i.opacity?[16]:[4,16];r&&i.st>r.st&&(h=[0]),h.forEach((r=>{var h,l;t.shadowColor=k(e,null!==(h=i.opacity)&&void 0!==h?h:1),t.shadowBlur=r,t.fillStyle=k(s,null!==(l=i.opacity)&&void 0!==l?l:1),t.fillRect(i.st,i.et,n,n)})),t.shadowBlur=0}))}Cg(t,i,n){const{Tt:s}=this.Lt,e=t.createLinearGradient(0,0,i,0);e.addColorStop(0,s),e.addColorStop(.25,k(s,0)),e.addColorStop(.75,k(s,0)),e.addColorStop(1,s),t.fillStyle=e,t.fillRect(0,0,i,n)}Pg(t,i){const{zh:n,Bh:s,Og:e,Hg:r,Wg:h}=this.Lt;if(!n||!s||h)return;const{fontSize:l,lineHeight:a,fontWeight:o,margin:_}=r;t.font=F(l,void 0,o.toString()),t.textBaseline="top",t.fillStyle=r.color;const u=t.measureText(n.Kt).width,c=l>=a?0:(a-l)/2;t.fillText(n.Kt,this.$g(n.st+e/2-u/2,u,i),n.et-_-l-c);const d=t.measureText(s.Kt).width;t.fillText(s.Kt,this.$g(s.st+e/2-d/2,d,i),s.et+e+r.margin+c)}$g(t,i,n){return t>-i&&t<n?Math.min(Math.max(0,t),n-i):t}Rm(t,i){const{Ng:n,Og:s,Wg:e,Ug:r}=this.Lt,{lineHeight:h,fontSize:l,margin:a}=r;t.strokeStyle=n,t.lineWidth=1,t.setLineDash([3,3]),t.beginPath();const o=Math.round(e.st+s/2);t.moveTo(o,0),t.lineTo(o,i-a-Math.max(h,l)),t.stroke()}qg(t,i,n){const{Tt:s,Wg:e,Og:r}=this.Lt,{st:h}=e,l=h+r/2,a=k(s,.2);t.fillStyle=a,t.fillRect(0,0,l,n);const o=k(s,.5);t.fillStyle=o,t.fillRect(l,0,i-l,n)}Gg(t,i){const{Yg:n,Ng:s,Ug:e,Hg:r,jg:h}=this.Lt;if(!n)return;const{st:l,et:a,$i:o,At:_}=n,{lineHeight:u}=e;let c=a;a+_+u>i?c=i-_-u:a<r.lineHeight&&(c=u),t.shadowOffsetX=0,t.shadowOffsetY=0;[4,16].forEach((i=>{t.shadowColor=h,t.shadowBlur=i,t.fillStyle=s,t.fillRect(l,c,o,_)})),t.shadowBlur=0}Ap(t,i,n){const{Xg:s,Wg:e,Ug:r,Og:h}=this.Lt;if(!s)return;const{fontSize:l,fontWeight:a,lineHeight:o}=r;t.font=F(l,void 0,a.toString()),t.textBaseline="top",t.fillStyle=r.color;const _=t.measureText(s).width,u=l>=o?l:l+(o-l)/2;t.fillText(s,this.$g(e.st+h/2-_/2,_,i),n-u)}Tg(t,i,n){const{Wg:s}=this.Lt;s&&(this.Rm(t,n),this.qg(t,i,n),this.Gg(t,n),this.Ap(t,i,n))}}class rr{constructor(t,i){this.Ls=!0,this.Kd=t,this.qs=new er}wt(){this.Ls=!0}renderer(){return this.Us(),this.qs}Us(){this.Ls&&(this.Js(),this.Ls=!1)}Js(){this.Qd()}Zg(){var t,i;const{maxValueInfo:n,minValueInfo:s,getCol:e,getRow:r}=this.Kd,{data:h,maxMinLabel:l,showMaxMinValue:a}=this.Kd.data();if(!a||!n||!s)return null;const o=(null===(t=l.formatter)||void 0===t?void 0:t.call(l,h[n.index]))||`${n.value}`,_=(null===(i=l.formatter)||void 0===i?void 0:i.call(l,h[s.index]))||`${s.value}`,u=this.Kg(r(n.index),e(n.index)),c=this.Kg(r(s.index),e(s.index));return{zh:{Kt:o,st:u.st,et:u.et},Bh:{Kt:_,st:c.st,et:c.et}}}Kg(t,i){const n=this.Kd.data(),{gridStyle:s}=n,{gridSize:e,gridGap:r}=s;return{st:i*(e+r),et:t*(e+r)}}Jg(){const{initEnd:t,allHighlightPoints:i}=this.Kd;return i.map((i=>{var n;return Object.assign(Object.assign({},this.Kg(i.row,i.col)),{opacity:null!==(n=i.opacity)&&void 0!==n?n:t?1:0})}))}Qg(){const{sortedPoints:t}=this.Kd,{gridSize:i,gridGap:n}=this.Kd.data().gridStyle,s=[],e=t[0][0],r=n+i;s.push({st:0,et:e*r});for(let n=0;n<t.length;n++){const e=n,h=t[n][0];if(n===t.length-1)s.push({st:e*r+i,et:h*r});else{const l=n+1,a=t[l][0];a<h?(s.push({st:l*r,et:h*r}),s.push({st:l*r,et:a*r})):a>h?(s.push({st:e*r+i,et:h*r}),s.push({st:e*r+i,et:a*r}),s.push({st:l*r,et:a*r})):s.push({st:l*r,et:a*r})}}return s}tM(){const{hoverIndex:t,getCol:i,getRow:n}=this.Kd;if(t!==Je)return this.Kg(n(t),i(t))}iM(){const{sortedPoints:t,hoverIndex:i,getCol:n}=this.Kd;if(i===Je)return;const{gridSize:s,gridGap:e}=this.Kd.data().gridStyle,r=n(i),h=t[r],l=h[0],a=h[h.length-1],o=this.Kg(l,r),_=this.Kg(a,r),u=h.length<=2?h.length+2:h.length,c=3*s/2,d=u*s+(u-1)*e,f=o.st+s/2,v=o.et+(_.et+s-o.et)/2;return{st:Math.round(f-c/2),et:Math.round(v-d/2),$i:c,At:d}}nM(){var t;const{hoverIndex:i}=this.Kd;if(i===Je)return;const{data:n,crosshairLabel:s}=this.Kd.data();return(null===(t=s.formatter)||void 0===t?void 0:t.call(s,n[i]))||`${n[i].time}`}Qd(){const{useUpColor:t,backgroundOpacity:i}=this.Kd,{gridStyle:n,maxMinLabel:s,crosshairLabel:e,upColor:r,downColor:h,backgroundColor:l,upShadowColor:a,downShadowColor:o}=this.Kd.data(),_=this.Zg(),u=t?r:h,c={Tt:l,xg:i,Ng:u,jg:t?a:o,Rg:n.gridGap,Og:n.gridSize,Lg:{Ag:k(u,.24),Ig:k(u,0)},zg:{Ag:k(u,0),Ig:k(u,.24)},Fg:this.Qg(),Eg:this.Jg(),zh:null==_?void 0:_.zh,Bh:null==_?void 0:_.Bh,Hg:s,Ug:e,Wg:this.tM(),Yg:this.iM(),Xg:this.nM()};this.qs.tt(c)}}function hr(t,i){const{bg:n,wg:s}=nr;t||(t=i);const e=i-t,r=s.find(((t,i)=>{const n=s[i+1];return!n||e>=t._t&&e<n._t}));return{gg:null==r?void 0:r.gg,sM:e>n}}class lr{constructor(t,i){this.initEnd=!1,this.sortedPoints=[],this.minValueInfo=null,this.maxValueInfo=null,this.useUpColor=!0,this.hoverIndex=Je,this.yAxisTopMarginGrids=0,this.yAxisBottomMarginGrids=0,this.allHighlightPoints=[],this.backgroundOpacity=0,this.eM=0,this.rM=0,this.hM=[],this.lM=[],this.aM=!0,this.oM=null,this.getCol=t=>{const i=this.Lt.data.length;return 0===t?0:t===i-1?this.eM-1:Math.round(t*(this.eM-1)/(i-1))},this.getRow=t=>{if(!this.maxValueInfo||!this.minValueInfo)return 0;const{value:i}=this.Lt.data[t]||{};let n=0;const s=this.maxValueInfo.value-this.minValueInfo.value;return n=s?(i-this.minValueInfo.value)/s:.5,this.yAxisTopMarginGrids+Math.floor((1-n)*(this.rM-this.yAxisBottomMarginGrids-this.yAxisTopMarginGrids-1))},this.ef=t=>{this.aM||this.rf(t)},this.Jd=t,this.Lt=i,this.hf=[new rr(this,t)],this.uv(),this.Jd.subscribeCrosshairMove(this.ef),this.Jd.subscribeClick(this.ef),this._M(),this.uM()}data(){return this.Lt}updateAllViews(){const t=this.Jd.paneSize();this.cM(t,this.dM)&&this.uv(),this.hf.forEach((t=>{var i;return null===(i=t.wt)||void 0===i?void 0:i.call(t)}))}paneViews(){return this.hf}attached({requestUpdate:t}){this.requestUpdate=t}detached(){this.requestUpdate=void 0}applyOptions(t){var i;this.aM?this.oM=t:(O(this.Lt,t),this.Lt.data&&(this.Lt.data=ir(this.Lt.data)),this.uv(),this.updateAllViews(),null===(i=this.requestUpdate)||void 0===i||i.call(this))}cM(t,i){return(null==i?void 0:i.width)!==t.width||(null==i?void 0:i.height)!==t.height}uv(){this.dM=this.Jd.paneSize(),this.fM(),this.vM();const{pM:t,he:i}=this.mM();this.eM=t,this.rM=i;const n=this.bM();this.hM=n,this.allHighlightPoints=this.wM(),this.sortedPoints=this.gM(),this.hoverIndex=Je,this.useUpColor=this.MM()}vM(){const{data:t}=this.Lt;let i=Object.assign(Object.assign({},t[0]),{index:0}),n=Object.assign(Object.assign({},t[t.length-1]),{index:t.length-1});t.forEach(((t,s)=>{t.value>i.value&&(i=Object.assign(Object.assign({},t),{index:s})),t.value<n.value&&(n=Object.assign(Object.assign({},t),{index:s}))})),this.maxValueInfo=i,this.minValueInfo=n}mM(){const{width:t,height:i}=this.Jd.paneSize(),{gridStyle:n}=this.Lt,{gridGap:s,gridSize:e}=n;return{pM:Math.floor((t+s)/(e+s)),he:Math.floor((i+s)/(e+s))}}fM(){const{maxMinLabel:t,crosshairLabel:i,gridStyle:n}=this.Lt,{gridSize:s}=n,e=Math.max(t.lineHeight,t.fontSize),r=Math.max(i.lineHeight,i.fontSize);this.yAxisTopMarginGrids=Math.ceil(e/s),this.yAxisBottomMarginGrids=Math.ceil(Math.max(r,e)/s)}bM(){const{data:t}=this.Lt;return t.map(((t,i)=>({col:this.getCol(i),row:this.getRow(i)})))}wM(){const t=this.hM,i=[];return t.forEach(((n,s)=>{i.push(n),s<t.length-1&&i.push(...this.xM(n,t[s+1]))})),Array.from(new Map(i.map((t=>[t.col+","+t.row,t]))).values())}gM(){const{allHighlightPoints:t}=this,i=[];for(let n=0;n<t.length;n++){const s=t[n];i[s.col]||(i[s.col]=[]),i[s.col].push(s.row)}return i.forEach((t=>t.sort(((t,i)=>t-i)))),i}xM(t,i){let{col:n,row:s}=t,{col:e,row:r}=i;r<s&&(n+=1);const h=n=>{const{row:s,col:e}=n;return s===t.row&&e===t.col||s===i.row&&e===i.col};let l=Number.MAX_VALUE,a=0;n!==e&&(l=(r-s)/(e-n),a=s-l*n);const o=[];if(n===e||Math.abs(l)>1e4){s>r&&([s,r]=[r,s]);for(let t=s;t<=r;t++){const i={col:n,row:t};h(i)||o.push(i)}}else if(s===r){n>e&&([n,e]=[e,n]);for(let t=n;t<=e;t++){const i={col:t,row:s};h(i)||o.push(i)}}else{for(let t=Math.min(s,r);t<=Math.max(s,r);t++){const i={col:Math.floor((t-a)/l),row:t};h(i)||o.push(i)}for(let t=Math.min(n,e);t<=Math.max(n,e);t++){const i={col:t,row:Math.floor(l*t+a)};h(i)||o.push(i)}}return o}MM(){var t,i;return(null===(t=this.Lt.data[this.Lt.data.length-1])||void 0===t?void 0:t.value)>=(null===(i=this.Lt.data[0])||void 0===i?void 0:i.value)}rf(t){var i,n,s,e,r,h,l;const{point:a}=t;if(!a)return this.hoverIndex=Je,this.useUpColor=this.MM(),null===(i=this.requestUpdate)||void 0===i||i.call(this),void(null===(s=(n=this.Lt).onHover)||void 0===s||s.call(n));const o=this.SM(a);if(o!==this.hoverIndex){this.hoverIndex=this.SM(a);const{value:t}=this.Lt.data[o];this.useUpColor=t>=(null===(e=this.Lt.data[0])||void 0===e?void 0:e.value),null===(h=(r=this.Lt).onHover)||void 0===h||h.call(r,this.Lt.data[o]),null===(l=this.requestUpdate)||void 0===l||l.call(this)}}SM(t){const i=t.x;let n=Je,s=1/0;return this.hM.forEach(((t,e)=>{const r=this.yM(e),h=Math.abs(i-r);h<s&&(s=h,n=e)})),n}CM(t){const{col:i}=this.hM[t]||{},{gridGap:n,gridSize:s}=this.Lt.gridStyle;return i*(n+s)}yM(t){const i=this.CM(t),{gridSize:n}=this.Lt.gridStyle;return i+n/2}_M(){const t=performance.now(),i=()=>{var n;const s=performance.now()-t,e=Math.min(s/sr,1);this.backgroundOpacity=e,e<1?requestAnimationFrame(i):this.backgroundOpacity=1,null===(n=this.requestUpdate)||void 0===n||n.call(this)};i()}uM(){const{allHighlightPoints:t}=this,i=t.length,n=Array.from({length:i},((t,i)=>i));n.sort((()=>Math.random()-.5));const s=performance.now(),e=()=>{var t;const i=performance.now(),r=(i-s)/nr.Mg,h=Math.min(Math.floor(n.length*r),n.length-1);for(let t=0;t<=h;t++){const s=n[t],e=this.lM[t]||i;this.lM[t]=e;const{gg:r=1,sM:h}=hr(e,i);this.allHighlightPoints[s].opacity=r,this.aM=!(h&&t===n.length-1)}null===(t=this.requestUpdate)||void 0===t||t.call(this),this.aM?requestAnimationFrame(e):(this.initEnd=!0,this.oM&&(this.applyOptions(this.oM),this.oM=null))};e()}}const ar={size:5,color:"#000000",borderColor:"#FFFFFF",borderSize:1,hoverColor:"#FFFFFF",hoverBorderColor:"#000000",hoverBorderSize:1};class or{constructor(){this.Lt=null,this.Hd=null}tt(t){this.Lt=t}draw(t){t.useMediaCoordinateSpace((t=>{if(!this.Lt)return;this.Hd=t;const{xw:i}=this.Lt,n=t.context;i.forEach((t=>{n.beginPath(),n.arc(t.st,t.et,t.te/2,0,2*Math.PI),n.fillStyle=t.V,n.fill(),n.strokeStyle=t.Bt,n.lineWidth=t.P,n.stroke()}))}))}Cr(t,i){if(!this.Lt||!this.Hd)return null;const{xw:n}=this.Lt;let s=null;for(let e=0;e<n.length;e++){const r=n[e],h=t-r.st,l=i-r.et;Math.sqrt(h*h+l*l)<=r.te/2&&(s=[r.kM,r.ae])}return s}}class _r{constructor(t,i){this.Ls=!0,this.Kd=t,this.Jd=i,this.qs=new or}wt(){this.Ls=!0}renderer(){return this.Us(),this.qs}Us(){this.Ls&&(this.Js(),this.Ls=!1)}Js(){this.Qd()}Qd(){const t=this.Kd.data(),i=this.Jd.paneSize(),{width:n}=i,s=[],{max:e,min:r}=t.xAxis;this.Kd.points.forEach(((t,i)=>{const{source:h,style:l}=t;h.forEach(((t,h)=>{const a=(t.time-r)/(e-r)*n,o=this.Kd.lineSeries.priceToCoordinate(t.value)||0,_=Object.assign(Object.assign({},ar),l||{}),u=this.Kd.hoverSourceIndex===i&&this.Kd.hoverIndex===h;s.push({st:a,et:o,te:_.size,V:u?_.hoverColor:_.color,Bt:u?_.hoverBorderColor:_.borderColor,P:u?_.hoverBorderSize:_.borderSize,kM:i,ae:h})}))}));const h={xw:s};this.qs.tt(h)}}class ur{constructor(t,i,n){this.points=[],this.hoverSourceIndex=null,this.hoverIndex=null,this.PM=null,this.TM=null,this.Aw=null,this.OM=t=>{t.forEach((t=>{null===this.PM||null===this.TM?(this.PM=t.value,this.TM=t.value):(this.PM=Math.max(this.PM,t.value),this.TM=Math.min(this.TM,t.value))}))},this.ef=t=>{this.rf(t)},this.Jd=t,this.Lt=n,this.lineSeries=i,this.hf=[new _r(this,t)],this.Jd.subscribeCrosshairMove(this.ef),this.Jd.subscribeClick(this.ef),this.Aw=ns(this.Lt.tooltip,this.Jd.chartElement())}addPoints(t){var i;this.points.push(t),this.RM(t.source),null===(i=this.requestUpdate)||void 0===i||i.call(this)}clear(){var t;this.points=[],this.PM=null,this.TM=null,null===(t=this.requestUpdate)||void 0===t||t.call(this)}remove(){this.Jd.remove()}data(){return this.Lt}updateAllViews(){this.hf.forEach((t=>t.wt()))}paneViews(){return this.hf}attached({requestUpdate:t}){this.requestUpdate=t}detached(){this.requestUpdate=void 0}applyOptions(t){var i;O(this.Lt,null!=t?t:{}),null===(i=this.requestUpdate)||void 0===i||i.call(this)}RM(t){const{max:i,min:n,interval:s}=this.Lt.xAxis;if(this.OM(t),null===this.PM||null===this.TM)return;const e=[];for(let t=n;t<=i;t+=s)e.push({time:t,value:t===n?this.PM:this.TM});this.lineSeries.setData(e),this.Jd.timeScale().setVisibleLogicalRange({from:.5,to:e.length-1.5})}rf(t){var i,n,s;const{point:e}=t;if(!e)return this.hoverSourceIndex=null,this.hoverIndex=null,this.Iw(),void(null===(i=this.requestUpdate)||void 0===i||i.call(this));const r=this.hf[0].renderer();if(null!==r&&r.Cr){const t=r.Cr(e.x,e.y);t?this.hoverSourceIndex===t[0]&&this.hoverIndex===t[1]||(this.hoverSourceIndex=t[0],this.hoverIndex=t[1],this.Iw({DM:this.points[t[0]].source[t[1]],st:e.x,et:e.y}),null===(n=this.requestUpdate)||void 0===n||n.call(this)):null===this.hoverSourceIndex&&null===this.hoverIndex||(this.hoverSourceIndex=null,this.hoverIndex=null,this.Iw(),null===(s=this.requestUpdate)||void 0===s||s.call(this))}}Iw(t){if(this.Lt.tooltip&&this.Aw)if(t){const{renderContent:i}=this.Lt.tooltip,n=this.Jd.chartElement(),s=i(t.DM),e=this.Jd.options().leftPriceScale.visible?this.Jd.priceScale("left").width():0;ss(this.Aw,n,s,t,e)}else this.Aw.style.display="none"}}class cr{constructor(){this.Lt=null}tt(t){this.Lt=t}draw(t){t.useMediaCoordinateSpace((t=>{if(!this.Lt)return;const{VM:i,Ds:n,BM:s}=this.Lt,e=t.context;for(let t=0;t<i.length;t++){const r=i[t];if(e.fillStyle=r.V,e.fillRect(s,r.et,r.$i,r.At),t>0){const h=i[t-1];e.fillStyle=n,e.moveTo(s,r.et),e.lineTo(s+r.$i,r.et),e.lineTo(s+h.$i,h.et+h.At),e.lineTo(s,h.et+h.At),e.closePath(),e.fill()}}}))}}class dr{constructor(t,i){this.Ls=!0,this.Kd=t,this.Jd=i,this.qs=new cr}wt(){this.Ls=!0}renderer(){return this.Us(),this.qs}Us(){this.Ls&&(this.Js(),this.Ls=!1)}Js(){this.Qd()}Qd(){const{histogramData:t}=this.Kd;if(0===t.length)return;const{xScaleMaxValue:i,xScaleMinValue:n}=this.Kd;if(null===i||null===n)return;const{yScaleMargin:s,shadowColor:e}=this.Kd.data(),r=this.Jd.paneSize(),{height:h}=r,l=h-2*s-t.reduce(((t,i)=>t+i.height),0),a=Math.round(l/(t.length-1)),o=this.Jd.timeScale(),_=o.timeToCoordinate(n),u=o.timeToCoordinate(i);if(null===_||null===u)return;const c=u-_;let d=s;const f=t.map((t=>{const s={et:d,At:t.height,$i:Math.round(t.value/(i-n)*c),V:t.color};return d+=a+t.height,s}));this.qs.tt({VM:f,Ds:e,BM:_})}}class fr{constructor(t,i,n){this.histogramData=[],this.xScaleMaxValue=null,this.xScaleMinValue=null,this.Jd=t,this.Lt=n,this.lineSeries=i,this.hf=[new dr(this,t)]}setData(t){var i;this.histogramData=t,this.zM(),this.RM(),null===(i=this.requestUpdate)||void 0===i||i.call(this)}remove(){this.Jd.remove()}data(){return this.Lt}updateAllViews(){this.hf.forEach((t=>t.wt()))}paneViews(){return this.hf}attached({requestUpdate:t}){this.requestUpdate=t}detached(){this.requestUpdate=void 0}applyOptions(t){var i;O(this.Lt,null!=t?t:{}),null===(i=this.requestUpdate)||void 0===i||i.call(this)}AM(){return 0===this.histogramData.length?null:Math.max(...this.histogramData.map((t=>t.value)))}zM(){const{xAxis:t}=this.Lt,{rightMargin:i}=t,n=this.AM();0!==n&&null!==n&&(this.xScaleMaxValue=t.max||n*(1+i),this.xScaleMinValue=t.min||0)}IM(){const{xAxis:t}=this.Lt,{splitNumber:i}=t,{xScaleMaxValue:n,xScaleMinValue:s}=this;if(null===n||null===s)return[0,1,2,3,4];const e=i-1,r=(n-s)/e,h=[];for(let t=0;t<e;t++)h.push(s+t*r);return h.push(n),h}RM(){const t=this.IM(),i=[];for(let n=0;n<t.length;n++)i.push({time:t[n],value:n?100:0});this.lineSeries.setData(i);const n=this.Jd.timeScale(),s=i.length-1.5;n.setVisibleLogicalRange({from:.5,to:s}),requestAnimationFrame((()=>{const t=.5-2/n.options().barSpacing;n.setVisibleLogicalRange({from:t,to:s})}))}}function vr(t,i,n){let s;if(V(t)){const i=document.getElementById(t);f(null!==i,`Cannot find element in DOM with id=${t}`),s=i}else s=t;const e=new Ge(s,i,n);return i.setOptions(e.options()),e}function pr(t,i){return vr(t,new Kn,Kn.Nd(i))}const mr={autoSize:!0,handleScroll:!1,handleScale:!1},br={vertLine:{visible:!1,labelVisible:!1},horzLine:{visible:!1,labelVisible:!1}},wr=Object.assign(Object.assign({layout:{background:{color:"transparent"}}},mr),{timeScale:{visible:!1},crosshair:br,rightPriceScale:{visible:!1}}),gr={lineVisible:!1,pointMarkersVisible:!1,lastValueVisible:!1,priceLineVisible:!1,crosshairMarkerVisible:!1};function Mr(t,i){const n=vr(t,new Kn,wr),s=n.addLineSeries(),e=new as(n,function(t){return O({name:"",color:["#5470c6","#91cc75","#fac858","#ee6666","#73c0de","#3ba272","#fc8452","#9a60b4","#ea7ccc"],radius:[0,"75%"],legend:{top:"top",left:"center",orient:"horizontal"},emptyCircleStyle:{color:"#F2F2F2"},data:[],defaultHighlightDataIndex:null,padAngle:0,minAngle:0,startAngle:0,itemStyle:{borderColor:"#FFFFFF",borderWidth:0},emphasis:{scaleSize:6,label:{show:!1,defaultRich:null,formatter:null}}},null!=t?t:{})}(i));return s.attachPrimitive(e),e}function xr(t,i){const n=vr(t,new Kn,wr),s=n.addLineSeries(),e=new Ke(n,function(t){return O({radius:"75%",startAngle:90,splitNumber:4,axisLine:{show:!0,lineStyle:{color:"#BBBBBB",lineWidth:1}},splitLine:{show:!0,lineStyle:{color:"#BBBBBB",lineWidth:1}},indicator:[],data:[],label:{formatter:null},nameGap:15},null!=t?t:{})}(i));return s.attachPrimitive(e),e}function Sr(t,i){const n=vr(t,new Kn,wr),s=n.addLineSeries(),e=new lr(n,function(t){const i=O({},Qe,t||{});return i.data=ir(i.data),i}(i));return s.attachPrimitive(e),e}function yr(t,i,n){const s=vr(t,i,O(Object.assign(Object.assign({},mr),{timeScale:{lockVisibleTimeRangeOnResize:!0,borderVisible:!1},crosshair:br}),n||{})),e=function(t){return O({xAxis:{max:0,min:100,interval:20}},null!=t?t:{})}(n),r=s.addLineSeries(gr),h=new ur(s,r,e);return r.attachPrimitive(h),h}function Cr(t,i){const n=Object.assign(Object.assign({},mr),{rightPriceScale:{visible:!1,scaleMargins:{top:0,bottom:0}},grid:{vertLines:{visible:!0},horzLines:{visible:!1}},timeScale:{lockVisibleTimeRangeOnResize:!0,borderVisible:!1,allowBoldLabels:!1,tickMarkMaxCharacterLength:3,tickMarkFormatter:t=>`${t}`},crosshair:br}),s=vr(t,new Kn,O(n,i||{})),e=function(t){return O({xAxis:{splitNumber:5,rightMargin:.1},yScaleMargin:10,shadowColor:"#FFFFFF20"},null!=t?t:{})}(i),r=s.addLineSeries(Object.assign({},gr)),h=new fr(s,r,e);return r.attachPrimitive(h),h}const kr=Object.assign(Object.assign({},o),a);function Pr(){return"0.0.43"}return window.LightweightCharts=i,{}})()));